<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>Byte/Bit Order</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item" href>BACK</div><div class="a-block nav-link-item"><a href=/posts>所有文章</a></div><div class="a-block nav-link-item"><a href=/tags>Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%ad%97%e8%8a%82%e5%ba%8f%e4%b8%8e%e6%af%94%e7%89%b9%e5%ba%8f aria-label=字节序与比特序>字节序与比特序</a></li><li><a href=#%e5%ad%97%e8%8a%82%e5%ba%8f%e4%b8%8e%e6%af%94%e7%89%b9%e5%ba%8f%e8%bd%ac%e6%8d%a2 aria-label=字节序与比特序转换>字节序与比特序转换</a><ul><li><a href=#%e5%ad%97%e8%8a%82%e5%ba%8f%e8%bd%ac%e6%8d%a2 aria-label=字节序转换>字节序转换</a></li><li><a href=#%e6%af%94%e7%89%b9%e5%ba%8f%e8%bd%ac%e6%8d%a2 aria-label=比特序转换>比特序转换</a></li></ul></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>Byte/Bit Order</div></header><h1 id=字节序与比特序>字节序与比特序</h1><p>字节序又称大小段，网络中传输的是大端，在CPU上处理的一般是小端。</p><h1 id=字节序与比特序转换>字节序与比特序转换</h1><h2 id=字节序转换>字节序转换</h2><h2 id=比特序转换>比特序转换</h2><p>两种方法，一种直接法，<strong>另外有一种优化的技巧</strong>。</p><p>（1）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Bit reverse
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#50fa7b>bit_reverse</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> x)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> newx <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>8</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    newx <span style=color:#ff79c6>|=</span> (((x <span style=color:#ff79c6>&gt;&gt;</span> i) <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>&lt;&lt;</span> (<span style=color:#bd93f9>7</span><span style=color:#ff79c6>-</span>i));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  <span style=color:#ff79c6>return</span> newx;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><p>(2) <a href=https://mp.weixin.qq.com/s/KNUH_RmIhUHhuSZLSmN4LQ>https://mp.weixin.qq.com/s/KNUH_RmIhUHhuSZLSmN4LQ</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Bit reverse(faster)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4>// 碟式交换法
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#50fa7b>bit_reverse_faster</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> x)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  x <span style=color:#ff79c6>=</span> (x<span style=color:#ff79c6>&lt;&lt;</span><span style=color:#bd93f9>4</span>) <span style=color:#ff79c6>|</span> (x<span style=color:#ff79c6>&gt;&gt;</span><span style=color:#bd93f9>4</span>); <span style=color:#6272a4>// [ 5678 1234 ]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>  x <span style=color:#ff79c6>=</span> ((x<span style=color:#ff79c6>&lt;&lt;</span><span style=color:#bd93f9>2</span>)<span style=color:#ff79c6>&amp;</span><span style=color:#bd93f9>0xcc</span>) <span style=color:#ff79c6>|</span> ((x<span style=color:#ff79c6>&gt;&gt;</span><span style=color:#bd93f9>2</span>)<span style=color:#ff79c6>&amp;</span><span style=color:#bd93f9>0x33</span>); <span style=color:#6272a4>// [ 78 56 34 12 ]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>  x <span style=color:#ff79c6>=</span> ((x<span style=color:#ff79c6>&lt;&lt;</span><span style=color:#bd93f9>1</span>)<span style=color:#ff79c6>&amp;</span><span style=color:#bd93f9>0xaa</span>) <span style=color:#ff79c6>|</span> ((x<span style=color:#ff79c6>&gt;&gt;</span><span style=color:#bd93f9>1</span>)<span style=color:#ff79c6>&amp;</span><span style=color:#bd93f9>0x55</span>); <span style=color:#6272a4>// [ 8 7 6 5 4 3 2 1 ]
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>return</span> x;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><p>测试工具函数:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#50fa7b>to_binary_str</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>long</span> val, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>bin_str, <span style=color:#8be9fd>int</span> <span style=color:#ff79c6>*</span>len)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>  <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>p, <span style=color:#ff79c6>*</span>q;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#8be9fd>int</span> cnt <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  <span style=color:#ff79c6>while</span> (val) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#8be9fd>char</span> tmp <span style=color:#ff79c6>=</span> val <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    bin_str[cnt<span style=color:#ff79c6>++</span>] <span style=color:#ff79c6>=</span> tmp<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;0&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    val <span style=color:#ff79c6>=</span> val <span style=color:#ff79c6>&gt;&gt;</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>  p <span style=color:#ff79c6>=</span> bin_str, q <span style=color:#ff79c6>=</span> bin_str<span style=color:#ff79c6>+</span>cnt<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>  <span style=color:#ff79c6>while</span> (p <span style=color:#ff79c6>&lt;</span> q) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#8be9fd>char</span> tmp <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>p;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#ff79c6>*</span>p <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>q;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#ff79c6>*</span>q <span style=color:#ff79c6>=</span> tmp;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    p<span style=color:#ff79c6>++</span>, q<span style=color:#ff79c6>--</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>  bin_str[cnt] <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>  <span style=color:#ff79c6>*</span>len <span style=color:#ff79c6>=</span> cnt;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>  <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>void</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>  <span style=color:#8be9fd>char</span> bin[<span style=color:#bd93f9>65</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>  <span style=color:#8be9fd>int</span> len;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> x <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b11110000;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>char</span> y <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>b10101010;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>  to_binary_str(bit_reverse(x), bin, <span style=color:#ff79c6>&amp;</span>len);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>  printf(<span style=color:#f1fa8c>&#34;bin: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, bin);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>  to_binary_str(bit_reverse(y), bin, <span style=color:#ff79c6>&amp;</span>len);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>  printf(<span style=color:#f1fa8c>&#34;bin: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, bin);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>  assert(bit_reverse(x) <span style=color:#ff79c6>==</span> bit_reverse_faster(x));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>  assert(bit_reverse(y) <span style=color:#ff79c6>==</span> bit_reverse_faster(y));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>  <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>}  
</span></span></code></pre></div></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-11-25T16:21:27, Lastmod: 2023-11-30T17:56:18</p></main></div></body></html>