<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>ARMv8 中断管理(2): 中断的生命周期</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item" href>BACK</div><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#%e4%b8%ad%e6%96%ad%e7%9a%84%e4%ba%a7%e7%94%9f aria-label=中断的产生>中断的产生</a></li><li><a href=#%e4%b8%ad%e6%96%ad%e7%9a%84%e5%88%86%e5%8f%91 aria-label=中断的分发>中断的分发</a></li><li><a href=#%e4%b8%ad%e6%96%ad%e4%bc%a0%e9%80%92 aria-label=中断传递>中断传递</a></li><li><a href=#%e4%b8%ad%e6%96%ad%e6%bf%80%e6%b4%bb aria-label=中断激活>中断激活</a></li><li><a href=#%e4%bc%98%e5%85%88%e7%ba%a7%e4%b8%8b%e9%99%8d%e5%92%8c%e4%b8%ad%e6%96%ad%e5%a4%b1%e6%95%88 aria-label=优先级下降和中断失效>优先级下降和中断失效</a></li></ul><li><a href=#%e5%b0%8f%e7%bb%93 aria-label=小结>小结</a></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>ARMv8 中断管理(2): 中断的生命周期</div></header><p>一个中断完整的生命周期大概包括:</p><ol><li>产生中断</li><li>中断分发: by Distributor or Redistributor</li><li>中断传递: deliver to CPU Interface</li><li>中断激活: pending->active</li><li>优先级下降: priority drop</li><li>中断失效: active->inactive</li></ol><h3 id=中断的产生>中断的产生</h3><p>外设传来中断信号，或者处理器触发 SGI， GIC 此时将该中断标记为<strong>pending</strong>状态。</p><h3 id=中断的分发>中断的分发</h3><p>中断生命周期中的重要部分，根据中断的类型不同可能由 Distributor 和 Redistributor
负责分发工作。</p><p>分发器查配置得到此中断的优先级，目的 CPU 等信息。此时可能有多个中断想要发往同一 CPU，
优先级决定先分发哪个中断。将其顺利分发目的 CPU 的 CPU Interface</p><h3 id=中断传递>中断传递</h3><p>CPU Interface 做最后一步检查，是否满足优先级屏蔽? 是否符合抢占条件?</p><p>如果条件都满足，给 CPU 一个信号，CPU 准备激活中断</p><p>TODO: 关于<code>running priority</code> 和 <code>highest pending priority</code>的解释</p><h3 id=中断激活>中断激活</h3><p>CPU 此时将触发 IRQ/FIQ，执行对应的中断服务程序。</p><p>中断服务程序中需要显式的执行一些操作将中断状态由 pending 置为 active。</p><blockquote><p>异常向量（中断处理函数）的详细步骤见下一节</p></blockquote><h3 id=优先级下降和中断失效>优先级下降和中断失效</h3><blockquote><p>优先级下降和中断的失效可以配置为同时发生，实际中我们也是这么使用的。</p><p>TODO: 何种情况下需要将其分开？</p></blockquote><p>中断服务函数结束后，需要执行一些额外的步骤来使中断失效，便于在该 CPU 上 pending
的其他中断能够进来。</p><p>优先级下降意味着降低抢占的优先级限制，允许 CPU 上等待的其他中断进来。</p><p>然后执行中断失效过程，将其状态由 active->inactive， 至此中断的整个生命周期结束。</p><h2 id=小结>小结</h2><p>中断激活到中断失效的整个过程都属于<strong>中断服务程序</strong>的部分，由开发者显式控制，
将在下一节进行介绍。</p></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-04-12T23:51:49, Lastmod: 2023-09-24T18:08:59</p></main></div></body></html>