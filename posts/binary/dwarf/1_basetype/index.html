<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax_pastie.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>Dwarf(2): basetype类型</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#basetype aria-label=basetype>basetype</a></li><li><a href=#array aria-label=Array>Array</a></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>Dwarf(2): basetype类型</div></header><p>想要描述一个变量，必须知道它类型信息，才能知道变量的大小、输出的格式等。</p><p>Dwarf 为 C 语言定义了一些描述数据类型的 DIE，包括 basetype, array,pointer, structure&mldr;</p><h2 id=basetype>basetype</h2><p>今天我们先介绍最简单的 basetype。</p><p>basetype 是指那些 C 语言自身定义的基础类型，像<code>int</code>, <code>double</code>这些。</p><p>basetype 类型的 DIE 通常有属性:</p><ul><li><code>DW_AT_name</code>: basetype 的名称</li><li><code>DW_AT_byte_size</code>: 该 basetype 占空间大小</li></ul><p>下面给出描述<code>int</code>和<code>double</code>的 DIE 展示(还是通过<code>objdump</code>工具输出）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl> &lt;1&gt;&lt;43&gt;: Abbrev Number: <span class=m>3</span> <span class=o>(</span>DW_TAG_base_type<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;44&gt;   DW_AT_byte_size   : <span class=m>4</span>
</span></span><span class=line><span class=cl>    &lt;45&gt;   DW_AT_encoding    : 5	<span class=o>(</span>signed<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;46&gt;   DW_AT_name        : int
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> &lt;1&gt;&lt;60&gt;: Abbrev Number: <span class=m>4</span> <span class=o>(</span>DW_TAG_base_type<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;61&gt;   DW_AT_byte_size   : <span class=m>8</span>
</span></span><span class=line><span class=cl>    &lt;62&gt;   DW_AT_encoding    : 4	<span class=o>(</span>float<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;63&gt;   DW_AT_name        : <span class=o>(</span>indirect string, offset: 0x9<span class=o>)</span>: double
</span></span></code></pre></div><h2 id=array>Array</h2><p>数组表示为 <code>DW_TAG_array</code> 的 DIE，通常含有属性:</p><ul><li><code>DW_AT_type</code>： 指向数组元素的 DIE</li></ul><p>数组的长度信息如何表示呢？每个 array DIE 的每个 child 都代表一个维度信息，最左边的 child
描述第一个维度信息。</p><p>描述维度信息的 DIE 为 <code>DW_TAG_subrange_type</code>, 其包含两个属性:</p><ul><li><code>DW_AT_type</code>: 指向所属 array 的 DIE</li><li><code>DW_AT_upper_bound</code>: 表示数据在该维度下的长度, <strong>数值是-1 的</strong></li></ul><p>所以要得到一个数组的总长度，需要遍历其 DIE 的所有 child。</p><p>下面给出一个二维数组<code>int var_array[3][5]</code>的相关 DIE 信息:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl> &lt;1&gt;&lt;43&gt;: Abbrev Number: <span class=m>3</span> <span class=o>(</span>DW_TAG_base_type<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;44&gt;   DW_AT_byte_size   : <span class=m>4</span>
</span></span><span class=line><span class=cl>    &lt;45&gt;   DW_AT_encoding    : 5	<span class=o>(</span>signed<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;46&gt;   DW_AT_name        : int
</span></span><span class=line><span class=cl> &lt;1&gt;&lt;4a&gt;: Abbrev Number: <span class=m>4</span> <span class=o>(</span>DW_TAG_array_type<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;4b&gt;   DW_AT_type        : &lt;0x43&gt;
</span></span><span class=line><span class=cl>    &lt;4f&gt;   DW_AT_sibling     : &lt;0x60&gt;
</span></span><span class=line><span class=cl> &lt;2&gt;&lt;53&gt;: Abbrev Number: <span class=m>5</span> <span class=o>(</span>DW_TAG_subrange_type<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;54&gt;   DW_AT_type        : &lt;0x60&gt;
</span></span><span class=line><span class=cl>    &lt;58&gt;   DW_AT_upper_bound : <span class=m>2</span>
</span></span><span class=line><span class=cl> &lt;2&gt;&lt;59&gt;: Abbrev Number: <span class=m>5</span> <span class=o>(</span>DW_TAG_subrange_type<span class=o>)</span>
</span></span><span class=line><span class=cl>    &lt;5a&gt;   DW_AT_type        : &lt;0x60&gt;
</span></span><span class=line><span class=cl>    &lt;5e&gt;   DW_AT_upper_bound : <span class=m>4</span>
</span></span><span class=line><span class=cl> &lt;2&gt;&lt;5f&gt;: Abbrev Number: <span class=m>0</span>
</span></span></code></pre></div></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-05-09T16:51:49, Lastmod: 2024-01-04T16:59:55</p><script src=/js/copy-to-clipboard.js></script></main></div></body></html>