<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>Dwarf(1): 基础</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item" href>BACK</div><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%9f%a5%e7%9c%8b%e4%b8%80%e4%b8%aa-elf-%e7%9a%84%e6%89%80%e6%9c%89-die aria-label="查看一个 ELF 的所有 DIE">查看一个 ELF 的所有 DIE</a></li><li><a href=#%e5%b0%8f%e7%bb%93 aria-label=小结>小结</a></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>Dwarf(1): 基础</div></header><p>Dwarf 把源文件中每个可描述的模块（例如函数，变量，结构体的声明等）描述为一个 DIE
(Debugging Information Entry)，所以每个源文件可以描述为若干 DIE 的组合。</p><p>每个 DIE 由一个 tag 和若干 attribute-val 键值对构成:</p><ul><li>tag: 描述此 DIE 的类型</li><li>attribute-val: 描述此 DIE 的一些细节属性，项目根据 DIE 的类型不同而有差别</li></ul><p>各个 DIE 之间会相互联系，一个 DIE 可能含有 parent，若干的 child 和 sibling，
它们之间组成树的结构。</p><h2 id=查看一个-elf-的所有-die>查看一个 ELF 的所有 DIE</h2><p>ELF 文件中的所有 DIE 存储在<code>.debug_info</code> section 中，通过 GNU utils 中的<code>objdump</code>工具
可以解析为可阅读的结构:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>objdump --dwarf<span style=color:#ff79c6>=</span>info &lt;file&gt;
</span></span></code></pre></div><p>若我们有一个 <code>demo.c</code> 如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>func</span>(<span style=color:#8be9fd>void</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd>int</span> var_local;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>编译为可执行文件后， 执行上述的<code>objdump</code>命令， 可以得到如下的输出（节选）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span> &lt;1&gt;&lt;68&gt;: Abbrev Number: <span style=color:#bd93f9>5</span> <span style=color:#ff79c6>(</span>DW_TAG_subprogram<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    &lt;69&gt;   DW_AT_external    : <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    &lt;69&gt;   DW_AT_name        : <span style=color:#ff79c6>(</span>indirect string, offset: 0x32<span style=color:#ff79c6>)</span>: func
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    &lt;6d&gt;   DW_AT_decl_file   : <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    &lt;6e&gt;   DW_AT_decl_line   : <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    &lt;6f&gt;   DW_AT_decl_column : <span style=color:#bd93f9>6</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    &lt;70&gt;   DW_AT_prototyped  : <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    &lt;70&gt;   DW_AT_low_pc      : 0x1129
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    &lt;78&gt;   DW_AT_high_pc     : 0xb
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    &lt;80&gt;   DW_AT_frame_base  : <span style=color:#bd93f9>1</span> byte block: 9c 	<span style=color:#ff79c6>(</span>DW_OP_call_frame_cfa<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    &lt;82&gt;   DW_AT_GNU_all_call_sites: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span> &lt;2&gt;&lt;82&gt;: Abbrev Number: <span style=color:#bd93f9>6</span> <span style=color:#ff79c6>(</span>DW_TAG_variable<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    &lt;83&gt;   DW_AT_name        : <span style=color:#ff79c6>(</span>indirect string, offset: 0x28<span style=color:#ff79c6>)</span>: var_local
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    &lt;87&gt;   DW_AT_decl_file   : <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    &lt;88&gt;   DW_AT_decl_line   : <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    &lt;89&gt;   DW_AT_decl_column : <span style=color:#bd93f9>9</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    &lt;8a&gt;   DW_AT_type        : &lt;0x43&gt;
</span></span></code></pre></div><p>上述例子中节选了两个 DIE，分别是函数<code>func()</code>和局部变量<code>var_local</code>, 可以看到它们的
tag 是不同的，且都具有一系列属性。</p><p>并且，值得注意的是，这两个 DIE 的关系可以从首列<code>&lt;></code>中的数字得知，数字代表 DIE 构成树的
深度，此例子中&lt;1>下面紧靠的&lt;2>就表示&lt;2>是&lt;1>的 child。理论上也是如此，因为局部变量
是属于对应的函数体的。</p><h2 id=小结>小结</h2><p>之后的章节打算介绍 Dwarf 是如何描述源文件中的不同对象的(函数,变量,数据类型等)</p></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-05-09T15:51:49, Lastmod: 2024-01-04T16:59:55</p></main></div></body></html>