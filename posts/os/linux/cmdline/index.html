<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax_pastie.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>Linux cmdline 配置</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>Linux cmdline 配置</div></header><p>内核启动时会打印当前生效的 cmdline。Command Line 相当于外部传给 Linux 内核的参数，内核针对他们做相应处理，并打印无法是被的参数。</p><p>如何看当前的cmdline：</p><ol><li>内核启动日志会输出<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[    0.000000] Kernel command line: earlycon rw rdinit=/linuxrc root=/dev/vda nokaslr
</span></span><span class=line><span class=cl>[    0.000000] Unknown command line parameters: nokaslr
</span></span></code></pre></div></li><li><code>cat /proc/cmdline/</code></li></ol><p>用户有几种方式来注入cmdline：</p><ul><li><p>设备树 bootargs。 linuxkernel的设备树是QEMU生成的，实际就是用的启动参数 <code>--append</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>qemu-system-aarch64 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -nographic -machine virt,secure<span class=o>=</span>on <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -cpu cortex-a53 -smp <span class=m>2</span> -m 4G <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -d guest_errors,unimp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -gdb tcp::1234 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -bios ./arm-trusted-firmware/build/qemu/debug/bl1.bin <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -kernel ./wupeng/linux/arch/arm64/boot/Image <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -initrd ./rootfs.cpio.gz <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -append <span class=s2>&#34;earlycon rw rdinit=/linuxrc nokaslr&#34;</span> <span class=se>\ </span>                                                                 
</span></span><span class=line><span class=cl>    -serial mon:stdio <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -semihosting-config <span class=nv>enable</span><span class=o>=</span>on,target<span class=o>=</span>native
</span></span></code></pre></div></li><li><p>uboot boot_args</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>setenv bootargs &#39;init=xx&#39;
</span></span></code></pre></div></li><li><p>Linux menuconfig</p></li></ul><figure><img src=/cmdline_menuconfig.png width=80%></figure><p>优先级：设备树 > uboot > linux kconfig</p></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2024-04-16T10:30:35, Lastmod: 2024-04-22T14:38:42</p><script src=/js/copy-to-clipboard.js></script></main></div></body></html>