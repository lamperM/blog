<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>开发环境构建指南</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item" href>BACK</div><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e5%ad%97%e4%bd%93 aria-label=字体>字体</a><ul><li><a href=#fira-code aria-label="Fira Code">Fira Code</a></li><li><a href=#%e9%9c%9e%e9%b9%9c%e6%96%87%e6%a5%b7 aria-label=霞鹜文楷>霞鹜文楷</a></li></ul></li><li><a href=#vscode aria-label=vscode>vscode</a><ul><li><a href=#ubuntu2004%e6%ba%90 aria-label=Ubuntu2004源>Ubuntu2004源</a><ul><li><a href=#%e6%96%b0%e7%89%88%e6%9c%ac%e7%9a%84clangd aria-label=新版本的Clangd>新版本的Clangd</a></li><li><a href=#%e6%96%b0%e7%89%88%e6%9c%ac%e7%9a%84vim aria-label=新版本的Vim>新版本的Vim</a></li><li><a href=#%e5%ae%89%e8%a3%85%e5%92%8c%e5%8d%87%e7%ba%a7node aria-label=安装和升级node>安装和升级node</a></li></ul></li></ul></li><li><a href=#%e7%bb%88%e7%ab%af%e8%bd%af%e4%bb%b6%e5%ae%89%e8%a3%85 aria-label=终端软件安装>终端软件安装</a><ul><li><a href=#%e6%ba%90%e6%9b%bf%e6%8d%a2 aria-label=源替换>源替换</a></li><li><a href=#apt aria-label=apt>apt</a></li><li><a href=#pip3 aria-label=pip3>pip3</a></li></ul></li><li><a href=#shell aria-label=shell>shell</a><ul><li><a href=#zsh aria-label=zsh>zsh</a><ul><li><a href=#oh-my-zsh aria-label=oh-my-zsh>oh-my-zsh</a></li></ul></li><li><a href=#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=配置文件>配置文件</a></li></ul></li><li><a href=#ssh-%e5%af%86%e9%92%a5 aria-label="ssh 密钥">ssh 密钥</a><ul><li><a href=#tmux aria-label=tmux>tmux</a><ul><li><a href=#%e9%97%ae%e9%a2%98%e8%b0%83%e6%95%b4%e6%98%be%e7%a4%ba%e5%b0%ba%e5%af%b8%e6%97%b6tmux%e6%9c%aa%e9%87%8d%e6%96%b0%e7%bb%98%e5%88%b6%e7%aa%97%e5%8f%a3 aria-label=问题：调整显示尺寸时，tmux未重新绘制窗口>问题：调整显示尺寸时，tmux未重新绘制窗口</a></li><li><a href=#reference aria-label=reference>reference</a></li></ul></li><li><a href=#%e7%a7%91%e5%ad%a6%e4%b8%8a%e7%bd%91 aria-label=科学上网>科学上网</a><ul><li><a href=#clash-for-mac aria-label="Clash for Mac">Clash for Mac</a></li><li><a href=#clash-for-linux aria-label="Clash for Linux">Clash for Linux</a><ul><li><a href=#%e9%aa%8c%e8%af%81%e7%a7%91%e5%ad%a6%e4%b8%8a%e7%bd%91 aria-label=验证科学上网>验证科学上网</a></li><li><a href=#clash%e5%85%a8%e5%b1%80%e4%bb%a3%e7%90%86 aria-label=Clash全局代理>Clash全局代理</a></li><li><a href=#%e5%b0%86clash%e4%bd%9c%e4%b8%ba%e4%b8%80%e4%b8%aa%e6%9c%8d%e5%8a%a1 aria-label=将Clash作为一个服务>将Clash作为一个服务</a></li></ul></li><li><a href=#reference-1 aria-label=Reference>Reference</a></li></ul></li></ul></li><li><a href=#windows%e4%b8%8b%e8%bf%81%e7%a7%bbwsl aria-label=Windows下迁移WSL>Windows下迁移WSL</a><ul><li><a href=#%e6%ad%a5%e9%aa%a4 aria-label=步骤>步骤</a><ul><li><a href=#1-%e5%85%b3%e9%97%adwsl aria-label="1. 关闭WSL">1. 关闭WSL</a></li><li><a href=#2-%e5%af%bc%e5%87%bawsl%e9%95%9c%e5%83%8f aria-label="2. 导出WSL镜像">2. 导出WSL镜像</a></li><li><a href=#3-%e6%b3%a8%e9%94%80%e5%8e%9f%e7%b3%bb%e7%bb%9f%e5%8f%af%e9%80%89 aria-label="3. 注销原系统(可选)">3. 注销原系统(可选)</a></li><li><a href=#4-%e5%b0%86%e9%95%9c%e5%83%8f%e5%8e%8b%e7%bc%a9%e6%96%87%e4%bb%b6%e5%a4%8d%e5%88%b6%e5%88%b0%e6%96%b0%e6%9c%ba%e5%99%a8%e6%96%b0%e4%bd%8d%e7%bd%ae aria-label="4. 将镜像压缩文件复制到新机器/新位置">4. 将镜像压缩文件复制到新机器/新位置</a></li><li><a href=#5-%e5%9c%a8%e6%96%b0%e6%9c%ba%e5%99%a8%e4%b8%8a%e5%af%bc%e5%85%a5%e9%95%9c%e5%83%8f%e6%96%87%e4%bb%b6 aria-label="5. 在新机器上导入镜像文件">5. 在新机器上导入镜像文件</a></li><li><a href=#6-%e9%85%8d%e7%bd%ae aria-label="6. 配置">6. 配置</a><ul><li><a href=#%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4%e7%94%a8%e6%88%b7 aria-label=设置默认用户>设置默认用户</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4distro aria-label=设置默认distro>设置默认distro</a></li></ul></li></ul></li><li><a href=#reference-2 aria-label=Reference>Reference</a></li></ul></li><li><a href=#linux%e7%bb%84%e7%bb%87dotfiles aria-label=Linux组织Dotfiles>Linux组织Dotfiles</a><ul><li><a href=#%e6%96%b0%e7%8e%af%e5%a2%83%e6%81%a2%e5%a4%8ddotfile aria-label=新环境恢复Dotfile>新环境恢复Dotfile</a></li><li><a href=#reference-3 aria-label=Reference>Reference</a></li></ul></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>开发环境构建指南</div></header><h1 id=前言>前言</h1><p>写这篇博客的背景是<strong>我实在忍受不了每次换新的开发机器都得费好大的劲来完全恢复以前的环境</strong>， 而且，我平常喜欢搜集各种有用的工具、好看的主题，字体这些，如果零零散散的记录，大概率会忘记或者记不得某些细节。</p><p>所以，最后期望达到的是<strong>能够使我每次在新机器上搭建环境只需要看这一篇文章就可以了</strong>。因此这里会记录：</p><ul><li>帮助提升开发效率的小工具</li><li>好看的字体、主题</li><li>配置某些环境的要点及注意事项</li></ul><blockquote><p>🥀 到目前为止，我还未发现一种方式能够完全达到“一键式布置”，这也不是本文的目的。
付出至少半天的时间的一定的，希望未来能发现一种好的方法。</p></blockquote><h1 id=字体>字体</h1><h2 id=fira-code>Fira Code</h2><p>这款字体适合做编程字体，蛮好看的。我在 vscode 和 terminal 下都使用了这款字体。</p><p>详情及安装参考<a href=https://github.com/tonsky/FiraCode>github</a></p><h2 id=霞鹜文楷>霞鹜文楷</h2><p>开源的中文字体，做博客、PPT 不错。</p><p>详情及安装参考<a href=https://github.com/lxgw/LxgwWenKai>github</a></p><h1 id=vscode>vscode</h1><p>vscode的所有配置通过其内置的sync功能实现, 目前用的是Github账号同步。</p><h2 id=ubuntu2004源>Ubuntu2004源</h2><h3 id=新版本的clangd>新版本的Clangd</h3><blockquote><p>Clangd用15+才能用vscode的inlay hint功能。</p></blockquote><p>获取签名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -
</span></span></code></pre></div><p>添加源地址到<code>/etc/apt/sources.list</code>, 修改完后别忘了<code>sudo apt update</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span># 15, 后缀可以改成你需要的版本号
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>deb http://apt.llvm.org/focal/ llvm-toolchain-focal-15 main
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>deb-src http://apt.llvm.org/focal/ llvm-toolchain-focal-15 main
</span></span></code></pre></div><h3 id=新版本的vim>新版本的Vim</h3><blockquote><p>Vim 8+才有pack插件管理</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo add-apt-repository ppa:jonathonf/vim
</span></span></code></pre></div><h3 id=安装和升级node>安装和升级node</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo apt install npm
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>npm install -g n
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>n stable
</span></span></code></pre></div><p>下载完成后 如果发现 <code>node -v</code> 仍然是之前的版本，根据不同的 shell 版本执行 <code>hash -r</code> 或者 <code>rehash</code> 即可。</p><h1 id=终端软件安装>终端软件安装</h1><h2 id=源替换>源替换</h2><h2 id=apt>apt</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo apt install python3-pip
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo apt install tmux
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>sudo apt install fzf
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>sudo apt install zsh
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>sudo apt install cmake <span style=color:#6272a4># low version?</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>sudo apt install tldr
</span></span></code></pre></div><h2 id=pip3>pip3</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># CLI 代码高亮</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo pip3 install pygments
</span></span></code></pre></div><h1 id=shell>shell</h1><h2 id=zsh>zsh</h2><h3 id=oh-my-zsh>oh-my-zsh</h3><p>oh-my-zsh可以看作对zsh的配置文件做一层抽象，使配置更方便。
带来的缺点就是速度变慢。</p><blockquote><p>进入git目录下太卡</p><p>TODO： 是主题的原因，可以配置</p></blockquote><h2 id=配置文件>配置文件</h2><ul><li>.bashrc</li><li>.zshrc</li><li>.bash_aliase</li><li>.bash_path</li></ul><h1 id=ssh-密钥>ssh 密钥</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>ssh-keygen -t rsa -C <span style=color:#f1fa8c>&#34;cnwanglu@icloud.com&#34;</span>
</span></span></code></pre></div><h2 id=tmux>tmux</h2><p>tmux 在远程开发时比较有用，解决了以下几个痛点：</p><ol><li>ssh连接主机不稳定，在休眠或者网络波动时经常断开，以前进入的目录或者vim打开的文件就需要重新做。而tmux是CS架构，只要远程主机上的server不死，永远可以重新连接并恢复到之前的窗口。甚至，tmux提供了将现场保存到本地文件中的功能。在远程主机重启后，也可以从文件中恢复现场。</li><li>ssh连接主机实现多窗口麻烦，一般需要在终端软件（如XShell，iterms）中开多个标签，多次连接ssh。tmux内置多窗口的实现方案，不依赖连接的终端，窗口创建、切换等方式可以做到统一。</li></ol><h3 id=问题调整显示尺寸时tmux未重新绘制窗口>问题：调整显示尺寸时，tmux未重新绘制窗口</h3><p>有时候我们在调整终端软件的显示大小时，发现tmux的显示窗口并没有跟着变化，而是在多余的串口中显示一些点。就像下面图片展示的那样。</p><figure><img src=/tmux_window.jpg width=70%></figure><p>原因在于该会话有多个绑定的连接，而tmux将窗口绘制为所有连接中最的最小尺寸。最简单的方法是在连接的时候将其他客户端从会话中断开：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>tmux attach -d
</span></span></code></pre></div><h3 id=reference>reference</h3><ol><li><a href=http://louiszhai.github.io/2017/09/30/tmux/>Tmux使用手册</a></li><li><a href=https://cloud.tencent.com/developer/ask/sof/49645>解决窗口尺寸问题</a></li></ol><h2 id=科学上网>科学上网</h2><p>Clash 最完整的教程，包括下载和安装使用：https://docs.gtk.pw/contents/macos/cfw.html#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85</p><h3 id=clash-for-mac>Clash for Mac</h3><p>直接下载桌面版，镜像下载地址：https://github.com/clashdownload/Clash_for_Windows/releases</p><h3 id=clash-for-linux>Clash for Linux</h3><p>目前clash的作者已经删除跑路，但是已经发布的版本还是可以正常使用的。这一章节介绍如何在Linux上用命令行配置Clash。</p><p>首先需要准备好一些文件：</p><ol><li>clash在linux中的命令行可执行文件，目前这里还可以下载 <a href=https://github.com/Kuingsmile/clash-core/releases>https://github.com/Kuingsmile/clash-core/releases</a>， 去下载clash-linux-amd64-v1.18.0.gz</li><li>Country.mmdb为全球IP库，可以实现各个国家的IP信息解析和地理定位，没有这个文件clash是无法运行的。 但目前版本的clash有点问题，不会自动生成MMDB文件，所以需要使用命令行下载。去<a href=https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb>这个地方</a>或者<a href=https://gitee.com/dnqbob/sp_engine/blob/SPcn-01-02-20/GeoLite2-Country.mmdb.gz>这个地方</a>看看</li><li>config.yaml为clash的代理规则和clash的一些其他设置。代理规则不需要我们自己编写，通过订阅地址直接下载即可。
此处将订阅链接粘贴进双引号中间。注意不要删除双引号，不要删除空格。
<code>wget -O ~/.config/clash/config.yaml "订阅链接"</code>。或者，如果你有clash的其他客户端，可以由已有的配置导出。</li></ol><p>下载上面的文件，就可以准备好安装了：</p><ol><li>创建<code>~/.config/clash/</code>，并将config.yaml和Country.mmdb放进去，如果已经存在请忽略<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>mkdir ~/.config/clash/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>mv Country.mmbd ~/.config/clash/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>mv config.yaml ~/.config/clash/
</span></span></code></pre></div></li><li>解压<code>clash-linux-amd64-v1.18.0.gz</code>，并将可执行文件放到一个合适的位置<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>gunzip clash-linux-amd64-v1.18.0.gz
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>chmod +x clash-linux-amd64-v1.18.0.gz
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>mv clash-linux-amd64-v1.18.0 ~/tools/clash-v1.18.0
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#8be9fd;font-style:italic>cd</span> ~/tools/
</span></span></code></pre></div></li><li>运行clash可执行文件，如果成功运行应该可以看到以下LOG<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span> $ ./clash-linux-amd64-v1.18.0
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span> INFO<span style=color:#ff79c6>[</span>0000<span style=color:#ff79c6>]</span> Start initial compatible provider 故障转移       
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span> INFO<span style=color:#ff79c6>[</span>0000<span style=color:#ff79c6>]</span> Start initial compatible provider 自动选择       
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span> INFO<span style=color:#ff79c6>[</span>0000<span style=color:#ff79c6>]</span> Start initial compatible provider 大机场 Big Airport 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span> INFO<span style=color:#ff79c6>[</span>0000<span style=color:#ff79c6>]</span> inbound mixed://:7890 create success.        
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span> INFO<span style=color:#ff79c6>[</span>0000<span style=color:#ff79c6>]</span> RESTful API listening at: 127.0.0.1:9090
</span></span></code></pre></div></li></ol><p>到此，clash就可以正常运行了，由于我的订阅地址有3条规则，所以会有3条Start initial compatible provider xxxx。</p><p>inbound mixed://:7890 则代表已经开启了http(含https)和socks代理，只要服务器内有软件流量通过7890这个端口，流量都将进入clash从而被代理。（但有些不支持设置，后面会说如何使用全局代理）</p><p>RESTful API listening at: [::]:9090代表clash已经开启了ui控制面板，是的，Linux的clash有可视化控制面板。</p><h4 id=验证科学上网>验证科学上网</h4><p>根据我们之前前台运行可得知，默认是监控了自己的7890端口，验证方式可以通过<code>curl</code>向google发送一个请求看是否能正常返回。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>curl --proxy 127.0.0.1:7890 www.google.com
</span></span></code></pre></div><p>返回正常 Google成功返回数据，代表7890端口代理正常，clash运行正常。<strong>注意目前必须手动指定代理的地址和端口，后面会介绍启用全局代理。</strong></p><h4 id=clash全局代理>Clash全局代理</h4><p>可以添加这个配置到你的<code>.bashrc</code>/<code>.zshrc</code>中，使得终端的所有请求都走代理。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>http_proxy</span><span style=color:#ff79c6>=</span>127.0.0.1:7890 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>https_proxy</span><span style=color:#ff79c6>=</span>127.0.0.1:7890
</span></span></code></pre></div><p>这里只设置了http和https，初次之外，还可代理其他协议。</p><p>可以做成一个sh命令，当想临时关闭科学上网的时候执行unproxy。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>function</span> proxy<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>http_proxy</span><span style=color:#ff79c6>=</span>http://127.0.0.1:7890
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>https_proxy</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$http_proxy</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#8be9fd;font-style:italic>echo</span> -e <span style=color:#f1fa8c>&#34;proxy on!&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#ff79c6>function</span> unproxy<span style=color:#ff79c6>(){</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    <span style=color:#8be9fd;font-style:italic>unset</span> http_proxy https_proxy
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    <span style=color:#8be9fd;font-style:italic>echo</span> -e <span style=color:#f1fa8c>&#34;proxy off&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>验证全局代理配置成功只需要再执行一次<code>curl</code>即可，这次无需手动指定代理。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>curl www.google.com
</span></span></code></pre></div><h4 id=将clash作为一个服务>将Clash作为一个服务</h4><p>使clash一直运行在前台会占用一个终端，而且总感觉不是很优雅，更好的方法是将clash作为一个服务来操作。</p><ol><li>在<code>/etc/systemd/system/</code>目录新建一个clash.service文件<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>[</span>Unit<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#8be9fd;font-style:italic>Description</span><span style=color:#ff79c6>=</span>Clash service 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#8be9fd;font-style:italic>After</span><span style=color:#ff79c6>=</span>network.target 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>[</span>Service<span style=color:#ff79c6>]</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#8be9fd;font-style:italic>Type</span><span style=color:#ff79c6>=</span>simple 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd;font-style:italic>User</span><span style=color:#ff79c6>=</span>root 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd;font-style:italic>ExecStart</span><span style=color:#ff79c6>=</span>这里写你的clash运行的绝对路径（本文中的路径是<span style=color:#f1fa8c>`</span>~/tools/clash-v1.18.0<span style=color:#f1fa8c>`</span>） 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#8be9fd;font-style:italic>Restart</span><span style=color:#ff79c6>=</span>on-failure <span style=color:#8be9fd;font-style:italic>RestartPreventExitStatus</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>23</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>[</span>Install<span style=color:#ff79c6>]</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#8be9fd;font-style:italic>WantedBy</span><span style=color:#ff79c6>=</span>multi-user.target
</span></span></code></pre></div></li><li>之后就可以用systemctl系列命令来确认是否启用成功：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>systemctl status clash 查看clash服务
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>systemctl start clash 启动clash服务 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>systemctl stop clash 停止clash服务 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>systemctl restart clash 重启clash服务 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>systemctl <span style=color:#8be9fd;font-style:italic>enable</span> clash 设置开机自启clash服务 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>systemctl daemon-reload 如果修改了clash.service文件，需要此命令来重载被修改的服务文件
</span></span></code></pre></div></li></ol><h3 id=reference-1>Reference</h3><ol><li><a href=https://www.zztongyun.com/article/clash%20for%20linux%20ubuntu>Linux中安装Clash并且实现全局代理（纯命令行）</a></li><li><a href=https://github.com/Kuingsmile/clash-core/releases>https://github.com/Kuingsmile/clash-core/releases</a></li><li><a href=https://iyuantiao.me/clash-for-linux.html>clash-for-linux</a></li><li><a href="https://zhuanlan.zhihu.com/p/662552814#:~:text=Ubuntu%E9%85%8D%E7%BD%AE%20%E5%91%BD%E4%BB%A4%E8%A1%8CClash%20%E6%95%99%E7%A8%8B%201%201.%E4%B8%8B%E8%BD%BD%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%20%E9%A6%96%E5%85%88%EF%BC%8C%E4%BD%A0%E9%9C%80%E8%A6%81%E5%88%B0%20Releases%20%C2%B7,%E5%BD%93%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%20%E5%BB%BA%E8%AE%AE%20tmux%20a%20-t%20clash%20%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E6%9C%89%E4%BD%95%E6%8A%A5%E9%94%99%20">Ubuntu配置 命令行Clash 教程</a></li><li><a href=https://zhuanlan.zhihu.com/p/472152669>Clash can&rsquo;t initial MMDB of Country.mmdb</a></li></ol><h1 id=windows下迁移wsl>Windows下迁移WSL</h1><p>WSL2目前已经相当好用了，在对性能要求不极致的场景下用WSL开发非常舒服。</p><p>迁移WSL到别的位置/别的机器还是比较方便的，也有人写了<a href=https://github.com/pxlrbt/move-wsl>脚本</a>来做这些，它是针对迁移到其他硬盘位置的，所以我这次还是自己手动做一遍，原理都是相同的。</p><h2 id=步骤>步骤</h2><h3 id=1-关闭wsl>1. 关闭WSL</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># 检查WSL是否在运行</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>wsl -l -v
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>  NAME          STATE           VERSION
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>* Ubuntu2004    Running         <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4># 关闭</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>wsl --shutdown 
</span></span></code></pre></div><h3 id=2-导出wsl镜像>2. 导出WSL镜像</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>wsl --export Ubuntu2004 D:<span style=color:#f1fa8c>\U</span>buntu2004_202311.tar
</span></span></code></pre></div><h3 id=3-注销原系统可选>3. 注销原系统(可选)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>wsl --unregister Ubuntu2004
</span></span></code></pre></div><h3 id=4-将镜像压缩文件复制到新机器新位置>4. 将镜像压缩文件复制到新机器/新位置</h3><p>如果是新机器，还需要重新配置好WSL，开启一些选项:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>控制面板-&gt;程序-&gt;启用或关闭 windows 功能，开启 Windows 虚拟化和 Linux 子系统（WSL2)以及Hyper-V。
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>勾选完成后，Windows11 会自己下载些东西，并提示你重启。等电脑彻底重启完以后，进行后续操作。
</span></span></code></pre></div><p><img src=https://s2.loli.net/2023/11/23/xMOZ7yugXmcWJnG.png alt=202311232214971.png>
<img src=https://s2.loli.net/2023/11/23/xMOZ7yugXmcWJnG.png alt></p><h3 id=5-在新机器上导入镜像文件>5. 在新机器上导入镜像文件</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>wsl --import Ubuntu2004 D:<span style=color:#f1fa8c>\w</span>sl<span style=color:#f1fa8c>\U</span>buntu2004<span style=color:#f1fa8c>\ </span>D:<span style=color:#f1fa8c>\U</span>buntu2004_202311.tar
</span></span></code></pre></div><p>执行的时间比较长, 执行完后至此WSL就迁移完毕了，剩下的是一下配置的修正。</p><h3 id=6-配置>6. 配置</h3><h4 id=设置默认用户>设置默认用户</h4><p>这样移过来现在登陆就是root，我们需要进行一些配置:</p><p>Set your default user inside your distro by adding the following configuration to your /etc/wsl.conf.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>[user]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>default=loo
</span></span></code></pre></div><p>If the file doesn&rsquo;t exist create it manually. Then exit your distro, terminate it (<code>wsl -t Ubuntu2004</code>) and start it again.</p><h4 id=设置默认distro>设置默认distro</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>wsl -s Ubuntu2004
</span></span></code></pre></div><p>这样完成后，所有的一切就OK了。</p><h2 id=reference-2>Reference</h2><ol><li><a href=https://zhuanlan.zhihu.com/p/622706723>https://zhuanlan.zhihu.com/p/622706723</a></li></ol><h1 id=linux组织dotfiles>Linux组织Dotfiles</h1><p>Linux开发环境中的许多软件都由配置文件，重新捣鼓一台新环境时去重新设置这些配置文件是非常复杂的一件事情，所以我想着用一种统一的方式进行管理。</p><ul><li>vimrcs 用单独的子仓库管理</li><li>vim 插件使用单独的子仓库管理</li><li>其他的配置文件暂时都使用mackup管理</li></ul><blockquote><p>不将vim插件也归于<code>mackup</code>管理的原因是: 我的<code>.vim/pack/xx/</code>下的所有插件都是通过submodule的方式管理,这样有利于维护和更新。但是在mackup的管理方式中是将整个<code>pack/</code>的内容拷贝过来，这就与submodule的理念冲突了。此时去改mackup的实现不如将vim的插件系统单独进行维护更容易。</p></blockquote><h2 id=新环境恢复dotfile>新环境恢复Dotfile</h2><ol><li>vimrcs的恢复方法: <a href=https://github.com/wangloo/myvimrcs>wangloo/myvimrcs</a></li><li>vim插件的恢复方法: <a href=https://github.com/wangloo/myvimpack>wangloo/myvimpack</a></li><li>其他配置文件，教程参考：<a href=https://github.com/wangloo/dotfiles/tree/master>wangloo/dotfiles</a></li></ol><h2 id=reference-3>Reference</h2><ul><li><a href=https://medium.com/@paulodiovani/installing-vim-8-plugins-with-the-native-pack-system-39b71c351fea>Installing Vim(8) plugins with the native pack system</a></li></ul></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-07-17T19:28:12, Lastmod: 2024-03-25T23:28:56</p></main></div></body></html>