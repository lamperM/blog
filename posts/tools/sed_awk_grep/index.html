<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>Sed/Awk/Grep 三剑客</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item" href>BACK</div><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#sed aria-label=Sed>Sed</a><ul><li><a href=#option--n- aria-label="Option: -n ">Option: <code>-n</code></a></li><li><a href=#option--i aria-label="Option: -i">Option: <code>-i</code></a></li><li><a href=#option--z aria-label="Option: -z">Option: <code>-z</code></a></li><li><a href=#commands aria-label=Commands>Commands</a></li><li><a href=#command-s-substitute aria-label="Command: s (substitute)">Command: <code>s</code> (substitute)</a><ul><li><a href=#sed-%e6%9b%bf%e6%8d%a2%e5%88%86%e9%9a%94%e7%ac%a6 aria-label="Sed 替换分隔符">Sed 替换分隔符</a></li><li><a href=#substitution-grouping aria-label="Substitution Grouping">Substitution Grouping</a></li><li><a href=#power-of----get-matched-pattern aria-label="Power of &amp;amp; - Get Matched Pattern">Power of & - Get Matched Pattern</a></li></ul></li></ul></li><li><a href=#sed-%e5%a4%84%e7%90%86bash%e5%8f%98%e9%87%8f aria-label="Sed 处理Bash变量">Sed 处理Bash变量</a></li><li><a href=#grep aria-label=Grep>Grep</a><ul><li><a href=#options aria-label=Options>Options</a><ul><li><a href=#-l-%e5%88%97%e5%87%ba%e5%8c%b9%e9%85%8d%e6%a8%a1%e5%bc%8f%e6%89%80%e5%9c%a8%e7%9a%84%e6%96%87%e4%bb%b6 aria-label="-l 列出匹配模式所在的文件"><code>-l</code> 列出匹配模式所在的文件</a></li><li><a href=#-r-%e9%80%92%e5%bd%92%e6%90%9c%e7%b4%a2%e5%a4%9a%e7%ba%a7%e7%9b%ae%e5%bd%95 aria-label="-r 递归搜索多级目录"><code>-r</code> 递归搜索多级目录</a></li><li><a href=#--exclude--exlude-dir-%e6%8e%92%e9%99%a4%e8%b7%af%e5%be%84%e5%92%8c%e6%96%87%e4%bb%b6 aria-label="--exclude/--exlude-dir 排除路径和文件"><code>--exclude</code>/<code>--exlude-dir</code> 排除路径和文件</a></li></ul></li></ul></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>Sed/Awk/Grep 三剑客</div></header><h2 id=sed>Sed</h2><p>Sed stands for <strong>Stream Editor</strong>.</p><p>Basic sed syntax:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>sed [options] {sed-commands} {input-file}
</span></span></code></pre></td></tr></table></div></div><p>Sed reads one line at a time from the {input-file} and executes the {sed-commands} on that particular line</p><blockquote><p>The input 并非必须是文件</p><p><code>echo "Some string" | sed ''</code> 当然也是支持的.</p></blockquote><h3 id=option--n->Option: <code>-n</code></h3><p>通常sed是按照行来处理文本的, 然后打印处理后的结果. 然而并不是符合匹配的行被打印, 所有的行都会被打印. 例如<code>sed 's/t/T/'</code>会输出所有的行, 并且替换其中某些行的<code>t</code>.</p><p>这样的结果不是我们想见的(大多数情况下), 所以, 我们可以添加<code>-n</code> option 来 <em>禁止自动打印所有内容</em>, 例如<code>sed -n 's/t/T/'</code> 不会输出任何结果.</p><p>如果想要将匹配的结果单独打印, 则sed为我们提供了<code>p</code>命令. 例如, <code>sed -n 's/t/T/p'</code> 只会打印替换后的行.</p><h3 id=option--i>Option: <code>-i</code></h3><p>As we know, sed doesn&rsquo;t modify the input files by default. Sed writes the output to standard output. When you want to store that in a file, you redirect it to a file (or use the <code>w</code> command.</p><p>如果要修改到源文件, 我们以前只能这样做:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed <span style=color:#d20;background-color:#fff0f0>&#39;s/John/Johnny/&#39;</span> employee.txt &gt; new-employee.txt
</span></span><span style=display:flex><span>mv new-employee.txt employee.txt
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Don&rsquo;t do <code>sed 's/John/Johnny/' employee.txt > employee.txt</code></p><p>Because whell shell see <code>> employee.txt</code> in the command line, it opens the file <code>employee.txt</code> for <strong>writing</strong>, wiping off all its previous contents.</p></blockquote><p>但现在, 有了<code>-i</code>, 我们可以选择直接修改input file.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -i <span style=color:#d20;background-color:#fff0f0>&#39;s/John/Johnny/&#39;</span> employee.txt
</span></span></code></pre></td></tr></table></div></div><p>‼️ 直接修改源文件是很危险的, 你也可以使用<code>-ibak</code>来做备份.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -ibak <span style=color:#d20;background-color:#fff0f0>&#39;s/John/Johnny/&#39;</span> employee.txt
</span></span></code></pre></td></tr></table></div></div><h3 id=option--z>Option: <code>-z</code></h3><p>原本sed是按行处理的, 也就是<code>\n</code>结尾. 使用<code>-z</code> 选项后, 转换为以<code>\0</code> 即0x00来结尾. 借用<code>-z</code> 一次跨行对整个文本进行处理.</p><h3 id=commands>Commands</h3><p><code>g</code></p><p><code>p</code></p><p><code>w</code></p><p><code>i</code> (ignore case)</p><h3 id=command-s-substitute>Command: <code>s</code> (substitute)</h3><p>The most powerful command in the stream editor is <strong>s</strong>ubstitute.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed <span style=color:#d20;background-color:#fff0f0>&#39;[address-range|pattern-range] s/old/new/[substitute-flags]&#39;</span> inputfile
</span></span></code></pre></td></tr></table></div></div><ul><li>匹配范围字段是可选的. 未指定情况下默认是<em>all lines</em>. 指定范围Example: <code>sed '/Sales/s/Manager/Director/' employee.txt</code> 仅替换<strong>包含</strong>Sales字段的行.</li></ul><h4 id=sed-替换分隔符>Sed 替换分隔符</h4><p>When there is a slash<code>/</code> in the original-string or the replacement-string, we need to escape it using <code>\</code>.
For this example create a path.txt file which contains a directory path as shown below.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed <span style=color:#d20;background-color:#fff0f0>&#39;s/\/usr\/local\/bin/\/usr\/bin/&#39;</span> path.txt
</span></span></code></pre></td></tr></table></div></div><h4 id=substitution-grouping>Substitution Grouping</h4><p>Sed中可以使用正则表达式中<em>匹配分组</em>. A group is opened with <code>\(</code> and closed with <code>\)</code>.</p><p>Example: 输出每个行第一个<code>,</code>前的所有内容.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span> sed &#39;s/\([^,]*\).*/\1/g&#39; employee.txt
</span></span></code></pre></td></tr></table></div></div><blockquote><p>[^,]* means zero or more non-comma.</p><p>In <code>[]</code>, a <code>,</code> means just a comma. And the leading <code>^</code> means &ldquo;anything but..&rdquo;.</p></blockquote><h4 id=power-of----get-matched-pattern>Power of & - Get Matched Pattern</h4><p><code>&</code> replaces it with whatever text matched the original-string or the regular-expression.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>$</span> echo <span style=color:#00d;font-weight:700>1234</span> | sed <span style=color:#a61717;background-color:#e3d2d2>&#39;</span>s/<span style=color:#00d;font-weight:700>123</span>/&lt;&amp;&gt;/<span style=color:#a61717;background-color:#e3d2d2>&#39;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#00d;font-weight:700>123</span>&gt;<span style=color:#00d;font-weight:700>4</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=sed-处理bash变量>Sed 处理Bash变量</h2><blockquote><p>一旦你的pattern中包含变量, 整个pattern必须由<strong>双引号</strong>包围.</p></blockquote><p>对于某些变量里含有forward slash(<code>/</code>), 需要换一个pattern delimiter. Sed 允许替换为任意的字符, 需要做的工作针对不同的使用情况有些许区别.</p><p><strong>Scenario #1: <code>s</code> command</strong>, 直接替换即可,</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -i <span style=color:#d20;background-color:#fff0f0>&#34;s:</span><span style=color:#369>$pushed_dir</span><span style=color:#d20;background-color:#fff0f0>:REPLACE:g&#34;</span> input_file
</span></span></code></pre></td></tr></table></div></div><p><strong>Scenario #2: For patterns used in addresses</strong>, 需要首先对新的delimiter使用<code>\:</code>进行escaped(转义)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -i <span style=color:#d20;background-color:#fff0f0>&#34;\:</span><span style=color:#369>$pushed_dir</span><span style=color:#d20;background-color:#fff0f0>:d&#34;</span> input_file
</span></span></code></pre></td></tr></table></div></div><blockquote><p>See: <a href=https://backreference.org/2010/02/20/using-different-delimiters-in-sed/index.html>Using different delimiters in sed « \1 (backreference.org)</a></p></blockquote><h2 id=grep>Grep</h2><p>Grep stands for <em>Global Regular Expression Print</em>.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>grep [OPTION]... PATTERN [FILE]...
</span></span></code></pre></td></tr></table></div></div><p>Search for <code>PATTERN</code> in each <code>FILE</code> or standard input.</p><blockquote><p>Pattern 并没有强制使用 double/single quote!</p></blockquote><blockquote><p>Pattern 默认使用基础正则表达式, <code>-E</code> option 可以使用扩展正则表达式.</p></blockquote><h3 id=options>Options</h3><h4 id=-l-列出匹配模式所在的文件><code>-l</code> 列出匹配模式所在的文件</h4><h4 id=-r-递归搜索多级目录><code>-r</code> 递归搜索多级目录</h4><p>Example: 列出当前目录(包含子目录)的所有匹配<code>main</code>关键字的文件名.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>grep -r -l <span style=color:#d20;background-color:#fff0f0>&#34;main&#34;</span> .
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>-R</code> is same as <code>-r</code>.</p></blockquote><h4 id=--exclude--exlude-dir-排除路径和文件><code>--exclude</code>/<code>--exlude-dir</code> 排除路径和文件</h4></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-01-03T19:28:12, Lastmod: 2024-01-04T16:59:55</p><script src=/js/clipboard.js></script></main></div></body></html>