<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax_pastie.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>Sed/Awk/Grep 三剑客</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#sed aria-label=Sed>Sed</a><ul><li><a href=#option--n- aria-label="Option: -n ">Option: <code>-n</code></a></li><li><a href=#option--i aria-label="Option: -i">Option: <code>-i</code></a></li><li><a href=#option--z aria-label="Option: -z">Option: <code>-z</code></a></li><li><a href=#commands aria-label=Commands>Commands</a></li><li><a href=#command-s-substitute aria-label="Command: s (substitute)">Command: <code>s</code> (substitute)</a><ul><li><a href=#sed-%e6%9b%bf%e6%8d%a2%e5%88%86%e9%9a%94%e7%ac%a6 aria-label="Sed 替换分隔符">Sed 替换分隔符</a></li><li><a href=#substitution-grouping aria-label="Substitution Grouping">Substitution Grouping</a></li><li><a href=#power-of----get-matched-pattern aria-label="Power of &amp;amp; - Get Matched Pattern">Power of & - Get Matched Pattern</a></li></ul></li></ul></li><li><a href=#sed-%e5%a4%84%e7%90%86bash%e5%8f%98%e9%87%8f aria-label="Sed 处理Bash变量">Sed 处理Bash变量</a></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>Sed/Awk/Grep 三剑客</div></header><h2 id=sed>Sed</h2><p>Sed stands for <strong>Stream Editor</strong>.</p><p>Basic sed syntax:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sed [options] {sed-commands} {input-file}
</span></span></code></pre></div><p>Sed reads one line at a time from the {input-file} and executes the {sed-commands} on that particular line</p><blockquote><p>The input 并非必须是文件</p><p><code>echo "Some string" | sed ''</code> 当然也是支持的.</p></blockquote><h3 id=option--n->Option: <code>-n</code></h3><p>通常sed是按照行来处理文本的, 然后打印处理后的结果. 然而并不是符合匹配的行被打印, 所有的行都会被打印. 例如<code>sed 's/t/T/'</code>会输出所有的行, 并且替换其中某些行的<code>t</code>.</p><p>这样的结果不是我们想见的(大多数情况下), 所以, 我们可以添加<code>-n</code> option 来 <em>禁止自动打印所有内容</em>, 例如<code>sed -n 's/t/T/'</code> 不会输出任何结果.</p><p>如果想要将匹配的结果单独打印, 则sed为我们提供了<code>p</code>命令. 例如, <code>sed -n 's/t/T/p'</code> 只会打印替换后的行.</p><h3 id=option--i>Option: <code>-i</code></h3><p>As we know, sed doesn&rsquo;t modify the input files by default. Sed writes the output to standard output. When you want to store that in a file, you redirect it to a file (or use the <code>w</code> command.</p><p>如果要修改到源文件, 我们以前只能这样做:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed <span class=s1>&#39;s/John/Johnny/&#39;</span> employee.txt &gt; new-employee.txt
</span></span><span class=line><span class=cl>mv new-employee.txt employee.txt
</span></span></code></pre></div><blockquote><p>Don&rsquo;t do <code>sed 's/John/Johnny/' employee.txt > employee.txt</code></p><p>Because whell shell see <code>> employee.txt</code> in the command line, it opens the file <code>employee.txt</code> for <strong>writing</strong>, wiping off all its previous contents.</p></blockquote><p>但现在, 有了<code>-i</code>, 我们可以选择直接修改input file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed -i <span class=s1>&#39;s/John/Johnny/&#39;</span> employee.txt
</span></span></code></pre></div><p>‼️ 直接修改源文件是很危险的, 你也可以使用<code>-ibak</code>来做备份.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed -ibak <span class=s1>&#39;s/John/Johnny/&#39;</span> employee.txt
</span></span></code></pre></div><h3 id=option--z>Option: <code>-z</code></h3><p>原本sed是按行处理的, 也就是<code>\n</code>结尾. 使用<code>-z</code> 选项后, 转换为以<code>\0</code> 即0x00来结尾. 借用<code>-z</code> 一次跨行对整个文本进行处理.</p><h3 id=commands>Commands</h3><p><code>g</code></p><p><code>p</code></p><p><code>w</code></p><p><code>i</code> (ignore case)</p><h3 id=command-s-substitute>Command: <code>s</code> (substitute)</h3><p>The most powerful command in the stream editor is <strong>s</strong>ubstitute.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed <span class=s1>&#39;[address-range|pattern-range] s/old/new/[substitute-flags]&#39;</span> inputfile
</span></span></code></pre></div><ul><li>匹配范围字段是可选的. 未指定情况下默认是<em>all lines</em>. 指定范围Example: <code>sed '/Sales/s/Manager/Director/' employee.txt</code> 仅替换<strong>包含</strong>Sales字段的行.</li></ul><h4 id=sed-替换分隔符>Sed 替换分隔符</h4><p>When there is a slash<code>/</code> in the original-string or the replacement-string, we need to escape it using <code>\</code>.
For this example create a path.txt file which contains a directory path as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed <span class=s1>&#39;s/\/usr\/local\/bin/\/usr\/bin/&#39;</span> path.txt
</span></span></code></pre></div><h4 id=substitution-grouping>Substitution Grouping</h4><p>Sed中可以使用正则表达式中<em>匹配分组</em>. A group is opened with <code>\(</code> and closed with <code>\)</code>.</p><p>Example: 输出每个行第一个<code>,</code>前的所有内容.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> sed &#39;s/\([^,]*\).*/\1/g&#39; employee.txt
</span></span></code></pre></div><blockquote><p>[^,]* means zero or more non-comma.</p><p>In <code>[]</code>, a <code>,</code> means just a comma. And the leading <code>^</code> means &ldquo;anything but..&rdquo;.</p></blockquote><h4 id=power-of----get-matched-pattern>Power of & - Get Matched Pattern</h4><p><code>&</code> replaces it with whatever text matched the original-string or the regular-expression.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=err>$</span> <span class=n>echo</span> <span class=mi>1234</span> <span class=o>|</span> <span class=n>sed</span> <span class=err>&#39;</span><span class=n>s</span><span class=o>/</span><span class=mi>123</span><span class=o>/&lt;&amp;&gt;/</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=mi>123</span><span class=o>&gt;</span><span class=mi>4</span>
</span></span></code></pre></div><h2 id=sed-处理bash变量>Sed 处理Bash变量</h2><blockquote><p>一旦你的pattern中包含变量, 整个pattern必须由<strong>双引号</strong>包围.</p></blockquote><p>对于某些变量里含有forward slash(<code>/</code>), 需要换一个pattern delimiter. Sed 允许替换为任意的字符, 需要做的工作针对不同的使用情况有些许区别.</p><p><strong>Scenario #1: <code>s</code> command</strong>, 直接替换即可,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed -i <span class=s2>&#34;s:</span><span class=nv>$pushed_dir</span><span class=s2>:REPLACE:g&#34;</span> input_file
</span></span></code></pre></div><p><strong>Scenario #2: For patterns used in addresses</strong>, 需要首先对新的delimiter使用<code>\:</code>进行escaped(转义)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sed -i <span class=s2>&#34;\:</span><span class=nv>$pushed_dir</span><span class=s2>:d&#34;</span> input_file
</span></span></code></pre></div><blockquote><p>See: <a href=https://backreference.org/2010/02/20/using-different-delimiters-in-sed/index.html>Using different delimiters in sed « \1 (backreference.org)</a></p></blockquote></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-01-03T19:28:12, Lastmod: 2024-05-12T21:54:13</p><script src=/js/copy-to-clipboard.js></script></main></div></body></html>