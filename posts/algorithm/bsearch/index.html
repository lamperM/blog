<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title>一道题搞定二分法的细节</title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item" href>BACK</div><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e9%a2%98%e7%9b%ae aria-label=题目>题目</a></li><li><a href=#%e8%a7%a3%e7%ad%94python aria-label=解答(python):>解答(python):</a></li><li><a href=#%e7%bb%86%e8%8a%82 aria-label=细节>细节</a><ul><li><a href=#%e9%97%ae%e9%a2%98%e8%bd%ac%e5%8c%96 aria-label=问题转化>问题转化</a></li><li><a href=#%e5%86%8d%e5%ae%a1%e5%8e%9f%e9%a2%98 aria-label=再审原题>再审原题</a></li></ul></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title>一道题搞定二分法的细节</div></header><p>实际上我做过的二分搜索的题目并不少，但是一直以来没有静下心去研究它的
【循环条件】【边界调整】【返回值】的细节，通过这个题目希望自己能完整、
清晰的了解二分搜索。</p><h2 id=题目>题目</h2><p><a href=https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array>https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array</a></p><blockquote><p>给你一个按照非递减顺序排列的整数数组 nums，和一个目标值 target。请你找出给定目标值在数组中的开始位置和结束位置。</p><p>如果数组中不存在目标值 target，返回 [-1, -1]。</p><p>你必须设计并实现时间复杂度为 O(log n) 的算法解决此问题。</p><blockquote><p>示例 1：</p><p>输入：nums = [5,7,7,8,8,10], target = 8
输出：[3,4]</p></blockquote></blockquote><h2 id=解答python>解答(python):</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>searchRange</span>(self, nums: List[<span style=color:#038>int</span>], target: <span style=color:#038>int</span>) -&gt; List[<span style=color:#038>int</span>]:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#080;font-weight:700>if</span> nums == []:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#080;font-weight:700>return</span> [-<span style=color:#00d;font-weight:700>1</span>, -<span style=color:#00d;font-weight:700>1</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#888># 第一次二分，确定右边界</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    left, right = <span style=color:#00d;font-weight:700>0</span>, <span style=color:#038>len</span>(nums)-<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#080;font-weight:700>while</span> left &lt;= right:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    mid = (left + right) // <span style=color:#00d;font-weight:700>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#080;font-weight:700>if</span> nums[mid] &lt;= target:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        left = mid+<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#080;font-weight:700>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        right = mid-<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    end = right
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#888># 第二次二分，确定左边界</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    left, right = <span style=color:#00d;font-weight:700>0</span>, <span style=color:#038>len</span>(nums)-<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#080;font-weight:700>while</span> left &lt;= right:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    mid = (left + right) // <span style=color:#00d;font-weight:700>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#080;font-weight:700>if</span> nums[mid] &lt; target:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        left = mid+<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#080;font-weight:700>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        right = mid-<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    sta = left
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#038>print</span>(sta, end)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#080;font-weight:700>if</span> end &lt; <span style=color:#00d;font-weight:700>0</span> <span style=color:#080>or</span> sta &gt; <span style=color:#038>len</span>(nums)-<span style=color:#00d;font-weight:700>1</span> <span style=color:#080>or</span> nums[sta] != target <span style=color:#080>or</span> nums[end] != target:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#080;font-weight:700>return</span> [-<span style=color:#00d;font-weight:700>1</span>, -<span style=color:#00d;font-weight:700>1</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#080;font-weight:700>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#080;font-weight:700>return</span> [sta, end]
</span></span></code></pre></div><h2 id=细节>细节</h2><p>写好一个二分搜索就是需要确定三件事:</p><ol><li>循环边界条件</li><li>调整边界</li><li>返回值</li></ol><p>这三件事是环环相扣的，先说确定的，调整边界的操作一定是<code>left=mid+1</code> or <code>right=mid-1</code>,
整数的二分不存在<code>left=mid</code>这种操作，仅限于浮点数中。</p><p>再说边界条件，我个人喜欢使用带等号的判断，即<code>while left &lt;= right</code>, 这纯粹是个人习惯.</p><h3 id=问题转化>问题转化</h3><p>以求右侧下标为例, 可以等价为: 搜索&lt;=target的最大值. 这其实是问题的关键, 只是另外加一个判断说如果求得数
不是target, 返回特殊值就行了. 如果你还是不理解这两个问题为什么是等价的, 那么看完下面的解释应该也能清楚.</p><p>先说搜索&lt;=target的最大值的计算方法, 一般的二分搜索, 搜索完成之后, 如果没有找到target,
<code>right=left-1</code>, <strong>且 right 指向比 target 首个小的元素,left 指向首个比 target 大的元素.</strong></p><p>那么代码是不是可以这么写:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>left, right = <span style=color:#00d;font-weight:700>0</span>, n-<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#080;font-weight:700>while</span> left &lt;= right:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    mid = (left + right) // <span style=color:#00d;font-weight:700>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#080;font-weight:700>if</span> nums[mid] == target:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#080;font-weight:700>return</span> mid
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#080;font-weight:700>elif</span> nums[mid] &lt; target:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        left += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#080;font-weight:700>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        right += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#080;font-weight:700>return</span> right
</span></span></code></pre></div><p>更进一步的说, 如果"把target也看作是小于target", 也就是让循环不停下, 最后平衡的条件也一定是满足
<strong>right 指向比 target 首个小的元素,left 指向首个比 target 大的元素.</strong>, 只不过此时=target
也被算作是小于target, 走小于target的处理流程.
最终的结果就是right指向的就是target(如果存在), 要不就是比target小的那个数.</p><p>于是代码就可以被优化为:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>left, right = <span style=color:#00d;font-weight:700>0</span>, n-<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#080;font-weight:700>while</span> left &lt;= right:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    mid = (left + right) // <span style=color:#00d;font-weight:700>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#080;font-weight:700>if</span> nums[mid] &lt;= target:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        left += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#080;font-weight:700>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>        right += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#080;font-weight:700>return</span> right
</span></span></code></pre></div><h3 id=再审原题>再审原题</h3><p>上述这种进一步思考的思想是不是与原题中的要求类似? 我可以有一连串的target, 我要求的是最右边的target在哪,
如果把=target也看作是小于target, 让循环继续跑, 最后right指向的就是最右边的那个target.</p></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 2023-08-20T20:30:35, Lastmod: 2023-09-24T18:08:59</p></main></div></body></html>