<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax_pastie.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><title></title></head><body><div id=app><div id=sideContainer class=side-container><div class=nav-link-list><div class="a-block nav-link-item"><a href=/posts>最近修改</a></div><div class="a-block nav-link-item"><a href=/categories>分类 Categories</a></div><div class="a-block nav-link-item"><a href=/tags>标签 Tags</a></div><div class="a-block nav-link-item"><a href=/index.xml>RSS Feed</a></div></div></div><div id=extraContainer class=extra-container><div class="a-block nav-link-item" href><div id=fastSearch><input id=searchInput placeholder="Press '/' to focus on me"><ul id=searchResults></ul></div></div><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%ba%90%e6%96%87%e4%bb%b6 aria-label=源文件>源文件</a></li><li><a href=#%e8%bf%90%e8%a1%8c%e5%8f%82%e6%95%b0%e8%a7%a3%e6%9e%90 aria-label=运行参数解析>运行参数解析</a></li><li><a href=#%e8%bf%90%e8%a1%8c aria-label=运行>运行</a></li></ul></div></details></div></div></div><script src=/js/fuse.js></script>
<script src=/js/fastsearch.js></script><main class=container><article><header><div class=post-title></div></header><h2 id=源文件>源文件</h2><p>模拟了一个调度器的行为，支持输入多个进程，每个进程可以包含一部分CPU计算指令和IO指令，IO指令可以设置等待时间。</p><p><a href=http://pages.cs.wisc.edu/~remzi/OSTEP/Homework/HW-CPU-Intro.tgz>http://pages.cs.wisc.edu/~remzi/OSTEP/Homework/HW-CPU-Intro.tgz</a></p><h2 id=运行参数解析>运行参数解析</h2><p>利用python OptionParser 模块</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>optparse</span> <span class=kn>import</span> <span class=n>OptionParser</span>
</span></span></code></pre></div><p>生成实例，添加支持的参数列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>parser</span> <span class=o>=</span> <span class=n>OptionParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># -s ==&gt; 短参数</span>
</span></span><span class=line><span class=cl><span class=c1># --seed ==&gt; 长参数</span>
</span></span><span class=line><span class=cl><span class=c1># default ==&gt; 默认值</span>
</span></span><span class=line><span class=cl><span class=c1># type ==&gt; type of option value</span>
</span></span><span class=line><span class=cl><span class=c1># action=&#39;store&#39; ==&gt; store option value to dest</span>
</span></span><span class=line><span class=cl><span class=c1># action=&#39;store_true&#39; ==&gt; 无需携带参数，只要出现就认为True</span>
</span></span><span class=line><span class=cl><span class=c1># dest ==&gt; member of parser for storing value</span>
</span></span><span class=line><span class=cl><span class=c1># help ==&gt; description of this option, -h时会输出</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-s&#39;</span><span class=p>,</span> <span class=s1>&#39;--seed&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;the random seed&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;int&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;seed&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-l&#39;</span><span class=p>,</span> <span class=s1>&#39;--processlist&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>help</span><span class=o>=</span><span class=s1>&#39;a comma-separated list of processes to run, in the form X1:Y1,X2:Y2,... where X is the number of instructions that process should run, and Y the chances (from 0 to 100) that an instruction will use the CPU or issue an IO&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;process_list&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-L&#39;</span><span class=p>,</span> <span class=s1>&#39;--iolength&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;how long an IO takes&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;int&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;io_length&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-S&#39;</span><span class=p>,</span> <span class=s1>&#39;--switch&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s1>&#39;SWITCH_ON_IO&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>help</span><span class=o>=</span><span class=s1>&#39;when to switch between processes: SWITCH_ON_IO, SWITCH_ON_END&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;process_switch_behavior&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-I&#39;</span><span class=p>,</span> <span class=s1>&#39;--iodone&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s1>&#39;IO_RUN_LATER&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>help</span><span class=o>=</span><span class=s1>&#39;type of behavior when IO ends: IO_RUN_LATER, IO_RUN_IMMEDIATE&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;string&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;io_done_behavior&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-c&#39;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;compute answers for me&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;solve&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_option</span><span class=p>(</span><span class=s1>&#39;-p&#39;</span><span class=p>,</span> <span class=s1>&#39;--printstats&#39;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;print statistics at end; only useful with -c flag (otherwise stats are not printed)&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;print_stats&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>根据以上定义的规则，解析本次传入的参数列表。返回两个变量：</p><ul><li>options: &lt;dest,value>的键值对。<code>options.seed</code> 访问seed参数的值</li><li>args: 按照规则解析后残余的参数list</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>(</span><span class=n>options</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=运行>运行</h2><p>输出我们给定的策略，包括每个进程的指令流，调度器的任务切换逻辑。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>options</span><span class=o>.</span><span class=n>solve</span> <span class=o>==</span> <span class=kc>False</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;Produce a trace of what would happen when you run these processes:&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pid</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>get_num_processes</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s1>&#39;Process </span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>pid</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>inst</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>get_num_instructions</span><span class=p>(</span><span class=n>pid</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span> <span class=s1>&#39;  </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>s</span><span class=o>.</span><span class=n>get_instruction</span><span class=p>(</span><span class=n>pid</span><span class=p>,</span> <span class=n>inst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;Important behaviors:&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;  System will switch when&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>options</span><span class=o>.</span><span class=n>process_switch_behavior</span> <span class=o>==</span> <span class=n>SCHED_SWITCH_ON_IO</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s1>&#39;the current process is FINISHED or ISSUES AN IO&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s1>&#39;the current process is FINISHED&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;  After IOs, the process issuing the IO will&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>options</span><span class=o>.</span><span class=n>io_done_behavior</span> <span class=o>==</span> <span class=n>IO_RUN_IMMEDIATE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s1>&#39;run IMMEDIATELY&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span> <span class=s1>&#39;run LATER (when it is its turn)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></div></article></body><hr width=100% id=EOF><p style=color:#777>创建于: 0001-01-01T00:00:00, Lastmod: 2024-04-22T14:38:42</p><script src=/js/copy-to-clipboard.js></script></main></div></body></html>