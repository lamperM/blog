<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Homepage ğŸŒˆ on Soben's Secret Base</title><link>https://wangloo.github.io/</link><description>Recent content in Homepage ğŸŒˆ on Soben's Secret Base</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>@2019 Notepadium.</copyright><lastBuildDate>Thu, 15 Sep 2022 15:14:05 +0800</lastBuildDate><atom:link href="https://wangloo.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>C è¯­è¨€ä½æ“ä½œæŠ€å·§</title><link>https://wangloo.github.io/posts/codestyle/bit-operation-hacks/</link><pubDate>Sun, 03 Jul 2022 09:44:13 +0800</pubDate><guid>https://wangloo.github.io/posts/codestyle/bit-operation-hacks/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/codestyle/bit-operation-hacks/ -&lt;h2 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º2çš„å¹‚">åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º2çš„å¹‚&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> v;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> ((v &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> (v &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>)) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;v is a power of 2&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;v is not a power of 2&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡">ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡&lt;/h2>
&lt;p>ä¾ç„¶æ˜¯åˆ©ç”¨&lt;code>v &amp;amp; (v -1)&lt;/code>çš„è¿ç®—ç»“æœä¼šå°†vçš„æœ€ä½ä½çš„&lt;code>1&lt;/code>(å¦‚æœæœ‰çš„è¯)ç½®&lt;code>0&lt;/code>.&lt;/p>
&lt;p>å¾ªç¯æ‰§è¡Œæ­¤æ“ä½œå°±å¯ç»Ÿè®¡vä¸­&lt;code>1&lt;/code>çš„æ•°é‡.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">numberof1&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> count &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>(v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> count&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#ff79c6">=&lt;/span> v &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> (v &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å°†ä¸€ä¸ªæ•°å‘ä¸Šå–æ•´ä¸º2çš„å¹‚">å°†ä¸€ä¸ªæ•°å‘ä¸Šå–æ•´ä¸º2çš„å¹‚&lt;/h2>
&lt;p>ç”¨ä¸€ä¸ª&lt;code>1&lt;/code>ä¸€ç›´å·¦ç§», ç›´åˆ°æ¯”è¿™ä¸ªæ•°å¤§ä¸ºæ­¢.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">uint32_t&lt;/span> &lt;span style="color:#50fa7b">roundup_pow_op_two&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">uint32_t&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">uint32_t&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (ret &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ret &lt;span style="color:#ff79c6">=&lt;/span> ret &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å‘ä¸Šå‘ä¸‹å¯¹é½-æ£€æŸ¥æ˜¯å¦å¯¹é½">å‘ä¸Š/å‘ä¸‹å¯¹é½, æ£€æŸ¥æ˜¯å¦å¯¹é½&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">/* uintptr_t ä»£è¡¨æŒ‡é’ˆçš„ä½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * åŠ uintptr_tè½¬æ¢çš„åŸå› æ˜¯: (void *)ä¸èƒ½è¿›è¡Œè¿ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define IS_ALIGNED(X, align) (((uintptr_t)(const void *)(X)) % (align) == 0)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define ALIGN_UP(X, align) (((X) + ((align) - 1)) &amp;amp; ~((align) - 1))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define ALIGN_DOWN(x, align) ((X) &amp;amp; ~((align) - 1))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define X (0x12345675)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define align (1 &amp;lt;&amp;lt; 2)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> v &lt;span style="color:#ff79c6">=&lt;/span> IS_ALIGNED(X, align);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">==&lt;/span> v) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;Given X(0x%x) is not align to 0x%08x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, X, align);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;After align up, new X = 0x%x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, ALIGN_UP(X, align));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;After align down, new X = 0x%x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, ALIGN_DOWN(X, align));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;Give X(0x%x) is aligned to 0x%08x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, X, align);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;After align up, new X = 0x%x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, ALIGN_UP(X, align));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;After align down, new X = 0x%x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, ALIGN_DOWN(X, align));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="æ£€æŸ¥ä¸¤ä¸ªæœ‰ç¬¦å·æ•°æ˜¯å¦å¼‚å·">æ£€æŸ¥ä¸¤ä¸ªæœ‰ç¬¦å·æ•°æ˜¯å¦å¼‚å·&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> x,y;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> ((x &lt;span style="color:#ff79c6">^&lt;/span> y) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;They have opposite signs&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;They have same signs&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å¤§å°ç«¯è½¬æ¢">å¤§å°ç«¯è½¬æ¢&lt;/h2>
&lt;p>Â &lt;/p>
&lt;h2 id="å¯¹æŸä¸ªä½çš„getsetclearæ“ä½œ">å¯¹æŸä¸ªä½çš„get/set/clearæ“ä½œ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define GET_BIT(x, bit) ( ((x) &amp;amp; (1ULL &amp;lt;&amp;lt; (bit))) &amp;gt;&amp;gt; (bit) )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define SET_BIT(x, bit) ( (x) |= (1ULL &amp;lt;&amp;lt; (bit)) )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define CLEAR_BIT(x, bit) ( (x) &amp;amp;= ~(1ULL &amp;lt;&amp;lt; (bit)) )
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Release note:&lt;/p>
&lt;ol>
&lt;li>æ·»åŠ å¯¹&lt;code>unsigned long long&lt;/code>é•¿åº¦çš„æ”¯æŒ&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="sign-extending-from-a-varaiable-bit-width">Sign extending from a varaiable bit-width&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> bits &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>; &lt;span style="color:#6272a4">// number of bits representing the number in x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0xFFC1&lt;/span>; &lt;span style="color:#6272a4">// ready to get sign-extended
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> rst; &lt;span style="color:#6272a4">// resulting sign-extended number
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">const&lt;/span> mask &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1U&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> (bits &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>); &lt;span style="color:#6272a4">// mask can be pre-computed if bits if fixed.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#ff79c6">=&lt;/span> x &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ((&lt;span style="color:#bd93f9">1U&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> bits) &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>); &lt;span style="color:#6272a4">// cut x if it holds more bits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> rst &lt;span style="color:#ff79c6">=&lt;/span> (x &lt;span style="color:#ff79c6">^&lt;/span> mask) &lt;span style="color:#ff79c6">-&lt;/span> mask; &lt;span style="color:#6272a4">// excellent trick!
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;INPUT: 0x%x, RESULT: 0x%x&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, x, rst);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å­—ç¬¦å­—ç¬¦æ•°ç»„çš„å¤§å°å†™è½¬æ¢">å­—ç¬¦/å­—ç¬¦æ•°ç»„çš„å¤§å°å†™è½¬æ¢&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define TO_LOWER(c) (unsigned char)((c &amp;gt;= &amp;#39;A&amp;#39; &amp;amp;&amp;amp; c &amp;lt;= &amp;#39;Z&amp;#39;) ? (c | 0x20) : c)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define TO_UPPER(c) (unsigned char)((c &amp;gt;= &amp;#39;a&amp;#39; &amp;amp;&amp;amp; c &amp;lt;= &amp;#39;z&amp;#39;) ? (c &amp;amp; ~0x20) : c)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define TO_LOWER_STR(s, len) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"> for (int i = 0; i &amp;lt; len &amp;amp;&amp;amp; s[i] != &amp;#39;\0&amp;#39;; i++) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"> s[i] = TO_LOWER(s[i]); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"> } \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define TO_UPPER_STR(s, len) {\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"> for (int i = 0; i &amp;lt; len &amp;amp;&amp;amp; s[i] != &amp;#39;\0&amp;#39;; i++) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"> s[i] = TO_UPPER(s[i]); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"> } \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/codestyle/bit-operation-hacks/ - @2019 Notepadium.</description></item><item><title>Stack and Heap</title><link>https://wangloo.github.io/posts/os/stack-and-heap/</link><pubDate>Tue, 28 Jun 2022 16:41:54 +0800</pubDate><guid>https://wangloo.github.io/posts/os/stack-and-heap/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/os/stack-and-heap/ -&lt;p>Â &lt;/p>
&lt;h2 id="å †çš„å«ä¹‰">å †çš„å«ä¹‰&lt;/h2>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“&lt;code>malloc&lt;/code>åŠ¨æ€ç”³è¯·çš„å˜é‡æ˜¯å­˜æ”¾åœ¨å †ä¸­. æ‰€ä»¥ç›¸æ¯”æ ˆæ¥è¯´, å †æ˜¯åŠ¨æ€çš„.&lt;/p>
&lt;p>å †å æ®è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„å¤§éƒ¨åˆ†, æˆ‘ä»¬å¯èƒ½é€šè¿‡å †æ¥ç”³è¯·&lt;code>1GB&lt;/code>çš„æ•°ç»„, ä½†æ˜¯æ ˆé€šå¸¸ä¸è¡Œ
, å¤§å¤šä¹Ÿå°±å‡ å…†çš„ç©ºé—´.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å †ç©ºé—´çš„ç®¡ç†">å †ç©ºé—´çš„ç®¡ç†&lt;/h2>
&lt;p>è¿›ç¨‹ä¸­å †ç©ºé—´çš„ç®¡ç†æ˜¯&lt;code>è¿è¡Œåº“&lt;/code>è´Ÿè´£çš„, åœ¨Linuxä¸­æ˜¯&lt;code>GLIBC&lt;/code>.&lt;/p>
&lt;p>è¿è¡Œåº“åœ¨åˆå§‹åŒ–æ—¶ä¼šåƒæ“ä½œç³»ç»Ÿç”³è¯·ä¸€å¤§å—çš„å †ç©ºé—´, å†ä¸ºæ¯ä¸ªè¿›è¡Œåˆ†åˆ«åˆ†é…éœ€æ±‚. å½“ç„¶,
å¦‚æœæŸäº›ç¨‹åºçš„éœ€æ±‚è¿‡å¤§, è¿è¡Œåº“ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>mmap&lt;/code>ç³»ç»Ÿè°ƒç”¨ç›´æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·, ç„¶å
è¿”å›ç»™ç”¨æˆ·è¿›ç¨‹.&lt;/p>
&lt;blockquote>
&lt;p>GLIBCçš„&lt;code>malloc&lt;/code>å‡½æ•°çš„å¤„ç†æ–¹å¼æ˜¯: å¯¹äºå°äº&lt;code>128KB&lt;/code>çš„ç”³è¯·, ä¼šä»è¿è¡Œåº“&amp;quot;æ‰¹å‘çš„&amp;quot;å †ç©ºé—´
é‡Œåˆ†å‡ºä¸€å—æ¥; ä½†è‹¥ç”³è¯·çš„ç©ºé—´è¿‡å¤§, åˆ™ä½¿ç”¨&lt;code>mmap&lt;/code>ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºåŒ¿åç©ºé—´åˆ†é…ç»™ç”¨æˆ·.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>Linuxä¸­è™šæ‹Ÿåœ°å€å—(VMA)çš„ç®¡ç†ä½¿ç”¨äº†çº¢é»‘æ ‘, å¯ä»¥ç”¨äºè¿è¡Œåº“ç®¡ç†è‡ªå·±å‘æ“ä½œç³»ç»Ÿ
&amp;ldquo;æ‰¹å‘&amp;quot;çš„å †ç©ºé—´. ä½¿å¾—ç”¨æˆ·ç¨‹åºåŠ¨æ€ç”³è¯·å’Œé‡Šæ”¾å†…å­˜æ€§èƒ½æé«˜.&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/os/stack-and-heap/ - @2019 Notepadium.</description></item><item><title>åŠ¨æ€é“¾æ¥</title><link>https://wangloo.github.io/posts/os/dynamic-link/</link><pubDate>Sun, 26 Jun 2022 19:50:45 +0800</pubDate><guid>https://wangloo.github.io/posts/os/dynamic-link/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/os/dynamic-link/ -&lt;h2 id="é™æ€é“¾æ¥å¸¦æ¥çš„é—®é¢˜">é™æ€é“¾æ¥å¸¦æ¥çš„é—®é¢˜&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>åƒæ˜¯&lt;code>libc&lt;/code>è¿™ç§å‡ ä¹æ¯ä¸ªç¨‹åºéƒ½è¦ç”¨åˆ°çš„åº“, å¦‚æœæ˜¯é™æ€çš„, é‚£ä¹ˆä¸ä»…æ„å¤–ç€æ¯ä¸ªç¨‹åºçš„
å¯æ‰§è¡Œæ–‡ä»¶å¾ˆå¤§, æµªè´¹ç£ç›˜ç©ºé—´. å¹¶ä¸”å½“ç¨‹åºåŠ è½½åˆ°å†…å­˜æ—¶, å¯èƒ½è®¸å¤šç¨‹åºéƒ½ä¼šç”¨åˆ°&lt;code>printf&lt;/code>
, ä½¿å¾—å†…å­˜ä¸­ä¼šå­˜åœ¨å¥½å¤šä»½çš„&lt;code>printf&lt;/code>æºç .&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»´æŠ¤å’Œæ›´æ–°éš¾. ä¸€æ—¦é™æ€é“¾æ¥çš„å…¶ä¸­ä¸€ä¸ªç›®æ ‡æ–‡ä»¶æ›´æ–°, æ‰€æœ‰çš„å¯æ‰§è¡Œç¨‹åºéƒ½è¦é‡æ–°é“¾æ¥.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸æ»¡è¶³å±€éƒ¨æ€§åŸç†. ä¸Šé¢æåˆ°, å†…å­˜ä¸­åŒæ—¶å­˜åœ¨å¤šä»½çš„&lt;code>printf&lt;/code>æºç ä¼šç ´å&lt;em>å±€éƒ¨æ€§åŸç†&lt;/em>çš„.
æ˜¾ç„¶å¦‚æœæ‰€æœ‰çš„ç¨‹åºå…±äº«ä¸€ä»½&lt;code>printf&lt;/code>æºç çš„æƒ³æ³•æ›´å¥½. å³åŠ¨æ€åŠ è½½.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ç§»æ¤æ€§å·®. é™æ€é“¾æ¥, åªè¦æœ‰ä¸€ä¸ªä¾èµ–ç›®æ ‡æ–‡ä»¶çš„å®ç°ä¸åŒ, è½¯ä»¶å‚å•†å°±å¾—ä¸“é—¨å‘å¸ƒä¸€ä¸ª
ç‰ˆæœ¬. è€ŒåŠ¨æ€é“¾æ¥åˆ™ä¿¡èµ–å®¢æˆ·ç”µè„‘ä¸Šçš„&lt;em>åŠ¨æ€åº“&lt;/em>, ç›¸å½“äºä¸€ä¸ªä¸­é—´å±‚.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Â &lt;/p>
&lt;h2 id="åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹">åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹&lt;/h2>
&lt;p>å¯¹æ¯”é™æ€é“¾æ¥ä½¿ç”¨&lt;code>ld&lt;/code>é“¾æ¥å™¨åœ¨ç¼–è¯‘åå³æ‰§è¡Œé“¾æ¥, åŠ¨æ€é“¾æ¥åˆ™æ˜¯å°†é“¾æ¥è¿‡ç¨‹æ¨è¿Ÿåˆ°&lt;strong>è¿è¡Œæ—¶&lt;/strong>,
å³è£…è½½åˆ°å†…å­˜æ—¶.&lt;/p>
&lt;p>è¿™æ ·, é“¾æ¥å™¨åœ¨é“¾æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æ—¶å°±æœ‰ä¸¤ç§åšæ³•:&lt;/p>
&lt;ul>
&lt;li>å¯¹äºé™æ€ç¬¦å·, æŒ‰ç…§é™æ€é“¾æ¥çš„è§„åˆ™è¿›è¡Œ&lt;em>åœ°å€å¼•ç”¨é‡å®šä½&lt;/em>&lt;/li>
&lt;li>å¯¹äºåŠ¨æ€ç¬¦å·, é“¾æ¥å™¨åˆ™ä»…æ ‡è®°å…¶ä¸ºåŠ¨æ€é“¾æ¥ä¸­çš„ç¬¦å·, ä¸è¿›è¡Œå¤„ç†. è€Œæ˜¯ç­‰åˆ°è£…è½½æ—¶ç”±
ä¸“é—¨çš„&lt;em>åŠ¨æ€é“¾æ¥å™¨&lt;/em>æ¥å®ŒæˆåŠ¨æ€ç¬¦å·çš„é“¾æ¥å·¥ä½œ.&lt;/li>
&lt;/ul>
&lt;p>â‰ï¸ é“¾æ¥å™¨å¦‚ä½•ç¡®å®šä¸€ä¸ªç¬¦å·æ˜¯é™æ€çš„oråŠ¨æ€çš„?&lt;/p>
&lt;p>åœ¨åŠ¨æ€å…±äº«å¯¹è±¡(&lt;em>.so)ä¸­ä¿å­˜äº†å®Œæ•´çš„&lt;/em>åŠ¨æ€ç¬¦å·è¡¨*, è¡¨ä¸­å­˜åœ¨çš„ç¬¦å·å³ä¸ºåŠ¨æ€çš„, å¦åˆ™ä¸ºé™æ€.&lt;/p>
&lt;blockquote>
&lt;p>Linuxçš„Cè¯­è¨€è¿è¡Œåº“&lt;code>glib&lt;/code>çš„åŠ¨æ€é“¾æ¥ç‰ˆæœ¬å«&lt;code>libc.so&lt;/code>. å®ƒåœ¨å¤–å­˜ä¸Šåªä¿å­˜ä¸€ä»½, æ‰€æœ‰çš„ç¨‹åº
éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒ. æ‰€ä»¥åƒä¸‡ä¸è¦åˆ æ‰å®ƒ.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>åŠ¨æ€é“¾æ¥æœ‰ä¸€å®šçš„æ€§èƒ½æŸå¤±, å› ä¸ºæ¯æ¬¡è¿è¡Œç¨‹åºæ—¶éƒ½è¦é‡æ–°é“¾æ¥, å¹¶ä¸åƒé™æ€é“¾æ¥æ˜¯ä¸€åŠ³æ°¸é€¸çš„.
ä¹Ÿæœ‰ä¾‹å¦‚&lt;code>å»¶è¿Ÿç»‘å®š&lt;/code>å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–çš„æ–¹æ³•, å¤§æ¦‚ä»…æœ‰5%çš„æŸè€—, ä¸å¸¦æ¥çš„ä¾¿åˆ©ç›¸æ¯”å¯ä»¥å¿½ç•¥ä¸è®¡.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="åœ°å€æ— å…³ä»£ç -pic">åœ°å€æ— å…³ä»£ç  PIC&lt;/h2>
&lt;p>GCCç”ŸæˆåŠ¨æ€åº“æ—¶éœ€è¦æ·»åŠ å‚æ•°&lt;code>-fPIC&lt;/code>, å«ä¹‰å°±æ˜¯ç”Ÿæˆåœ°å€æ— å…³ç &lt;/p>
&lt;p>åœ°å€æ— å…³ç çš„å«ä¹‰æ˜¯ä»£ç ä¸­&lt;strong>ä¸åŒ…å«ä»»ä½•çš„ç»å¯¹åœ°å€å¼•ç”¨&lt;/strong>, å…¨éƒ½æ˜¯&lt;strong>ç›¸å¯¹åœ°å€&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>å¯¹äº&lt;strong>æ¨¡å—å†…&lt;/strong>çš„è·³è½¬/æ•°æ®å¼•ç”¨, ä½¿ç”¨ç›¸å¯¹çš„è·³è½¬/åŠ è½½æŒ‡ä»¤. ä¾‹å¦‚ARMæŒ‡ä»¤é›†ä¸­çš„&lt;code>B&lt;/code>, &lt;code>ADR&lt;/code>, ç»è¿‡æ±‡ç¼–å™¨ä¹‹å, ç›®æ ‡çš„åœ°å€éƒ½ä¼šè½¬ä¸ºç›¸å¯¹äºè¯¥æŒ‡ä»¤(PC)çš„åç§».&lt;/li>
&lt;li>å¯¹äº&lt;strong>æ¨¡å—é—´&lt;/strong>çš„è·³è½¬/æ•°æ®å¼•ç”¨, å€Ÿç”¨&lt;em>GOTè¡¨&lt;/em>æ¥é—´æ¥å®ç°åœ°å€æ— å…³.&lt;/li>
&lt;/ul>
&lt;p>è€Œå¦‚æœè¯¥åŠ¨æ€åº“ä¸­å…¨éƒ¨ä½¿ç”¨ç›¸å¯¹åœ°å€, é‚£ä¹ˆåŠ è½½æ—¶ä¹Ÿå°±ä¸éœ€è¦è¿›è¡Œé‡å®šä½, å³æ‰€æœ‰çš„ç¨‹åºéƒ½å¯ä»¥
å…±äº«è¿™äº›åœ°å€æ— å…³ä»£ç .&lt;/p>
&lt;blockquote>
&lt;p>ä¸Šé¢è¯´PICçš„åŠ¨æ€åº“ä¸éœ€è¦é‡å®šä½å…¶å®æ˜¯é”™è¯¯çš„, åªä¸è¿‡å®ƒçš„é‡å®šä½è¿‡ç¨‹ä¸éœ€è¦ä¿®æ”¹ä»£ç æ®µ,
è€Œæ˜¯è®¾ç½®äº†ä¸€ä¸ªæ”¾ç½®åœ¨æ•°æ®æ®µçš„&lt;em>GOT&lt;/em>è¡¨æ¥å®ç°ä»£ç æ®µéƒ¨åˆ†çš„åœ°å€æ— å…³ç‰¹æ€§.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ç°åœ¨è²Œä¼¼GCC ARMç‰ˆæœ¬åœ¨ç¼–è¯‘åŠ¨æ€åº“æ—¶å¼ºåˆ¶ä½¿ç”¨-fPICé€‰é¡¹, å¦åˆ™ä¼šæŠ¥é”™. å¯¹æ­¤æˆ‘ä¸æ˜¯
éå¸¸ç¡®å®š!&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ä¸€èˆ¬æ¥è¯´, ä¸å°†ä¸»ç¨‹åºç¼–è¯‘ä¸ºåœ°å€æ— å…³ç . å› ä¸ºä¸»ç¨‹åºä¸éœ€è¦å…±äº«, è€Œä¸”åœ°å€æ— å…³ç çš„è°ƒç”¨
éœ€è¦ä¸¤ä¸ªæŒ‡ä»¤: &lt;code>è®¡ç®—åœ°å€&lt;/code> + &lt;code>è·³è½¬&lt;/code>. å¤šäº†ä¸€æ­¥æ ¹æ®åç§»å¾—åˆ°ç»å¯¹åœ°å€.&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/os/dynamic-link/ - @2019 Notepadium.</description></item><item><title>ELF æ–‡ä»¶çš„é“¾æ¥ä¸åŠ è½½</title><link>https://wangloo.github.io/posts/os/elf-format/</link><pubDate>Mon, 20 Jun 2022 16:21:27 +0800</pubDate><guid>https://wangloo.github.io/posts/os/elf-format/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/os/elf-format/ -&lt;h2 id="elf-is-a-file-format">&lt;code>ELF&lt;/code> is a file format&lt;/h2>
&lt;p>Files in &lt;code>ELF&lt;/code> format includes:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>å®ä¾‹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Relocatable File&lt;/td>
&lt;td>è¿™äº›æ–‡ä»¶åŒ…å«äº†ä»£ç å’Œdata, å¯ä»¥è¢«ç”¨æ¥é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«ç›®æ ‡æ–‡ä»¶.&lt;/td>
&lt;td>&lt;code>.o&lt;/code>, &lt;code>.a&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Executable File&lt;/td>
&lt;td>ç›´æ¥å¯æ‰§è¡Œçš„æ–‡ä»¶&lt;/td>
&lt;td>&lt;code>/bin/ls&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Object File&lt;/td>
&lt;td>Including code and data. é“¾æ¥å™¨å¯å°†å…¶ä¸å…¶ä»–Relocatable Fileæˆ–Shared Object Fileç»“åˆ, ç”Ÿæˆæ–°çš„ç›®æ ‡æ–‡ä»¶. åŠ¨æ€é“¾æ¥å™¨å¯å°†å…¶ä¸Executable Fileç»“åˆ, ä½œä¸ºè¿›ç¨‹æ˜ åƒçš„ä¸€éƒ¨åˆ†æ¥è¿è¡Œ.&lt;/td>
&lt;td>&lt;code>.so&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Core Dump File&lt;/td>
&lt;td>Restore critical infomation when process is terminated unexpectedly&lt;/td>
&lt;td>&lt;code>core dump&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;blockquote>
&lt;p>ğŸ“Œ &lt;code>file&lt;/code> command in Linux can output the format of a file.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="elf-æ–‡ä»¶ç»„æˆçš„ç»“æ„">ELF æ–‡ä»¶ç»„æˆçš„ç»“æ„&lt;/h2>
&lt;pre tabindex="0">&lt;code>+---------------------------------+
| ELF Header | åŒ…å«æè¿°æ•´ä¸ªELFçš„åŸºæœ¬ä¿¡æ¯, å¦‚ç‰ˆæœ¬, å…¥å£åœ°å€...
+---------------------------------+
| .text |
+---------------------------------+
| .data |
+---------------------------------+ ç´§æ¥ç€æ˜¯å„ä¸ªæ®µ
| .bss |
+---------------------------------+
| ... |
| other sections |
+---------------------------------+
| | æ®µè¡¨: ä¸æ®µç›¸å…³æœ€é‡è¦çš„ç»“æ„
| Section Header table | æè¿°äº†æ¯ä¸ªæ®µçš„name, length, authority...
| |
+---------------------------------+
| String tables |
| Symbol tables |
+---------------------------------+
&lt;/code>&lt;/pre>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å­—æ®µ&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>e_machine&lt;/td>
&lt;td>ç›®æ ‡æ¶æ„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_entry&lt;/td>
&lt;td>å…¥å£åœ°å€&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_machine&lt;/td>
&lt;td>ç›®æ ‡æ¶æ„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_phnum&lt;/td>
&lt;td>number of entries in the &lt;strong>program header table&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_shnum&lt;/td>
&lt;td>number of entries in the &lt;strong>section header table&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_shoff&lt;/td>
&lt;td>offset, in bytes, of the section header table&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_phoff&lt;/td>
&lt;td>offset, in bytes, of the program header table&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_machine&lt;/td>
&lt;td>ç›®æ ‡æ¶æ„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>e_machine&lt;/td>
&lt;td>ç›®æ ‡æ¶æ„&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="æ®µè¡¨">æ®µè¡¨&lt;/h3>
&lt;p>ELFæ–‡ä»¶ä¸­çš„å„ä¸ªæ®µçš„åŸºæœ¬å±æ€§å°±æ˜¯ä¿å­˜åœ¨&lt;strong>æ®µè¡¨&lt;/strong>ä¸­ï¼Œæ˜¯åˆ†æELFæ–‡ä»¶æœ€é‡è¦çš„å­—æ®µã€‚å­˜æ”¾äº†æ¯ä¸ªæ®µçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæ®µåï¼Œæ®µçš„é•¿åº¦ï¼Œåœ¨æ–‡ä»¶ä¸­çš„åç§»ï¼Œè¯»å†™æƒé™ä»¥åŠå…¶ä»–å±æ€§ã€‚&lt;/p>
&lt;p>ç¼–è¯‘å™¨ã€é“¾æ¥å™¨éƒ½æ˜¯ä¾é æ®µè¡¨æ¥å®šä½å’Œè®¿é—®å„ä¸ªæ®µçš„å±æ€§çš„ã€‚&lt;/p>
&lt;p>å¦‚ä½•æ‰¾åˆ°æ®µè¡¨ï¼Ÿ &lt;strong>&lt;code>e_shoff&lt;/code>å­—æ®µ&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨&lt;code>readelf -S &amp;lt;elfname&amp;gt;&lt;/code> å°±èƒ½æŸ¥çœ‹ELFæ–‡ä»¶çš„æ®µè¡¨&lt;/p>
&lt;/blockquote>
&lt;h3 id="ç¨‹åºå¤´è¡¨">ç¨‹åºå¤´è¡¨&lt;/h3>
&lt;p>Â &lt;/p>
&lt;h2 id="åˆ†æelfæ–‡ä»¶çš„å·¥å…·">åˆ†æELFæ–‡ä»¶çš„å·¥å…·&lt;/h2>
&lt;h3 id="1-objdump">1. objdump&lt;/h3>
&lt;h3 id="2-readelf">2. readelf&lt;/h3>
&lt;p>Â &lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆç›®æ ‡æ–‡ä»¶ä¸­ä»£ç å’Œæ•°æ®è¦åˆ†å¼€æ”¾">ä¸ºä»€ä¹ˆç›®æ ‡æ–‡ä»¶ä¸­ä»£ç å’Œæ•°æ®è¦åˆ†å¼€æ”¾?&lt;/h2>
&lt;p>ä¸€æ–¹é¢, ç¨‹åºè¢«åŠ è½½è¿›å†…å­˜å, ä»£ç æ®µå’Œæ•°æ®æ®µåˆ†åˆ«è¢«æ˜ å°„åˆ°&lt;strong>ä¸¤ä¸ªvirtual memory region&lt;/strong>.
é€šè¿‡MMUçš„æ”¯æŒ, å¯ä»¥å°†ä»£ç æ®µçš„åŒºåŸŸè®¾ç½®ä¸ºåªè¯», é˜²æ­¢æ¶æ„ç¯¡æ”¹.&lt;/p>
&lt;p>å¦ä¸€æ–¹é¢, å½“ä¸‹CPU Cacheå¤šåˆ’åˆ†ä¸º&lt;em>Instruction Cache&lt;/em>å’Œ&lt;em>Data Cache&lt;/em>, å†é…åˆäº’ç›¸ç‹¬ç«‹çš„
åœ°å€åŒºåŸŸèƒ½å¤Ÿæé«˜&lt;strong>å±€éƒ¨æ€§åŸç†&lt;/strong>çš„æ•ˆæœ.&lt;/p>
&lt;p>æœ€å, ä»£ç æ®µå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«(ä¾‹å¦‚éƒ½è°ƒç”¨åŒä¸€å¤–éƒ¨å‡½æ•°), èŠ‚çœå†…å­˜ç©ºé—´.&lt;/p>
&lt;blockquote>
&lt;p>é’ˆå¯¹åµŒå…¥å¼è®¾å¤‡, å¦‚æœå†…å­˜ç©ºé—´ä¸å¤Ÿå¤§, åªè¯»çš„ä»£ç æ®µå¯å­˜æ”¾åœ¨ROMä¸­&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="å…³äºé™æ€åº“">å…³äºé™æ€åº“&lt;/h2>
&lt;p>ä¸€ä¸ªé™æ€åº“å¯ä»¥ç®€å•çš„çœ‹ä½œæ˜¯ a set of object file.&lt;br>
è¿™äº› object file å¯èƒ½åŒ…æ‹¬: è¾“å…¥è¾“å‡ºç›¸å…³çš„&lt;code>printf.o&lt;/code>, &lt;code>scanf.o&lt;/code>, æ—¥æœŸæ—¶é—´ç›¸å…³çš„&lt;code>time.o&lt;/code>, &lt;code>date.o&lt;/code>ç­‰.&lt;/p>
&lt;p>â“ ä¸ºä»€ä¹ˆä¸ç›´æ¥æä¾›è¿™äº›&lt;em>ç›®æ ‡æ–‡ä»¶&lt;/em>å‘¢?&lt;/p>
&lt;p>è¿™äº›&lt;strong>é›¶æ•£çš„&lt;/strong>æ–‡ä»¶è‹¥ç›´æ¥æä¾›ç»™ä½¿ç”¨è€…, å¾ˆå¤§ç¨‹åº¦ä¸Šé€ æˆæ–‡ä»¶ä¼ è¾“, ç®¡ç†ç­‰æ–¹é¢çš„ä¸ä¾¿.&lt;br>
äºæ˜¯äººä»¬é€šå¸¸ä½¿ç”¨&lt;code>ar&lt;/code>å‹ç¼©ç¨‹åºå°†è¿™äº›ç›®æ ‡æ–‡ä»¶å‹ç¼©åˆ°ä¸€èµ·.&lt;/p>
&lt;p>â“ å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªé™æ€åº“æ˜¯ç”±å“ªäº›object fileå‹ç¼©åˆ°ä¸€èµ·çš„?&lt;/p>
&lt;p>Shell command&lt;code>ar -t libc.a&lt;/code> å¯ä»¥æŸ¥çœ‹&lt;code>libc.a&lt;/code>ä¸­åŒ…å«çš„æ‰€æœ‰object files.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="elfæ–‡ä»¶åŠ è½½-è¿è¡Œæµç¨‹">ELFæ–‡ä»¶åŠ è½½-è¿è¡Œæµç¨‹&lt;/h2>
&lt;blockquote>
&lt;p>åºŸäº†åŠå¤©åŠ²ç¼–è¯‘ç”Ÿæˆçš„ELFæ–‡ä»¶, æƒ³è¦æœ€ç»ˆè·‘èµ·æ¥åˆ™åŒ…å«çš„instruction and dataå¿…é¡»è¦åœ¨å†…å­˜ä¸­.&lt;/p>
&lt;/blockquote>
&lt;h3 id="é™æ€åŠ è½½ä¸åŠ¨æ€åŠ è½½">é™æ€åŠ è½½ä¸åŠ¨æ€åŠ è½½&lt;/h3>
&lt;p>æˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„åŠæ³•æ˜¯: æŠŠæ•´ä¸ªELFçš„&lt;strong>æ‰€æœ‰æŒ‡ä»¤å’Œæ•°æ®&lt;/strong>åœ¨è¿è¡Œä¹‹å‰å°±å…¨éƒ¨loadåˆ°å†…å­˜ä¸­. è¿™å°±æ˜¯&lt;em>é™æ€åŠ è½½&lt;/em>.&lt;/p>
&lt;p>æ›´åŠ é«˜æ•ˆçš„åšæ³•æ˜¯: å……åˆ†åˆ©ç”¨&lt;em>å±€éƒ¨æ€§åŸç†&lt;/em>, å°†æŒ‡ä»¤å’Œæ•°æ®åˆ’åˆ†ä¸º&lt;strong>æ¨¡å—&lt;/strong>, åªæœ‰å½“è¯¥æ¨¡å—è¢«ä½¿ç”¨æ—¶, æ‰loadè¿›å†…å­˜,
å¦åˆ™å°±åœ¨å¤–å­˜ä¸­è€è€å®å®å‘†ç€. è¿™å°±æ˜¯&lt;em>åŠ¨æ€åŠ è½½&lt;/em>.&lt;/p>
&lt;h3 id="åŠ¨æ€åŠ è½½çš„æ­¥éª¤">åŠ¨æ€åŠ è½½çš„æ­¥éª¤&lt;/h3>
&lt;p>å€ŸåŠ©&lt;em>è™šæ‹Ÿå†…å­˜&lt;/em>æŠ€æœ¯, ä¸Šé¢æåˆ°çš„&lt;strong>æ¨¡å—&lt;/strong>çš„æ¦‚å¿µå¯ä»¥è‡ªç„¶çš„è¢«&lt;strong>é¡µ&lt;/strong>(page)ä»£æ›¿.
æˆ‘ä»¬å°†æ‰€æœ‰çš„æŒ‡ä»¤å’Œæ•°æ®æŒ‰ç…§pageä¸ºå•ä½åˆ’åˆ†.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è¿è¡Œè¯¥ELFçš„çº¿ç¨‹è¢«åˆ›å»ºæ—¶, å…¶virtual spaceèŒƒå›´è¢«åˆ’å®š, ä½†å…¶é¡µè¡¨æ˜¯ç©ºçš„, æ²¡æœ‰ä»»ä½•æ˜ å°„.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>OSè¯»å–ELF Header, å»ºç«‹virtual spaceä¸&lt;strong>ELFæ–‡ä»¶&lt;/strong>çš„æ˜ å°„å…³ç³». è¿™ä¸ªæ˜ å°„å…³ç³»çš„è¡¨è¾¾æ–¹å¼æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„&lt;strong>æ•°æ®ç»“æ„&lt;/strong>.
å»ºç«‹è¯¥æ˜ å°„å…³ç³»çš„åŸå› æ˜¯: å½“ç¨‹åºè¿è¡Œåˆ°æŸä¸ªåœ°å€å‘ç°è¯¥é¡µè¡¨é¡¹æ˜¯ç©ºçš„(ä¾‹å¦‚ &lt;code>call 0x1234&lt;/code>), é‚£ä¹ˆå¿…ç„¶è§¦å‘&lt;code>page fault&lt;/code>.
ç”±OSè´Ÿè´£åˆ°&lt;em>ç‰¹å®šçš„å¤–å­˜åœ°å€&lt;/em>å°†é¡µé¢åŠ è½½åˆ°physical memoryä¸­.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>OSè¦æƒ³çŸ¥é“ç¼ºå¤±çš„å†…å®¹åœ¨ELFæ–‡ä»¶çš„å“ªä¸ªä½ç½®, å°±æ˜¯åˆ©ç”¨è¯¥æ˜ å°„, å³æŸä¸ªæ•°æ®ç»“æ„
&lt;/code>&lt;/pre>&lt;ol start="3">
&lt;li>physical memoryä¸­æœ‰äº†æ‰€éœ€çš„æŒ‡ä»¤æˆ–æ•°æ®å, è¿˜éœ€å»ºç«‹visual memoryåˆ°physical memoryçš„æ˜ å°„, å³åœ¨&lt;em>é¡µè¡¨é¡¹&lt;/em>ä¸­å†™å…¥.
éšç€ç¨‹åºçš„è¿è¡Œ, ä¼šç»§ç»­è§¦å‘&lt;code>page fault&lt;/code>, ä»ELFä¸­ä¸æ–­load pageåˆ°physical memory, å»ºç«‹ç¼ºé¡µvisual addrå¤„çš„é¡µè¡¨æ˜ å°„,
æœ€ç»ˆå¡«è¡¥æˆä¸€ä¸ªå®Œæ•´çš„pagetable.&lt;/li>
&lt;/ol>
&lt;p>Â &lt;/p>
&lt;h2 id="æ®µåœ°å€å¯¹é½æŠ€æœ¯">æ®µåœ°å€å¯¹é½æŠ€æœ¯&lt;/h2>
&lt;blockquote>
&lt;p>ç”±å‰é¢åŠ¨æ€åŠ è½½çš„æ­¥éª¤å¯çŸ¥, ELFæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®è¢«æŒ‰pageåˆ’åˆ†. å¹¶åªæœ‰åœ¨ç”¨åˆ°æ—¶æ‰è¢«åŠ è½½åˆ°å†…å­˜,
å¹¶å»ºç«‹&lt;code>è™šæ‹Ÿå†…å­˜-ç‰©ç†å†…å­˜&lt;/code>çš„æ˜ å°„.&lt;/p>
&lt;/blockquote>
&lt;p>å‡è®¾ä¸€ä¸ªELFæœ‰ä¸‰ä¸ªæ®µéœ€è¦è¢«&lt;code>LOAD&lt;/code>, ELFæ®µè¡¨å¦‚ä¸‹:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Segment&lt;/th>
&lt;th>Length&lt;/th>
&lt;th>offset&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>SEG 0&lt;/td>
&lt;td>127 B&lt;/td>
&lt;td>34 B&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SEG 1&lt;/td>
&lt;td>9899 B&lt;/td>
&lt;td>164 B&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SEG 2&lt;/td>
&lt;td>1988 B&lt;/td>
&lt;td>0 B&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="-è¿™ä¸‰ä¸ªæ®µåœ¨elfæ–‡ä»¶ä¸­çš„å¸ƒå±€å¦‚ä½•">â“ è¿™ä¸‰ä¸ªæ®µåœ¨ELFæ–‡ä»¶ä¸­çš„å¸ƒå±€å¦‚ä½•?&lt;/h3>
&lt;p>æ ¹æ®å‰é¢ELFæ–‡ä»¶æ ¼å¼çš„ä»‹ç», è¿™ä¸‰ä¸ªæ®µå¿…ç„¶æ˜¯æŒ¨ç€çš„(ç®€å•è€ƒè™‘, ELFä¸­ä»…æœ‰è¿™ä¸‰ä¸ªæ®µ).&lt;/p>
&lt;h3 id="-è¿™ä¸‰ä¸ªæ®µåœ¨ç‰©ç†å†…å­˜ä¸­çš„å¸ƒå±€">â“ è¿™ä¸‰ä¸ªæ®µåœ¨ç‰©ç†å†…å­˜ä¸­çš„å¸ƒå±€?&lt;/h3>
&lt;p>å‘ç”Ÿ&lt;code>page fault&lt;/code>ä¹‹å, OSä¼šä¸ºé¡µé¢åˆ†é…åˆé€‚çš„ç‰©ç†é¡µé¢, å¦‚åˆ©ç”¨&lt;code>buddy system&lt;/code>ç­‰.&lt;/p>
&lt;p>å¯ä»¥ä¿è¯&lt;em>æ®µå†…&lt;/em>çš„è¿ç»­, ä¸èƒ½ä¿è¯&lt;em>æ®µä¸æ®µ&lt;/em>æ˜¯è¿ç»­çš„.&lt;/p>
&lt;blockquote>
&lt;p>æœªä½¿ç”¨æ®µå¯¹é½æŠ€æœ¯ä¹‹å‰, &lt;code>SEG0&lt;/code>çš„é•¿åº¦ä¸è¶³ä¸€é¡µ, ä½†æ˜¯ä¹Ÿç»™å®ƒåˆ†é…ä¸€é¡µçš„ç©ºé—´. åŒç†ä¸º&lt;code>SEG1&lt;/code>åˆ†é…ä¸¤é¡µ, &lt;code>SEG2&lt;/code>åˆ†é…ä¸€é¡µ.
æ€»å…±å ç”¨ &lt;code>1+2+1=5&lt;/code>ä¸ªç‰©ç†é¡µ.&lt;/p>
&lt;/blockquote>
&lt;h3 id="-è¿™ä¸‰ä¸ªæ®µåœ¨ç”¨æˆ·virtual-addrspaceä¸‹çš„å¸ƒå±€å¦‚ä½•">â“ è¿™ä¸‰ä¸ªæ®µåœ¨ç”¨æˆ·virtual addrspaceä¸‹çš„å¸ƒå±€å¦‚ä½•?&lt;/h3>
&lt;p>todo&lt;/p>
&lt;h3 id="-ä½•ä¸ºæ®µåœ°å€å¯¹é½æŠ€æœ¯">â“ ä½•ä¸ºæ®µåœ°å€å¯¹é½æŠ€æœ¯?&lt;/h3>
&lt;p>ä¸Šé¢è¯´äº†, åœ¨ä¸ºè¿™ä¸‰ä¸ªæ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶, è™½ç„¶ä»–ä»¬çš„çœŸå®å¤§å°è¿œå°äº5ä¸ªé¡µé¢, ä½†ç”±äºç®€å•é‡‡ç”¨: &lt;code>æ¯ä¸ªæ®µçš„å¼€å¤´å¿…é¡»æ˜¯page align&lt;/code>,
å¯¼è‡´å®é™…ä¸Šäº§ç”Ÿäº†å·¨å¤§çš„&lt;strong>å†…éƒ¨ç¢ç‰‡&lt;/strong>.&lt;/p>
&lt;p>æ®µåœ°å€å¯¹é½å®é™…ä¸Šå°±æ˜¯åœ¨ä¸ºELFæ–‡ä»¶ä¸­çš„æ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶, ä¸è€ƒè™‘å…¶æ®µçš„ç‹¬ç«‹æ€§, å¼ºåˆ¶æŒ‰ç…§&lt;code>page&lt;/code>æ¥åˆ’åˆ†. åˆ’åˆ†çš„è¡Œä¸ºå¦‚ä¸‹å›¾æ‰€ç¤º.
ç»“æœå°±æ˜¯ä»…éœ€å ç”¨&lt;code>3&lt;/code>ä¸ªç‰©ç†é¡µé¢.&lt;/p>
&lt;pre tabindex="0">&lt;code>+---+---------------+
| P | SEG0 |
| A +---------------+
| G | |
| E | |
+---+ |
| P | SEG1 |
| A | |
| G | |
| E | |
+---+ |
| P +---------------+
| A | |
| G | SEG2 |
| E | |
+---+---------------+
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>ç›®å‰, gcc(æ›´å‡†ç¡®æ˜¯è¯´æ˜¯GUN ld)é»˜è®¤å¯ç”¨æ®µå¯¹é½æŠ€æœ¯. å„ä¸ªæ®µçš„è™šæ‹Ÿåœ°å€å¹¶ä¸æ˜¯&lt;code>page align&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ğŸ€ ç‰©ç†é¡µé¢åˆ°è™šæ‹Ÿé¡µé¢çš„æ˜ å°„é˜¶æ®µ, é‚£äº›&lt;em>åŒæ—¶åŒ…å«&lt;/em>ä¸¤ä¸ªæ®µçš„é¡µé¢ä¼šè¢«æ˜ å°„ä¸¤æ¬¡, å³ä¸€ä¸ªç‰©ç†é¡µé¢å¯¹åº”ä¸¤ä¸ª
è™šæ‹Ÿé¡µ.&lt;/p>
&lt;p>åŸå› æ˜¯: åœ¨ä¸€ä¸ªé¡µé¢çš„ä¸åŒæ®µå¯èƒ½&lt;strong>æƒé™ä¸åŒ&lt;/strong>, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨åŒä¸€æ˜ å°„.&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/os/elf-format/ - @2019 Notepadium.</description></item><item><title>Improving the quality of C code</title><link>https://wangloo.github.io/posts/codestyle/improve_quality/</link><pubDate>Tue, 14 Jun 2022 17:59:22 +0800</pubDate><guid>https://wangloo.github.io/posts/codestyle/improve_quality/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/codestyle/improve_quality/ -&lt;h2 id="æ·»åŠ æ›´å¤šçš„ç¼–è¯‘é€‰é¡¹comiler-optionsæ¥é˜²æ­¢bug">æ·»åŠ æ›´å¤šçš„ç¼–è¯‘é€‰é¡¹(comiler options)æ¥é˜²æ­¢bug&lt;/h2>
&lt;p>å¯¹äºæˆ‘å¸¸ç”¨çš„&lt;code>GCC&lt;/code>, æ¨èå¼€å¯ä¸€ä¸‹çš„compiler options:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>-Wall&lt;/code>: enable a lot of common warnings&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-Wno-format-truncation&lt;/code>: warns about the snprintf output buffer not being
large enough for a corresponding â€œ%sâ€ in the format string.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-Werror&lt;/code>: turn warnings into errors.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="åŠ¨æ€ç”³è¯·çš„ç©ºé—´åˆ°åº•è¦ä¸è¦é‡Šæ”¾">åŠ¨æ€ç”³è¯·çš„ç©ºé—´åˆ°åº•è¦ä¸è¦é‡Šæ”¾&lt;/h2>
&lt;p>When using a barebones embedded OS, you absolutely need to tightly manage your memory.&lt;/p>
&lt;p>ä½†æ˜¯, å¦‚æœä½ æ˜¯å†™åº”ç”¨ä¸šåŠ¡çš„ä»£ç , ç‰¹åˆ«æ˜¯åœ¨å†…å­˜è¶³å¤Ÿçš„åœºæ™¯ä¸‹. æœ€å¥½ä¸è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜,
å› ä¸ºå½“çº¿ç¨‹/è¿›ç¨‹é€€å‡ºæ—¶, æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡Šæ”¾. &lt;strong>æŸäº›æƒ…å†µä¸‹, é‡Šæ”¾å†…å­˜çš„æ“ä½œä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå¢åŠ é€»è¾‘çš„å¤æ‚åº¦&lt;/strong>.&lt;/p>
&lt;blockquote>
&lt;p>å¦‚æœä½ æ˜¯ä¸€ä¸ªå†…æ ¸ç¨‹åºå‘˜, åˆ™å¿…é¡»æ‰‹åŠ¨çš„é‡Šæ”¾. ä¸ç”¨æ€€ç–‘.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h3 id="å°½å¯èƒ½åœ¨åˆ›å»ºå˜é‡æ—¶èµ‹åˆå€¼">å°½å¯èƒ½åœ¨åˆ›å»ºå˜é‡æ—¶èµ‹åˆå€¼&lt;/h3>
&lt;p>æ”¾ç½®æŸäº›å˜é‡åˆ›å»ºåæ˜¯ &lt;code>magic value&lt;/code>. è€Œä½¿ç”¨è¿™äº›å˜é‡å¯èƒ½ä¸ä¼šç«‹é©¬å¯¼è‡´é”™è¯¯, ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªéšæ‚£.&lt;/p>
&lt;p>ä½†è¿™ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜, æœ‰æ—¶æˆ‘ä»¬å®šä¹‰å˜é‡ä¹‹åçš„ä¸ä¹…ä¹‹åå°±ä¼šå¯¹å…¶èµ‹äºˆæ­£ç¡®çš„å€¼, è¿™æ—¶å€™åˆå€¼å°±æ˜¯
å¤šä½™çš„. è€Œä¸”ç»´æŠ¤è€…å¯èƒ½è®¤ä¸ºè¿™ä¸ªå€¼æ˜¯meaningful, è¿™å°±è¦æ±‚æˆ‘ä»¬å¦‚æœè¦èµ‹åˆå€¼, å°±è¦è¯´æ˜è¿™ä¸ªå€¼
ä»…ä»…æ˜¯&lt;strong>æ— æ„ä¹‰çš„&lt;/strong>åˆå€¼.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h3 id="ä½¿ç”¨define-enum">ä½¿ç”¨&lt;code>#define&lt;/code>, &lt;code>enum&lt;/code>&lt;/h3>
&lt;p>å¯¹äºä»£ç åœ¨ä¸åŒåœ°æ–¹ä½¿ç”¨çš„åŒä¸€ä¸ªå€¼, åº”ä½¿ç”¨&lt;code>#define&lt;/code>æ¥å£°æ˜ä½¿å¾—ä»£ç &lt;strong>maintainable&lt;/strong>.&lt;/p>
&lt;p>å¦‚æœè¿™äº›å€¼æœ‰å¤šä¸ªä¸”èƒ½è§„åˆ’ä¸ºåŒä¸€ç±»åˆ«, åˆ™è¿˜å¯å°†&lt;code>#define&lt;/code>çš„æ–¹å¼æ¢ä¸º&lt;code>enum&lt;/code>. è¿™ä¼šä½¿ä»£ç æ›´åŠ &lt;strong>meaningful&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨&lt;code>enum&lt;/code>ä½¿è¿˜è¦æ³¨æ„å…¶æ‰€å å†…å­˜ç©ºé—´åœ¨ä¸åŒæ¶æ„ä¸­å¯èƒ½ä¸åŒçš„é—®é¢˜, see &lt;a href="https://www.cnblogs.com/bluettt/p/16041867.html">enumçš„ä¼˜åŠ¿å’Œæ¼æ´&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h3 id="ä½¿ç”¨typedefä¼˜åŒ–function-pointer">ä½¿ç”¨&lt;code>typedef&lt;/code>ä¼˜åŒ–function pointer&lt;/h3>
&lt;p>Â &lt;/p>
&lt;h3 id="é‡å®šä¹‰ä¸€å¥—è‡ªå·±çš„ç±»å‹">é‡å®šä¹‰ä¸€å¥—è‡ªå·±çš„ç±»å‹&lt;/h3>
&lt;p>åœ¨å¼€å‘å¤§é¡¹ç›®æ—¶, éœ€è¦è€ƒè™‘å¯ç§»æ¤æ€§çš„æƒ…å†µä¸‹, æœ€å¥½åˆ©ç”¨&lt;code>typedef&lt;/code>å¯¹ç±»å‹è¿›è¡Œé‡å®šä¹‰.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#if SYSTEM1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> INT32;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> INT32;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä¸Š, å¯¹äºæŸäº›æ¶æ„&lt;code>int&lt;/code>ç±»å‹å¯èƒ½ä¸æ˜¯32bit, æ­¤æ—¶å°±è¦ä½¿ç”¨&lt;code>long&lt;/code>. è¿™ç§å®šä¹‰çš„æ–¹å¼ä¼šä¿è¯æˆ‘ä»¬çš„ç³»ç»Ÿ
åœ¨ä»»ä½•æ¶æ„ä¸­éƒ½ä¸ä¼šå‡ºç°ç±»å‹çš„bug. è€Œä¸”ä¹Ÿå¢åŠ äº†ä»£ç çš„&lt;strong>readability&lt;/strong>.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å–„ç”¨0">å–„ç”¨&lt;code>~0&lt;/code>&lt;/h2>
&lt;p>åœ¨åšåµŒå…¥å¼ç¼–ç¨‹æ—¶, æœ‰æ—¶åœ¨è®¾ç½®æ©ç (mask)æˆ–è€…å…¶ä»–æƒ…å†µä¼šè¦ç”¨åˆ°&lt;strong>å…¨1&lt;/strong>çš„å˜é‡å€¼, ä½ æ˜¯å¦ç»å¸¸è¿™æ ·å£°æ˜?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> mask &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0xffff&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æš‚ä¸”ä¸è°ˆ&lt;code>int&lt;/code>ç±»å‹åˆ°åº•å å¤šå°‘å­—èŠ‚çš„é—®é¢˜. å°±åƒä¸Šé¢ä¸€æ ·, æˆ‘ä»¬ç¨‹åºå‘˜ç»å¸¸å¿˜è®°æŸä¸ªç±»å‹çš„å¤§å°,
è€Œå°‘æ·»åŠ äº†&lt;code>f&lt;/code>. ä¼šå¯¼è‡´å˜é‡&lt;code>mask&lt;/code>çš„å€¼ä¸æ˜¯å…¨1(32ä½æƒ…å†µä¸‹).&lt;/p>
&lt;p>è¿™æ˜¯è¦å˜æ¢ä¸€ä¸‹æ€ç»´, ä½¿ç”¨&lt;code>~0&lt;/code>çš„å®šä¹‰æ–¹æ³•å°±å¯è½»æ¾åŒ–è§£, æ— éœ€ç®¡å˜é‡çš„ç±»å‹æ˜¯ä»€ä¹ˆ.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> mask &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>&lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="åˆç†çš„ä½¿ç”¨gotoè¯­å¥">åˆç†çš„ä½¿ç”¨&lt;code>goto&lt;/code>è¯­å¥&lt;/h2>
&lt;p>åœ¨å¤§å­¦è¯¾å ‚ä¸­, æˆ‘ä»¬è€å¸ˆè¯´è¿‡ç¦æ­¢ä½¿ç”¨&lt;code>goto&lt;/code>è¯­å¥, ä½†å´æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„åŸå› .&lt;/p>
&lt;p>å®é™…ä¸Š, &lt;strong>åˆç†çš„&lt;/strong>ä½¿ç”¨&lt;code>goto&lt;/code>èƒ½å¤Ÿæå¤§çš„å‡å°‘ç¨‹åºçš„å†—ä½™åº¦.&lt;/p>
&lt;p>&lt;code>goto&lt;/code>è¯­å¥å¸¸ç”¨äºç¨‹åºå‡ºç°é”™è¯¯è¦é€€å‡ºæ—¶, å¯èƒ½æœ‰å¤šä¸ªæƒ…å†µä¼šä½¿ç”¨é‡å¤çš„ä»£ç å¤„ç†,
ä¾‹å¦‚é‡Šæ”¾ä¸€äº›allocated memory. ç›¸è¾ƒäºä½¿ç”¨&lt;code>flag&lt;/code>, ä½¿ç”¨&lt;code>goto&lt;/code>æ˜¾ç„¶æ›´åŠ clearly and readability.&lt;/p>
&lt;p>æ‰€ä»¥, åœ¨é¢å¯¹é‡å¤çš„é”™è¯¯å¤„ç†ä»£ç æ—¶, æƒ³æƒ³èƒ½ä¸èƒ½ç”¨&lt;code>goto&lt;/code>è¿›è¡Œä¼˜åŒ–. å½“ç„¶, &lt;strong>é¿å…è¿‡æ—©ä¼˜åŒ–&lt;/strong>.&lt;/p>
&lt;blockquote>
&lt;p>æ³¨æ„, &lt;code>goto&lt;/code>å‡ºç°çš„åœºæ™¯å…¶å®å¾ˆå—é™. Never use a backward &lt;code>goto&lt;/code> or jump into control statements.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="æ°¸è¿œä¸ºä½ çš„å‡½æ•°è®¾ç½®error-return-value">æ°¸è¿œä¸ºä½ çš„å‡½æ•°è®¾ç½®error return value&lt;/h2>
&lt;p>ä¸€æ—¦ä½ çš„å‡½æ•°å¯èƒ½è¢«å…¶ä»–äººè°ƒç”¨, é‚£ä¹ˆå…»æˆè®¾ç½®return valueçš„ä¹ æƒ¯. å³ä¾¿ä½ ç°åœ¨çš„å®ç°
å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•é”™è¯¯, ä¹Ÿè¯·è¿”å›&lt;code>success&lt;/code>.&lt;/p>
&lt;p>è¿™æ ·åšçš„åŸå› æ˜¯, callerå¯ä»¥æ ¹æ®ä½ çš„å®šä¹‰åšé”™è¯¯åˆ¤æ–­, å³ä¾¿ä»¥åä½ çš„å®ç°åŠ ä¸Šäº†å‡ºé”™æƒ…å†µ,
ä¸Šå±‚çš„ä»£ç ä¹Ÿä¸éœ€è¦ä¿®æ”¹.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å˜é‡ç±»å‹çš„é€‰æ‹©">å˜é‡ç±»å‹çš„é€‰æ‹©&lt;/h2>
&lt;ul>
&lt;li>åå­—, ç‰¹å®šä¸å˜çš„å­—ç¬¦ä¸²ä½¿ç”¨&lt;code>const char *&lt;/code>, ç”šè‡³&lt;code>const char const*&lt;/code>&lt;/li>
&lt;li>é•¿åº¦ä½¿ç”¨&lt;code>size_t&lt;/code>&lt;/li>
&lt;li>è¡¨ç¤ºç±»å‹çš„å‚æ•°å°½å¯èƒ½ä½¿ç”¨&lt;code>enum&lt;/code>&lt;/li>
&lt;li>å¾ªç¯å˜é‡iä½¿ç”¨&lt;code>signed&lt;/code>, é¿å…æº¢å‡ºåå‡ºé”™&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;p>&lt;a href="https://www.msweet.org/blog/2020-12-31-how-i-improve-my-c-code-quality.html">How I Improve My (C) Code Quality&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.codeproject.com/Articles/357065/Ten-Fallacies-of-Good-C-Code">Ten Fallacies of Good C Code&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/codestyle/improve_quality/ - @2019 Notepadium.</description></item><item><title>MicroKernel Learning: SeL4</title><link>https://wangloo.github.io/posts/microkernel/sel4/</link><pubDate>Sat, 04 Jun 2022 11:52:51 +0800</pubDate><guid>https://wangloo.github.io/posts/microkernel/sel4/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/microkernel/sel4/ -&lt;h2 id="sel4-capabilities">seL4 Capabilities&lt;/h2>
&lt;p>In seL4, capabilities are stored in &lt;strong>C-space&lt;/strong>. C-space is a hierarchical data structure very similar to &lt;strong>page table&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>page table is a mapping from virtual address to physical address.&lt;/li>
&lt;li>C-space is a mapping from &lt;strong>object ID&lt;/strong> to &lt;strong>capability&lt;/strong>.&lt;/li>
&lt;li>Kernel object is made up of several &lt;strong>C-nodes&lt;/strong>, just like a page table made up of individual page tables.&lt;/li>
&lt;li>Each C-nodes is an array of cap &lt;em>slots&lt;/em>, which contain capability.&lt;/li>
&lt;/ul>
&lt;p>Inaccessible to userland, you can never hold an &lt;strong>actual capability&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>You can only hold a reference to capability, which pointers into C-space(slot addresses)&lt;/li>
&lt;li>These C-space addresses are called &lt;strong>CPTRs&lt;/strong>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>You don&amp;rsquo;t need to do the transform, because this is typically extracted in some libs.&lt;/p>
&lt;/blockquote>
&lt;p>Capabilities convey specific privilege (acces rights)&lt;/p>
&lt;ul>
&lt;li>Read, Write, Execute, GrantReply(&lt;code>call&lt;/code>), Grant(&lt;code>cap transfer&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>Main operations on capabilities:&lt;/p>
&lt;ul>
&lt;li>&lt;code>Invoke&lt;/code>perform operation on object referred to by cap.
&lt;ul>
&lt;li>For example, map some frame into memory. You need to have capabilities to both the frame and address space.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Copy&lt;/code>|&lt;code>Mint&lt;/code>|&lt;code>Grant&lt;/code>: create copy of cap with &lt;strong>same/lesser&lt;/strong> privilege.&lt;/li>
&lt;li>&lt;code>Move&lt;/code>|&lt;code>Mutate&lt;/code>: transfer to different address with &lt;strong>same/lesser&lt;/strong> privilege.
&lt;ul>
&lt;li>Between C-space or within C-space.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Delete&lt;/code>: invalidate slot(cleans up object if this is the only cap to it)&lt;/li>
&lt;li>&lt;code>Revoke&lt;/code>: delete any derived(eg. copied or minted) caps&lt;/li>
&lt;/ul>
&lt;h3 id="capability-derivation">Capability Derivation&lt;/h3>
&lt;h4 id="mint-operation">MINT OPERATION&lt;/h4>
&lt;p>The &lt;strong>Mint&lt;/strong> operation creates a new, less powerful cap&lt;/p>
&lt;ul>
&lt;li>Can add badge&lt;/li>
&lt;li>Can strip access rights, eg &lt;code>RW-&amp;gt;RO&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>mint(dest, src, rights, badge)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>The first two arguement are &lt;strong>capability pointers(CPTR)&lt;/strong> to a C-space(represented by C-node), which are references inside C-node.&lt;/li>
&lt;li>The &lt;strong>destination C-node cap&lt;/strong> must allow modification&lt;/li>
&lt;li>Then you have the rights and the &lt;em>batch&lt;/em> of the new cap.&lt;/li>
&lt;/ul>
&lt;p>ğŸ“Œ This is an alternative of sending addressed capabilities by &lt;strong>IPC operation&lt;/strong>.
That is what operating system do to set up protection domains for &lt;strong>user level process&lt;/strong>.&lt;/p>
&lt;h4 id="copy-operation">COPY OPERATION&lt;/h4>
&lt;blockquote>
&lt;p>Copy as a version of &lt;em>Mint&lt;/em>.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="sel4-kernel-objects">seL4 Kernel Objects&lt;/h2>
&lt;p>In file &lt;code>libsel4\include\sel4\objecttype.h&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">enum&lt;/span> api_object {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seL4_UntypedObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seL4_TCBObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seL4_EndpointObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seL4_NotificationObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seL4_CapTableObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#ifdef CONFIG_KERNEL_MCS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span> seL4_SchedContextObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seL4_ReplyObject,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span> seL4_NonArchObjectTypeCount,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} seL4_ObjectType;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="sel4-system-calls">seL4 System Calls&lt;/h2>
&lt;p>seL4 has &lt;code>11&lt;/code> syscalls:&lt;/p>
&lt;p>&lt;code>Yield()&lt;/code>: invokes scheduler&lt;/p>
&lt;ul>
&lt;li>does NOT require a capability!&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Send()&lt;/code>,&lt;code>Recv()&lt;/code> and variants/combinations thereof: IPC operations&lt;/p>
&lt;ul>
&lt;li>&lt;code>Call()&lt;/code>,&lt;code>ReplyRecv()&lt;/code>: usually invokes by client/server&lt;/li>
&lt;li>&lt;code>Send()&lt;/code>, &lt;code>NBSend()&lt;/code>: send-only and non-blocking version of it.&lt;/li>
&lt;li>&lt;code>Recv()&lt;/code>, &lt;code>NBRecv()&lt;/code>, &lt;code>NBSendRecv()&lt;/code>&lt;/li>
&lt;li>&lt;code>Wait()&lt;/code>, &lt;code>NBWait()&lt;/code>, &lt;code>NBSendWait()&lt;/code>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>We just use &lt;code>Call()&lt;/code> normally, the others are only for bootstrapping protocols and exception handling.&lt;/p>
&lt;/blockquote>
&lt;p>Call() is atomic Send() + reply-object setup + Wait()&lt;/p>
&lt;ul>
&lt;li>cannot be simulated with one-way operations!&lt;/li>
&lt;/ul>
&lt;p>ReplyRecv() is NBSend() + Recv()&lt;/p>
&lt;h3 id="different-object-support-different-operations">Different object support different operations&lt;/h3>
&lt;h4 id="endpoints">ENDPOINTS&lt;/h4>
&lt;p>Endpoints support all 10 IPC variants.&lt;/p>
&lt;h4 id="notifications">NOTIFICATIONS&lt;/h4>
&lt;p>Notifications support:&lt;/p>
&lt;ul>
&lt;li>NBSend() - aliased as Signal()&lt;/li>
&lt;li>Wait()&lt;/li>
&lt;li>NBWait() - aliased as Poll()&lt;/li>
&lt;/ul>
&lt;h4 id="other-objects">OTHER OBJECTS&lt;/h4>
&lt;p>Other objects only supports &lt;code>Call()&lt;/code> operation.&lt;/p>
&lt;ul>
&lt;li>Appear as (kernel-implemented) servers. If you invoking a method on an object, this is done by treating the object as a kernel-implemented server. And you invoke it with a &lt;code>call()&lt;/code> operation just as you do a normal server invocation.&lt;/li>
&lt;li>Each of these kernel objects has a different kernel-defined protocol
&lt;ul>
&lt;li>operations encoded in message tag&lt;/li>
&lt;li>parameters passed in message words&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Mostly hidden behind &lt;strong>syscall&lt;/strong> wrappers, user do not need to know this details.&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="sel4-ipc">seL4 IPC&lt;/h2>
&lt;blockquote>
&lt;p>IPC in seL4 is a way to realize &lt;strong>cross-domain&lt;/strong> invocation.&lt;/p>
&lt;/blockquote>
&lt;p>seL4 IPC is not a mechanism for shipping data. Transfering data is axillary but not the primary purpose.&lt;/p>
&lt;p>seL4 IPC is a protected procedure call, a user-controlled context switch(from clients context into server context).&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="sel4-threads">seL4 Threads&lt;/h2>
&lt;h3 id="creating-a-thread">Creating a thread&lt;/h3>
&lt;ol>
&lt;li>Obtain a TCB object&lt;/li>
&lt;li>Set attributes: V-space, C-space, fault endpoint, IPC buffer&lt;/li>
&lt;li>Set Scheduling parameters:
&lt;ul>
&lt;li>priority, scheduling context, timeout endpoint(maybe MCP)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Set architecture-related registers&lt;/li>
&lt;/ol>
&lt;h3 id="threads-and-stacks">Threads and Stacks&lt;/h3>
&lt;p>Stacks are completely user-managed, kernel doesn&amp;rsquo;t care!&lt;/p>
&lt;blockquote>
&lt;p>Kernel only preserves SP.. on context switch&lt;/p>
&lt;/blockquote>
&lt;p>Stack location, allocation, size must be managed by &lt;strong>userland&lt;/strong>.&lt;/p>
&lt;p>Kernel beware of stack overflow&lt;/p>
- https://wangloo.github.io/posts/microkernel/sel4/ - @2019 Notepadium.</description></item><item><title>ä½¿ç”¨ HuGo æ­å»ºä¸ªäººç½‘ç«™</title><link>https://wangloo.github.io/posts/hugo/</link><pubDate>Sat, 21 May 2022 17:39:42 +0800</pubDate><guid>https://wangloo.github.io/posts/hugo/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/hugo/ -&lt;h1 id="hugo-åŸºç¡€å­¦ä¹ ">HuGo åŸºç¡€å­¦ä¹ &lt;/h1>
&lt;p>æœ¬ç« å°†è§£ç­”Hugoæ˜¯ä»€ä¹ˆ, ä»¥åŠHugoæ˜¯å¦‚ä½•å·¥ä½œçš„. åªæœ‰äº†è§£Hugoçš„å·¥ä½œæœºåˆ¶ä¹‹å, æ‰èƒ½å‘æŒ¥æƒ³è±¡åŠ›è¿›è¡ŒDIY.&lt;/p>
&lt;p>æœ¬ç« å†…å®¹å¤§å¤šæ¥è‡ª&lt;a href="https://gohugo.io/documentation/">å®˜æ–¹æ‰‹å†Œ&lt;/a>æˆ–è€…æœç´¢å¼•æ“æä¾›çš„ç»“æœ.&lt;/p>
&lt;h2 id="hugo-é¡¹ç›®ç›®å½•ç»“æ„">Hugo é¡¹ç›®ç›®å½•ç»“æ„&lt;/h2>
&lt;p>ä¸€ä¸ªhugo é¡¹ç›®é€šå¸¸åŒ…å«ä»¥ä¸‹å†…å®¹:&lt;/p>
&lt;pre tabindex="0">&lt;code>.
â”œâ”€â”€ archetypes
â”œâ”€â”€ config.toml
â”œâ”€â”€ content
â”œâ”€â”€ data
â”œâ”€â”€ layouts
â”œâ”€â”€ public
â”œâ”€â”€ static
â””â”€â”€ themes
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œé¢æœ‰äº›æ˜¯å¿…é¡»çš„, æœ‰äº›æ˜¯å¯é€‰çš„.&lt;/p>
&lt;p>&lt;strong>archetypes&lt;/strong>&lt;/p>
&lt;p>å®šä¹‰æ–°åˆ›å»ºpostæ—¶, headerçš„æ ¼å¼.&lt;/p>
&lt;p>&lt;strong>asserts&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>Note: assets directory is not created by default.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>config&lt;/strong>&lt;/p>
&lt;p>Hugo uses the &lt;code>config.toml&lt;/code>, &lt;code>config.yaml&lt;/code>, or &lt;code>config.json&lt;/code> (if found in the site root) as the default site config file.&lt;/p>
&lt;p>The user can choose to override that default with one or more site config files using the command-line &lt;code>--config&lt;/code> switch.&lt;/p>
&lt;pre tabindex="0">&lt;code>hugo --config debugconfig.toml
hugo --config a.toml,b.toml,c.toml
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>Note: config directory is not created by default.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>content&lt;/strong>&lt;/p>
&lt;p>æ˜¾ç„¶, å­˜å‚¨æ‰€æœ‰çš„post.&lt;/p>
&lt;p>&lt;strong>data&lt;/strong>&lt;/p>
&lt;p>This directory is used to store configuration files that can be used by Hugo when generating your website.&lt;/p>
&lt;p>åƒæ˜¯ä½  website çš„ä¸€ä¸ªmini æ•°æ®åº“, ä½ å¯ä»¥æ”¾ç½® toml, yaml, jsonæ ¼å¼çš„æ–‡ä»¶.&lt;/p>
&lt;p>&lt;strong>layouts&lt;/strong>&lt;/p>
&lt;p>Stores templates in the form of &lt;code>.html&lt;/code> files that specify how views of your content will be rendered into a static website. Templates include &lt;a href="https://gohugo.io/templates/list/">list pages&lt;/a>, your &lt;a href="https://gohugo.io/templates/homepage/">homepage&lt;/a>, &lt;a href="https://gohugo.io/templates/taxonomy-templates/">taxonomy templates&lt;/a>, &lt;a href="https://gohugo.io/templates/partials/">partials&lt;/a>, &lt;a href="https://gohugo.io/templates/single-page-templates/">single page templates&lt;/a>, and more.&lt;/p>
&lt;p>&lt;strong>public&lt;/strong>&lt;/p>
&lt;p>ä¿å­˜buildç”Ÿæˆçš„ç«™ç‚¹. å½“è¿è¡Œ&lt;code>hugo [flag]&lt;/code>æ—¶ç”Ÿæˆ.&lt;/p>
&lt;p>æ‹·è´è¯¥ç›®å½•ä¸‹çš„å†…å®¹, å¯ä»¥éƒ¨ç½²åˆ°web æœåŠ¡å™¨ä¸Šäº†.&lt;/p>
&lt;p>&lt;strong>static&lt;/strong>&lt;/p>
&lt;p>Stores all the static content: images, CSS, JavaScript, etc. å½“Hugoæ„å»ºæ‚¨çš„ç«™ç‚¹æ—¶ï¼Œé™æ€ç›®å½•ä¸­çš„æ‰€æœ‰èµ„æºéƒ½ä¼šæŒ‰åŸæ ·å¤åˆ¶ã€‚&lt;/p>
&lt;p>å³å½“æ„å»ºwebsiteæ—¶, &lt;code>static/&lt;/code>ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå¤åˆ¶åˆ° &lt;code>public/&lt;/code>ä¸‹.&lt;/p>
&lt;p>The static files are served on the site root path (eg. if you have the file &lt;code>static/image.png&lt;/code> you can access it using &lt;code>http://{server-url}/image.png&lt;/code>, to include it in a document you can use &lt;code>![Example image](/image.png) )&lt;/code>.&lt;/p>
&lt;p>&lt;strong>resources&lt;/strong>&lt;/p>
&lt;p>ä¸€äº›ç¼“å­˜æ–‡ä»¶&lt;/p>
&lt;blockquote>
&lt;p>Note: resources directory is not created by default.&lt;/p>
&lt;/blockquote>
&lt;h2 id="hugo-cli-å‘½ä»¤">Hugo CLI å‘½ä»¤&lt;/h2>
&lt;p>hugo æ”¯æŒçš„æ‰€æœ‰å‘½ä»¤å¯ä»¥é€šè¿‡ &lt;code>hugo help&lt;/code> å‘½ä»¤æ¥æŸ¥çœ‹. æ¯ä¸€æ¡å‘½ä»¤çš„å…·ä½“ç”¨æ³•, å¯ä»¥æ‰§è¡Œ &lt;code>hugo [command] help&lt;/code> æ¥æŸ¥çœ‹&lt;/p>
&lt;pre tabindex="0">&lt;code>Usage:
hugo [flags]
hugo [command]
&lt;/code>&lt;/pre>&lt;h3 id="hugo-completion">Hugo completion&lt;/h3>
&lt;p>ç”¨æ¥é…ç½®è¡¥å…¨ hugo command å’Œ flag çš„. è¯¥å‘½ä»¤ä¼šè¾“å‡ºä¸€æ®µè„šæœ¬, å°†è¯¥è„šæœ¬å¤åˆ¶åˆ°ä½ çš„ shell çš„é…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨ hugo tab è¡¥å…¨äº†.&lt;/p>
&lt;h3 id="hugo-config">hugo config&lt;/h3>
&lt;p>æ‰“å°hugoçš„é…ç½®æ–‡ä»¶, å³æ ¹ç›®å½•ä¸‹çš„ &lt;code>config.toml&lt;/code>.&lt;/p>
&lt;h3 id="hugo-env">hugo env&lt;/h3>
&lt;p>æ‰“å° hugo çš„ç‰ˆæœ¬å’Œç¯å¢ƒä¿¡æ¯&lt;/p>
&lt;h3 id="hugo-list">hugo list&lt;/h3>
&lt;p>æ‰“å°æ‰€æœ‰postçš„info, åŒ…å«æ ‡é¢˜, å‘å¸ƒæ—¥å¿—, é“¾æ¥ç­‰.&lt;/p>
&lt;h3 id="hugo-new">hugo new&lt;/h3>
&lt;p>éå¸¸é‡è¦çš„å‘½ä»¤, å¯ä»¥ç”¨æ¥æ–°å»ºä¸€ä¸ª website, ä¸»é¢˜, æˆ–è€…ä¸€ç¯‡post(å¸¸ç”¨). å¸¦æœ‰è®¸å¤š flagå¯ä»¥ä½¿ç”¨.&lt;/p>
&lt;h3 id="hugo-server">hugo server&lt;/h3>
&lt;p>æ‰§è¡Œ&lt;code>hugo server&lt;/code>ä¹‹å, é¦–å…ˆæ„å»ºäº†ä½ çš„ç½‘ç«™(ä½†æ˜¯é»˜è®¤å¹¶ä¸åœ¨æœ¬åœ°åˆ›å»ºæ–‡ä»¶, è€Œæ˜¯æ”¾åœ¨å†…å­˜), ç„¶åå¯åŠ¨hugo è‡ªå¸¦çš„ webæœåŠ¡å™¨è®©æˆ‘ä»¬èƒ½çœ‹è§ç½‘ç«™çš„æ•ˆæœ.&lt;/p>
&lt;p>åŒæ—¶, é»˜è®¤æƒ…å†µä¸‹, server ä¼šåŒæ­¥ä½ çš„æœ¬åœ°æ›´æ”¹, ç„¶åå®æ—¶çš„reloadä½ çš„é¡µé¢. è¿™æ ·ä½ å°±èƒ½åŒæ—¶çœ‹åˆ°ä¿®æ”¹çš„æ•ˆæœ.&lt;/p>
&lt;p>hugo server çš„å¸¸ç”¨flag:&lt;/p>
&lt;pre tabindex="0">&lt;code>-D åŒ…å«æ ‡è®°ä¸ºè‰ç¨¿çš„post. é»˜è®¤ä¸æ„å»ºè‰ç¨¿.
--theme strings ä½¿ç”¨[strings]ä¸»é¢˜è¿›è¡Œæ„å»º
&lt;/code>&lt;/pre>&lt;h3 id="hugo-flags">hugo [flags]&lt;/h3>
&lt;p>&lt;code>hugo&lt;/code> è‡ªèº«å°±æ˜¯ä¸€ä¸ªå‘½ä»¤, ç”¨äºbuild website, æ”¾åˆ° &lt;code>public/&lt;/code>ç›®å½•ä¸‹.&lt;/p>
&lt;p>å¸¸ç”¨ Flag(&lt;a href="https://gohugo.io/getting-started/usage/#test-installation:~:text=The%20output%20you%20see%20in%20your%20console%20should%20be%20similar%20to%20the%20following%3A">All supported flags&lt;/a>):&lt;/p>
&lt;pre tabindex="0">&lt;code>--gc åœ¨buildåä¼šæ¸…é™¤ä¸€äº›cacheæ–‡ä»¶. ä¸ resource/æœ‰å…³
--minify minify any supported output format (HTML, XML etc.)
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>&lt;code>hugo&lt;/code> å‘½ä»¤ä¸ä¼šåˆ é™¤ä¹‹å‰çš„æ–‡ä»¶. è€Œæ˜¯ä»…æ–°å¢æ”¹åŠ¨. æ‰€ä»¥æ¯æ¬¡buildæ—¶éœ€è¦ä½ æ‰‹åŠ¨åˆ é™¤ &lt;code>public/&lt;/code> ç›®å½•.&lt;/p>
&lt;/blockquote>
&lt;h2 id="hugo-å†…å®¹ç®¡ç†">Hugo å†…å®¹ç®¡ç†&lt;/h2>
&lt;p>hugo build åçš„websiteé¡µé¢çš„å¸ƒå±€å’Œä½ æºæ–‡ä»¶çš„å¸ƒå±€ç›¸åŒ, æ‰€æœ‰æºæ–‡ä»¶éƒ½æ”¾ç½®åœ¨ &lt;code>content/&lt;/code> ç›®å½•ä¸‹.&lt;/p>
&lt;pre tabindex="0">&lt;code>â””â”€â”€ content
â”œâ”€â”€ _index.md // &amp;lt;- https://example.com
|
â”œâ”€â”€ about
| â””â”€â”€ index.md // &amp;lt;- https://example.com/about/
â”œâ”€â”€ posts
| â”œâ”€â”€ _index.md // https://example.com/posts/
| â”œâ”€â”€ firstpost.md // &amp;lt;- https://example.com/posts/firstpost/
| â”œâ”€â”€ happy
| | â””â”€â”€ ness.md // &amp;lt;- https://example.com/posts/happy/ness/
| â””â”€â”€ secondpost.md // &amp;lt;- https://example.com/posts/secondpost/
â””â”€â”€ quote
â”œâ”€â”€ first.md // &amp;lt;- https://example.com/quote/first/
â””â”€â”€ second.md // &amp;lt;- https://example.com/quote/second/
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>hugo å°†content/ ä¸‹çš„é‚£çº§ç›®å½•(ä¾‹å¦‚ content/posts)ç‰¹æ®Šçœ‹å¾…, ç§°ä¸º &lt;em>section&lt;/em>.&lt;/p>
&lt;/blockquote>
&lt;h3 id="é¡µé¢èµ„æºpage-resources">é¡µé¢èµ„æº(Page Resources)&lt;/h3>
&lt;p>é¡µé¢èµ„æºæŒ‡æ¯ä¸ªé¡µé¢&lt;strong>ç§æœ‰çš„&lt;/strong>å›¾ç‰‡, æ–‡æ¡£ç­‰é™æ€èµ„æº. ä¸&lt;code>static/&lt;/code> ä¸­å…¨å±€çš„èµ„æºä¸åŒ.&lt;/p>
&lt;p>é¡µé¢èµ„æºæ”¾åœ¨&lt;code>content/&lt;/code>ä¸‹çš„ä»»æ„ä½ç½®, ä½†ä¸æ˜¯æ‰€æœ‰é¡µé¢éƒ½èƒ½è®¿é—®. page bundles ä¸­çš„&lt;code>index.md&lt;/code> or &lt;code>_index.md&lt;/code> èƒ½å¤Ÿè®¿é—®è¯¥ bundles ä¸‹çš„èµ„æº.&lt;/p>
&lt;pre tabindex="0">&lt;code>content
â””â”€â”€ post
â”œâ”€â”€ first-post
â”‚ â”œâ”€â”€ images
â”‚ â”‚ â”œâ”€â”€ a.jpg
â”‚ â”‚ â”œâ”€â”€ b.jpg
â”‚ â”‚ â””â”€â”€ c.jpg
â”‚ â”œâ”€â”€ index.md (root of page bundle, èƒ½å¤Ÿè®¿é—®first-post/ä¸‹çš„æ‰€æœ‰èµ„æº)
â”‚ â”œâ”€â”€ notice.md ä¸èƒ½è®¿é—®ä»»ä½•èµ„æº, ä½†å…¶è‡ªèº«ä½œä¸ºä¸€ä¸ªèµ„æºå¯è¢«index.mdè®¿é—®
â”‚ â”œâ”€â”€ office.mp3
â”‚ â”œâ”€â”€ pocket.mp4
â”‚ â”œâ”€â”€ rating.pdf
â”‚ â””â”€â”€ safety.txt
â””â”€â”€ second-post
â””â”€â”€ index.md (root of page bundle, ä½†ä¸èƒ½è®¿é—®first-post/ä¸‹çš„èµ„æº)
&lt;/code>&lt;/pre>&lt;h3 id="å†…å®¹åˆ†ç±»taxonomy">å†…å®¹åˆ†ç±»(Taxonomy)&lt;/h3>
&lt;p>Taxonomy: How to group the content together. Two default taxonomies are &lt;em>tags&lt;/em> and &lt;em>categories&lt;/em>.&lt;/p>
&lt;h3 id="ä»£ç é«˜äº®syntax-highlighter">ä»£ç é«˜äº®(Syntax Highlighter)&lt;/h3>
&lt;p>&lt;a href="https://gohugo.io/getting-started/configuration-markup/#configure-markup:~:text=anchorize%20template%20func.-,Highlight,-This%20is%20the">ä»£ç é«˜äº®çš„é…ç½®&lt;/a>(in &lt;code>config.toml&lt;/code>):&lt;/p>
&lt;h3 id="é¡µé¢åˆ†ç±»">é¡µé¢åˆ†ç±»&lt;/h3>
&lt;p>ä»å¸ƒå±€ä¸Šæ¥çœ‹, é¡µé¢å¯ä»¥åˆ†ä¸ºä¸¤ç±»: List page å’Œ single page.&lt;/p>
&lt;p>æ˜¾è€Œæ˜“è§, list pageæ¯”è¾ƒç‰¹æ®Š, å®ƒè´Ÿè´£åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰post. æ‰€ä»¥ä¸€ä¸ªç›®å½•åœ°å€å¿…ç„¶æ˜¯ä¸€ä¸ªlist page.&lt;/p>
&lt;p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, &lt;code>https://example.com&lt;/code> , &lt;code>https://example.com/posts/happy/&lt;/code> éƒ½å¯ä»¥å«åš list page.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>https://example.com/posts/happy/&lt;/code> æ˜¯list page, ç›®å½•ä¸‹çš„&lt;code>_index.md&lt;/code> ä¸æ˜¯å¿…é¡»çš„, hugo ä¼šé»˜è®¤ä»…æ˜¾ç¤ºæ‰€æœ‰postçš„title. &lt;a href="https://gohugo.io/templates/lists/#list-pages-without-_indexmd">è¯¦è§&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>https://example.com/about/&lt;/code> ä¸æ˜¯list page, å› ä¸ºå…¶ç›®å½•ä¸‹æœ‰&lt;code>index.md&lt;/code>, å¼ºåˆ¶è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª single page. &lt;a href="https://gohugo.io/content-management/page-bundles/#:~:text=CONTENT%20MANAGEMENT-,Page%20Bundles,-Content%20organization%20using">è¯¦è§&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>â””â”€â”€ content
â”œâ”€â”€ _index.md // &amp;lt;- https://example.com
|
â”œâ”€â”€ about
| â””â”€â”€ index.md // &amp;lt;- https://example.com/about/
â””â”€â”€ posts
â”œâ”€â”€ _index.md // https://example.com/posts/
â”œâ”€â”€ firstpost.md // &amp;lt;- https://example.com/posts/firstpost/
â”œâ”€â”€ happy
| â””â”€â”€ ness.md // &amp;lt;- https://example.com/posts/happy/ness/
â””â”€â”€ secondpost.md // &amp;lt;- https://example.com/posts/secondpost/
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>Homepage å’Œ section page éƒ½å±äºç‰¹æ®Šçš„ list page.&lt;/p>
&lt;ul>
&lt;li>homepage ç‰¹æŒ‡ &lt;code>content/_index.md&lt;/code>&lt;/li>
&lt;li>section page ç‰¹æŒ‡ &lt;code>content/[section]/_index.md&lt;/code>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="shortcodes">shortcodes&lt;/h3>
&lt;p>shortcode å¯ä»¥ç†è§£ä¸º hugo ä¸ºäº†å°è£…äº†ä¸€äº›ä»£ç å—, é€šè¿‡ shortcode æ¥è°ƒç”¨.&lt;/p>
&lt;h2 id="æ¨¡æ¿template">æ¨¡æ¿(Template)&lt;/h2>
&lt;p>æ¨¡æ¿æ˜¯hugoçš„ä¸€ä¸ªé«˜çº§ç”¨æ³•, ç”¨æ¥å®šä¹‰ä½ ç½‘ç«™çš„style. æ¨¡æ¿ä¸ç­‰åŒä¸ä¸»é¢˜(themes), å¯ä»¥ç†è§£ä¸ºä¸»é¢˜æ˜¯ä¸€å¥—æ¨¡æ¿çš„é›†åˆ. æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ¨¡æ¿çš„åŒæ—¶æ·»åŠ DIYçš„ style. ğŸ˜ Hugo ä¼šæœ‰ä¼˜å…ˆçº§çš„åˆ¤æ–­.&lt;/p>
&lt;p>ä¸åŒçš„é¡µé¢ç±»å‹éœ€è¦å®šä¹‰ä¸åŒçš„æ¨¡æ¿. List page çš„æ¨¡æ¿ç§°ä¸º List template, single page çš„æ¨¡æ¿ç§°ä¸º single template. åŒç†è¿˜æœ‰ homepage template, section template.&lt;/p>
&lt;p>å­˜å‚¨æ¨¡æ¿çš„ç›®å½•ä¸º&lt;code>layout/&lt;/code>, ä¸Šé¢ä»‹ç»hugoçš„ç›®å½•ç»“æ„æ—¶å·²ç»è¯´è¿‡. å¦‚æœä½ ä½¿ç”¨äº†ä¸€ä¸ª theme, é‚£ä¹ˆ&lt;code>themes/[your-theme]/layout/&lt;/code>å°±æ˜¯è¯¥themeçš„æ¨¡æ¿.&lt;/p>
&lt;h3 id="homepage-æ¨¡æ¿">homepage æ¨¡æ¿&lt;/h3>
&lt;h3 id="base-æ¨¡æ¿">Base æ¨¡æ¿&lt;/h3>
&lt;p>å¯¹åº”&lt;code>layouts/_default/baseof.html&lt;/code>&lt;/p>
&lt;p>base æ¨¡æ¿æ˜¯æ•´ä¸ªwebsiteçš„æ ¸å¿ƒ. æ‰€æœ‰çš„æ¨¡æ¿åŒ…æ‹¬ list template, single template, homepage template&amp;hellip; éƒ½æ˜¯ç‹¬ç«‹çš„, base template å°†å…¶ä»–çš„æ¨¡æ¿è”ç³»åˆ°ä¸€èµ·.&lt;/p>
&lt;h3 id="partial-æ¨¡æ¿">partial æ¨¡æ¿&lt;/h3>
&lt;p>åŒ…å«ç½‘ç«™çš„è®¸å¤šå…ƒç´ , å¢åŠ æ¨¡å—åŒ–. æˆ‘å¯ä»¥ä¸ºç½‘ç«™çš„ header æˆ–è€… footer å†™ä¸€ä¸ªæ¨¡æ¿(html), è¿™äº›HTMLå¯ä»¥åµŒå…¥å…¶ä»–çš„æ¨¡æ¿.&lt;/p>
&lt;h3 id="æ¨¡æ¿ä¼˜å…ˆçº§">æ¨¡æ¿ä¼˜å…ˆçº§&lt;/h3>
&lt;p>æ—¢ç„¶åŒä¸€ç§é¡µé¢çš„æ¨¡æ¿å¯ä»¥å®šä¹‰åœ¨å¤šä¸ªä½ç½®, å¦‚æœä»–ä»¬åŒæ—¶å­˜åœ¨æ—¶, ä¼˜å…ˆçº§è§„åˆ™å¿…ç„¶å­˜åœ¨. å¸¸è§çš„æƒ…å†µæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨äº†æŸä¸ªæ¨¡æ¿, ç„¶è€Œ, æˆ‘ä»¬å¯¹æ¨¡æ¿ä¸­çš„ä¸€äº›å¸ƒå±€ä¸æ»¡æ„, ç›´æ¥ä¿®æ”¹æ¨¡æ¿ä¸­çš„æ–‡ä»¶æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•, é‚£ä¹ˆè¯¥æ€ä¹ˆåšå‘¢?&lt;/p>
&lt;p>&lt;strong>ä¸€èˆ¬æ¥è¯´&lt;/strong>, å¦‚æœä½ åªæƒ³é‡å†™themeä¸­çš„æŸä¸ªæ¨¡æ¿, ä¾‹å¦‚section template. é‚£ä¹ˆä½ åªéœ€è¦æ–°å»º &lt;code>layout/_default/section.html&lt;/code> å³å¯, hugo æ„å»ºä½ çš„ç½‘ç«™æ—¶, å¦‚æœæ£€æµ‹åˆ°æœ¬åœ°å’Œthemeçš„&lt;code>layout/_default&lt;/code>ä¸‹éƒ½æœ‰ &lt;code>section.html&lt;/code>, å®ƒä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„é‚£ä¸ª.&lt;/p>
&lt;blockquote>
&lt;p>å®Œæ•´çš„, å¤šçº§çš„ä¼˜å…ˆçº§è§„åˆ™: &lt;a href="https://gohugo.io/templates/lookup-order/">Hugo&amp;rsquo;s Lookup Order | Hugo (gohugo.io)&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="å˜é‡variables">å˜é‡(Variables)&lt;/h2>
&lt;p>â— Hugo å˜é‡ä»…è®¾è®¡ç»™æ¨¡æ¿ä½¿ç”¨, å³åœ¨&lt;code>layouts/&lt;/code>ä¸‹çš„htmlæ–‡ä»¶.&lt;/p>
&lt;h3 id="page-variables">Page Variables&lt;/h3>
&lt;p>ä¸postç›¸å…³çš„å˜é‡, å®šä¹‰åœ¨post çš„ front matterä¸­.&lt;/p>
&lt;pre tabindex="0">&lt;code>// Define Page variables in front matter of post
----------------
title: &amp;#34;ä½¿ç”¨ HuGo æ­å»ºä¸ªäººç½‘ç«™&amp;#34;
description: å­¦ä¹ æ­£ç¡®çš„ Hugo é£Ÿç”¨æ–¹å¼, DIY å±äºè‡ªå·±çš„ website~
Myvar: &amp;#34;my value&amp;#34;
----------------
// Use Page Variables
{{.Description}} // Get the description of the post
{{.Params.Myvar}} // Get the value of Myvar, that is, &amp;#34;my value&amp;#34;
&lt;/code>&lt;/pre>&lt;h3 id="site-variables">Site Variables&lt;/h3>
&lt;p>ç«™ç‚¹å±‚é¢çš„å˜é‡å¤§éƒ¨åˆ†æ˜¯ç½‘ç«™é…ç½®ç›¸å…³.&lt;/p>
&lt;h2 id="å‡½æ•°functions">å‡½æ•°(Functions)&lt;/h2>
&lt;p>å‡½æ•°æ˜¯hugoä¸ºä½ å°è£…çš„ä¸€äº›æ–¹æ³•ä½ å¯ä»¥ç›´æ¥è°ƒç”¨.&lt;/p>
&lt;p>â— Hugo å‡½æ•°ä»…è®¾è®¡ç»™æ¨¡æ¿ä½¿ç”¨, å³åœ¨&lt;code>layouts/&lt;/code>ä¸‹çš„htmlæ–‡ä»¶. Same as variables.&lt;/p>
&lt;h2 id="hugo-pipes">Hugo pipes&lt;/h2>
&lt;h1 id="diy-my-own-website">DIY My Own Website&lt;/h1>
&lt;h2 id="æ”¯æŒ-emoji">æ”¯æŒ Emoji&lt;/h2>
&lt;p>&lt;a href="https://stackoverflow.com/questions/41047920/adding-emoji-to-a-hugo-page-variable">Adding emoji tutorial&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.webfx.com/tools/emoji-cheat-sheet/">Emoji chart&lt;/a>&lt;/p>
&lt;h2 id="todo-list">TODO List&lt;/h2>
&lt;ol>
&lt;li>æ·±è‰²å’Œæµ…è‰²æ¨¡å¼ä½¿ç”¨ ä¸åŒçš„ä»£ç é«˜äº® æ ¼å¼&lt;/li>
&lt;li>Post section page æ·»åŠ ç®€ä»‹&lt;/li>
&lt;li>Single template è°ƒæ•´ Header&amp;rsquo;s margin&lt;/li>
&lt;/ol>
- https://wangloo.github.io/posts/hugo/ - @2019 Notepadium.</description></item><item><title>2019 Stanford Commencement Timcook</title><link>https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/</link><pubDate>Wed, 18 May 2022 19:32:38 +0800</pubDate><guid>https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/ -&lt;h1 id="content">Content&lt;/h1>
&lt;p>Fourteen years ago, Steve stood on this stage and told your predecessors &amp;ldquo;Your time is limited. So don&amp;rsquo;t waste is living someone else&amp;rsquo;s life.&amp;rdquo;&lt;/p>
&lt;p>So what is true then is true now. Don&amp;rsquo;t waste your time living someone else&amp;rsquo;s life.
Don&amp;rsquo;t try to emulate the people who came before you to the exclusion of
everything else, contorting into a shape that doesn&amp;rsquo;t fit.&lt;/p>
&lt;p>Graduates, the fact is, when your time comes, and it will, you will never be ready.
But you&amp;rsquo;re not suppposed to be. Find the hope in the unexpected. Find the hope
int the challenge. Find your vision on the solitary road. Don&amp;rsquo;t get distracted.
There are too many people who want credit without responsibility. Too many who
show up for the ribbon cutting without building anything worth a damn.&lt;/p>
&lt;p>Be different. Leave something worthy. And always remember that you can&amp;rsquo;t take it
with you. You&amp;rsquo;re going to have to pass it on.&lt;/p>
&lt;p>Thank you very much. And Congratulations to the Class of 2019!&lt;/p>
&lt;p>&lt;a href="https://www.youtube.com/watch?v=2C2VJwGBRRw&amp;amp;t=80s">YouTube vidio&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/ - @2019 Notepadium.</description></item><item><title>Html Css Learning note (0)</title><link>https://wangloo.github.io/posts/html-css/0/</link><pubDate>Tue, 17 May 2022 11:02:04 +0800</pubDate><guid>https://wangloo.github.io/posts/html-css/0/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/html-css/0/ -&lt;h1 id="get-start">Get start&lt;/h1>
&lt;h2 id="what-is-htmlcss">What is HTML&amp;amp;CSS?&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>HTML is resonsible for the content of the page. That&amp;rsquo;s the text, images, buttons, etc.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CSS is resonsible for the presentation of the content. That&amp;rsquo;s the color, layout, etc.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Web &lt;strong>designers&lt;/strong> create the overall look and fell of a website.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Web &lt;strong>developers&lt;/strong> implement the design using &lt;strong>HTML, CSS and JavaScript code&lt;/strong>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="configure-vim-as-html-code-editor">Configure VIM as HTML code-editor&lt;/h2>
&lt;blockquote>
&lt;p>Finally in the arms of &lt;code>vscode&lt;/code> ğŸ™‰&lt;/p>
&lt;/blockquote>
&lt;p>Add vim plugin:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://emmet.io/">emmet&lt;/a>: Coding HTML faster.&lt;/li>
&lt;/ul>
&lt;p>CSS autocomplete key: &lt;code>&amp;lt;C-x&amp;gt; &amp;lt;C-o&amp;gt;&lt;/code>&lt;/p>
&lt;p>HTML and CSS live previes plugin: &lt;a href="https://github.com/turbio/bracey.vim">bracey&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/turbio/bracey.vim/issues/21">urlopen error solution&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h1 id="html-fundamentals">HTML Fundamentals&lt;/h1>
&lt;h2 id="anatomy-of-an-html-element">Anatomy of an HTML element&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&amp;lt;&lt;span style="color:#ff79c6">p&lt;/span>&amp;gt; THML is a markup language&amp;lt;/&lt;span style="color:#ff79c6">p&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The HTML element is composed of &lt;code>opening tag&lt;/code>, &lt;code>content&lt;/code>, &lt;code>closing tag&lt;/code>.&lt;/p>
&lt;h2 id="html-good-styles">HTML good styles&lt;/h2>
&lt;ul>
&lt;li>&lt;code>&amp;lt;img/&amp;gt;&lt;/code> element should add &lt;code>alt&lt;/code> attritube at all time, for the convenience of the blind.&lt;/li>
&lt;li>An important principle in web design is &lt;code>making the HTML elements meaningful&lt;/code>. That is &lt;a href="https://www.thoughtco.com/why-use-semantic-html-3468271">semantic HTML&lt;/a>.&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h1 id="css-fundamentals">CSS Fundamentals&lt;/h1>
&lt;p>CSS describes the visual style and presentation of the contend in HTML.&lt;/p>
&lt;h2 id="anatomy-of-an-html-element-1">Anatomy of an HTML element&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">h1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">color&lt;/span>: &lt;span style="color:#ff79c6">blue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">text-align&lt;/span>: &lt;span style="color:#ff79c6">center&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">font-size&lt;/span>: &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>h1 is &lt;code>Seletor&lt;/code>, every &lt;code>style&lt;/code> has &lt;code>proporty&lt;/code> and &lt;code>value&lt;/code>.&lt;/p>
&lt;h2 id="css-good-styles">CSS good styles&lt;/h2>
&lt;ul>
&lt;li>Class selector is more commonly used than ID selector, as &lt;code>ID&lt;/code> is &lt;em>unique&lt;/em> in HTML. For scalability, &lt;strong>remember always using class selector&lt;/strong>.&lt;/li>
&lt;li>We should always specify all the four state of &lt;code>&amp;lt;a&amp;gt;&lt;/code> element in order, which including &lt;code>link&lt;/code>, &lt;code>visited&lt;/code>, &lt;code>hover&lt;/code> and &lt;code>active&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h2 id="priority-conflicts-between-selectors">Priority conflicts between selectors&lt;/h2>
&lt;p>CSS style priority from high to low:&lt;/p>
&lt;ol>
&lt;li>Inline style(style attribute in HTML)&lt;/li>
&lt;li>ID selector&lt;/li>
&lt;li>class or pseudo-class selector&lt;/li>
&lt;li>element selector&lt;/li>
&lt;li>universal element selector&lt;/li>
&lt;/ol>
&lt;p>Â &lt;/p>
&lt;h1 id="the-css-box-model">The CSS box model&lt;/h1>
&lt;p>The box model defines how elements are displayed on a webpage and how they are sized.&lt;br>
In the box model, every element on a webpage can be seen as a rectangular box.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h1 id="universal-element--body-element">Universal element &amp;amp; &lt;code>&amp;lt;body&amp;gt;&lt;/code> element&lt;/h1>
&lt;p>Styles in &lt;code>&amp;lt;body&amp;gt;&lt;/code> selector take effect because of inheritance. But the text-independent elements do not support inheritance.&lt;br>
That is where &lt;em>universal element&lt;/em> selector is needed. It&amp;rsquo;s styles take effect on all element.&lt;/p>
&lt;p>When we want to set padding and margin of all elements to &lt;code>0&lt;/code>. Must put the code in universal element selector.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h1 id="inline-elements--block-elements">Inline elements &amp;amp; Block elements&lt;/h1>
&lt;p>Inline elements:&lt;/p>
&lt;ul>
&lt;li>Occupies only the space necessary for its content.&lt;/li>
&lt;li>Box model applies in different way: &lt;strong>heights and widths do no apply&lt;/strong>.&lt;/li>
&lt;li>Paddings and margins are applied &lt;strong>only horizontally&lt;/strong>(left and right).&lt;/li>
&lt;/ul>
&lt;p>Block elements:&lt;/p>
&lt;ul>
&lt;li>100% of parent&amp;rsquo;s width&lt;/li>
&lt;li>vertivally, one after another&lt;/li>
&lt;/ul>
&lt;p>Inline-Block elements:&lt;/p>
&lt;ul>
&lt;li>Good example is &lt;code>&amp;lt;img&amp;gt;&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h1 id="the-3-ways-of-building-layouts-with-css">The 3 ways of building layouts with CSS&lt;/h1>
&lt;p>&lt;code>Float Layouts&lt;/code>: The &lt;strong>old way of building layouts&lt;/strong>, using the float CSS property. Still used, but getting outdated fase.&lt;/p>
&lt;ul>
&lt;li>Element is removed from the normal flow: &lt;em>out of&lt;/em> flow. Like absolutely positioning.&lt;/li>
&lt;li>Text and inline elements will wrap around the floated elements. Different from absolutely elements.&lt;/li>
&lt;li>The container will &lt;em>NOT&lt;/em> adjust its height to the elements.&lt;/li>
&lt;/ul>
&lt;p>&lt;code>FlexBox&lt;/code>: Modern way of laying out elements in a &lt;strong>1-dimensional row&lt;/strong> without using floats. Prefect for &lt;strong>component layouts&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>One of its most useful applications is &lt;strong>vertical centering&lt;/strong>.&lt;/li>
&lt;li>Flex container property:
&lt;ul>
&lt;li>&lt;code>gap&lt;/code>: To create space between items.&lt;/li>
&lt;li>&lt;code>justify-content&lt;/code>: To align items along main axis(&lt;strong>horizontally&lt;/strong>, by default)&lt;/li>
&lt;li>&lt;code>align-items&lt;/code>: To align items along cross axis(&lt;strong>vertically&lt;/strong>, by dedauly)&lt;/li>
&lt;li>&lt;code>flex-wrap&lt;/code>: To allow items to &lt;strong>wrap into a new line&lt;/strong> if they are too large&lt;/li>
&lt;li>&lt;code>align-content&lt;/code>: Only applies when there are multiple lines(flex-wrap: wrap)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Flex Items property:
&lt;ul>
&lt;li>&lt;code>align-self&lt;/code>: To overwrite align-items for individual flex items.&lt;/li>
&lt;li>&lt;code>flex-grow&lt;/code>: To allow an element to &lt;strong>grow&lt;/strong>.&lt;/li>
&lt;li>&lt;code>flex-shrink&lt;/code>: To allow an element to &lt;strong>shrink&lt;/strong>.&lt;/li>
&lt;li>&lt;code>flex-basis&lt;/code>: To define an item&amp;rsquo;s width, &lt;strong>instead of the width&lt;/strong> property.&lt;/li>
&lt;li>&lt;code>flex&lt;/code>: &lt;strong>Recommended shorthand&lt;/strong> for flex-grow, -shrink, -basis.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>CSS Grid&lt;/code>: For laying out elements in a fully-fledged &lt;strong>2-dimensional grid&lt;/strong>. Perfect for page layouts and complex components.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>CSS grid is a set of &lt;strong>CSS properties&lt;/strong> for building &lt;strong>2-dimensional&lt;/strong> layouts&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The main idea behind CSS Grid is that we &lt;strong>divide a container element into rows and columns&lt;/strong> that can be filled with its child elements&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CSS grid is &lt;strong>not meant to replace flexbox!&lt;/strong>. Instead, they work perfectly together. Need a &lt;strong>1D&lt;/strong> layouts? Use flexbox. Need a &lt;strong>2D&lt;/strong> layout? Use CSS grid&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Grid container&lt;/p>
&lt;ul>
&lt;li>grid-template-rows/grid-template-columns: To establish the grid &lt;strong>row and column tracks&lt;/strong>. One length uniit for each track. Any unit can be used, new &lt;strong>fr&lt;/strong> fills unused space&lt;/li>
&lt;li>row-gap/colum-gap: To &lt;strong>create empty space&lt;/strong> between tracks&lt;/li>
&lt;li>justify-items/align-items: To align items inside rows/columns(&lt;strong>horizontally/vertically&lt;/strong>)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Grid items&lt;/p>
&lt;ul>
&lt;li>grid-column/grid-row: To &lt;strong>place a grid item&lt;/strong> into a specific cell, based on line numbers. span keyword can be used to span an item across more cells&lt;/li>
&lt;li>justify-self/align-self: To &lt;strong>overwrite&lt;/strong> justify-items/align-items for single items&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
- https://wangloo.github.io/posts/html-css/0/ - @2019 Notepadium.</description></item><item><title>æˆ‘çš„ vim è°ƒæ•™éšç¬”</title><link>https://wangloo.github.io/posts/vim/basic/</link><pubDate>Mon, 09 May 2022 19:28:12 +0800</pubDate><guid>https://wangloo.github.io/posts/vim/basic/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/vim/basic/ -&lt;p>Search a word quickly: put cursor on the word, press &lt;code>/&lt;/code> and press &lt;code>&amp;lt;C-R&amp;gt;&lt;/code> &lt;code>&amp;lt;C-W&amp;gt;&lt;/code>.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="ç¼©å†™çš„å«ä¹‰meaning-of-abbreviations">ç¼©å†™çš„å«ä¹‰(Meaning of abbreviations)&lt;/h2>
&lt;p>Operation&lt;/p>
&lt;ul>
&lt;li>d - delete&lt;/li>
&lt;li>y - yank(copy, å› ä¸ºcè¢«å äº†)&lt;/li>
&lt;li>c - change&lt;/li>
&lt;li>r - replace&lt;/li>
&lt;li>v - visual select&lt;/li>
&lt;/ul>
&lt;p>Scope or location&lt;/p>
&lt;ul>
&lt;li>i - inside&lt;/li>
&lt;li>a - around&lt;/li>
&lt;li>f - forward&lt;/li>
&lt;li>t - to&lt;/li>
&lt;/ul>
&lt;p>Object&lt;/p>
&lt;ul>
&lt;li>w - word&lt;/li>
&lt;li>s - sentence&lt;/li>
&lt;li>p - paragraph&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="ä¹¦ç­¾-bookmark">ä¹¦ç­¾: Bookmark&lt;/h2>
&lt;p>&lt;code>ma&lt;/code>: create bookmark &lt;code>a&lt;/code> inside file.&lt;br>
&lt;code>mA&lt;/code>: create global bookmark &lt;code>A&lt;/code>.&lt;br>
&lt;code>`a&lt;/code>: jump to bookmark &lt;code>a&lt;/code>.&lt;/p>
&lt;p>&lt;code>:marks&lt;/code>: display all bookmarks&lt;/p>
&lt;h2 id="ç¼©è¿›-indent">ç¼©è¿›: indent&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;code>&amp;gt;&lt;/code>: increase indent , &lt;code>&amp;lt;&lt;/code>: decrease indent ,&lt;code>=&lt;/code>: auto indent&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>&amp;gt;&amp;gt;&lt;/code>: å¢åŠ å½“å‰è¡Œçš„ç¼©è¿›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>gg=G&lt;/code>: ç¼©è¿›å…¨æ–‡, æ— è®ºå½“å‰å…‰æ ‡åœ¨å“ª&lt;/p>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä»¥ä¸Šå‘½ä»¤éƒ½å¯ä»¥é…åˆvisual modeä½¿ç”¨&lt;/p>
&lt;/blockquote>
&lt;h3 id="è‡ªåŠ¨ç¼©è¿›çš„è§„åˆ™">è‡ªåŠ¨ç¼©è¿›çš„è§„åˆ™&lt;/h3>
&lt;p>ä¸»è¦æœ‰å››ç§å¯ç”¨ç¼©è¿›çš„æ–¹å¼, åˆ†åˆ«æ˜¯:&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;#39;autoindent&amp;#39; æ²¿ç”¨ä¸Šä¸€è¡Œçš„ç¼©è¿›ã€‚
&amp;#39;smartindent&amp;#39; ç±»ä¼¼ &amp;#39;autoindent&amp;#39;ï¼Œä½†æ˜¯å¯ä»¥è¯†åˆ«ä¸€äº› C è¯­æ³•ä»¥èƒ½åœ¨åˆé€‚çš„åœ°æ–¹
å¢åŠ  / å‡å°‘ç¼©è¿›ã€‚
&amp;#39;cindent&amp;#39; æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´èªæ˜ï¼›å¯ä»¥è®¾ç½®ä¸åŒçš„ç¼©è¿›é£æ ¼ã€‚
&amp;#39;indentexpr&amp;#39; æœ€çµæ´»çš„ä¸€ä¸ª: æ ¹æ®è¡¨è¾¾å¼æ¥è®¡ç®—ç¼©è¿›ã€‚è‹¥æ­¤é€‰é¡¹éç©ºï¼Œåˆ™ä¼˜å…ˆäºå…¶å®ƒ
é€‰é¡¹è¦†ç›–ã€‚å‚è§ indent-expression ã€‚
&lt;/code>&lt;/pre>&lt;p>è‡ªå®šä¹‰çš„å¿«é€Ÿå‘½ä»¤:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-vimrc" data-lang="vimrc">&lt;span style="display:flex;">&lt;span>command IndentOff setl noai nocin nosi indentexpr=&lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>command IndentOn setl ai cin si &lt;span style="color:#6272a4">&amp;#34;indentexpr can&amp;#39;t be re-enabled.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>command IndentStatus set ai? si? cin? indentexpr?
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;code>cindent&lt;/code> ä¸ä¸€å®šå¯¹æ‰€æœ‰çš„è¯­è¨€éƒ½æœ‰æ•ˆæœ. åªæ˜¯ C-like é£æ ¼, å…¶ä¸­ä¸€ä¸ªè¦æ±‚æ˜¯é¡¶å±‚å‡½æ•°å¿…é¡»åœ¨ç¬¬ä¸€åˆ—ä¸­å«æœ‰ &lt;code>{&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>åªæœ‰å½“&lt;code>indentexpr&lt;/code>è®¡ç®—ä¸å‡ºå½“å‰éœ€è¦ç¼©è¿›å‡ æ ¼æ—¶(return -1), æ‰ä½¿ç”¨ä¸Šé¢çš„ä¸‰ä¸ªè§„åˆ™. å®ƒæ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„.&lt;/p>
&lt;/blockquote>
&lt;h2 id="find-and-tail">&lt;code>F&lt;/code>ind and &lt;code>T&lt;/code>ail&lt;/h2>
&lt;p>&lt;code>f(&lt;/code>: ä»å½“å‰cursorå¤„å‘å³æŸ¥æ‰¾ä¸‹ä¸€ä¸ª&lt;code>(&lt;/code>, å¹¶å°†å…‰æ ‡ç§»åŠ¨åˆ°&lt;code>(&lt;/code>å¤„.&lt;br>
&lt;code>F(&lt;/code>: Like &lt;code>f(&lt;/code>, but å‘å·¦æŸ¥æ‰¾.&lt;br>
&lt;code>t(&lt;/code>: Like &lt;code>f(&lt;/code>, but å°†cursorç§»åŠ¨åˆ°&lt;code>(&lt;/code>çš„å‰ä¸€ä¸ª.&lt;br>
&lt;code>T(&lt;/code>: You can guess.&lt;/p>
&lt;h4 id="trick">Trick&lt;/h4>
&lt;p>&lt;code>vt(c&lt;/code>: With visual, åˆ é™¤å½“å‰å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ª&lt;code>(&lt;/code>å‰çš„æ‰€æœ‰å†…å®¹.&lt;/p>
&lt;p>&lt;code>;&lt;/code>/&lt;code>,&lt;/code>: æŸ¥æ‰¾ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ª &lt;code>f/F/t/T&lt;/code> çš„å†…å®¹.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="substitute-and-global">&lt;code>S&lt;/code>ubstitute and &lt;code>G&lt;/code>lobal&lt;/h2>
&lt;blockquote>
&lt;p>See: &lt;code>:help :s&lt;/code> and &lt;code>:help :g&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>è¿™ä¸¤ä¸ªéƒ½å±äºvimçš„å‘½ä»¤. vim çš„æ›¿æ¢å’Œsed çš„&lt;code>s&lt;/code>å‘½ä»¤ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸€è‡´. å°±ä¸å¤šä»‹ç»äº†.&lt;/p>
&lt;p>è€Œ vim çš„ global å‘½ä»¤å’Œsedæœ‰äº›è®¸å·®åˆ«. ä½¿ç”¨Sedåˆ é™¤åŒ…å«ä¸ªå­—ç¬¦ä¸²çš„è¡Œçš„æŒ‡ä»¤ä¸º: &lt;code>sed '/STRING/d' input_file&lt;/code>, è€Œåœ¨vimä¸­åˆ™å¤šäº†ä¸€ä¸ª&lt;strong>g&lt;/strong>å‰ç¼€, &lt;code>:g/STRING/d&lt;/code>.&lt;/p>
&lt;p>global å¯ä»¥å’Œ substitute ç»“åˆä½¿ç”¨, ä¾‹å¦‚æƒ³è¦åœ¨åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„è¡Œä¸­æ›¿æ¢&lt;code>good&lt;/code>ä¸º&lt;code>excellent&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>:g/STRING/s/good/excellent/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>TODO:&lt;/p>
&lt;ol>
&lt;li>More [cmd] in global. &lt;a href="https://vim.fandom.com/wiki/Power_of_g">Power of g | Vim Tips Wiki | Fandom&lt;/a>&lt;/li>
&lt;li>vim subtituteä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼é›†åŒ…å« &lt;code>\zs&lt;/code>å’Œ&lt;code>\ze&lt;/code>, ç„¶è€Œ sed æ²¡æœ‰(Sed ä¸º POSIX Basic Regular Expression).&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="å¤§å°å†™è½¬æ¢">å¤§å°å†™è½¬æ¢&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>cmd&lt;/th>
&lt;th>description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>g~&lt;/code>&lt;/td>
&lt;td>ç¿»è½¬å¤§å°å†™&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>gu&lt;/code>&lt;/td>
&lt;td>è½¬æ¢ä¸ºå°å†™&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>gU&lt;/code>&lt;/td>
&lt;td>è½¬æ¢ä¸ºå¤§å†™&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä»¥ä¸Šå‘½ä»¤(ä¸¥æ ¼æ¥è¯´å«æ“ä½œç¬¦)éœ€è¦é…åˆ&lt;strong>åŠ¨ä½œå‘½ä»¤&lt;/strong>æ¥ä½¿ç”¨.&lt;/p>
&lt;ul>
&lt;li>&lt;code>gUaw&lt;/code>: å°†å…‰æ ‡æ‰€åœ¨ä½ç½®çš„&lt;em>å•è¯&lt;/em>è½¬ä¸ºå¤§å†™&lt;/li>
&lt;li>&lt;code>gUap&lt;/code>: å°†å…‰æ ‡æ‰€åœ¨ä½ç½®çš„&lt;em>æ®µè½&lt;/em>è½¬ä¸ºå¤§å†™&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="search-and-replace">Search and replace&lt;/h2>
&lt;h3 id="case-1-search-and-convert-to-uppercaselowercase">case 1: search and convert to uppercase/lowercase&lt;/h3>
&lt;p>æˆ‘ç›´è§‰æƒ³åˆ°çš„æ–¹å¼æ˜¯&lt;code>%s/html/HTML/gc&lt;/code>&lt;/p>
&lt;p>è¿™ç§æ–¹å¼åœ¨ç®€å•æƒ…å†µä¸‹ä¹Ÿè¡Œ, æ¯”è¾ƒçµæ´»ä¸”ç›´è§‚, ä½†æ˜¯å¯¹äºå¤æ‚æ–‡ä»¶ä¸å¤Ÿé€šç”¨ä¸”å®¹æ˜“å‡ºé”™&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å…ˆæœç´¢, ç„¶åä¸€æ­¥æ­¥æ›¿æ¢&lt;/p>
&lt;ul>
&lt;li>æœç´¢: &lt;code>/\vhtml\C&lt;/code>&lt;/li>
&lt;li>æ›¿æ¢: æ‰§è¡Œå‘½ä»¤&lt;code>gUgn&lt;/code>, ç„¶åä½¿ç”¨&lt;code>n&lt;/code>å’Œ&lt;code>.&lt;/code>æ¥é‡å¤æ“ä½œä¸‹ä¸€ä¸ªé€‰ä¸­é¡¹.&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;code>gn&lt;/code>å‘½ä»¤è¿›å¯¹äºsreachçš„åŒ¹é…é¡¹ä½¿ç”¨, ç±»ä¼¼äº&lt;code>n&lt;/code>, ä½†ä¼šå°†ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹(è‹¥å…‰æ ‡åœåœ¨matchä¸Š, é‚£åˆ™é€‰ä¸­å½“å‰åŒ¹é…é¡¹)
è½¬ä¸ºvisualæ¨¡å¼é€‰ä¸­çš„çŠ¶æ€.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å…¶å®å¯¹äºç®€å•çš„æ–‡æœ¬, &lt;code>n&lt;/code>å’Œ&lt;code>.&lt;/code>ä¹Ÿå¯ä»¥ç®€åŒ–ä¸º&lt;code>.&lt;/code>. å”¯ä¸€çš„åå¤„å°±æ˜¯å¦‚æœä¸¤ä¸ªåŒ¹é…çš„è·ç¦»å¤ªå¤§,
ä½ ä¸èƒ½ç¡®è®¤æ˜¯å¦searchäº†ä½ æƒ³è¦çš„å†…å®¹.&lt;/p>
&lt;/blockquote>
&lt;h3 id="case-2-search-the-text-seleted-in-visual-mode">case 2: search the text seleted in &lt;em>visual mode&lt;/em>&lt;/h3>
&lt;blockquote>
&lt;p>vim æœ¬èº«å¹¶æœªæä¾›è¿™ä¸ªåŠŸèƒ½, éœ€è¦å€ŸåŠ©ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆ&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="#search-text-selected-in-visual-mode">search the text selected in visual mode&lt;/a>&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="visual-block-æ¨¡å¼">Visual Block æ¨¡å¼&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>é€‰ä¸­å, ç¼–è¾‘æ‰€æœ‰è¡Œ: &lt;code>I&lt;/code>(captial i), ç¼–è¾‘å®ŒæˆåæŒ‰ä¸¤æ¬¡&lt;code>ESC&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é‡å¤visual é€‰ä¸­ä¸Šæ¬¡çš„ block: Normalæ¨¡å¼ä¸‹&lt;code>gv&lt;/code>å³å¯.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="å•è¯é—´è·³è½¬">å•è¯é—´è·³è½¬&lt;/h2>
&lt;p>&lt;code>w&lt;/code>: Move cursor to begin of next word.&lt;br>
&lt;code>b&lt;/code>: Move cursor to begin of last word.&lt;br>
&lt;code>e&lt;/code>: Move cursor to end of next word.&lt;/p>
&lt;h3 id="trick-1">Trick&lt;/h3>
&lt;p>&lt;code>w&lt;/code>/&lt;code>b&lt;/code>é…åˆ&lt;code>ce&lt;/code>ä½¿ç”¨å¯è¾¾åˆ°åœ¨æŸä¸€è¡Œä¸­å¿«é€Ÿç§»åŠ¨åˆ°æŸä¸ªå•è¯, ç„¶ååˆ é™¤è¯¥å•è¯å¼€å§‹edit.&lt;/p>
&lt;p>&lt;code>daw&lt;/code>: å³ Delete A Word, å¯ä»¥åˆ é™¤ä¸€ä¸ªå®Œæ•´çš„å•è¯, æ— è®ºå½“å‰å…‰æ ‡çš„ä½ç½®åœ¨å“ª.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="ç¼–è¾‘äºŒè¿›åˆ¶åå…­è¿›åˆ¶æ–‡ä»¶">ç¼–è¾‘äºŒè¿›åˆ¶/åå…­è¿›åˆ¶æ–‡ä»¶&lt;/h2>
&lt;p>å¯ä»¥ä½¿ç”¨&lt;code>xxd&lt;/code>å‘½ä»¤å°†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ–‡æœ¬è½¬æ¢ä¸ºhexæ ¼å¼æ˜¾ç¤º. åœ¨vimä¸­é”®å…¥&lt;code>:%!xxd&lt;/code> å³å¯. å¾—åˆ°çš„æ•ˆæœå¦‚ä¸‹:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-xxd" data-lang="xxd">0000000: 5468 6973 2069 7320 6120 7465 7374 0a41 This is a test.A
0000010: 6e6f 7468 6572 206c 696e 650a 416e 6420 nother line.And
0000020: 7965 7420 616e 6f74 6865 720a yet another.
&lt;/code>&lt;/pre>&lt;p>åé¢çš„å¯¹åº”æ–‡æœ¬æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„, ä»…éœ€è¦ä¿®æ”¹åå…­è¿›åˆ¶çš„éƒ¨åˆ†å³å¯. ä¿®æ”¹å®Œæˆå, è¦è¿”å›åŸæœ¬çš„æ¨¡å¼, é”®å…¥&lt;code>:%!xxd -r&lt;/code>.&lt;/p>
&lt;blockquote>
&lt;p>å¯é€šè¿‡è®¾ç½®æ–‡æœ¬æ ¼å¼å¯¹åå…­è¿›åˆ¶å†…å­˜é«˜äº®æ˜¾ç¤º &lt;code>set ft=xxd&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="åˆ é™¤å…‰æ ‡å‰åçš„æ‰€æœ‰å­—ç¬¦">åˆ é™¤å…‰æ ‡å‰/åçš„æ‰€æœ‰å­—ç¬¦&lt;/h2>
&lt;ol>
&lt;li>&lt;code>d^&lt;/code> &amp;ndash; delete to first non-whitespace character in the line&lt;/li>
&lt;li>&lt;code>d0&lt;/code> &amp;ndash; delete to beginning of the line&lt;/li>
&lt;li>&lt;code>c-u&lt;/code> in &lt;strong>insert mode&lt;/strong>. Same as bash command shortkeys, see &lt;a href="https://ss64.com/bash/syntax-keyboard.html">here&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>Â &lt;/p>
&lt;h2 id="æ–‡ä»¶æ¢å¤swpæ–‡ä»¶">æ–‡ä»¶æ¢å¤/swpæ–‡ä»¶&lt;/h2>
&lt;p>æ­£ç¡®å¯¹å¾…swpæ–‡ä»¶çš„å§¿åŠ¿:&lt;/p>
&lt;ol>
&lt;li>vim æ‰“å¼€åŸæ–‡ä»¶, æ­¤æ—¶ä¼šæç¤º&lt;code>Found a swap file the name .xxx.swp&lt;/code>, æ˜¾ç„¶é€‰æ‹©&lt;code>(R)ecover&lt;/code> æ¥æ¢å¤æœªä¿å­˜çš„å†…å®¹.&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>:w&lt;/code>å°†æ¢å¤çš„å†…å®¹ä¿å­˜ä¸‹æ¥&lt;/li>
&lt;li>ä½†æ˜¯æ­¤æ—¶åŸæœ¬çš„swpæ–‡ä»¶è¿˜æ˜¯å­˜åœ¨, æ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œ&lt;code>:e&lt;/code>åˆ·æ–°ä¸€ä¸‹å½“å‰bufffer, ä»ç„¶ä¼šæç¤ºæ¢å¤çš„é€‰é¡¹, ä½†æ­¤æ—¶æ–‡ä»¶å†…å®¹å·²ç»æ¢å¤, é€‰æ‹©&lt;code>(D)elete&lt;/code> å°±å¯å°†å¯¹åº”çš„swpæ–‡ä»¶åˆ é™¤äº†&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>åˆ é™¤å½“å‰ç›®å½•ä¸­æ‰€æœ‰swp fileçš„è„šæœ¬?&lt;/p>
&lt;p>éœ€è¦ç¡®ä¿:&lt;/p>
&lt;ul>
&lt;li>æ‰€æœ‰æ–‡ä»¶å†…å®¹å·²æ¢å¤&lt;/li>
&lt;li>å½“å‰çª—å£æˆ–è€…å…¶ä»–çª—å£æ²¡æœ‰vimæ­£åœ¨æ‰“å¼€æ–‡ä»¶(ä¼šç”Ÿæˆswp file)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>find . -type f -name &lt;span style="color:#f1fa8c">&amp;#34;.*.sw[klmnop]&amp;#34;&lt;/span> -delete
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/blockquote>
&lt;p>&lt;a href="https://www.cs.longwood.edu/VimSwap.html">How to handle swapfiles in Vim (longwood.edu)&lt;/a>&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="debug-vim-key-mapping">Debug VIM key mapping&lt;/h2>
&lt;p>&lt;a href="https://vi.stackexchange.com/a/7723/43494">https://vi.stackexchange.com/a/7723/43494&lt;/a>&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å¦‚ä½•åŒæ­¥-vim-dotfiles">å¦‚ä½•åŒæ­¥ VIM Dotfiles&lt;/h2>
&lt;p>vim çš„ dotfiles ä¸»è¦åŒ…å«&lt;code>.vimrc&lt;/code>å’Œ&lt;code>.vim/&lt;/code>ä¸­çš„æ’ä»¶.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¯¹äº&lt;code>.vimrc&lt;/code>, æˆ‘é€‰æ‹©ä½¿ç”¨mackup è½¯ä»¶å’Œå…¶ä»–system dotfiles ä¸€èµ·å¤‡ä»½. &lt;a href="https://github.com/wangloo/dotfiles">Git repo&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹äº plugins, ä¼ ç»Ÿçš„ç®¡ç†æ’ä»¶çš„æ–¹å¼(ä½¿ç”¨&lt;code>vim-plug&lt;/code>), ä¹Ÿå°±æ˜¯æ”¾åœ¨&lt;code>~/.vim/plugged/&lt;/code>ç›®å½•ä¸­çš„, å¯ä»¥é€šè¿‡&lt;code>:PlugInstall&lt;/code>å‘½ä»¤åœ¨æ–°æœºå™¨ä¸Šé‡æ–°ä»ç½‘ä¸Šå…‹éš†. èƒ½å¤Ÿä¿è¯ä½¿ç”¨çš„æ˜¯æ–°ç‰ˆæœ¬.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>VIM 8.0 ä¹‹å, å¼•å…¥ &lt;em>pack system&lt;/em> æ–°çš„æ’ä»¶ç®¡ç†æ–¹å¼. å¯¹äºè¿™ç±»çš„æ’ä»¶, æˆ‘ä»¬ç›´æ¥åˆ©ç”¨&lt;code>submodule&lt;/code>åŠ å…¥å¦ä¸€ä¸ªå¤‡ä»½çš„ &lt;a href="https://github.com/wangloo/vimpack">Git repo&lt;/a>. ä½¿ç”¨æ–¹æ³•è§&lt;code>README&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="good-plugins">Good plugins&lt;/h2>
&lt;blockquote>
&lt;p>Reference: &lt;a href="https://github.com/amix/vimrc">The Ultimate vimrc&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="todo">TODO&lt;/h3>
&lt;h3 id="installed">Installed&lt;/h3>
&lt;p>&lt;a href="https://github.com/preservim/nerdcommenter#settings">NERD Commneter - å¿«é€Ÿæ³¨é‡Š&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/preservim/nerdtree">NERD Tree - ç›®å½•æ ‘&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/amix/open_file_under_cursor.vim">Open File Under Cursor - æ‰“å¼€å…‰æ ‡å¤„çš„æ–‡ä»¶ç›®å½•&lt;/a>&lt;/p>
&lt;ul>
&lt;li>ä¸æ”¯æŒ&lt;code>vim-plug&lt;/code>å®‰è£…. ç›´æ¥cloneæºç åˆ°&lt;code>plugged&lt;/code>ç›®å½•å³å¯.&lt;/li>
&lt;li>Usage: &lt;code>gf&lt;/code>: åœ¨å½“å‰windowæ‰“å¼€æ–‡ä»¶. &lt;code>&amp;lt;C-w&amp;gt;&amp;lt;C-f&amp;gt;&lt;/code>: &lt;strong>new vertical windows&lt;/strong>ä¸­æ‰“å¼€æ–‡ä»¶.&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://github.com/mileszs/ack.vim">Ack.vim - å¿«é€Ÿå®šä½å†…å®¹&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/Yggdroot/LeaderF">LeaderF - Like Ctrlp but better?&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/rlue/vim-barbaric">barbaric - normalæ¨¡å¼åˆ‡æ¢è‹±æ–‡è¾“å…¥æ³•&lt;/a>&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="helpful-script">Helpful script&lt;/h2>
&lt;h3 id="search-text-selected-in-visual-mode">search text selected in visual mode&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-vimrc" data-lang="vimrc">&lt;span style="display:flex;">&lt;span>xnoremap * :&amp;lt;C-u&amp;gt;call &amp;lt;SID&amp;gt;VSetSearch(&lt;span style="color:#f1fa8c">&amp;#39;/&amp;#39;&lt;/span>)&amp;lt;CR&amp;gt;&lt;span style="color:#f1fa8c">/&amp;lt;C-R&amp;gt;=@/&lt;/span>&amp;lt;CR&amp;gt;&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xnoremap # :&amp;lt;C-u&amp;gt;call &amp;lt;SID&amp;gt;VSetSearch(&lt;span style="color:#f1fa8c">&amp;#39;?&amp;#39;&lt;/span>)&amp;lt;CR&amp;gt;?&amp;lt;C-R&amp;gt;=@/&amp;lt;CR&amp;gt;&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">function&lt;/span>! s:VSetSearch(cmdtype)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">let&lt;/span> temp = @s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>norm! gv&amp;#34;sy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">let&lt;/span> @/ = &lt;span style="color:#f1fa8c">&amp;#39;\V&amp;#39;&lt;/span> . substitute(escape(@s, a:cmdtype.&lt;span style="color:#f1fa8c">&amp;#39;\&amp;#39;&lt;/span>), &lt;span style="color:#f1fa8c">&amp;#39;\n&amp;#39;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#39;\\n&amp;#39;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#39;g&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">let&lt;/span> @s = temp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">endfunction&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/vim/basic/ - @2019 Notepadium.</description></item></channel></rss>