<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Homepage ğŸŒˆ on Wangloo's BLOG</title><link>https://wangloo.github.io/</link><description>Recent content in Homepage ğŸŒˆ on Wangloo's BLOG</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>@2019 Notepadium.</copyright><lastBuildDate>Thu, 15 Sep 2022 15:14:05 +0800</lastBuildDate><atom:link href="https://wangloo.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>æˆ‘çš„å¼€å‘ç¯å¢ƒæ„å»ºæŒ‡å—</title><link>https://wangloo.github.io/posts/tools/dev_env/</link><pubDate>Mon, 17 Jul 2023 19:28:12 +0800</pubDate><guid>https://wangloo.github.io/posts/tools/dev_env/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/tools/dev_env/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>å†™è¿™ç¯‡åšå®¢çš„èƒŒæ™¯æ˜¯&lt;strong>æˆ‘å®åœ¨å¿å—ä¸äº†æ¯æ¬¡æ¢æ–°çš„å¼€å‘æœºå™¨éƒ½å¾—è´¹å¥½å¤§çš„åŠ²æ¥å®Œå…¨æ¢å¤ä»¥å‰çš„ç¯å¢ƒ&lt;/strong>ï¼Œ è€Œä¸”ï¼Œæˆ‘å¹³å¸¸å–œæ¬¢æœé›†å„ç§æœ‰ç”¨çš„å·¥å…·ã€å¥½çœ‹çš„ä¸»é¢˜ï¼Œå­—ä½“è¿™äº›ï¼Œå¦‚æœé›¶é›¶æ•£æ•£çš„è®°å½•ï¼Œå¤§æ¦‚ç‡ä¼šå¿˜è®°æˆ–è€…è®°ä¸å¾—æŸäº›ç»†èŠ‚ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæœ€åæœŸæœ›è¾¾åˆ°çš„æ˜¯&lt;strong>èƒ½å¤Ÿä½¿æˆ‘æ¯æ¬¡åœ¨æ–°æœºå™¨ä¸Šæ­å»ºç¯å¢ƒåªéœ€è¦çœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¯ä»¥äº†&lt;/strong>ã€‚å› æ­¤è¿™é‡Œä¼šè®°å½•ï¼š&lt;/p>
&lt;ul>
&lt;li>å¸®åŠ©æå‡å¼€å‘æ•ˆç‡çš„å°å·¥å…·&lt;/li>
&lt;li>å¥½çœ‹çš„å­—ä½“ã€ä¸»é¢˜&lt;/li>
&lt;li>é…ç½®æŸäº›ç¯å¢ƒçš„è¦ç‚¹åŠæ³¨æ„äº‹é¡¹&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ğŸ¥€ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æœªå‘ç°ä¸€ç§æ–¹å¼èƒ½å¤Ÿå®Œå…¨è¾¾åˆ°â€œä¸€é”®å¼å¸ƒç½®â€ï¼Œè¿™ä¹Ÿä¸æ˜¯æœ¬æ–‡çš„ç›®çš„ã€‚
ä»˜å‡ºè‡³å°‘åŠå¤©çš„æ—¶é—´çš„ä¸€å®šçš„ï¼Œå¸Œæœ›æœªæ¥èƒ½å‘ç°ä¸€ç§å¥½çš„æ–¹æ³•ã€‚&lt;/p>
&lt;/blockquote>
&lt;h1 id="å­—ä½“">å­—ä½“&lt;/h1>
&lt;h2 id="fira-code">Fira Code&lt;/h2>
&lt;p>è¿™æ¬¾å­—ä½“é€‚åˆåšç¼–ç¨‹å­—ä½“ï¼Œè›®å¥½çœ‹çš„ã€‚æˆ‘åœ¨ vscode å’Œ terminal ä¸‹éƒ½ä½¿ç”¨äº†è¿™æ¬¾å­—ä½“ã€‚&lt;/p>
&lt;p>è¯¦æƒ…åŠå®‰è£…å‚è€ƒ&lt;a href="https://github.com/tonsky/FiraCode">github&lt;/a>&lt;/p>
&lt;h2 id="éœé¹œæ–‡æ¥·">éœé¹œæ–‡æ¥·&lt;/h2>
&lt;p>å¼€æºçš„ä¸­æ–‡å­—ä½“ï¼Œåšåšå®¢ã€PPT ä¸é”™ã€‚&lt;/p>
&lt;p>è¯¦æƒ…åŠå®‰è£…å‚è€ƒ&lt;a href="https://github.com/lxgw/LxgwWenKai">github&lt;/a>&lt;/p>
&lt;h1 id="vscode">vscode&lt;/h1>
&lt;h2 id="ä¸»é¢˜">ä¸»é¢˜&lt;/h2>
&lt;h1 id="vim">vim&lt;/h1>
&lt;h2 id="vimrc">vimrc&lt;/h2>
&lt;h2 id="ycm-ç‰¹åˆ«æ³¨æ„">ycm ç‰¹åˆ«æ³¨æ„&lt;/h2>
&lt;p>YCM æ’ä»¶å¯¹ python, vim çš„ç‰ˆæœ¬å‡æœ‰è¦æ±‚ã€‚&lt;/p>
&lt;h3 id="ä¸‹è½½">ä¸‹è½½&lt;/h3>
&lt;p>å¯ä»¥ä½¿ç”¨ vim-plug ç­‰å·¥å…·ä¸‹è½½, ä¹Ÿå¯ä»¥ä¸‹è½½æºç ç„¶åæ‹·è´åˆ°&lt;code>.vim&lt;/code>ç›®å½•ä¸‹&lt;/p>
&lt;h3 id="ç¼–è¯‘">ç¼–è¯‘&lt;/h3>
&lt;p>ç¼–è¯‘ç”¨åˆ° python3, è¿™é‡Œæ˜¯é—®é¢˜æœ€å¤šçš„ä¸€æ­¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># ç¼–è¯‘å¹¶æ·»åŠ å¯¹Cçš„æç¤ºæ”¯æŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>python3 install.py --clangd-completer --verbose
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Searching Python 3.8 libraries...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Downloading Clangd from https://github.com/ycm-core/llvm/releases/download/13.0.0/clangd-13.0.0-x86_64-unknown-linux-gnu.tar.bz2...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨&lt;code>--clangd-completer&lt;/code>å‚æ•°æ—¶, è„šæœ¬ä¼šå»ä¸‹è½½ clangd-14.0.0-x86_64-unknown-linux-gnu.tar.bz2 æ–‡ä»¶, æ¯”è¾ƒæ…¢. ä¹Ÿå¯ä»¥&lt;strong>æå‰æ ¹æ®æç¤ºçš„ç½‘ç«™è‡ªå·±æ‰‹åŠ¨ä¸‹è½½&lt;/strong>å‹ç¼©åŒ….&lt;/p>
&lt;p>ä¸‹è½½å®Œæˆå, æ”¾åˆ°æœ¬åœ°ç›®å½•ä¸‹:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>:~/.vim/plugged/YouCompleteMe/third_party/ycmd/third_party/clangd/cache$ ls
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>clangd-14.0.0-x86_64-unknown-linux-gnu.tar.bz2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜éœ€å¯¹è„šæœ¬&lt;code>YouCompleteMe/third_party/ycmd/build.py&lt;/code>è¿›è¡Œä¿®æ”¹, é˜²æ­¢é‡æ–°ä¸‹è½½.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">def&lt;/span> &lt;span style="color:#50fa7b">DownloadClangd&lt;/span>( printer ):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MakeCleanDirectory( CLANGD_OUTPUT_DIR )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#ff79c6">not&lt;/span> p&lt;span style="color:#ff79c6">.&lt;/span>exists( CLANGD_CACHE_DIR ):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> os&lt;span style="color:#ff79c6">.&lt;/span>makedirs( CLANGD_CACHE_DIR )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4"># æ³¨é‡Šä¸‹é¢çš„è¯­å¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4"># elif p.exists( file_name ) and not CheckFileIntegrity( file_name, check_sum ):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4"># printer( &amp;#39;Cached Clangd archive does not match checksum. Removing...&amp;#39; )&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4"># os.remove( file_name )&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> p&lt;span style="color:#ff79c6">.&lt;/span>exists( file_name ):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printer( &lt;span style="color:#f1fa8c">f&lt;/span>&lt;span style="color:#f1fa8c">&amp;#39;Using cached Clangd: &lt;/span>&lt;span style="color:#f1fa8c">{&lt;/span> file_name &lt;span style="color:#f1fa8c">}&lt;/span>&lt;span style="color:#f1fa8c">&amp;#39;&lt;/span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é…ç½®">é…ç½®&lt;/h3>
&lt;p>YCM é…åˆä¸€ä¸ªé…ç½®æ–‡ä»¶&lt;code>.ycm_c_c++_conf.py&lt;/code>, YCM æœç´¢çš„ä½ç½®åœ¨ vimrc ä¸­æŒ‡å®š:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-vimrc" data-lang="vimrc">&lt;span style="display:flex;">&lt;span>Plug &lt;span style="color:#f1fa8c">&amp;#39;rdnetto/YCM-Generator&amp;#39;&lt;/span>, { &lt;span style="color:#f1fa8c">&amp;#39;branch&amp;#39;&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#39;stable&amp;#39;&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">let&lt;/span> g:ycm_global_ycm_extra_conf = &lt;span style="color:#f1fa8c">&amp;#34;~/.ycm_c_c++_conf.py&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶å†…å®¹çš„ example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-py" data-lang="py">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> os
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> ycm_core
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>flags &lt;span style="color:#ff79c6">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-Wall&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-Wextra&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># &amp;#39;-Werror&amp;#39;,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-Wno-long-long&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># &amp;#39;-Wno-variadic-macros&amp;#39;,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-fexceptions&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-ferror-limit=10000&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-DNDEBUG&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-std=c99&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-xc&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;-isystem/usr/include/&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>SOURCE_EXTENSIONS &lt;span style="color:#ff79c6">=&lt;/span> [ &lt;span style="color:#f1fa8c">&amp;#39;.cpp&amp;#39;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#39;.cxx&amp;#39;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#39;.cc&amp;#39;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#39;.c&amp;#39;&lt;/span>, ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">def&lt;/span> &lt;span style="color:#50fa7b">FlagsForFile&lt;/span>( filename, &lt;span style="color:#ff79c6">**&lt;/span>kwargs ):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;flags&amp;#39;&lt;/span>: flags,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f1fa8c">&amp;#39;do_cache&amp;#39;&lt;/span>: &lt;span style="color:#ff79c6">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¼˜åŒ–">ä¼˜åŒ–&lt;/h3>
&lt;p>ğŸ”» å¯¹äºC/C++æ¥è¯´, YCMçš„ä½¿ç”¨æœ€å¥½é…åˆ&lt;em>compilation database&lt;/em> æ¥ä½¿ç”¨, ä¾‹å¦‚&lt;a href="https://github.com/nickdiego/compiledb">compiledb&lt;/a>. å¦åˆ™, å¯èƒ½å¤´æ–‡ä»¶çš„pathè¯†åˆ«å‡ºé—®é¢˜(&lt;a href="https://stackoverflow.com/questions/64277317/youcompleteme-not-work-properly-for-c-headers.">stackoverflow&lt;/a>).&lt;/p>
&lt;p>2022å¹´2æœˆ13æ—¥æˆ‘ä½¿ç”¨çš„compilation databaseç”Ÿæˆå·¥å…·ä»&lt;code>compiledb&lt;/code>æ¢æˆäº†&lt;code>bear&lt;/code>, å› ä¸º&lt;code>bear&lt;/code>æ›´å¥½çš„æ”¯æŒé€’å½’, å³æœ‰&lt;code>make -C&lt;/code>çš„æƒ…å†µ.&lt;/p>
&lt;p>éœ€è¦çš„compilation databaseç”Ÿæˆå·¥å…·ä»‹ç»: &lt;a href="https://sarcasm.github.io/notes/dev/compilation-database.html">Compilation database â€” Sarcasm notebook&lt;/a>&lt;/p>
&lt;h1 id="shell">shell&lt;/h1>
&lt;h2 id="zsh">zsh&lt;/h2>
&lt;h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h2>
&lt;h1 id="terminal">terminal&lt;/h1>
&lt;p>ubuntuè‡ªå¸¦çš„ç»ˆç«¯æˆ‘è§‰å¾—è¿˜ä¸é”™ï¼Œæœ‰äº›äººè¯´Terminitorä¸é”™ï¼Œåˆ†å±åŠŸèƒ½è¿˜æ˜¯æŒºå¸¸ç”¨çš„ï¼&lt;/p>
&lt;h1 id="tmux">tmux&lt;/h1>
- https://wangloo.github.io/posts/tools/dev_env/ - @2019 Notepadium.</description></item><item><title>é¢è¯•æ€»ç»“ï¼šç‰¹æ–¯æ‹‰å®ä¹ </title><link>https://wangloo.github.io/posts/work/tesla/</link><pubDate>Sat, 10 Jun 2023 08:51:49 +0800</pubDate><guid>https://wangloo.github.io/posts/work/tesla/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/work/tesla/ -&lt;p>ä¸Šåˆç»“æŸäº†ç‰¹æ–¯æ‹‰&lt;em>åµŒå…¥å¼å®ä¹ ç”Ÿ-Linux platform&lt;/em>çš„äºŒé¢ï¼Œç‰¹æ–¯æ‹‰å®ä¹ ç”Ÿ
ä¸€å…±æœ‰ä¸‰è½®é¢è¯•ï¼Œä¸€è½®å’ŒäºŒè½®éƒ½æ˜¯æŠ€æœ¯é¢ï¼Œä¸‰é¢æ˜¯ä¸»ç®¡é¢ã€‚
ç›®å‰æˆ‘å®Œæˆäº†æ‰€æœ‰çš„æŠ€æœ¯é¢ï¼Œä¸”ä¸è®ºç»“æœå¦‚ä½•ï¼Œæ•´ä¸ªé¢è¯•è¿‡ç¨‹å¯¹æˆ‘è€Œè¨€è¿˜æ˜¯æ”¶è·é¢‡ä¸°çš„ï¼Œ
æ•…ä»¥æ­¤æ–‡æ•´ç†ä¸‹è‡ªå·±çš„æ¬ ç¼ºçš„æŠ€æœ¯çŸ¥è¯†ï¼Œå¸Œæœ›ä¸‹æ¬¡èƒ½å¤Ÿè¡¨ç°çš„æ›´å¥½ã€‚&lt;/p>
&lt;h1 id="äºŒé¢">äºŒé¢&lt;/h1>
&lt;p>é¦–å…ˆï¼Œæ­¤è½®é¢è¯•çš„é¢è¯•å®˜æ˜¾ç„¶æ¯”ä¸Šä¸€è½®æ›´æœ‰ç¤¼è²Œä¸€äº›ï¼Œå‡†æ—¶ä¸ä¼š+ä»‹ç»è‡ªå·±ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹
æ˜¯æˆ‘å¼€äº†æ‘„åƒå¤´ä»–æ²¡å¼€ï¼Œä¹Ÿæ²¡æœ‰è¿›è¡Œè¯´æ˜å§ã€‚ ä¸è¿‡è¿™äº›éƒ½æ˜¯å°äº‹ï¼Œæˆ‘ä»¬è¿™æ¬¡ä¸»è¦è°ˆè®º
æŠ€æœ¯çš„å†…å®¹ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨æ­¤å›é¡¾å‡ ä¸ªæ²¡æœ‰å›ç­”å¥½çš„é—®é¢˜ï¼Œä¾›ä»¥ååšå‚è€ƒã€‚&lt;/p>
&lt;h2 id="elf-æ–‡ä»¶çš„åŠ è½½æµç¨‹">ELF æ–‡ä»¶çš„åŠ è½½æµç¨‹&lt;/h2>
&lt;blockquote>
&lt;p>åŸå›ç­”&lt;/p>
&lt;ol>
&lt;li>æ‹¿åˆ° ELF å­˜å‚¨çš„åœ°å€åï¼Œå…ˆå°†å¤´éƒ¨è¯»å‡ºæ¥ï¼Œé•¿åº¦æ˜¯å›ºå®šçš„ã€‚å¤´éƒ¨æœ‰æ ¡éªŒå­—æ®µï¼Œ
maigic number, ç„¶åæ˜¯ç¡®è®¤ ELF ç¼–è¯‘çš„æ¶æ„ï¼Œä½æ•°æ˜¯å¦æ­£ç¡®ã€‚&lt;/li>
&lt;li>ç¡®è®¤æ ¼å¼æ­£ç¡®åï¼Œè¯»å–ç¨‹åºå¤´è¡¨ï¼Œå…¶ä¸­ä¿å­˜äº†å„ä¸ªéœ€è¦åŠ è½½çš„æ®µçš„åç§»ï¼Œæ ¹æ®
base+æ®µåç§»èƒ½å¤Ÿå¾—åˆ°è¯¥æ®µçš„ä½ç½®ï¼Œç„¶åæ ¹æ®æ®µå±æ€§çš„ä¸åŒï¼Œé€‰æ‹©æ˜ å°„åˆ°ä¸åŒ
çš„åŒºåŸŸå’Œå±æ€§ï¼Œä¾‹å¦‚ text æ®µæ˜ å°„ä¸º RE, ä»£ç æ®µæ˜ å°„ä¸º RWï¼Œæ¸…ç©º BSS ç­‰&lt;/li>
&lt;li>è¯´æ˜è‡ªå·±æ²¡æ¥è§¦è¿‡åŠ¨æ€åº“æ–‡ä»¶ï¼Œæ‰€ä»¥å¯¹åŠ¨æ€åŠ è½½ä¸æ˜¯å¾ˆç†Ÿæ‚‰&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>ç‚¹è¯„å¦‚ä¸‹: å¯¹æ®µè¡¨ã€ç¨‹åºå¤´è¡¨ï¼Œè¿™äº›æ¦‚å¿µçš„åŒºåˆ†è¿˜ä¸æ˜¯å¾ˆç†Ÿï¼Œä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™ç”¨
section tableï¼Œ ä»€ä¹ˆæ—¶å€™ç”¨ program header table. ä»¥å‰éƒ½çœ‹è¿‡ï¼Œåªæ˜¯
æ—¶é—´é•¿äº†ä¸ç”¨å°±å¿˜è®°äº†ï¼Œè¿™ä¸€éƒ¨åˆ†éœ€è¦å¥½å¥½çš„åšä¸‹ç¬”è®°ã€‚&lt;/p>
&lt;h2 id="å…¨å±€å˜é‡å­˜åœ¨å“ªè°è´Ÿè´£åˆå§‹åŒ–çš„">å…¨å±€å˜é‡å­˜åœ¨å“ªï¼Ÿè°è´Ÿè´£åˆå§‹åŒ–çš„&lt;/h2>
&lt;blockquote>
&lt;p>åŸå›ç­”&lt;/p>
&lt;p>ä¸çŸ¥é“ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å…¨å±€ä¿é‡å­˜åœ¨çš„ä½ç½®ï¼š&lt;/p>
&lt;ul>
&lt;li>æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ ==&amp;gt; bssæ®µ&lt;/li>
&lt;li>constä¿®é¥°çš„å…¨å±€å˜é‡ ==&amp;gt; rodataæ®µ&lt;/li>
&lt;li>å…¶ä»–å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ ==&amp;gt; dataæ®µ&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡çš„è®¿é—®ï¼Œç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å°†å€¼å­˜å…¥dataæ®µï¼Œè®¿é—®çš„æŒ‡ä»¤æ˜¯é€šè¿‡
ç›¸å¯¹å¯»å€æ¥åšï¼Œä¾‹å¦‚ç›¸å¯¹äºdataæ®µå¼€å¤´ã€‚å¯¹äºé™æ€é“¾æ¥æ¥è¯´ï¼Œç¼–è¯‘å®Œæˆåè®¿é—®æŒ‡ä»¤çš„
åŸºåœ°å€å’Œåç§»éƒ½æ˜¯ç©ºï¼Œå½“é“¾æ¥æ—¶ä¿®æ”¹æŒ‡ä»¤ï¼Œå³é‡å®šä½çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;h2 id="aligned_allocè®¾è®¡">aligned_alloc()è®¾è®¡&lt;/h2>
&lt;p>è¿™æ˜¯é¢è¯•æœ€åçš„ç¨‹åºè®¾è®¡é¢˜ï¼Œæˆ‘ä¹Ÿæ˜¯æ²¡æœ‰åšå¥½ï¼Œåé¢å¥½æ­¹åœ¨é¢è¯•å®˜çš„æ— æ•°æ¬¡æç¤ºä¸­ï¼Œ
å†™å‡ºäº†ä¸€ä¸ªè§£ï¼Œé¢˜ç›®å¾ˆæ£’ï¼Œåªæ˜¯è‡ªå·±å®ä¹ ä¸å¤Ÿï¼Œæ€ªä¸å¾—å…¶ä»–ã€‚&lt;/p>
&lt;h3 id="åŸé—®é¢˜">åŸé—®é¢˜&lt;/h3>
&lt;p>å¯¹&lt;code>malloc()&lt;/code>å’Œ&lt;code>free()&lt;/code>è¿›è¡Œå°è£…ï¼Œè®¾è®¡ä¸€ä¸ªè¿”å›æ»¡è¶³ä»»æ„å­—èŠ‚å¯¹é½è¦æ±‚çš„
&lt;code>align_alloc()&lt;/code>å’Œ&lt;code>align_free()&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">align_alloc&lt;/span>(size_t size, size_t align);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">align_free&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size_t alignment[&lt;span style="color:#bd93f9">6&lt;/span>] &lt;span style="color:#ff79c6">=&lt;/span> {&lt;span style="color:#bd93f9">5&lt;/span>, &lt;span style="color:#bd93f9">8&lt;/span>, &lt;span style="color:#bd93f9">32&lt;/span>, &lt;span style="color:#bd93f9">64&lt;/span>, &lt;span style="color:#bd93f9">128&lt;/span>, &lt;span style="color:#bd93f9">12&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">6&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#ff79c6">=&lt;/span> align_alloc(&lt;span style="color:#bd93f9">10&lt;/span>, alignment[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span>)p &lt;span style="color:#ff79c6">%&lt;/span> alignment[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;FAILED!, alignment: %ld, addr: %p&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> alignment[i], p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(p, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#bd93f9">10&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> align_free(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;PASS&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ€è·¯åŠè§£å†³æ–¹æ¡ˆ">æ€è·¯åŠè§£å†³æ–¹æ¡ˆ&lt;/h3>
&lt;p>æ€è·¯ä¹Ÿå†™åœ¨ä»£ç é‡Œäº†ï¼Œå°±æ˜¯æ€è·¯æ¯”è¾ƒéš¾æƒ³ï¼Œä»£ç å€’æ˜¯ä¸éš¾å†™ã€‚&lt;/p>
&lt;p>PS: ä¸¢äººçš„æ˜¯ï¼Œæˆ‘åœ¨ä¸€å¼€å§‹å±…ç„¶è¿˜æäº†: &lt;code>malloc()&lt;/code>è¿”å›çš„åœ°å€èƒ½å¤Ÿä¿è¯æ˜¯å‚æ•°&lt;code>size&lt;/code>å¯¹é½çš„ï¼Œ
çœŸæ˜¯ä»¤äººè€»ç¬‘å•Šï¼ï¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">align_alloc&lt;/span>(size_t size, size_t align);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">align_free&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// å¦‚ä½•ä¿è¯å¯¹é½åˆ°align?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ==&amp;gt; ç”³è¯·æ›´å¤šç©ºé—´, è¿”å›å¯¹é½çš„åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ä¸èƒ½ä¿è¯mallocè¿”å›çš„åœ°å€æ˜¯å¯¹é½åˆ°å“ªçš„ï¼Œæ€ä¹ˆç¡®å®šå¤šç”³è¯·å¤šå¤§å‘¢?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ==&amp;gt; å¤šç”³è¯·alignçš„ç©ºé—´ï¼Œå°±èƒ½ä¿è¯è¿™alignçš„åœ°å€èŒƒå›´é‡Œï¼Œæ€»æœ‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// æ»¡è¶³å¯¹é½æ¡ä»¶çš„åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// å¦‚ä½•è®¡ç®—è¿”å›çš„åœ°å€? æ¯”å¦‚malloc(10)=12, align=5, æ­¤æ—¶æˆ‘ä»¬ä¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ç”³è¯·çš„ç©ºé—´ä¸ºmalloc(10+5), å³(12-27)éƒ½æ˜¯å¯ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ç»è¿‡è®¡ç®—åè¿”å›åœ°å€ 15
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ==&amp;gt; è®¡ç®—çš„è§„åˆ™æ˜¯(12+5)-(12+5)%5
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// aligned_free()åªæ¥å—addrä¸€ä¸ªå‚æ•°ï¼Œå¦‚ä½•é‡Šæ”¾malloc()ç”³è¯·çš„ç©ºé—´?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ==&amp;gt; ä¼ å…¥çš„addræ˜¯ç»è¿‡alignä¹‹åçš„ï¼Œç¡®å®éœ€è¦ä¸€å®šçš„æ–¹æ³•æ‰èƒ½
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// æ±‚å¾—malloc()è¿”å›çš„åœ°å€ï¼Œè¿™é€šè¿‡è®¡ç®—æ˜¯æ— æ³•å¾—åˆ°çš„ï¼Œå› ä¸º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ä¸çŸ¥é“è¿™ä¸ªåœ°å€çš„alignæ˜¯å¤šå°‘ã€‚æ‰€ä»¥å¯ä»¥æƒ³åˆ°åœ¨p_retä¹‹å‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// å†å¤šå€Ÿç”¨ä¸€ä¸ªåœ°å€çš„é•¿åº¦æ¥å­˜æ”¾malloc()è¿”å›çš„åŸåœ°å€ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">align_alloc&lt;/span>(size_t size, size_t align)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p_malloc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p_ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size_t aligned_size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size_t ptr_size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ptr_size &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> aligned_size &lt;span style="color:#ff79c6">=&lt;/span> size &lt;span style="color:#ff79c6">+&lt;/span> align &lt;span style="color:#ff79c6">+&lt;/span> ptr_size;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p_malloc &lt;span style="color:#ff79c6">=&lt;/span> malloc(aligned_size);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p_ret &lt;span style="color:#ff79c6">=&lt;/span> (p_malloc&lt;span style="color:#ff79c6">+&lt;/span>ptr_size&lt;span style="color:#ff79c6">+&lt;/span>align) &lt;span style="color:#ff79c6">-&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span>)p_malloc&lt;span style="color:#ff79c6">+&lt;/span>ptr_size&lt;span style="color:#ff79c6">+&lt;/span>align) &lt;span style="color:#ff79c6">%&lt;/span> align;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>)p_ret&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> (&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span>)p_malloc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// debug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> printf(&lt;span style="color:#f1fa8c">&amp;#34;[ALLOC] p_malloc: %p, p_ret: %p, align: %ld&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p_malloc, p_ret, align);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> p_ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">align_free&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p_malloc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p_malloc &lt;span style="color:#ff79c6">=&lt;/span> (&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>)(&lt;span style="color:#ff79c6">*&lt;/span>((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>)addr&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;[ FREE] p_malloc: %p&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, p_malloc);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> free(p_malloc);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> size_t alignment[&lt;span style="color:#bd93f9">6&lt;/span>] &lt;span style="color:#ff79c6">=&lt;/span> {&lt;span style="color:#bd93f9">5&lt;/span>, &lt;span style="color:#bd93f9">8&lt;/span>, &lt;span style="color:#bd93f9">32&lt;/span>, &lt;span style="color:#bd93f9">64&lt;/span>, &lt;span style="color:#bd93f9">128&lt;/span>, &lt;span style="color:#bd93f9">12&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">6&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> p &lt;span style="color:#ff79c6">=&lt;/span> align_alloc(&lt;span style="color:#bd93f9">10&lt;/span>, alignment[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span>)p &lt;span style="color:#ff79c6">%&lt;/span> alignment[i]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;FAILED!, alignment: %ld, addr: %p&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> alignment[i], p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(p, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#bd93f9">10&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> align_free(p);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;PASS&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/work/tesla/ - @2019 Notepadium.</description></item><item><title>Linux å†…æ ¸æ•°æ®ç»“æ„ hlist</title><link>https://wangloo.github.io/posts/os/linux/data_struct/hlist/</link><pubDate>Thu, 11 May 2023 20:51:49 +0800</pubDate><guid>https://wangloo.github.io/posts/os/linux/data_struct/hlist/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/os/linux/data_struct/hlist/ -&lt;p>linux å†…æ ¸ä¸ºåˆ›å»ºã€ç”¨å•é“¾è¡¨è§£å†³å†²çªçš„å“ˆå¸Œè¡¨ã€‘è®¾è®¡äº†ä¸“é—¨çš„æ•°æ®ç»“æ„ hlistã€‚&lt;/p>
&lt;p>hlist æ•´ä½“æ¥è¯´æ˜¯å¸¦å¤´ç»“ç‚¹çš„åŒå‘é“¾è¡¨ï¼Œå¤´ç»“ç‚¹çš„ç±»å‹ä¸º&lt;code>hlist_head&lt;/code>, æ™®é€šèŠ‚ç‚¹
çš„ç±»å‹ä¸º&lt;code>hlist_node&lt;/code>. &lt;strong>ä¸ºä»€ä¹ˆè¦åŒºåˆ«ä¸¤ç§ç±»å‹ï¼ŸèŠ‚çº¦ç©ºé—´&lt;/strong>ï¼Œ å› ä¸ºå“ˆå¸Œè¡¨çš„
è¡¨é¡¹ç±»å‹å¯ä»¥æ˜¯&lt;code>hlist_head&lt;/code>, å®ƒå…¶å®ä¸éœ€è¦&lt;code>prev&lt;/code>æŒ‡é’ˆ, æ¯”èµ·ä¸€èˆ¬çš„ç»“ç‚¹ï¼Œä¸€ä¸ª
å“ˆå¸Œè¡¨èƒ½èŠ‚çº¦ä¸€åŠçš„ç©ºé—´ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ä¸€ä¸ªå“ˆå¸Œè¡¨å’Œå¤´ç»“ç‚¹çš„ç»“æ„å¯è¡¨ç¤ºä¸º:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> hlist_head {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>first;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> hlist_head table[TALBE_SZ];
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="äºŒè±¡æ€§">äºŒè±¡æ€§&lt;/h2>
&lt;p>ä»»ä½•äº‹ç‰©éƒ½å…·æœ‰äºŒè±¡æ€§ï¼ŒåŒºåˆ†ä¸¤ç§ç±»å‹èŠ‚çº¦ç©ºé—´çš„ç©ºé—´ï¼Œä¹Ÿå¸¦äº†ä¸€ä¸ªé—®é¢˜ï¼š
&lt;strong>é¦–ä¸ª&lt;code>hlist_node&lt;/code>ç»“ç‚¹çš„&lt;code>prev&lt;/code>æŒ‡å‘å“ªå‘¢ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>æ­£å¸¸æƒ…å†µä¸‹è‚¯å®šæ¯«ä¸çŠ¹è±«çš„æŒ‡å‘å¤´ç»“ç‚¹ï¼Œå³&lt;code>hlist_head&lt;/code>ï¼Œä½†æ³¨æ„æ­¤æ—¶ç±»å‹æ˜¯
ä¸åŒçš„ï¼Œ&lt;code>prev&lt;/code>ä¸èƒ½åŒæ—¶æ˜¯&lt;code>struct hlist_head*&lt;/code>å’Œ&lt;code>struct hlist_node *&lt;/code>ã€‚&lt;/p>
&lt;p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼Œé¦–å…ˆå¯ä»¥ä½¿é¦–ä¸ªç»“ç‚¹çš„&lt;code>prev=NULL&lt;/code>, è¿™æ ·è™½ç„¶é¿å…äº†ç±»å‹å¼•å‘çš„
é—®é¢˜ï¼Œä¹Ÿèƒ½ä¿è¯åŠŸèƒ½æ­£ç¡®ï¼Œä½†æ˜¯å´ç ´åäº†ä¸€è‡´æ€§ï¼Œä½¿å¾—æ“ä½œçš„å¤æ‚åº¦ä¸Šå‡ï¼Œå¢åŠ äº†è®¸å¤š
åˆ¤æ–­åˆ†æ”¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// delelt a node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">del_node&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> hlist_head &lt;span style="color:#ff79c6">*&lt;/span>head, &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>node)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// è¿™ä¸ªif æœ¬æ¥æ˜¯ä¸éœ€è¦çš„ï¼Œç”šè‡³å‚æ•°çš„head ä¹Ÿä¸éœ€è¦ä¼ ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// æ›´å¥½çš„å¤„ç†æ–¹å¼è§è§£å†³æ–¹æ¡ˆ2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (node &lt;span style="color:#ff79c6">==&lt;/span> head&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>first) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>first &lt;span style="color:#ff79c6">=&lt;/span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next &lt;span style="color:#ff79c6">=&lt;/span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev &lt;span style="color:#ff79c6">=&lt;/span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// insert a node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">add_node_before&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> hlist_head &lt;span style="color:#ff79c6">*&lt;/span>head, &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>new
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// è¿™ä¸ªif æœ¬æ¥æ˜¯ä¸éœ€è¦çš„ï¼Œå‚æ•°headä¹Ÿæ˜¯ä¸éœ€è¦ä¼ é€’çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (next &lt;span style="color:#ff79c6">==&lt;/span> head&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>first) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>first &lt;span style="color:#ff79c6">=&lt;/span> new;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev &lt;span style="color:#ff79c6">=&lt;/span> next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next &lt;span style="color:#ff79c6">=&lt;/span> new;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next &lt;span style="color:#ff79c6">=&lt;/span> next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev &lt;span style="color:#ff79c6">=&lt;/span> new;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ-prev">æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ: &lt;code>**prev&lt;/code>&lt;/h2>
&lt;p>æ”¹å˜&lt;code>struct hlist_node&lt;/code>çš„æ„æˆï¼Œä½¿ç”¨äºŒçº§æŒ‡é’ˆ:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> hlist_node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">**&lt;/span>pprev;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿å¾—æ¯ä¸ªç»“ç‚¹çš„&lt;code>pprev = &amp;amp;(prev_node-&amp;gt;next)&lt;/code>, é¦–å…ˆç±»å‹æ˜¯ç»Ÿä¸€çš„ï¼Œå…¶æ¬¡åˆ é™¤å’Œæ·»åŠ 
éƒ½æ— éœ€é¢å¤–çš„åˆ†æ”¯äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">del_node&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>node)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>(node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev) &lt;span style="color:#ff79c6">=&lt;/span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev &lt;span style="color:#ff79c6">=&lt;/span> node&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">add_node&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>new, &lt;span style="color:#ff79c6">struct&lt;/span> hlist_node &lt;span style="color:#ff79c6">*&lt;/span>next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev &lt;span style="color:#ff79c6">=&lt;/span> next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>(new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev) &lt;span style="color:#ff79c6">=&lt;/span> new;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next &lt;span style="color:#ff79c6">=&lt;/span> next;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pprev &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>(new&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Ref:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/360217911">&lt;code>**prev&lt;/code> å¯ä»¥æé«˜åˆ é™¤çš„æ•ˆç‡&lt;/a>&lt;/li>
&lt;li>stackoverflow&lt;/li>
&lt;/ul>
- https://wangloo.github.io/posts/os/linux/data_struct/hlist/ - @2019 Notepadium.</description></item><item><title>Cè¯­è¨€çš„å†…å­˜å¯¹é½</title><link>https://wangloo.github.io/posts/c/alignment/</link><pubDate>Mon, 08 May 2023 17:19:44 +0800</pubDate><guid>https://wangloo.github.io/posts/c/alignment/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/c/alignment/ -&lt;h2 id="å†…å­˜å¯¹é½ä¸ºä½•è¢«éœ€è¦">å†…å­˜å¯¹é½ä¸ºä½•è¢«éœ€è¦&lt;/h2>
&lt;p>æ¶æ„è§„å®šäº†æ•°æ®ç±»å‹å¤§å°çš„åŒæ—¶ï¼Œä¹Ÿè§„å®šäº†å¯¹è¿™äº›ç±»å‹çš„å˜é‡åˆæ³•è®¿é—®çš„å¯¹é½è¦æ±‚ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡ä¸èƒ½éšä¾¿çš„æ”¾åœ¨å†…å­˜çš„ä»»æ„ä½ç½®ï¼Œèµ·å§‹åœ°å€å¿…é¡»æ»¡è¶³ç‰¹å®šçš„å¯¹é½è¦æ±‚ï¼Œ
å¯¹ä¸æ»¡è¶³è¦æ±‚çš„å˜é‡å¼ºè¡Œè®¿é—®å°±å«åš&lt;strong>éå¯¹é½è®¿é—®&lt;/strong>ï¼Œ éå¯¹é½è®¿é—®é€šå¸¸ä¼šè§¦å‘å¼‚å¸¸ã€‚&lt;/p>
&lt;h3 id="ä¸€èˆ¬æ•°æ®ç±»å‹çš„å¯¹é½è¦æ±‚">ä¸€èˆ¬æ•°æ®ç±»å‹çš„å¯¹é½è¦æ±‚&lt;/h3>
&lt;p>å¯¹äºä¸€èˆ¬çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ int, long, char è¿™äº›ï¼Œè¦æ±‚å…¶å˜é‡åœ°å€å¯¹é½åˆ°è‡ªèº«å¤§å°ï¼Œ
æ¯”å¦‚ ARM64 ä¸­ï¼Œint å˜é‡çš„åœ°å€å¿…é¡»å¯¹é½åˆ° 4 å­—èŠ‚ï¼Œlong å˜é‡åœ°å€å¿…é¡»å¯¹é½åˆ° 8 å­—èŠ‚ç­‰ç­‰ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆå¯¹äº&lt;code>*(int *)0x1001 = 1234;&lt;/code>, è¿™ç±»çš„å†…å­˜è®¿é—®å°±å«éå¯¹é½çš„å†…å­˜è®¿é—®ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å³ ï¼ˆå˜é‡ addr % å˜é‡ size) ï¼= 0, å°±ç§°ä¸ºéå¯¹é½å†…å­˜è®¿é—®ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="ç»“æ„ä½“çš„å¯¹é½è¦æ±‚">ç»“æ„ä½“çš„å¯¹é½è¦æ±‚&lt;/h3>
&lt;p>ä¸Šé¢è¯´çš„è¿˜éƒ½æ˜¯ä¸€èˆ¬çš„æ•°æ®ç±»å‹ï¼Œå¯¹äºç»“æ„ä½“è¿™ç§å¤æ‚çš„ç±»å‹ï¼Œå¯¹é½çš„è¦æ±‚ä¹Ÿå¤æ‚äº›ã€‚&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆæ˜¯ç»“æ„ä½“æˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ»¡è¶³å…¶è‡ªèº«çš„å¯¹é½è¦æ±‚&lt;/li>
&lt;li>ç„¶åæ˜¯ç»“æ„ä½“å˜é‡è‡ªèº«çš„èµ·å§‹åœ°å€çš„å¯¹é½è¦æ±‚æ˜¯&lt;strong>å…¶æ‰€æœ‰æˆå‘˜çš„æœ€å¤§å¯¹é½è¦æ±‚&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç„¶è€Œä¸¤ä¸ªè¦æ±‚å‡æ»¡è¶³æœ‰æ—¶å€™æ ¹æœ¬ä¸å¯èƒ½ï¼Œæ¯”å¦‚ä¸€ä¸ªç»“æ„ä½“å£°æ˜ä¸º:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> foo {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> mem1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> mem2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">short&lt;/span> mem3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸å¯èƒ½åŒæ—¶åšåˆ° foo å˜é‡å’Œå…¶æˆå‘˜ mem2 åŒæ—¶æ»¡è¶³å¯¹é½åˆ° 4 å­—èŠ‚ï¼Œæ‰€ä»¥&lt;strong>ç¼–è¯‘å™¨ä¼šä¾æ®
ä¸Šé¢çš„ä¸¤æ¡è¦æ±‚åœ¨æˆå‘˜ä¹‹é—´æ·»åŠ  padding&lt;/strong>ã€‚&lt;/p>
&lt;p>é™¤äº†å˜é‡ä¸­é—´æ·»åŠ  padding å¤–ï¼Œåœ¨æœ«å°¾ä¹Ÿä¼šæ·»åŠ ï¼Œ&lt;strong>ä½¿å¾—ç»“æ„ä½“æ•°ç»„å®¹æ˜“æ»¡è¶³å¯¹é½éœ€æ±‚&lt;/strong>ã€‚&lt;/p>
&lt;p>æœ€å foo å˜é‡åœ¨å†…å­˜ä¸­çš„æ ·å­å¯èƒ½æ˜¯:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> foo {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> mem1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> _pad1[&lt;span style="color:#bd93f9">3&lt;/span>]; &lt;span style="color:#6272a4">// ä¿è¯ç»“æ„ä½“å’Œæˆå‘˜å‡å¯¹é½æ­£ç¡®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> mem2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">short&lt;/span> mem3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> _pad2[&lt;span style="color:#bd93f9">2&lt;/span>]; &lt;span style="color:#6272a4">// ä¿è¯ã€ç»“æ„ä½“æ•°ç»„ã€‘å¯¹é½æ­£ç¡®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>è‹¥ç»“æ„ä½“çš„æˆå‘˜è¿˜æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåµŒå¥—æ“ä½œå°±å¯ä»¥äº†ï¼Œç¼–è¯‘å™¨å¯ä»¥ handleã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å¯¹äºç»“æ„ä½“çš„å®šä¹‰æ¥è¯´ï¼Œè‹¥ä¸æƒ³æ·»åŠ  paddingï¼Œå¯ä»¥ä½¿ç”¨&lt;code>__attribute((packed))&lt;/code>
æ¥å£°æ˜ã€‚ å¸¸ç”¨äºä¸€äº›æ•°æ®åŒ…çš„å£°æ˜ï¼Œé™¤éä½ æ¸…æ¥šè‡ªå·±ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œè¦ä¸åˆ«ç”¨ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å¦‚ä½•åšåˆ°å†…å­˜å¯¹é½">å¦‚ä½•åšåˆ°å†…å­˜å¯¹é½&lt;/h2>
&lt;p>ä¸Šé¢ä¸€èŠ‚è¯´æ˜äº†å„ä¸ªç±»å‹çš„å˜é‡å¯¹äºå†…å­˜å¯¹é½çš„éœ€æ±‚ï¼Œåªè¦æ˜¯å„ä¸ªç±»å‹å˜é‡çš„åœ°å€æ»¡è¶³è¦æ±‚äº†ï¼Œ
å¯¹æ‰€æœ‰å˜é‡çš„è®¿é—®ä¹Ÿå°± OK äº†ã€‚é‚£ä¹ˆ&lt;em>å¦‚ä½•ä¿è¯æ¯ä¸ªå˜é‡åœ°å€éƒ½æ»¡è¶³éœ€æ±‚å‘¢ï¼Ÿ&lt;/em>&lt;/p>
&lt;p>å¯¹äºé™æ€åˆ†é…çš„å˜é‡ï¼Œå³åœ¨ç¼–è¯‘é“¾æ¥æ—¶æœŸå°±èƒ½ç¡®å®šåœ°å€ï¼Œç”±ç¼–è¯‘å™¨å®Œæˆè¿™é¡¹å·¥ä½œã€‚ç¼–è¯‘å™¨ä¿è¯
åˆ†é…ç»™è¿™äº›å˜é‡çš„åœ°å€æ˜¯æ»¡è¶³å¯¹é½è¦æ±‚çš„ï¼Œè¿™ä¸ªå®Œå…¨ä¸ç”¨æ‹…å¿ƒã€‚&lt;/p>
&lt;p>å¯¹äºè¿è¡Œæ—¶åŠ¨æ€åˆ†é…çš„å˜é‡ï¼Œä¾‹å¦‚&lt;code>malloc()&lt;/code>æ¥å£è¿”å›çš„ï¼Œå…¶å® malloc æœ¬èº«ä¸çŸ¥é“è¦ç”³è¯·
ç©ºé—´çš„å¯¹é½è§„åˆ™ï¼Œå› ä¸ºå®ƒåªæ¥å—ä¸€ä¸ª size ä½œä¸ºå‚æ•°ã€‚ æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†ä¿è¯æ»¡è¶³æ‰€æœ‰çš„
å¯¹é½è¦æ±‚ï¼Œ&lt;code>malloc()&lt;/code> è¿”å›çš„åœ°å€&lt;strong>æ€»æ˜¯æ»¡è¶³æœ€å¤§çš„å¯¹é½è¯·æ±‚ï¼Œå³æŒ‡é’ˆçš„å¤§å° 8 å­—èŠ‚ã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>malloc()&lt;/code> çš„å®é™…æ•ˆæœä¸è¿è¡Œåº“çš„å®ç°æœ‰å…³ï¼Œå¹¶ä¸æ˜¯è§„å®šæ­»çš„ã€‚ä¸è¿‡æˆ‘è¿˜æ²¡æœ‰è§è¿‡ä¸æ˜¯
æŒ‰ç…§æœ€å¤§å¯¹é½è¦æ±‚åˆ†é…çš„å®ç°æ–¹æ³•:)&lt;/p>
&lt;/blockquote>
&lt;h2 id="aarch64-å¯¹éå¯¹é½è®¿é—®çš„æ”¯æŒ">AArch64 å¯¹éå¯¹é½è®¿é—®çš„æ”¯æŒ&lt;/h2>
&lt;p>éå¯¹é½è®¿é—®çš„ç»“æœæ˜¯&lt;strong>æ¶æ„å®šä¹‰çš„&lt;/strong>ï¼Œ ä¸åŒçš„æ¶æ„å¯èƒ½é€ æˆçš„ç»“æœä¸åŒï¼š&lt;/p>
&lt;ul>
&lt;li>æ¶æ„å¯èƒ½æ”¯æŒéå¯¹é½è®¿é—®ï¼ŒæˆåŠŸè¯»å–æ•°æ®&lt;/li>
&lt;li>æ¶æ„ä¸æ”¯æŒéå¯¹é½è®¿é—®ï¼Œäº§ç”Ÿå¼‚å¸¸&lt;/li>
&lt;/ul>
&lt;p>AArch64 æ¶æ„æ”¯æŒ 16ã€32ã€64 å’Œ 128 ä½çš„éå¯¹é½è®¿é—®ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªå‰ææ¡ä»¶:&lt;/p>
&lt;ul>
&lt;li>å…³é—­ç³»ç»Ÿçš„å¯¹é½æ£€æŸ¥: &lt;code>SCTLR_ELx.A&lt;/code> bit æ¥æ§åˆ¶&lt;/li>
&lt;li>exclusive load/store å’Œ load-acuqire/store-release ä¸¤ç±»æŒ‡ä»¤å¿…é¡»æ˜¯å¯¹é½è®¿é—®çš„
ã€‚è¿™å°±è¡¨ç¤ºæ„å»ºä¿¡å·é‡å’Œå…¶ä»–é”æœºåˆ¶æ—¶å¿…é¡»æ˜¯å¯¹é½è®¿é—®çš„&lt;/li>
&lt;li>éå¯¹é½è®¿é—®ä»…â€œæ™®é€šå†…å­˜â€å¯ç”¨ï¼Œ&amp;quot;&lt;strong>Device memory&lt;/strong>&amp;ldquo;å¿…é¡»æ˜¯å¯¹é½è®¿é—®çš„&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>AArch64 éå¯¹é½è®¿é—®çš„åŸç†æ˜¯&lt;strong>åˆ†è§£ä¸ºå¤šæ¬¡çš„è®¿å­˜&lt;/strong>ï¼Œæ‰€ä»¥&lt;strong>ä¸èƒ½ä¿è¯åŸå­æ€§&lt;/strong>ï¼Œä¸”æ€§èƒ½æ˜¯è¾ƒå·®çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>è™½ç„¶ AArch64 æ”¯æŒéå¯¹é½è®¿é—®ï¼Œ ä½†ç¼–è¯‘å™¨é»˜è®¤è¿˜æ˜¯ä¼šç”Ÿæˆæ»¡è¶³å¯¹é½è¦æ±‚çš„ä»£ç ã€‚&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/c/alignment/ - @2019 Notepadium.</description></item><item><title>AArch64 å†…å­˜å±æ€§ä¸å†…å­˜ç±»å‹</title><link>https://wangloo.github.io/posts/armv8/memory_attr/</link><pubDate>Wed, 12 Apr 2023 08:01:33 +0800</pubDate><guid>https://wangloo.github.io/posts/armv8/memory_attr/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/armv8/memory_attr/ -&lt;p>æœ‰äº†è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¹‹åï¼ŒMMU å¯ä»¥æŠ½è±¡å‡ºä¸€äº›å¯é…ç½®çš„å†…å­˜å±æ€§ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œé…ç½®æŸä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸä¸ºä¸å¯æ‰§è¡Œã€ä¸è¢« cache ç­‰ï¼Œä¸å¯æ‰§è¡Œçš„å±æ€§
æœ‰åŠ©äºé˜²èŒƒæ”»å‡»ï¼Œä¸è¿›å…¥ cache ç»å¸¸åˆ’åˆ†ç»™ å¤–è®¾ Memory-mapped åŒºåŸŸã€‚&lt;/p>
&lt;h2 id="è®¾ç½®å†…å­˜å±æ€§">è®¾ç½®å†…å­˜å±æ€§&lt;/h2>
&lt;blockquote>
&lt;p>ç›¸å…³å†…å®¹å¯ä»¥åœ¨ ARMv8 arm æ‰‹å†Œ D5.3.3 Attuibute fields in stage 1
VMSAv8-64 Block and Page descriptors ä¸­æ‰¾åˆ°å‚è€ƒ&lt;/p>
&lt;/blockquote>
&lt;p>å¯¹äºæ¯ä¸€ä¸ªè¡¨ç¤ºå†…å­˜å—(block)çš„é¡µè¡¨é¡¹ï¼Œéƒ½æœ‰ä¸¤ä¸ªå±æ€§å­—æ®µ: &lt;strong>lower attr å’Œ upper attr&lt;/strong>.&lt;/p>
&lt;p>ä»¥ä¸‹ä»»ä½•ç±»å‹æˆ–è€…å±æ€§çš„è®¾ç½®éƒ½æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªå­—æ®µå®Œæˆçš„ã€‚&lt;/p>
&lt;h2 id="å¤§ç±»-å†…å­˜ç±»å‹">å¤§ç±»: å†…å­˜ç±»å‹&lt;/h2>
&lt;p>AArch64 æä¾›ä¸¤ç§å†…å­˜ç±»å‹: æ™®é€šå†…å­˜å’Œè®¾å¤‡å†…å­˜ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ™®é€šå†…å­˜ä¼šå¯ç”¨æ¶æ„æä¾›çš„æ‰€æœ‰ä¼˜åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚åˆå¹¶è®¿å­˜ã€ä¹±åºæ‰§è¡Œç­‰ã€‚æ‰€ä»¥
æ™®é€šå†…å­˜æœ‰æœ€é«˜çš„æ€§èƒ½ï¼Œä½†åŒæ—¶ä¸æ˜¯é‚£ä¹ˆçš„â€œå®‰å…¨â€ï¼Œéœ€è¦åº•å±‚äººå‘˜æ‰‹åŠ¨ä½¿ç”¨
&lt;strong>å†…å­˜å±éšœ&lt;/strong>ç­‰æ‰‹æ®µä¿è¯æŸäº›æƒ…å†µä¸‹çš„é¡ºåºæ€§è¦æ±‚ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è®¾å¤‡å†…å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œå¸¸æ˜ å°„åˆ°å¤–è®¾çš„ Memory-mapped åŒºåŸŸã€‚å¯¹äºè®¾å¤‡æ¥è¯´ï¼Œ
é‚£äº›æé«˜æ€§èƒ½çš„æŠ€æœ¯ä¼šé€ æˆä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æŸäº›å¯„å­˜å™¨çš„é…ç½®å¿…é¡»æŒ‰ç…§é¡ºåºï¼Œ
è¿™æ—¶å°±ä¸èƒ½ä½¿ç”¨ä¹±åºæ‰§è¡Œã€‚è®¾å¤‡å†…å­˜å°±ç‰ºç‰²äº†æ€§èƒ½ï¼Œä¼˜å…ˆä¿è¯æ­£ç¡®æ€§ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é…ç½®å†…å­˜ç±»å‹ä¹Ÿæ˜¯é€šè¿‡é¡µè¡¨é¡¹ä¸­çš„å…¶ä¸­ä¸€ä¸ªå±æ€§å­—æ®µ: &lt;code>AttrIndx[2:0]&lt;/code>,
å®ƒä¸ç³»ç»Ÿå¯„å­˜å™¨&lt;code>MAIR_EL1&lt;/code>é…åˆå®ç°ã€‚&lt;/p>
&lt;p>å…·ä½“è¡¨ç°ä¸º: &lt;code>mair_el1&lt;/code>å¯„å­˜å™¨è¢«åˆ’åˆ†ä¸º 8 ä¸ªå­—æ®µï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªå­—æ®µå†™å…¥
ä¸åŒçš„å€¼å¯ä»£è¡¨ä¸åŒçš„å†…å­˜ç±»å‹å’Œä¸€äº›é…å¥—å±æ€§ï¼Œå…·ä½“çš„çœŸå€¼è¡¨å¯ä»¥å‚è§
&lt;code>mair_el1&lt;/code>å¯„å­˜å™¨çš„æè¿°ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>mair_el1&lt;/code>ä¸­å†…å­˜ç±»å‹é…å¥—å±æ€§åªæ˜¯å±æ€§çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å’Œè®¾å¤‡ç±»å‹ç»‘å®šçš„
é‚£éƒ¨åˆ†ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="æ›´ç»†åˆ†çš„æè¿°1-cacheable">æ›´ç»†åˆ†çš„æè¿°(1): cacheable&lt;/h2>
&lt;p>å†…å­˜æ”¯æŒé…ç½®ä¸ºæ˜¯å¦è¢« cacheï¼Œè¿™åœ¨&lt;code>mair_el1&lt;/code>çš„å­—æ®µä¸­é…ç½®ã€‚&lt;/p>
&lt;p>è¦æ³¨æ„ï¼Œ&lt;strong>åªæœ‰æ™®é€šå†…å­˜æ‰æ”¯æŒé…ç½®æ˜¯å¦è¿›å…¥ cacheï¼Œæ‰€æœ‰çš„è®¾å¤‡å†…å­˜
éƒ½æ˜¯ non-cacheable çš„&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="æ›´ç»†åˆ†çš„æè¿°2-shareable">æ›´ç»†åˆ†çš„æè¿°(2): shareable&lt;/h2>
&lt;p>shareable è¯´çš„æ˜¯ä¸€å—å†…å­˜çš„å¤–éƒ¨å¯è§æ€§ï¼Œä¹Ÿå¯åˆ†ä¸º inner/outer
shareable.&lt;/p>
&lt;p>shareable çš„è®¾ç½®éœ€è¦å‚è€ƒæ­¤å†…å­˜çš„ cacheable å±æ€§:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¦‚æœä¸€å—å†…å­˜æ˜¯ cacheable çš„ï¼Œåˆ™éœ€è¦ç¡¬ä»¶æä¾› cache çš„ä¸€è‡´æ€§ç»´æŠ¤æœºåˆ¶ã€‚
å¦‚æœä¸èƒ½ä¿è¯ cache çš„ä¸€è‡´æ€§ï¼Œæƒ³è¦å¯ç”¨ shareable å°±å¿…é¡»æ˜¯ non-cacheable&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹äº non-cacheable çš„å†…å­˜ï¼Œä¸€å®šæ˜¯ shareable çš„ï¼Œ
ä¸éœ€è¦é…ç½®ã€‚å› ä¸ºæ­¤æ—¶å¯¹æ•°æ®çš„ä¿®æ”¹ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¯»å–æ“ä½œäº¦æ˜¯å¦‚æ­¤ï¼Œä¸€å®š
æ˜¯å¤–éƒ¨å¯è§çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ›´ç»†åˆ†çš„æè¿°x-">æ›´ç»†åˆ†çš„æè¿°(x): &amp;hellip;&lt;/h2>
&lt;p>TODO&lt;/p>
- https://wangloo.github.io/posts/armv8/memory_attr/ - @2019 Notepadium.</description></item><item><title>Cè¯­è¨€enumçš„ä½¿ç”¨</title><link>https://wangloo.github.io/posts/c/enum/</link><pubDate>Thu, 09 Mar 2023 17:18:57 +0800</pubDate><guid>https://wangloo.github.io/posts/c/enum/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/c/enum/ -&lt;h2 id="æšä¸¾ç±»å‹çš„ä¼˜åŠ¿">æšä¸¾ç±»å‹çš„ä¼˜åŠ¿&lt;/h2>
&lt;p>æšä¸¾ç±»å‹å®Œå…¨å¯è¢«å®å®šä¹‰æ›¿ä»£ï¼Œç±»å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">enum&lt;/span> Furniture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DOOR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DESK,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LOCK,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ä¸‹é¢çš„ä»£ç ç­‰æ•ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define DOOR 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define DESK 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#define LOCK 3
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨ä¸¤ç§è®¾è®¡æ–¹æ³•ä¸­é€‰æ‹©å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ enum ä¼šæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š&lt;/p>
&lt;ol>
&lt;li>æé«˜ä»£ç é”®å…¥æ•ˆç‡ï¼›ä»…é€‚ç”¨äºæ‰€éœ€å˜é‡çš„å€¼æ˜¯è¿ç»­çš„æ•´æ•°ï¼Œå°±åƒä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥åªç»™ç¬¬ä¸€ä¸ª DOOR èµ‹å€¼ï¼Œå…¶ä½™çš„å€¼ç´¯åŠ ã€‚å¦‚æœé¦–ä¸ªå˜é‡çš„å€¼è¦æ±‚æ˜¯ 0ï¼Œç”šè‡³æ¯ä¸€ä¸ªéƒ½æ— éœ€æ˜¾å¼èµ‹å€¼&lt;/li>
&lt;li>æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼›å¯ä»¥åˆ’å®šèŒƒå›´ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šæ£€æŸ¥ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œå¶å°”ä¼šæœ‰ç”¨&lt;/li>
&lt;li>æé«˜ä»£ç çš„å¯è¯»æ€§ï¼›ä¾‹å¦‚ DOOR, DESK, LOCK&amp;hellip; éƒ½å±äºå®¶å…·ï¼Œå‡å®šä¹‰åœ¨ Furniture ä¸­&lt;/li>
&lt;/ol>
&lt;h2 id="æšä¸¾ç±»å‹æ‰€å çš„å¤§å°">æšä¸¾ç±»å‹æ‰€å çš„å¤§å°&lt;/h2>
&lt;p>æšä¸¾ç±»å‹æ‰€å å†…å­˜çš„å¤§å°ï¼Œå³æšä¸¾å˜é‡çš„å¤§å°ã€‚&lt;/p>
&lt;p>ç”±äºæšä¸¾å˜é‡çš„èµ‹å€¼ï¼Œä¸€æ¬¡åªèƒ½å­˜æ”¾æšä¸¾ç»“æ„ä¸­çš„æŸä¸ªå¸¸æ•°ã€‚æ‰€ä»¥ æšä¸¾å˜é‡çš„å¤§å°ï¼Œå®è´¨æ˜¯å¸¸æ•°æ‰€å å†…å­˜ç©ºé—´çš„å¤§å°ï¼ˆå¸¸æ•°ä¸º int ç±»å‹ï¼Œå½“å‰ä¸»æµçš„ç¼–è¯‘å™¨ä¸­ä¸€èˆ¬æ˜¯ 32 ä½æœºå™¨å’Œ 64 ä½æœºå™¨ä¸­ int å‹éƒ½æ˜¯ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œæšä¸¾ç±»å‹æ‰€å å†…å­˜å¤§å°ä¹Ÿæ˜¯è¿™æ ·ã€‚&lt;/p>
&lt;p>æ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— è®ºæšä¸¾å˜é‡çš„å€¼æ˜¯å¤šå°‘ï¼Œéƒ½æ˜¯å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚å³æ‰§è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>printf(&lt;span style="color:#f1fa8c">&amp;#34;sizeof(enum Furniture) = %d&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#ff79c6">enum&lt;/span> Furniture));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å…¥çš„ç»“æœæ˜¯ 4ã€‚&lt;/p>
&lt;h3 id="ç¼–è¯‘é€‰é¡¹-fshort-enums">ç¼–è¯‘é€‰é¡¹ï¼š-fshort-enums&lt;/h3>
&lt;p>GCC ä¸‹å…³äºè¿™ä¸ªç¼–è¯‘é€‰é¡¹çš„ä»‹ç»ï¼š&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>-fshort-enums&lt;/strong>
Allocate to an enum type only as many bytes as it needs for the declared range of possible values. Specifically, the enum type is equivalent to the smallest integer type that has enough room.
Warning: the -fshort-enums switch causes GCC to generate code that is not binary compatible with code generated without that switch. Use it to conform to a non-default application binary interface.&lt;/p>
&lt;/blockquote>
&lt;p>æ„æ€æ˜¯è¯´ä½¿ç”¨&lt;code>-fshort-enum&lt;/code>s åï¼Œå¯¹æ”¹æšä¸¾ç±»å‹æ‰€å ç©ºé—´çš„åˆ†é…å°±ä¼šæŒ‰ç…§å®é™…å˜é‡çš„å ç”¨ç©ºé—´ï¼Œè€Œéæ€»æ˜¯ 4 å­—èŠ‚ã€‚&lt;/p>
&lt;p>å¯ç”¨è¯¥é€‰é¡¹ä¹‹åï¼Œå†æ‰“å°å®ƒçš„ size å°±ä¼šæ˜¯ 1ï¼Œå› ä¸ºç”¨ 1 ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤ºæ‰€æœ‰æšä¸¾å˜é‡çš„å€¼ï¼ˆDOOR=1ï¼ŒDESK=2ï¼ŒLOCK=3ï¼‰.&lt;/p>
&lt;p>è¿™ä¸ªâ€œ1â€ä¸å†æ˜¯å›ºå®šçš„ï¼Œæ ¹æ®å…¶ä¸­æšä¸¾å˜é‡å€¼çš„ä¸åŒï¼ŒåŠ¨æ€è°ƒæ•´&lt;code>enum Furniture&lt;/code>çš„å¤§å°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">enum&lt;/span> Furniture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DOOR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">256&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DESK,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LOCK,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†æ‰“å°å®ƒçš„ sizeï¼Œç»“æœä¸º 2ã€‚å› ä¸ºå€¼ 256 æ— æ³•ç”¨ 1 ä¸ªå­—èŠ‚å­˜ä¸‹ã€‚&lt;/p>
&lt;h2 id="enum-æ½œåœ¨çš„å¯ç§»æ¤æ€§é—®é¢˜">enum æ½œåœ¨çš„å¯ç§»æ¤æ€§é—®é¢˜&lt;/h2>
&lt;p>çœ‹ä¼¼å¥½åƒå¯ç”¨è¯¥é€‰é¡¹ä¼šèŠ‚çº¦ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œæ˜¯çš„ã€‚ä½†å®ƒä¹Ÿæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼Œå…¶ä¸€å°±æ˜¯å¯ç§»æ¤æ€§é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ä½ ç¼–å†™çš„åº”ç”¨åœ¨ç¼–è¯‘æ—¶æ²¡æœ‰å¯ç”¨äº†è¯¥â€œä¼˜åŒ–â€é€‰é¡¹ï¼Œé»˜è®¤é‡‡ç”¨ 4 å­—èŠ‚å­˜å‚¨æšä¸¾å˜é‡ã€‚è€Œé“¾æ¥çš„åº“æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶å´ä½¿ç”¨äº†â€œä¼˜åŒ–â€é€‰é¡¹ï¼Œåˆ™åº“å†…éƒ¨æ­¤æšä¸¾ç±»å‹çš„å¤§å°å¯èƒ½ä¸º 1 å­—èŠ‚ã€‚è‹¥æ­¤æ—¶æ°å¥½ä½ æœ‰è°ƒç”¨æŸä¸ªåº“ APIï¼Œå°† enum å˜é‡ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚&lt;/p>
&lt;p>ä¸ºé¿å…ä¸åŒåº“å’Œåº”ç”¨ç¨‹åºä½¿ç”¨â€œä¼˜åŒ–â€é€‰é¡¹çš„å·®å¼‚é€ æˆæ½œåœ¨çš„å±é™©ï¼Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯å¼ºåˆ¶ä½¿ enum å˜é‡å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œæ— è®ºå…¶æ˜¯å¦å¼€å¯â€œä¼˜åŒ–â€ã€‚å®ç°æ–¹å¼æ˜¯åœ¨ enum å˜é‡æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆå‘˜ &lt;code>XXXX_END = 0xFFFFF&lt;/code>ï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">enum&lt;/span> Furniture {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DOOR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DESK,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LOCK,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> END &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0xFFFFF&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/c/enum/ - @2019 Notepadium.</description></item><item><title>Cè¯­è¨€çš„ç‰¹ç‚¹ä¸éš¾ç‚¹</title><link>https://wangloo.github.io/posts/c/feature/</link><pubDate>Thu, 09 Mar 2023 17:18:57 +0800</pubDate><guid>https://wangloo.github.io/posts/c/feature/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/c/feature/ -&lt;h1 id="å‡½æ•°æŒ‡é’ˆ">å‡½æ•°æŒ‡é’ˆ&lt;/h1>
&lt;h2 id="æŒ‡é’ˆçš„æ•°ç»„-or-æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ">æŒ‡é’ˆçš„æ•°ç»„ or æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ?&lt;/h2>
&lt;pre tabindex="0">&lt;code>&amp;gt;&amp;gt; int (*p)[10] pæ˜¯æŒ‡é’ˆ, æŒ‡å‘é•¿åº¦ä¸º10çš„æ•°ç»„. åŠ æ‹¬å·æ˜¯ä¸ºäº†å¼ºè°ƒpæ˜¯ä¸€ä¸ªæŒ‡é’ˆ, åŒºåˆ«åŒ…å«10ä¸ªæŒ‡é’ˆçš„array.
&amp;gt;&amp;gt; int *(p[10]) pæ˜¯æ•°ç»„, å®ƒçš„å…ƒç´ ç±»å‹æ˜¯int *, åŠ æ‹¬å·æ˜¯ä¸ºäº†å¼ºè°ƒpæ˜¯æ•°ç»„.
&amp;gt;&amp;gt; int *p[10] ç­‰æ•ˆäºint *(p[10])
&lt;/code>&lt;/pre>&lt;h2 id="åŸºç¡€æ¶æ„">åŸºç¡€æ¶æ„&lt;/h2>
&lt;pre tabindex="0">&lt;code>// å‡½æ•°æŒ‡é’ˆ
&amp;gt;&amp;gt; int (*f)(int) è¯´æ˜fæ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ, åŠ æ‹¬å·ä¸ºäº†åŒºåˆ«è¿”å›å€¼ä¸ºint*çš„å‡½æ•°
&amp;gt;&amp;gt; f = function; å‡½æ•°æŒ‡é’ˆçš„èµ‹å€¼
&amp;gt;&amp;gt; (*f)(x) å‡½æ•°æŒ‡é’ˆæŒ‡å‘å‡½æ•°çš„è°ƒç”¨, å¯ç®€åŒ–ä¸ºf(x). ä½†æ˜¯å®¹æ˜“å°†fè¯¯è®¤ä¸ºæ˜¯å‡½æ•°.
// å‡½æ•°æŒ‡é’ˆçš„æ•°ç»„
&amp;gt;&amp;gt; int (*(f[10])) (int) fæ˜¯æ•°ç»„,å…ƒç´ ä¸º10ä¸ªå‡½æ•°æŒ‡é’ˆ. å†…å±‚æ‹¬å·è¯´æ˜fæ˜¯æ•°ç»„,å¤–å±‚æ‹¬å·è¯´æ˜å…ƒç´ ç±»å‹æ˜¯å‡½æ•°æŒ‡é’ˆ
&amp;gt;&amp;gt; int (*f[10]) (int) ä¸ä¸Šé¢ç­‰æ•ˆ. ä½†å¤–å±‚æ‹¬å·ä¸èƒ½çœç•¥
&amp;gt;&amp;gt; f[0] = function() èµ‹å€¼
&amp;gt;&amp;gt; (*f[0])() æŒ‡å‘å‡½æ•°çš„è°ƒç”¨, å¯ç®€åŒ–ä¸ºf[0]()
// è¿”å›å‡½æ•°æŒ‡é’ˆçš„å‡½æ•°
&amp;gt;&amp;gt; void (*signal(int sig, ...))(int); signalæ˜¯ä¸€ä¸ªå‡½æ•°, å‚æ•°æœ‰sig.... å®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ, æŒ‡å‘ä»»æ„è¿”å›å€¼ä¸ºvoid, å‚æ•°ä¸ºintçš„å‡½æ•°.
&lt;/code>&lt;/pre>&lt;h2 id="typedefå¸®åŠ©ç†è§£å‡½æ•°æŒ‡é’ˆ">&lt;code>typedef&lt;/code>å¸®åŠ©ç†è§£å‡½æ•°æŒ‡é’ˆ&lt;/h2>
&lt;p>&lt;code>signal()&lt;/code>æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨, ç”¨äºå‘Šè¯‰ç³»ç»Ÿ, å½“æŸç§ç‰¹å®š&amp;quot;è½¯ä»¶ä¸­æ–­&amp;quot;å‘ç”Ÿæ—¶è°ƒç”¨&lt;em>ç‰¹å®šçš„ç¨‹åº&lt;/em>. å®ƒçš„çœŸæ­£åç§°åº”å½“æ˜¯: &lt;em>Call that routine when the interrupt comes in&lt;/em>.&lt;/p>
&lt;p>çœ‹&lt;code>signal()&lt;/code>çš„åŸå‹, éå¸¸å¤æ‚. æ ¹æ®ä¸Šé¢åŸºç¡€æ¶æ„çš„é“ºå«, å¯ä»¥çœ‹å‡º&lt;code>signal()&lt;/code>çš„è¿”å›å€¼æ˜¯å‡½æ•°æŒ‡é’ˆ, åŒæ—¶å®ƒçš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ. ä¸”è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆæ‰€æŒ‡å‘å‡½æ•°çš„è¿”å›å€¼å’Œå‚æ•°ç›¸åŒ.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>signal(&lt;span style="color:#8be9fd">int&lt;/span> sig, &lt;span style="color:#8be9fd">void&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>func)(&lt;span style="color:#8be9fd">int&lt;/span>)))(&lt;span style="color:#8be9fd">int&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥å€Ÿç”¨&lt;code>typedef&lt;/code>è¡¨ç¤ºé€šç”¨éƒ¨åˆ†.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#50fa7b">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>sighandler_t)(&lt;span style="color:#8be9fd">int&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œå&lt;code>signal&lt;/code>çš„å£°æ˜å°±æ˜¯äººèƒ½çœ‹æ‡‚çš„äº†:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>sighandler_t &lt;span style="color:#50fa7b">signal&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> signum, sighandler_t handler);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="cè¯­è¨€æ ‡å‡†">Cè¯­è¨€æ ‡å‡†&lt;/h1>
&lt;p>æˆ‘ä»¬åœ¨ä½¿ç”¨Cè¯­è¨€ç¼–ç¨‹æ—¶å¾ˆå°‘æœ‰äººå‘Šè¯‰æˆ‘ä»¬Cè¯­è¨€å„ä¸ªæ ‡å‡†çš„æƒ…å†µï¼Œäºæ˜¯æˆ‘ä»¬åœ¨çœ‹è§ä¸€äº›å‡½æ•°æ ‡å®šæ”¯æŒçš„Cæ ‡å‡†ï¼ˆä¾‹å¦‚ä»…æ”¯æŒC99åŠä»¥åï¼‰ï¼Œå†…å¿ƒä¸ä¼šæœ‰ä»€ä¹ˆæ³¢æ¾œã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¸¸è§è¿™äº›Cæ ‡å‡†ï¼šK&amp;amp;R Cã€ANSI Cã€ISO Cã€C89ã€C99ã€C11ã€C18ã€‚è®©æˆ‘ä»¬è¡¥å……ç‚¹å¯èƒ½å¾ˆå°‘ä½¿ç”¨çš„çŸ¥è¯†å§ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯kr-c">ä»€ä¹ˆæ˜¯K&amp;amp;R Cï¼Ÿ&lt;/h2>
&lt;p>1978å¹´ï¼Œä¸¹å°¼æ–¯â€¢é‡Œå¥‡ï¼ˆDennis Ritchieï¼‰å’Œå¸ƒè±æ©â€¢æŸ¯æ—æ±‰ï¼ˆBrian ernighanï¼‰åˆä½œå‡ºç‰ˆäº†ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€ã€‹çš„ç¬¬ä¸€ç‰ˆã€‚ä¹¦ä¸­ä»‹ç»çš„Cè¯­è¨€æ ‡å‡†ä¹Ÿè¢«ç§°ä½œâ€œK&amp;amp;R Câ€ã€‚&lt;/p>
&lt;p>æœ€åˆçš„Cæ ‡å‡†ä¸æˆ‘ä»¬ç°åœ¨ç”¨çš„æœ‰è¾ƒå¤§å·®åˆ«ï¼Œä¾‹å¦‚å®ƒç«Ÿç„¶è¿˜ä¸æ”¯æŒvoidç±»å‹ï¼&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯ansi-ciso-cc89c90æ ‡å‡†">ä»€ä¹ˆæ˜¯ANSI Cã€ISO Cã€C89ã€C90æ ‡å‡†ï¼Ÿ&lt;/h2>
&lt;p>éšç€Cè¯­è¨€ä½¿ç”¨å¾—è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå‡ºç°äº†è®¸å¤šæ–°é—®é¢˜ï¼Œäººä»¬æ—¥ç›Šå¼ºçƒˆåœ°è¦æ±‚å¯¹Cè¯­è¨€è¿›è¡Œæ ‡å‡†åŒ–ã€‚1983å¹´ï¼Œç¾å›½å›½å®¶æ ‡å‡†åä¼šï¼ˆANSIï¼‰ç»„æˆäº†ä¸€ä¸ªå§”å‘˜ä¼šï¼ŒX3J11ï¼Œä¸ºäº†åˆ›ç«‹ C çš„ä¸€å¥—æ ‡å‡†ã€‚ç»è¿‡æ¼«é•¿è€Œè‰°è‹¦çš„è¿‡ç¨‹ï¼Œè¯¥æ ‡å‡†äº1989å¹´å®Œæˆï¼Œè¿™ä¸ªç‰ˆæœ¬çš„è¯­è¨€ç»å¸¸è¢«ç§°ä½œANSI Cï¼Œæˆ–æœ‰æ—¶ç§°ä¸ºC89ï¼ˆä¸ºäº†åŒºåˆ«C99ï¼‰ã€‚åœ¨1990å¹´ï¼ŒANSI Cæ ‡å‡†ï¼ˆå¸¦æœ‰ä¸€äº›å°æ”¹åŠ¨ï¼‰è¢«ç¾å›½å›½å®¶æ ‡å‡†åä¼šï¼ˆANSIï¼‰é‡‡çº³ä¸ºISO/IEC 9899:1990ã€‚è¿™ä¸ªç‰ˆæœ¬æœ‰æ—¶å€™ç§°ä¸ºC90æˆ–è€…ISO Cã€‚ç»¼ä¸Šï¼ŒANSI Cã€ISO Cã€C89ã€C90å…¶å®æ˜¯åŒä¸€ç§æ ‡å‡†ã€‚&lt;/p>
&lt;p>è¿™ä¸€ç‰ˆæœ¬çš„Cå°±æ›´æ¥è¿‘æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„Cäº†ï¼Œå¤§éƒ¨åˆ†ç‰¹æ€§éƒ½å¼•å…¥äº†ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯c99æ ‡å‡†">ä»€ä¹ˆæ˜¯C99æ ‡å‡†ï¼Ÿ&lt;/h2>
&lt;p>2000å¹´3æœˆï¼ŒANSI é‡‡çº³äº† ISO/IEC 9899:1999 æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†é€šå¸¸æŒ‡C99ã€‚&lt;/p>
&lt;p>C99æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ–°ç‰¹æ€§æ˜¯ï¼šåœ¨æºä»£ç çš„ä¸­é—´ä½ç½®å£°æ˜å˜é‡ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯c11æ ‡å‡†">ä»€ä¹ˆæ˜¯C11æ ‡å‡†ï¼Ÿ&lt;/h2>
&lt;p>C11æ ‡å‡†æ˜¯Cè¯­è¨€æ ‡å‡†çš„ç¬¬ä¸‰ç‰ˆï¼ˆ2011å¹´ç”±ISO/IECå‘å¸ƒï¼‰ï¼Œå‰ä¸€ä¸ªæ ‡å‡†ç‰ˆæœ¬æ˜¯C99æ ‡å‡†ã€‚ä¸C99ç›¸æ¯”ï¼ŒC11æœ‰å“ªäº›å˜åŒ–å‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">1&lt;/span>ã€ å¯¹é½å¤„ç†ï¼šalignof(T)è¿”å›Tçš„å¯¹é½æ–¹å¼ï¼Œaligned_alloc()ä»¥æŒ‡å®šå­—èŠ‚å’Œå¯¹é½æ–¹å¼åˆ†é…å†…å­˜ï¼Œå¤´æ–‡ä»¶&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>stdalign.h&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>å®šä¹‰äº†è¿™äº›å†…å®¹ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">2&lt;/span>ã€ _Noreturnï¼š_Noreturn æ˜¯ä¸ªå‡½æ•°ä¿®é¥°ç¬¦ï¼Œä½ç½®åœ¨å‡½æ•°è¿”å›ç±»å‹çš„å‰é¢ï¼Œå£°æ˜å‡½æ•°æ— è¿”å›å€¼ï¼Œæœ‰ç‚¹ç±»ä¼¼äºgccçš„__attribute__((noreturn))ï¼Œåè€…åœ¨å£°æ˜è¯­å¥å°¾éƒ¨ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">3&lt;/span>ã€ _Genericï¼š_Genericæ”¯æŒè½»é‡çº§èŒƒå‹ç¼–ç¨‹ï¼Œå¯ä»¥æŠŠä¸€ç»„å…·æœ‰ä¸åŒç±»å‹è€Œå´æœ‰ç›¸åŒåŠŸèƒ½çš„å‡½æ•°æŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">4&lt;/span>ã€ _Static_assert()ï¼š_Static_assert()ï¼Œé™æ€æ–­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ»è¿›è¡Œï¼Œæ–­è¨€è¡¨è¾¾å¼å¿…é¡»æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå¯ä»¥è®¡ç®—çš„è¡¨è¾¾å¼ï¼Œè€Œæ™®é€šçš„assert()åœ¨è¿è¡Œæ—¶åˆ»æ–­è¨€ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">5&lt;/span>ã€å®‰å…¨ç‰ˆæœ¬çš„å‡ ä¸ªå‡½æ•°ï¼šgets_s()å–ä»£äº†gets()ï¼ŒåŸå› æ˜¯åè€…è¿™ä¸ªI&lt;span style="color:#ff79c6">/&lt;/span>Oå‡½æ•°çš„å®é™…ç¼“å†²åŒºå¤§å°ä¸ç¡®å®šï¼Œä»¥è‡³äºå‘ç”Ÿå¸¸è§çš„ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Œç±»ä¼¼çš„å‡½æ•°è¿˜æœ‰å…¶å®ƒçš„ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">6&lt;/span>ã€ fopen()æ–°æ¨¡å¼ï¼šfopen()å¢åŠ äº†æ–°çš„åˆ›å»ºã€æ‰“å¼€æ¨¡å¼â€œxâ€ï¼Œåœ¨æ–‡ä»¶é”ä¸­æ¯”è¾ƒå¸¸ç”¨ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">7&lt;/span>ã€ åŒ¿åç»“æ„ä½“ã€è”åˆä½“ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">8&lt;/span>ã€ å¤šçº¿ç¨‹ï¼šå¤´æ–‡ä»¶&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>threads.h&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>å®šä¹‰äº†åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹çš„å‡½æ•°ï¼Œæ–°çš„å­˜å‚¨ç±»ä¿®é¥°ç¬¦_Thread_localé™å®šäº†å˜é‡ä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">9&lt;/span>ã€ _Atomicç±»å‹ä¿®é¥°ç¬¦å’Œå¤´æ–‡ä»¶&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>stdatomic.h&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">10&lt;/span>ã€æ”¹è¿›çš„Unicodeæ”¯æŒå’Œå¤´æ–‡ä»¶&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>uchar.h&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">11&lt;/span>ã€quick_exit()ï¼šåˆä¸€ç§ç»ˆæ­¢ç¨‹åºçš„æ–¹å¼ï¼Œå½“exit()å¤±è´¥æ—¶ç”¨ä»¥ç»ˆæ­¢ç¨‹åºã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">12&lt;/span>ã€å¤æ•°å®ï¼Œæµ®ç‚¹æ•°å®ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#bd93f9">13&lt;/span>ã€time.hæ–°å¢timespecç»“æ„ä½“ï¼Œæ—¶é—´å•ä½ä¸ºçº³ç§’ï¼ŒåŸæ¥çš„timevalç»“æ„ä½“æ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä»€ä¹ˆæ˜¯c18æ ‡å‡†">ä»€ä¹ˆæ˜¯C18æ ‡å‡†ï¼Ÿ&lt;/h2>
&lt;p>C18ä¹Ÿç§°C17æ˜¯äº2018å¹´6æœˆå‘å¸ƒçš„ ISO/IEC 9899:2018 çš„éæ­£å¼åç§°ï¼Œä¹Ÿæ˜¯ç›®å‰ï¼ˆæˆªæ­¢åˆ°2020å¹´6æœˆï¼‰ä¸ºæ­¢æœ€æ–°çš„ Cè¯­è¨€ç¼–ç¨‹æ ‡å‡†ï¼Œè¢«ç”¨æ¥æ›¿ä»£ C11 æ ‡å‡†ã€‚&lt;/p>
&lt;p>C17 æ²¡æœ‰å¼•å…¥æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œåªå¯¹ C11 è¿›è¡Œäº†è¡¥å……å’Œä¿®æ­£ã€‚&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;h2 id="å¦‚ä½•æŸ¥çœ‹è‡ªå·±ç¨‹åºçš„cæ ‡å‡†ç‰ˆæœ¬">å¦‚ä½•æŸ¥çœ‹è‡ªå·±ç¨‹åºçš„Cæ ‡å‡†ç‰ˆæœ¬ï¼Ÿ&lt;/h2>
&lt;p>ä½¿ç”¨å®__STDC_VERSION__å¯ä»¥è¾“å‡ºå½“å‰ä½¿ç”¨çš„Cæ ‡å‡†ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªé•¿æ•´å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>printf(&lt;span style="color:#f1fa8c">&amp;#34;C std version:%ld&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, __STDC_VERSION__);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å€¼ä¸æ ‡å‡†çš„å¯¹åº”å…³ç³»ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ ‡å‡†&lt;/th>
&lt;th>å®&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>C94&lt;/td>
&lt;td>_&lt;em>STDC_VERSION&lt;/em>_= 199409L&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>C99&lt;/td>
&lt;td>_&lt;em>STDC_VERSION&lt;/em>_= 199901L&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>C11&lt;/td>
&lt;td>_&lt;em>STDC_VERSION&lt;/em>_= 201112L&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>C18&lt;/td>
&lt;td>_&lt;em>STDC_VERSION&lt;/em>_= 201710L&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>â€‹&lt;/p>
&lt;h2 id="å¦‚ä½•æŒ‡å®šæŒ‰ç…§æŸä¸ªæ ‡å‡†æ‰§è¡Œç¼–è¯‘">å¦‚ä½•æŒ‡å®šæŒ‰ç…§æŸä¸ªæ ‡å‡†æ‰§è¡Œç¼–è¯‘ï¼Ÿ&lt;/h2>
&lt;p>ä»¥ä¸‹çš„ä»‹ç»åªé’ˆå¯¹GCCï¼Œæˆ‘æ²¡æœ‰ç”¨è¿‡åˆ«çš„ç¼–è¯‘å™¨ã€‚&lt;/p>
&lt;p>GCCä¸­å¯ä»¥æ·»åŠ &lt;code>--std=xxx&lt;/code>æ¥æŒ‡å®šCæ ‡å‡†ç‰ˆæœ¬ï¼Œå¸¸ç”¨çš„æƒ…å†µå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>c11 Conform to the ISO &lt;span style="color:#bd93f9">2011&lt;/span> C standard
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>c89 Conform to the ISO &lt;span style="color:#bd93f9">1990&lt;/span> C standard
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>c90 Conform to the ISO &lt;span style="color:#bd93f9">1990&lt;/span> C standard
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>c99 Conform to the ISO &lt;span style="color:#bd93f9">1999&lt;/span> C stand
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>gnu11 Conform to the ISO &lt;span style="color:#bd93f9">2011&lt;/span> C standard with GNU extensions
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>gnu89 Conform to the ISO &lt;span style="color:#bd93f9">1990&lt;/span> C standard with GNU extensions
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>gnu90 Conform to the ISO &lt;span style="color:#bd93f9">1990&lt;/span> C standard with GNU extensions
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">-&lt;/span>std&lt;span style="color:#ff79c6">=&lt;/span>gnu99 Conform to the ISO &lt;span style="color:#bd93f9">1999&lt;/span> C standard with GNU extensions
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ç”µè„‘ä¸Šçš„&lt;code>gcc 5.4.0&lt;/code>ä½¿ç”¨&lt;code>-std-gnu11&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;h2 id="å‚è€ƒç›®å½•">å‚è€ƒç›®å½•&lt;/h2>
&lt;p>&lt;a href="https://blog.csdn.net/zhengnianli/article/details/87387268">https://blog.csdn.net/zhengnianli/article/details/87387268&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://gcc.gnu.org/onlinedocs/gcc/C-Dialect-Options.html#C-Dialect-Options">C Dialect Options (Using the GNU Compiler Collection (GCC))&lt;/a>&lt;/p>
&lt;h1 id="å«ç³Šä¸æ¸…çš„ç¬¦å·æ‰©å±•">å«ç³Šä¸æ¸…çš„ç¬¦å·æ‰©å±•&lt;/h1>
&lt;h2 id="é—®é¢˜å‡ºåœ¨å“ª">é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ&lt;/h2>
&lt;p>ä¸‹é¢ä¸€æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">char&lt;/span> c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0xff&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (c &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0xff&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;successful&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç­”æ¡ˆæ˜¯å–å†³äºä¸åŒçš„ç¼–è¯‘å™¨è®¾å®šï¼š&lt;/p>
&lt;ul>
&lt;li>å½“ç¼–è¯‘å™¨å°†charè¯†åˆ«ä¸ºsigned charæ—¶ï¼Œè¯¥åˆ¤æ–­ä¼šå¤±è´¥ã€‚å› ä¸ºå¸¸æ•°0xffè¢«è¯†åˆ«ä¸ºintç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨é¦–å…ˆè¦å¯¹cè¿›è¡Œç¬¦å·æ‰©å±•ï¼Œåˆ¤æ–­è¯­å¥&lt;code>c == 0xff&lt;/code>æ­¤æ—¶ç­‰ä»·äº&lt;code>(int)c == 0xff&lt;/code>ã€‚è€Œå¯¹äºsigned charç±»å‹æ˜¯æ‰©å±•å…¶æœ€é«˜ä½ï¼Œå³&lt;code>(int)c=0xffffffff&lt;/code>ï¼Œifåˆ¤æ–­å¤±è´¥ã€‚&lt;/li>
&lt;li>å½“ç¼–è¯‘å™¨å°†charè¯†åˆ«ä¸ºunsigned charæ—¶ï¼Œåˆ¤æ–­æˆåŠŸã€‚å¯¹äºunsigned charç±»å‹æ€»æ˜¯æ‰©å±•0ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ³¨ï¼šgccå¯é€šè¿‡æ·»åŠ ç¼–è¯‘å‚æ•° -fsigned-char/ -funsigned-charæ¥æŒ‡å®šç¼–è¯‘å™¨å¦‚ä½•è¯†åˆ«char&lt;/p>
&lt;/blockquote>
&lt;p>åŒæ ·çš„é—®é¢˜ä¹Ÿå­˜åœ¨ä¸ä½åŸŸ(bitfiled)ä¸­ï¼Œè¯¦è§-fsigned-bitfields/-funsigned-bitfieldså‚æ•°ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•é¿å…">å¦‚ä½•é¿å…ï¼Ÿ&lt;/h2>
&lt;p>åœ¨ä½¿ç”¨charç±»å‹æ—¶ï¼Œæ ¹æ®æƒ…å†µå†™æ¸…æ¥šunsigned/signed charå°±ok&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0xff&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (c &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0xff&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#f1fa8c">&amp;#34;successful&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å³ç§»å’Œé™¤æ³•">å³ç§»å’Œé™¤æ³•&lt;/h1>
&lt;p>ä½ æ˜¯å¦æœ‰å¬è¯´è¿‡æœ‰ç¬¦å·æ•°ä¸èƒ½ä½¿ç”¨å³ç§»æ“ä½œ(&lt;code>&amp;gt;&amp;gt;&lt;/code>)æ¥ä»£æ›¿é™¤æ³•ï¼Ÿ è¿™ç¯‡çŸ­æ–‡ä¼šå‘ä½ è¯æ˜å®ƒï¼Œå¹¶å°è¯•å‘ä½ è§£é‡Šä¸ºä»€ä¹ˆã€‚&lt;/p>
&lt;h2 id="logical-shift-vs-arithmetic-shift">Logical Shift .vs. Arithmetic Shift&lt;/h2>
&lt;p>è‹¥ä½ ç°åœ¨æœ‰äºŒè¿›åˆ¶æ•°&lt;code>x=1110B&lt;/code>ï¼Œå¯¹å…¶æ–½åŠ å³ç§»æ“ä½œï¼Œè¯·é—®é«˜ä½å¡«0è¿˜æ˜¯å¡«1ï¼Ÿ&lt;/p>
&lt;p>&lt;strong>é€»è¾‘ç§»ä½&lt;/strong>ä¸ç®¡é€ æˆçš„å½±å“ï¼Œæ€»æ˜¯ç”¨0æ¥å¡«å……ç§»ä½æ“ä½œäº§ç”Ÿçš„ç©ºç¼ºã€‚ä½†æ˜¯è¿™æ ·ç®€å•çš„æƒ³æ³•åœ¨ä¸€äº›æƒ…å†µæ€»ä¼šå‡ºé”™ã€‚ä¾‹å¦‚è‹¥ä¸Šè¿°xæ˜¯æœ‰ç¬¦å·æ•°ï¼Œé‚£ä¹ˆç®€å•çš„å¡«0å°±ä¼šé€ æˆé”™è¯¯ï¼Œèµ·ç æ­£è´Ÿå·å‡ºé”™äº†ã€‚&lt;/p>
&lt;p>&lt;strong>ç®—æ•°ç§»ä½&lt;/strong>æ”¯æŒæœ‰ç¬¦å·æ•°çš„ç§»ä½æ“ä½œï¼Œåœ¨ç§»ä½åä½¿ç”¨&lt;!-- raw HTML omitted -->ç¬¦å·ä½&lt;!-- raw HTML omitted -->è¿›è¡Œå¡«å……ï¼Œç»“åˆè¡¥ç çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå°±èƒ½å®ç°æ­£ç¡®çš„è´Ÿæ•°ç§»ä½æ“ä½œã€‚&lt;/p>
&lt;p>æ€»ç»“æ¥è¯´ï¼šåœ¨æœ‰ç¬¦å·çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ç®—æ•°ä½ç§»ï¼›å¦‚æœä½ èƒ½ä¿è¯ç§»ä½æ“ä½œæ˜¯æ— ç¬¦å·çš„ï¼Œé‚£ä¹ˆç”¨é€»è¾‘ä½ç§»ä¹Ÿæ— å¦¨.&lt;/p>
&lt;p>x86æ±‡ç¼–ä»£ç ä¸­ï¼Œ&lt;code>shr&lt;/code>ä»£è¡¨é€»è¾‘å³ç§»æŒ‡ä»¤ï¼Œ&lt;code>sar&lt;/code>ä»£è¡¨ç®—æ•°å³ç§»æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹Cä»£ç åŠå…¶åæ±‡ç¼–çš„ç»“æœæ¥æ›´å¥½çš„ç†è§£é€»è¾‘ç§»ä½å’Œç®—æ•°ç§»ä½ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">signed&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> y &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#ff79c6">&amp;gt;&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> y &lt;span style="color:#ff79c6">&amp;gt;&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code class="language-assembly" data-lang="assembly">x:
.long -3
y:
.long 3
main:
push rbp
mov rbp, rsp
mov eax, DWORD PTR x[rip]
sar eax
mov DWORD PTR x[rip], eax
mov eax, DWORD PTR y[rip]
shr eax
mov DWORD PTR y[rip], eax
mov eax, 0
pop rbp
ret
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://godbolt.org/z/K4M4Ko4c7">https://godbolt.org/z/K4M4Ko4c7&lt;/a>&lt;/p>
&lt;h2 id="å®è·µå‡ºçœŸçŸ¥">å®è·µå‡ºçœŸçŸ¥&lt;/h2>
&lt;p>åœ¨æˆ‘ä½œä¸ºä¸€ä¸ªåˆçº§ç¨‹åºå‘˜çš„è®¤çŸ¥ä¸­ï¼Œ&lt;code>/2&lt;/code>å’Œ&lt;code>&amp;gt;&amp;gt;1&lt;/code>æ˜¯ç­‰ä»·çš„ï¼Œç”šè‡³ä¸€èµ·è¿˜å¬è¯´è¿‡åè€…èƒ½å¤Ÿä¼˜åŒ–ä»£ç çš„æ•ˆç‡ã€‚ä½†æ˜¯ä»Šå¤©æˆ‘è¦å‘Šè¯‰ä½ ï¼Œ Definitely wrong!&lt;/p>
&lt;p>æˆ–è®¸åœ¨é¥è¿œçš„å¤ä»£ï¼Œæˆ‘ä»¬ä½¿ç”¨ä½ç§»æ“ä½œçœŸçš„èƒ½å¤Ÿå¯¹ä»£ç è¿›è¡ŒåŠ é€Ÿï¼Œä½†æ˜¯å½“ä¸‹ç¼–è¯‘å™¨å·²ç»è¶³å¤Ÿèªæ˜ï¼Œå¦‚æœä½ çœŸçš„åŠ¨æ‰‹åæ±‡ç¼–&amp;quot;&lt;code>/2&lt;/code>&amp;ldquo;çš„ä»£ç ï¼Œé‚£ä¹ˆä½ å°±ä¼šçŸ¥é“ç¼–è¯‘å™¨å·²ç»æ›¿ä½ ä¼˜åŒ–ä¸ºäº†ä½ç§»æ“ä½œã€‚&lt;/p>
&lt;p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬è¦é¿å…ä½¿ç”¨ç§»ä½æ“ä½œæ¥å®ç°é™¤æ³•æˆ–è€…ä¹˜æ³•ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºè¿™ä¸¤è€…ç­‰ä»·ï¼Œå®é™…ä¸Šï¼Œä»–ä»¬å¹¶ä¸æ˜¯ç­‰ä»·çš„ï¼å¹¶ä¸”ä¼šé€ æˆé”™è¯¯ï¼&lt;/p>
&lt;p>è€ƒè™‘å¦‚ä¸‹çš„Cè¯­è¨€ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">signed&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">signed&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> y &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#ff79c6">&amp;gt;&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> y &lt;span style="color:#ff79c6">/=&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»–ä»¬çš„æ±‡ç¼–ä»£ç æ˜¯ç›¸åŒçš„å—ï¼Ÿè¿™é‡Œè¿˜æ˜¯æ‹¿X86æ±‡ç¼–ä¸¾ä¾‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-assembly" data-lang="assembly">; Following is â€˜x &amp;gt;&amp;gt;= 1â€™
mov eax, #-3 ;x
sar eax
mov x, eax
; Following is â€˜y/= 2â€™
mov eax, #-3 ;y
mov edx, eax
shr edx, 31
add eax, edx
sar eax
mov y, eax
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„ï¼šä»¥ä¸Šçš„æ±‡ç¼–ä»£ç çœå»äº†ä¸€äº›æˆ‘è®¤ä¸ºæ— å…³ç´§è¦çš„æ“ä½œï¼Œå¹¶ä¸æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½†æ˜¯è¶³å¤Ÿè¡¨è¾¾ä»–ä»¬çš„å·®åˆ«äº†ã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹å‡ºï¼Œé™¤æ³•æ¯”ç§»ä½å¤šäº†ä¸€æ­¥&lt;code>shr edx, 31&lt;/code>è¿‡ç¨‹ï¼Œä¸‹é¢ä¼šæ¢è®¨è¿™ä¸ªã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ä»¶ä½¿ä½ éœ‡æƒŠçš„äº‹ä»¶ï¼Œ&lt;code>x&lt;/code>, &lt;code>y&lt;/code>çš„å€¼æœ€ç»ˆæ˜¯&lt;strong>ä¸åŒ&lt;/strong>çš„ï¼æ˜¯çš„ï¼Œæ­£æ˜¯å› ä¸ºé‚£æ¡çœ‹ä¼¼â€œå¤šä½™â€çš„&lt;code>shr&lt;/code>æŒ‡ä»¤ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆç»“æœä¸åŒ">ä¸ºä»€ä¹ˆç»“æœä¸åŒ&lt;/h2>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šçš„ä¸€ä»¶äº‹æ˜¯ï¼šç¼–è¯‘å™¨çœŸçš„å¸®æˆ‘ä»¬å°†é™¤æ³•æ“ä½œä¼˜åŒ–ä¸ºç§»ä½ã€‚æ‰€ä»¥ï¼Œå†ä¹Ÿä¸è¦è¯´ä½ çš„ä»£ç ä¸­ä½¿ç”¨&lt;code>&amp;gt;&amp;gt;&lt;/code>æ¥æ›¿ä»£é™¤æ³•æ˜¯ä¸ºäº†å¢åŠ æ‰§è¡Œæ•ˆç‡äº†ã€‚&lt;/p>
&lt;p>è®©æˆ‘ä»¬æ¥è§£é‡Šä¸‹ä¸ºä»€ä¹ˆä¸¤è€…çš„ç»“æœæ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œ&lt;code>sar&lt;/code>æŒ‡ä»¤åœ¨x86æŒ‡ä»¤é›†ä¸­è¡¨ç¤ºç®—æ•°å³ç§»ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ï¼Œé‚£ä¹ˆ&lt;code>-3&lt;/code>è¿›è¡Œç®—æ•°å³ç§»åçš„ç»“æœå°±æ˜¯&lt;code>-2&lt;/code>. æ„å‘³ç€&lt;code>&amp;gt;&amp;gt;&lt;/code>æ˜¯å‘è´Ÿæ— ç©·èˆå…¥çš„.&lt;/p>
&lt;p>é‚£ä¹ˆé™¤æ³•æ“ä½œåˆæ˜¯åœ¨å¹²ä»€ä¹ˆå‘¢? å®ƒæ˜¯å°†åŸå€¼åŠ ä¸Šå…¶ç¬¦å·ä½.Demoä¸­ä½¿ç”¨çš„æ•°æ®ç±»å‹æ˜¯32ä½&lt;code>int&lt;/code>.&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-assembly" data-lang="assembly">shr edx, 31
add eax, edx
&lt;/code>&lt;/pre>&lt;p>è¿™æ ·åšå¿…ç„¶æ”¹å˜äº†åŸå€¼å•Šï¼ŒåŠ¨æ‰‹ç®—ä¸€ä¸‹å°±ä¼šçŸ¥é“ï¼Œ&lt;code>-3/2&lt;/code>çš„ç»“æœä¸º&lt;code>-1&lt;/code>. å¹¶ä¸”åªæœ‰è´Ÿå¥‡æ•°ä¼šå—å½±å“ï¼Œå¯¹äºæ­£æ•°ï¼Œå…¶ç¬¦å·ä¸º0ï¼›å¯¹äºè´Ÿå¶æ•°ï¼Œå…¶è¡¥ç çš„æœ€ä½ä½å¿…ä¸º0ï¼ŒåˆšåŠ ä¸Šçš„1ä¼šè¢«ä¸‹ä¸€æ­¥çš„ç®—æ•°å³ç§»ä¸¢å¼ƒï¼Œä¸å¯¹é«˜ä½äº§ç”Ÿå½±å“ã€‚&lt;/p>
&lt;p>Aha, å·®åˆ«å°±æ˜¯å‘è´Ÿæ— ç©·èˆå¼ƒè¿˜æ˜¯å‘0èˆå¼ƒï¼Œä¸€æ—¶é—´ç«Ÿç„¶ä¸çŸ¥é“å“ªä¸ªæ˜¯æ­£ç¡®çš„äº†ã€‚&lt;/p>
&lt;h2 id="æˆ‘ä»¬åº”è¯¥å¦‚ä½•åš">æˆ‘ä»¬åº”è¯¥å¦‚ä½•åš&lt;/h2>
&lt;p>æ ¹æ®æœ€æ–°çš„[Cè¯­è¨€æ ‡å‡†è‰æ¡ˆ](&lt;a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1336.pdf">ISO/IEC 9899:201x (open-std.org)&lt;/a>) 6.5.7ç« èŠ‚ï¼Œè´Ÿæ•°çš„å³ç§»æ“ä½œæ˜¯implementation-definedï¼Œå³å–å†³äºå…·ä½“çš„å®ç°ï¼š&lt;/p>
&lt;blockquote>
&lt;p>The result of E1 &amp;raquo; E2 is E1 right-shifted E2 bit positions. If E1 has an unsigned type or if E1 has a signed type and a nonnegative value, the value of the result is the integral part of the quotient of E1 / 2E2. If E1 has a signed type and a negative value, the resulting value is implementation-defined.&lt;/p>
&lt;/blockquote>
&lt;p>å› æ­¤ï¼Œç†è®ºä¸Šå®ƒä¾èµ–äºå®ç°ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ä¸ºäº†ç¨‹åºçš„å¯ç§»æ¤æ€§ï¼Œåº”å½“é¿å…å¯¹æœ‰ç¬¦å·æ•°ä½¿ç”¨ç§»ä½æ“ä½œã€‚é™¤éä½ èƒ½ç¡®å®šå®ƒçš„å€¼ä¸€å®šæ˜¯éè´Ÿæ•°ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œè¯·å°†å®ƒç”¨æ— ç¬¦å·ç±»å‹æ¥å£°æ˜ã€‚&lt;/p>
&lt;p>å¯¹äºé™¤æ³•æ“ä½œï¼Œæ ‡å‡†ä¸­çš„6.5.5ç« èŠ‚è§„å®šäº†ï¼Œé™¤æ³•æ“ä½œæ€»æ˜¯å‘0èˆå…¥. éå¸¸å¥½ï¼&lt;/p>
&lt;blockquote>
&lt;p>When integers are divided, the result of the / operator is the algebraic quotient with any fractional part discarded.&lt;/p>
&lt;/blockquote>
&lt;p>æ£€æŸ¥ä½ çš„ä»£ç ï¼Œæ¢å¤æ‰€æœ‰çš„â€œä¼˜åŒ–â€ä¹˜é™¤æ³•çš„è¡Œä¸ºå§ï¼&lt;/p>
- https://wangloo.github.io/posts/c/feature/ - @2019 Notepadium.</description></item><item><title>Cè¯­è¨€ç¨‹åºè®¾è®¡çš„ä¸€äº›ç»éªŒ</title><link>https://wangloo.github.io/posts/c/experience/</link><pubDate>Mon, 27 Feb 2023 19:20:20 +0800</pubDate><guid>https://wangloo.github.io/posts/c/experience/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/c/experience/ -&lt;h2 id="å¤´æ–‡ä»¶çš„å¼•ç”¨å½¢å¼">å¤´æ–‡ä»¶çš„å¼•ç”¨å½¢å¼&lt;/h2>
&lt;p>C ä¸­å¼•ç”¨ä¸€ä¸ªå¤´æ–‡ä»¶æœ‰ä¸¤ç§å½¢å¼ &lt;code>#include &amp;lt;&amp;gt;&lt;/code>å’Œ&lt;code>#include &amp;quot;&amp;quot;&lt;/code>ï¼Œåœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œéœ€è¦å¼•ç”¨ä¸€äº›ç³»ç»Ÿåº“æ–‡ä»¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨&lt;code>&amp;lt;&amp;gt;&lt;/code>ï¼Œå¯¹äºè‡ªå·±å®šä¹‰çš„å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨&lt;code>&amp;quot;&amp;quot;&lt;/code>ã€‚&lt;/p>
&lt;p>ç„¶è€Œå¯¹äºåº•å±‚è½¯ä»¶çš„å¼€å‘ï¼Œæ¯”å¦‚è¯´æ“ä½œç³»ç»Ÿï¼Œç”¨åˆ°çš„åº“éƒ½æ˜¯è‡ªå·±å·¥ç¨‹ä¸­çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”¨&lt;code>&amp;quot;&amp;quot;&lt;/code>å’Œ&lt;code>&amp;lt;&amp;gt;&lt;/code>æœ‰æ—¶éƒ½èƒ½ workï¼Œé‚£ä¹ˆå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>æœç´¢ç›¸å…³å…³é”®è¯å¾—åˆ°çš„ç»“è®ºæ˜¯: ä¸¤ç§æ–¹å¼çš„åŒºåˆ«æ˜¯&lt;strong>æœç´¢æ–‡ä»¶çš„ä¼˜å…ˆçº§ï¼Œ &lt;code>&amp;quot;&amp;quot;&lt;/code>ä¼˜å…ˆæœç´¢çš„å½“å‰ç›®å½•ï¼Œè€Œ&lt;code>&amp;lt;&amp;gt;&lt;/code>ä¼˜å…ˆæœç´¢ç³»ç»Ÿåº“æ–‡ä»¶ç›®å½•&lt;/strong>ã€‚å¯¹äºè¿™ä¸ªç³»ç»Ÿåº“ï¼Œå³é‚£äº›ä½¿ç”¨&lt;code>gcc -I&amp;lt;dir&amp;gt;&lt;/code>å‚æ•°æŒ‡å®šçš„è·¯å¾„ã€‚
å½“ç„¶ï¼Œå¦‚æœç¬¬ä¸€ä¼˜å…ˆçº§ä½ç½®æ²¡æœ‰è¢«æ‰¾åˆ°ï¼Œä¹Ÿä¼šåˆ°å¦ä¸€ä¸ªç›®å½•ä¸­æœç´¢ã€‚è¿™ä¹ˆä¸¤ç§æ–¹å¼å‡å¯ï¼Œå®é™…å·¥ç¨‹ä¸­ä¹Ÿæœ‰éƒ¨åˆ†äººæ··åˆä½¿ç”¨ï¼Œæ¯«ä¸åœ¨æ„è§„åˆ™ã€‚ä½†æ˜¯æœ‰æ—¶ä¼šå¯¼è‡´ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°&lt;code>-MMD&lt;/code>æˆ–è€…ç±»ä¼¼é€‰é¡¹ç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„ä¾èµ–ï¼Œæ–¹ä¾¿å®ç°å¢é‡ç¼–è¯‘ã€‚æ­¤æ—¶å°±å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚&lt;/p>
&lt;p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤´æ–‡ä»¶&lt;code>inc/father.h&lt;/code>, å®ƒé‡Œé¢ä¼šå¼•ç”¨&lt;code>inc/child.h&lt;/code>, å¯¹äº&lt;strong>æ ¹ç›®å½•ä¸‹&lt;/strong>çš„æºæ–‡ä»¶&lt;code>main.c&lt;/code>ï¼Œå…¶å¼•ç”¨è¯­å¥è¯¥å¦‚ä½•å†™å‘¢ï¼Ÿä»¥ä¸‹åˆ—å‡ºçš„å‡ ç§å½¢å¼éƒ½å¯ä»¥ï¼Œä»»æ„çš„æ’åˆ—ç»„åˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// ç¼–è¯‘å‚æ•°: -I. -MMD
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// main.c
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;inc/father.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;inc/father.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// father.h
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;inc/child.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;inc/child.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;child.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;child.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¦‚æœ main.c æ˜¯ä½¿ç”¨ç³»ç»Ÿåº“è·¯å¾„(&lt;code>-I.&lt;/code>)æ¥æ‰¾åˆ°çš„ father.h, å³ä¸Šé¢ main.c çš„ç¬¬ 2 ç§æƒ…å†µï¼Œé‚£ä¹ˆå…¶ç”Ÿæˆä¾èµ–æ–‡ä»¶çš„å½¢å¼å†…å®¹éƒ½æ˜¯&lt;strong>ç»å¯¹è·¯å¾„&lt;/strong>ï¼ŒåŒ…æ‹¬ father.h ä¸­çš„å¼•ç”¨ï¼ˆå› ä¸ºå³ä¾¿ child.h æ˜¯ç›¸å¯¹è·¯å¾„æ‰¾åˆ°çš„ï¼Œç›¸å¯¹çš„ä¹Ÿæ˜¯ father.hï¼Œå…¶åŸºå‡†å°±æ˜¯ç»å¯¹è·¯å¾„ï¼‰ã€‚ä¾‹å¦‚:&lt;code>main.o: main.c /home/xx/father.h /home/xx/child.h&lt;/code>&lt;/li>
&lt;li>å¦åˆ™å³ä»¥ç›¸å¯¹è·¯å¾„æ‰¾åˆ° father.h,å³ä¸Šè¯´ main.c çš„ç¬¬ 1 ç§ï¼Œé‚£ä¹ˆç”Ÿæˆ father.h ä¾èµ–çš„æ–¹å¼&lt;strong>ä¸€å®šæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä½† child.h çš„å½¢å¼å´å–å†³äºå…¶æœ¬èº«&lt;/strong>.
&lt;ul>
&lt;li>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ child.h çš„å¯»æ‰¾æ–¹å¼æ˜¯ç»å¯¹çš„ï¼ˆä¸Šé¢çš„ç¬¬ 1,2,4 ç§ï¼‰ï¼Œé‚£ä¹ˆä¾èµ–æ–‡ä»¶çš„å½¢å¼å°±æ˜¯&lt;code>main.o: main.c inc/father.h /home/xx/child.h&lt;/code>.&lt;/li>
&lt;li>å¦‚æœ child.h çš„å¯»æ‰¾æ–¹å¼æ˜¯ç›¸å¯¹çš„(ä¸Šé¢çš„ç¬¬ 3 ç§)ï¼Œé‚£ä¹ˆä¾èµ–æ–‡ä»¶çš„å½¢å¼æ˜¯&lt;code>main.o: main.c inc/father.h inc/child.h&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä¾èµ–æ–‡ä»¶çš„å½¢å¼å¾ˆé‡è¦ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯å‡ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œæ­¤æ—¶ä¸éœ€è¦è€ƒè™‘ä¾èµ–æ–‡ä»¶åœ¨ makefile ä¸­ include çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦è€ƒè™‘ make çš„â€œå½“å‰è·¯å¾„â€ã€‚å¦‚æœéå¾—ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå·²ç»è¦ç¡®å®šèƒ½å¤Ÿ makefile ä¸­ include æ—¶çš„ make å½“å‰è·¯å¾„å°±æ˜¯ç”Ÿæˆä¾èµ–æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦åˆ™ä¸èƒ½å»ºç«‹æ­£ç¡®çš„ä¾èµ–å…³ç³»ã€‚&lt;/p>
&lt;p>å®é™…ä¸Šï¼Œåœ¨â€œåŸºç¡€æ¶æ„â€ä¼˜ç§€çš„é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½å‡ºç°æˆ–è€…å°½é‡é¿å…å‡ºæ¥ä¸¤ç§å½¢å¼éƒ½èƒ½æ‰¾åˆ°å¤´æ–‡ä»¶çš„æƒ…å†µã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¼šå°†æºæ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨å­ç›®å½•&lt;code>src/&lt;/code>ä¸‹ä¸å¤´æ–‡ä»¶éš”ç¦»ï¼Œè¿™æ ·å°±ä»æ ¹æœ¬ä¸Šé¿å…äº†ç›¸å¯¹ä¾èµ–çš„ç”Ÿæˆï¼Œåªèƒ½é€šè¿‡ç³»ç»Ÿåº“çš„å½¢å¼æ¥æ‰¾å¤´æ–‡ä»¶ã€‚æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œæ­£ç¡®çš„æ–¹å¼æ˜¯ï¼šmain.c æ”¾å…¥ src/ä¸­ï¼Œç„¶åä¸ç®¡æ˜¯æºæ–‡ä»¶è¿˜æ˜¯å¤´æ–‡ä»¶ï¼Œéƒ½ç»Ÿä¸€ä½¿ç”¨&lt;code>#include &amp;quot;inc/xxx&amp;quot;&lt;/code>ã€‚è¿™æ ·åš&lt;strong>å³ç»Ÿä¸€ï¼Œä¹Ÿèƒ½ä¿è¯æ‰€æœ‰çš„ä¾èµ–éƒ½æ˜¯ç»å¯¹è·¯å¾„å½¢å¼&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å¦å¤–è¯´ä¸€ç‚¹ï¼Œå…¶å®ä¾èµ–æ–‡ä»¶(.d)ä¸­æºæ–‡ä»¶çš„ä¾èµ–é¡¹å½¢å¼ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ï¼Œè¿™ä¸èƒ½é€šè¿‡ç³»ç»Ÿæ¶æ„æ¥è§£å†³ï¼Œåªèƒ½ç”¨ Makefile çš„æŠ€å·§æ¥å®ç°ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬çš„ make å½“å‰ç›®å½•æ€»æ˜¯æ ¹ç›®å½•ï¼Œè€Œåœ¨å»ºç«‹ OBJS å˜é‡æ—¶ä¸ºå…¶åŠ ä¸Šç»å¯¹è·¯å¾„çš„å‰ç¼€ï¼Œ ä»è€Œ make ä¸éœ€è¦è¿›å…¥å„çº§å­ç›®å½•ï¼Œç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ä¹Ÿéƒ½æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„ï¼Œinclude ä¾èµ–æ–‡ä»¶çš„è¡Œä¸ºä¹Ÿæ˜¯åœ¨æ ¹ç›®å½•è¿›è¡Œçš„ï¼Œä¿è¯ç»Ÿä¸€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å¤–éƒ¨åº“çš„ä½¿ç”¨æ–¹å¼">å¤–éƒ¨åº“çš„ä½¿ç”¨æ–¹å¼&lt;/h2>
&lt;p>æœ€è¿‘æˆ‘åœ¨å¼€å‘é¡¹ç›®æ˜¯, éœ€è¦ä½¿ç”¨åˆ° libelf åº“, æˆ‘åœ¨ Github ä¸Šæ‰¾åˆ°äº†å…¶æºä»£ç .&lt;/p>
&lt;p>æˆ‘ä¹‹å‰ä½¿ç”¨ä¸€ä¸ª lib éƒ½æ˜¯ä»¥é“¾æ¥çš„å½¢å¼ä½¿ç”¨åŠ¨æ€åº“/é™æ€åº“, ä½†æ˜¯æ—¢ç„¶å®ƒæä¾›äº†æºç , é‚£ä¹ˆæˆ‘å¯ä»¥ç›´æ¥å°†æºç æ‹·è´åˆ°æˆ‘çš„é¡¹ç›®ä¸­å—? ç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥, é‚£ä¹ˆè¿™ä¸¤ç§æ–¹æ¡ˆè¯¥å¦‚ä½•æŠ‰æ‹©å‘¢?&lt;/p>
&lt;p>åœ¨æŸ¥é˜…äº†ä¸€äº›èµ„æ–™å, æˆ‘æ€»ç»“äº†ä»¥ä¸‹å‡ ä¸ªåˆ¤æ–­ä¾æ®:&lt;/p>
&lt;ol>
&lt;li>åº“çš„å¤§å°/å¯¹ç¼–è¯‘æ—¶é—´çš„æ•æ„Ÿåº¦; å¦‚æœä½¿ç”¨æºä»£ç , æ¯æ¬¡ç¼–è¯‘é¡¹ç›®æ—¶éœ€è¦é¢å¤–å¯¹åº“æ–‡ä»¶è¿›è¡Œç¼–è¯‘(èµ·ç æ˜¯ç¬¬ä¸€æ¬¡), è€Œåº“æ–‡ä»¶çš„å®šä¹‰æ˜¯ä¸å¸¸ä¿®æ”¹çš„, å¦‚æœåº“æ–‡ä»¶æ¯”è¾ƒå¤§, åˆ™ä¼šå»¶é•¿æ•´ä¸ªé¡¹ç›®çš„ç¼–è¯‘æ—¶é—´.&lt;/li>
&lt;li>æ˜¯å¦éœ€è¦ç‰ˆæœ¬æ§åˆ¶; è¦ä½¿ç”¨çš„åº“å¦‚æœéœ€è¦åŒºåˆ†ç‰ˆæœ¬, æˆ–è€…åˆ†é…ç»™å…¶ä»–çš„å›¢é˜Ÿæˆå‘˜ä½¿ç”¨, é‚£ä¹ˆç”¨åº“çš„å½¢å¼ä¼¼ä¹æ›´ä¸ºæ–¹ä¾¿&lt;/li>
&lt;li>å‘æŒ¥ git submodule çš„ä¼˜åŠ¿;&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>Ref: &lt;a href="https://softwareengineering.stackexchange.com/questions/313907/should-i-add-the-source-of-libraries-instead-of-linking-to-them">c++ - Should I add the source of libraries instead of linking to them? - Software Engineering Stack Exchange&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="const-ä¿®é¥°ç¬¦çš„å¦™ç”¨">&lt;code>const&lt;/code> ä¿®é¥°ç¬¦çš„å¦™ç”¨&lt;/h2>
&lt;p>æœ‰äº›æ—¶å€™, æˆ‘ä»¬è®¾è®¡çš„ç»“æ„ä½“ä¸­ä¼šæœ‰&lt;em>name&lt;/em>å­—æ®µ, ç±»å‹æ˜¯&lt;code>char *&lt;/code>. åœ¨ä½¿ç”¨æ—¶ä¸ºå®ƒåˆ†é…ç©ºé—´, ä¸ä½¿ç”¨æ—¶éœ€è¦å›æ”¶.&lt;/p>
&lt;p>å…¶å®è¿˜æœ‰å¦ä¸€ç§æƒ…å†µ, å°±æ˜¯&lt;em>name&lt;/em>è¦æŒ‡å‘é¢„å…ˆå®šä¹‰å¥½çš„&amp;quot;static name list&amp;quot;, é€‚ç”¨äº name çš„å–å€¼æ˜¯ç¡®å®šçš„èŒƒå›´. ä¾‹å¦‚, libdwarf åº“ä¸­çš„æè¿° section name çš„&lt;code>dss_name&lt;/code> æˆå‘˜.&lt;/p>
&lt;p>è¿™æ—¶, ä¸ºäº†é˜²æ­¢ä½¿ç”¨è€…è°ƒç”¨&lt;code>free()&lt;/code>æ¥é‡Šæ”¾å®ƒ, æˆ‘ä»¬å¯ä»¥å°†å…¶å£°æ˜ä¸º&lt;code>const char *&lt;/code>, æ­¤æ—¶å¦‚æœè°ƒç”¨&lt;code>free(.dss_name)&lt;/code>, ç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Š:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>const.c:16:10: warning: passing argument &lt;span style="color:#bd93f9">1&lt;/span> of â€˜freeâ€™ discards â€˜constâ€™ qualifier from pointer target &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span>-Wdiscarded-qualifiers&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#bd93f9">16&lt;/span> | free&lt;span style="color:#ff79c6">(&lt;/span>dss_name&lt;span style="color:#ff79c6">)&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> | ^~~~~~~~
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/c/experience/ - @2019 Notepadium.</description></item><item><title>è¡Œç»“æŸç¬¦åœ¨windowså’Œlinuxçš„åŒºåˆ«</title><link>https://wangloo.github.io/posts/c/end-of-line/</link><pubDate>Sat, 24 Dec 2022 01:35:24 +0800</pubDate><guid>https://wangloo.github.io/posts/c/end-of-line/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/c/end-of-line/ -&lt;p>ä½¿ç”¨VIM æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶, æœ‰æ—¶ä¼šçœ‹åˆ°ä¾‹å¦‚ &lt;code>^M&lt;/code> è¿™ç±»å­—ç¬¦å‡ºç°. ä¸‹é¢æˆ‘ä¼šæŒ–ä¸€ä¸‹å…¶å‡ºç°çš„åŸå› .&lt;/p>
&lt;h2 id="eol-å­—ç¬¦">EOL å­—ç¬¦&lt;/h2>
&lt;p>EOL æˆ–è€…è¯´ end-of-line è¡¨ç¤ºä¸€ä¸ªæ–°è¡Œçš„å¼€å§‹.&lt;/p>
&lt;p>EOL å­—ç¬¦åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­æ˜¯ä¸åŒçš„. æœ¬æ–‡ä¸­ä»…ä»¥ Linux å’Œ Windows ä¸ºä¾‹è¯´æ˜.&lt;/p>
&lt;ul>
&lt;li>Windowsä¸­æ˜¯ä»¥è¯»åˆ°å›è½¦&amp;lt;CR&amp;gt;å’Œæ¢è¡Œ&amp;lt;LF&amp;gt; è¡¨ç¤º EOL.&lt;/li>
&lt;li>Linux ä¸­ä»…ä»¥æ¢è¡Œä½œä¸ºEOL&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;ul>
&lt;li>å›è½¦&amp;lt;CR&amp;gt; : Carriage return. å°†å…‰æ ‡å›åˆ°è¡Œé¦–, å¯¹åº”Cè¯­è¨€ä¸­çš„ &lt;code>\r&lt;/code>&lt;/li>
&lt;li>æ¢è¡Œ&amp;lt;LF&amp;gt; : Line feed. å°†å…‰æ ‡ä¸‹ç§»ä¸€è¡Œ, å¯¹åº”Cè¯­è¨€ä¸­çš„ &lt;code>\n&lt;/code>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>åœ¨ Linux ä¸­æ‰“å¼€ Windows ä¸‹çš„æ–‡ä»¶å°†å¤šä½™çš„å›è½¦é€šå¸¸æ˜¾ç¤ºæˆ &lt;code>^M&lt;/code> æˆ–è€… &lt;code>Control-M&lt;/code>&lt;/p>
&lt;h2 id="ref">Ref&lt;/h2>
&lt;p>&lt;a href="https://peterbenjamin.com/seminars/crossplatform/texteol.html">End Of Line Characters&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/c/end-of-line/ - @2019 Notepadium.</description></item><item><title>æµ…è°ˆ errno çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</title><link>https://wangloo.github.io/posts/os/errno_thread_safe/</link><pubDate>Wed, 21 Dec 2022 19:08:22 +0800</pubDate><guid>https://wangloo.github.io/posts/os/errno_thread_safe/</guid><description>Wangloo's BLOG https://wangloo.github.io/posts/os/errno_thread_safe/ -&lt;p>æˆ‘å§‹ç»ˆä»¥ä¸ºï¼ŒCåº“ä¸­å¸¸ç”¨çš„ &lt;code>errno&lt;/code> ä»…æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½¿ç”¨äº†å…¨å±€å˜é‡å°±æ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨äº†ï¼Œå› ä¸ºå…¨å±€å˜é‡åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½æ˜¯å…±äº«çš„ã€‚&lt;/p>
&lt;p>è¦å®ç°çº¿ç¨‹å®‰å…¨çš„&lt;code>errno&lt;/code> å°±å¿…é¡»å°†å…¶è®¾ç½®ä¸º&lt;strong>çº¿ç¨‹ç§æœ‰çš„å˜é‡&lt;/strong>ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹GCCæ˜¯å¦‚ä½•å·§å¦™çš„å®ç°çš„ã€‚&lt;/p>
&lt;h2 id="æ­£æ–‡">æ­£æ–‡&lt;/h2>
&lt;p>ç°åœ¨çš„&lt;code>errno&lt;/code>å®šä¹‰å¹¶éä¸€ä¸ªå…¨å±€å˜é‡, è€Œæ˜¯ä¸€ä¸ª&lt;strong>å®å®šä¹‰&lt;/strong>, ä»¥ä¸‹æ˜¯åœ¨&lt;code>usr/include/errno&lt;/code>ä¸­çš„å£°æ˜:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">extern&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">__errno_location&lt;/span> (&lt;span style="color:#8be9fd">void&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6"># define errno (*__errno_location ())
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§æ–¹å¼ä¸‹å…¶å®ç°åŸç†å¤§æ¦‚æ˜¯: &lt;code>__errno_location&lt;/code> å‡½æ•°è¿”å›ä¸€ä¸ª&lt;code>int&lt;/code>æŒ‡é’ˆ, è€Œè¿™ä¸ªå‡½æ•°çš„å®ç°ä¸­, è¿”å›çš„å°±æ°å¥½æ˜¯&lt;strong>å®é™…çš„&lt;/strong>&lt;code>errno&lt;/code> å˜é‡(ä¸å®åŒå)çš„åœ°å€, æ‰€ä»¥å¯¹å…¶&lt;strong>è§£å¼•ç”¨&lt;/strong>å°±ç›¸å½“äºå¯¹å…¶å€¼è¿›è¡Œæ“ä½œ. æ‰€ä»¥, è¿™ç§å®šä¹‰è§„åˆ™ä¸‹, å·¦å€¼å’Œå³å€¼è¡¨è¾¾å¼å‡æˆç«‹.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>errno &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>; &lt;span style="color:#6272a4">// *__errno_location () = 10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> errno; &lt;span style="color:#6272a4">// x = *__errno_location ();
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>__errno_location&lt;/code> çš„å®ç°å°±è‡³å…³é‡è¦, å› ä¸ºå¦‚æœå…¶è¿”å›çš„å˜é‡åœ°å€ä¸åŒ…å«ä»»ä½•æŠ€å·§çš„è¯, å°±å’ŒåŸå…ˆç›´æ¥å®šä¹‰å…¨å±€å˜é‡çš„æ–¹å¼æ²¡å·®äº†, &lt;strong>è¯´åˆ°åº•èƒ½å¦å®ç°çº¿ç¨‹å®‰å…¨, è¿˜å¾—çœ‹å®é™…ä¿å­˜errnoçš„å˜é‡æ˜¯å¦ä¸ºçº¿ç¨‹ç‹¬æœ‰çš„&lt;/strong>. ç›®å‰è¿˜æ²¡æœ‰å‘æ˜åˆ°å…¶ç²¾é«“, åªæ˜¯å¥—å£³è€Œå·².&lt;/p>
&lt;p>ä»¥ä¸‹ç»™å‡º&lt;code>/csu/errno-loc.c&lt;/code>ä¸­&lt;code>__errno_location&lt;/code> çš„å®ç°, ä¸æˆ‘ä»¬é¢„æœŸä¸€è‡´, è¿”å›å˜é‡çš„åœ°å€. è€ŒåŒåå˜é‡&lt;code>errno&lt;/code>åˆ™å®šä¹‰åœ¨&lt;code>/csu/errno.c&lt;/code>ä¸­, &lt;strong>å†³å®šäº†èƒ½å¤Ÿå®ç°errnoçš„çº¿ç¨‹å®‰å…¨&lt;/strong>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#50fa7b">__errno_location&lt;/span> (&lt;span style="color:#8be9fd">void&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>errno;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>__thread &lt;span style="color:#8be9fd">int&lt;/span> errno;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&amp;ldquo;&lt;code>__thread&lt;/code>&amp;rdquo; æ˜¯GCCæä¾›çš„æ‰©å±•å‰ç¼€, è¡¨ç¤ºè¯¥å˜é‡å°†è¢«åº“å¤„ç†ä¸ºçº¿ç¨‹ç§æœ‰çš„, æ³¨æ„è¿™ä¸€æ­¥æ˜¯Cåº“å®Œæˆçš„, å¯¹ç¨‹åºå‘˜é€æ˜. ç›¸å…³çš„ç†è®ºå« &lt;em>Thread-local Storage&lt;/em>, AArch64 æ¶æ„å®ç°çš„åŸç†æ˜¯åˆ©ç”¨&lt;code>TPIDR_EL0&lt;/code> å¯„å­˜å™¨, å…¶ä»–æ¶æ„å¯ä»¥å‚è€ƒ&lt;a href="https://akkadia.org/drepper/tls.pdf">æ­¤PDF&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>â“ ä»¥ä¸Šæºæ–‡ä»¶ä¸­æœ‰æ³¨é‡Šä¸º &lt;em>non-threaded&lt;/em>ç‰ˆæœ¬çš„å®ç°, æ˜¯ä»£è¡¨ä»€ä¹ˆå«ä¹‰å‘¢?&lt;/p>
&lt;/blockquote>
&lt;p>â€‹&lt;/p>
&lt;p>è™½ç„¶æˆ‘æš‚æ—¶æ²¡æœ‰æŸ¥é˜…åˆ°errnoçš„å…¶ä»–çº¿ç¨‹å®‰å…¨çš„å®ç°åŸç†, ä½†èµ·ç GCCä¸‹è¯¥æ–¹å¼è¿™æ˜¯å¯è¡Œçš„. ä¾é çš„æ˜¯&amp;quot;&lt;code>__thread&lt;/code>&amp;ldquo;çš„æ”¯æŒ, &lt;strong>ä¸æ¢æˆå®å®šä¹‰çš„æ–¹å¼æ— å…³&lt;/strong>, ä¸æ’é™¤å¯èƒ½ä¸ºäº†è€ƒè™‘å…¼å®¹å…¶ä»–å®ç°æ–¹å¼çš„å¯èƒ½æ€§.&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;p>&lt;a href="https://stackoverflow.com/questions/18025995/how-is-thread-safe-errno-initialized-if-define-substitutes-errno-symbol">c - How is thread-safe errno initialized if #define substitutes errno symbol? - Stack Overflow&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/os/errno_thread_safe/ - @2019 Notepadium.</description></item></channel></rss>