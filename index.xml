<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>My New Hugo Site</title><link>https://lamperm.github.io/blog/</link><description>Recent content on My New Hugo Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>@2019 Notepadium.</copyright><lastBuildDate>Tue, 26 Apr 2022 19:08:22 +0800</lastBuildDate><atom:link href="https://lamperm.github.io/blog/index.xml" rel="self" type="application/rss+xml"/><item><title>GCC '-M' and Related Parameters</title><link>https://lamperm.github.io/blog/posts/gcc_-m_related/</link><pubDate>Tue, 26 Apr 2022 19:08:22 +0800</pubDate><guid>https://lamperm.github.io/blog/posts/gcc_-m_related/</guid><description>My New Hugo Site https://lamperm.github.io/blog/posts/gcc_-m_related/ -&lt;p>As we all know, there are huge number of parameters for GCC. With them, we can make many things possible. Now we talk about -M and related ones.
After reading this article, you will know the meaning of there magic parameters. And I will put some little demos follows. Finally, we will see what can they do in really project. Let&amp;rsquo;s go ahead.&lt;/p>
&lt;h2 id="-m">-M&lt;/h2>
&lt;p>Output the dependencies of the input source file. Incluing the names of itself and all included files.&lt;/p>
&lt;p>&lt;strong>Little Demo&lt;/strong>&lt;br>
Suppose we have source file &lt;code>tmp.c&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/* File: tmp.c */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt; // system header file&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;#34;tmp.h&amp;#34; // user defined header file&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If we run &lt;code>gcc -M tmp.c&lt;/code>, we will get messy output like following. Notice that the first two words is object filename and a colon.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>tmp.o: /home/wanglu/demo/tmp.c /usr/include/stdc-predef.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/stdio.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/libc-header-start.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/features.h /usr/include/x86_64-linux-gnu/sys/cdefs.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/wordsize.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/long-double.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/gnu/stubs.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/gnu/stubs-64.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/lib/gcc/x86_64-linux-gnu/9/include/stddef.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/lib/gcc/x86_64-linux-gnu/9/include/stdarg.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/timesize.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/typesizes.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/time64.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types/__fpos_t.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types/__mbstate_t.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types/__fpos64_t.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types/__FILE.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types/FILE.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/types/struct_FILE.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/stdio_lim.h &lt;span style="color:#8045ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8045ff">&lt;/span> /usr/include/x86_64-linux-gnu/bits/sys_errlist.h /home/wanglu/demo/tmp.h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-mm">-MM&lt;/h2>
&lt;p>Like &lt;code>-M&lt;/code> but do NOT output system header files.&lt;/p>
&lt;p>&lt;strong>Little Demo&lt;/strong>&lt;br>
Use same source file &lt;code>tmp.c&lt;/code> above.&lt;br>
Run &lt;code>gcc -MM tmp.c&lt;/code>. Output dependencies except system header files.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>tmp.o: /home/wanglu/demo/tmp.c /home/wanglu/demo/tmp.h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-mf">-MF&lt;/h2>
&lt;p>Use with &lt;code>-M&lt;/code> or &lt;code>-MM&lt;/code>. Specify output dependencies to file instead of STDOUT.&lt;/p>
&lt;p>&lt;strong>Little Demo&lt;/strong>&lt;br>
Use same source file &lt;code>tmp.c&lt;/code> above.&lt;br>
Run &lt;code>gcc -MM -MF dp.txt tmp.c&lt;/code>. File &lt;code>dp.txt&lt;/code> will be created and filled with dependecies of &lt;code>tmp.c&lt;/code> except system header files.&lt;/p>
&lt;h2 id="-md">-MD&lt;/h2>
&lt;p>&lt;code>-MD&lt;/code> is same as &lt;code>-M -F &amp;lt;file&amp;gt;&lt;/code>. But the filename is basd on the object file but replacing &lt;code>.o&lt;/code> with &lt;code>.d&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Little Demo&lt;/strong>&lt;br>
Use same source file &lt;code>tmp.c&lt;/code> above.&lt;br>
Run &lt;code>gcc -MD tmp.c&lt;/code>. File &lt;code>tmp.d&lt;/code> will be created and filled with all dependecies.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>-rw-rw-r-- &lt;span style="color:#ae81ff">1&lt;/span> wanglu wanglu &lt;span style="color:#ae81ff">67&lt;/span> 4月 &lt;span style="color:#ae81ff">26&lt;/span> 19:49 tmp.c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-rw-rw-r-- &lt;span style="color:#ae81ff">1&lt;/span> wanglu wanglu &lt;span style="color:#ae81ff">1175&lt;/span> 4月 &lt;span style="color:#ae81ff">26&lt;/span> 20:27 tmp.d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-rw-rw-r-- &lt;span style="color:#ae81ff">1&lt;/span> wanglu wanglu &lt;span style="color:#ae81ff">38&lt;/span> 4月 &lt;span style="color:#ae81ff">26&lt;/span> 19:47 tmp.h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-mmd">-MMD&lt;/h2>
&lt;p>&lt;code>-MMD&lt;/code> is same as &lt;code>-MD -F &amp;lt;file&amp;gt;&lt;/code>. Also named on object file but replacing &lt;code>.o&lt;/code> with &lt;code>.d&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Little Demo&lt;/strong>&lt;br>
Use same source file &lt;code>tmp.c&lt;/code> above.&lt;br>
Run &lt;code>gcc -MMD tmp.c&lt;/code>. File &lt;code>tmp.d&lt;/code> will be created and filled with dependecies except system header files.&lt;/p>
&lt;h2 id="application">Application&lt;/h2>
&lt;p>Here is an important question you may ask me: &lt;em>Why do we struggle to get the dependencies formats? What can they do?&lt;/em>&lt;br>
If you are familiar with &lt;code>make&lt;/code> and &lt;code>Makefile&lt;/code>, aha, that&amp;rsquo;s it!
With the help of M-related parameters, you can easily handle the problem of &lt;strong>tracing header files&lt;/strong>.&lt;br>
Give you a little demo about my point.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">-include&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">*.d&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">%.o&lt;/span>&lt;span style="color:#f92672">:&lt;/span>%.&lt;span style="color:#111">c&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">$(&lt;/span>CC&lt;span style="color:#00a8c8">)&lt;/span> &lt;span style="color:#00a8c8">$(&lt;/span>CFLAGS&lt;span style="color:#00a8c8">)&lt;/span> &lt;span style="color:#00a8c8">$(&lt;/span>INCLUDES&lt;span style="color:#00a8c8">)&lt;/span> $&amp;lt; -c -MMD -o &lt;span style="color:#111">$@&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Actually, we do two things in order:&lt;/p>
&lt;ol>
&lt;li>When complieing source files, we generate dependency files &lt;code>xxx.d&lt;/code> at the same time.&lt;/li>
&lt;li>After geting &lt;code>xxx.d&lt;/code>, we include them in makefile. As its format is exactly the dependency format required by makefile.&lt;/li>
&lt;/ol>
&lt;h2 id="summary">Summary&lt;/h2>
&lt;p>Hope this article can give you a clear understanding of M-related parameters in GCC. We can sometimes find them in large projects&amp;rsquo; makefile. It&amp;rsquo;s very useful to automatic build dependency for header files. So try to use them in your current or next project.&lt;/p>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://gcc.gnu.org/onlinedocs/gcc/Preprocessor-Options.html#Preprocessor-Options">GNU GCC options&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://programmer.group/gcc-m-mm-mmd-mf-mt.html">GCC -M, -MM, -MMD, -MF, -MT&lt;/a>&lt;/li>
&lt;/ol>
- https://lamperm.github.io/blog/posts/gcc_-m_related/ - @2019 Notepadium.</description></item><item><title>Second Blog</title><link>https://lamperm.github.io/blog/posts/second-blog/</link><pubDate>Tue, 26 Apr 2022 15:32:11 +0800</pubDate><guid>https://lamperm.github.io/blog/posts/second-blog/</guid><description>My New Hugo Site https://lamperm.github.io/blog/posts/second-blog/ -&lt;p>This is my second blog.&lt;/p>
&lt;ul>
&lt;li>happy&lt;/li>
&lt;li>smile&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://lamperm.github.io/blog/static/img/test.jpg" alt="">
&lt;img src="https://lamperm.github.io/blog/img/test.jpg" alt="">
&lt;img src="https://lamperm.github.io/blog/test.jpg" alt="">
&lt;img src="test.jpg" alt="">&lt;/p>
- https://lamperm.github.io/blog/posts/second-blog/ - @2019 Notepadium.</description></item><item><title>First Blog</title><link>https://lamperm.github.io/blog/posts/first-blog/</link><pubDate>Tue, 26 Apr 2022 15:13:07 +0800</pubDate><guid>https://lamperm.github.io/blog/posts/first-blog/</guid><description>My New Hugo Site https://lamperm.github.io/blog/posts/first-blog/ -&lt;p>This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.
This is my first blog.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello, hugo&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://lamperm.github.io/blog/posts/first-blog/ - @2019 Notepadium.</description></item></channel></rss>