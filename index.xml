<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Homepage ðŸŒˆ on Soben's Secret Base</title><link>https://wangloo.github.io/</link><description>Recent content in Homepage ðŸŒˆ on Soben's Secret Base</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>@2019 Notepadium.</copyright><lastBuildDate>Thu, 15 Sep 2022 15:14:05 +0800</lastBuildDate><atom:link href="https://wangloo.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>GICv3 - for ARMV8</title><link>https://wangloo.github.io/posts/armv8/gicv3/</link><pubDate>Sat, 10 Sep 2022 21:51:49 +0800</pubDate><guid>https://wangloo.github.io/posts/armv8/gicv3/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/armv8/gicv3/ -&lt;h1 id="gicv3generic-interrupt-controller---version-3">GICV3(Generic Interrupt Controller - version 3)&lt;/h1>
&lt;h2 id="å…³äºŽgic">å…³äºŽGIC&lt;/h2>
&lt;p>GICå³ä¸­æ–­æŽ§åˆ¶å™¨, è´Ÿè´£ç®¡ç†ä¸­æ–­çš„æŽ¥æ”¶, å±è”½, è·¯ç”±ç­‰ç›¸å…³ä»»åŠ¡, å¹¶å‘ç³»ç»Ÿç¨‹åºå‘˜æä¾›é…ç½®çš„æŽ¥å£.&lt;/p>
&lt;p>GICä¸Žå¼‚å¸¸æ¨¡åž‹åä½œå®Œæˆä¸­æ–­çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ, GICä¸»è¦è´Ÿè´£&lt;code>ä¸­æ–­æº-äº§ç”ŸIRQ/FIQä¿¡å·&lt;/code>è¿™æ®µè·¯, å…³äºŽå¤„ç†IRQ/FIQåˆ™æ˜¯ç”±CPUå†…éƒ¨çš„&lt;em>å¼‚å¸¸æ¨¡åž‹&lt;/em>æ¥å®Œæˆ.&lt;/p>
&lt;h2 id="å¯¹æ¯”-gicv2">å¯¹æ¯” GICv2&lt;/h2>
&lt;ul>
&lt;li>æ”¯æŒæ›´å¤šçš„å¤„ç†å™¨, ç”¨&lt;code>affinity routing&lt;/code> æ–¹æ¡ˆæ¥åšä¸­æ–­è·¯ç”±.&lt;/li>
&lt;li>æ”¯æŒä¸­æ–­åˆ†ç»„, ä¸ºäº†é…åˆARMv8çš„å¼‚å¸¸ç­‰çº§æ¨¡åž‹&lt;/li>
&lt;li>æ–°å¢žä¸­æ–­ç±»åž‹: SGI, è½¯ä»¶ç”Ÿæˆä¸­æ–­&lt;/li>
&lt;li>æ–°å¢žä¸­æ–­ç±»åž‹: SPI, Shared Peripheral Interrupts&lt;/li>
&lt;li>å¯¹äºŽCPU interfaceçš„å¯„å­˜å™¨, å¯ç›´æŽ¥ä½¿ç”¨ç³»ç»Ÿå¯„å­˜å™¨æŽ¥å£(system register interface)æ¥è®¿é—®, æ¯”memory-mappedçš„æ–¹å¼å¿«.&lt;/li>
&lt;li>ITS, Interrupt Translation Service æš‚ä¸ä»‹ç»&lt;/li>
&lt;li>LPI, Locality-specific Peripheral Interrupts . æš‚ä¸ä»‹ç»&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>GICv3æ”¯æŒARMv8-Aæˆ–ARMv8-Rç³»åˆ—å¤„ç†å™¨, ä½†æ²¡æœ‰å¿…ç„¶çš„ç»‘å®šå…³ç³». ARMv8-Aä¹Ÿå¯ä»¥ä½¿ç”¨GICv2.&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸­æ–­ç±»åž‹">ä¸­æ–­ç±»åž‹&lt;/h2>
&lt;h3 id="locality-specific-peripheral-interrupt-lpi">Locality-specific Peripheral Interrupt (LPI)&lt;/h3>
&lt;p>LPIs are always &lt;a href="https://en.wikipedia.org/wiki/Message_Signaled_Interrupts">message-based interrupts&lt;/a> interrupts. è¿™é‡Œä¸åšä»‹ç».&lt;a href="https://en.wikipedia.org/wiki/Message_Signaled_Interrupts">&lt;/a>&lt;/p>
&lt;h3 id="private-peripheral-interrupt-ppi">Private Peripheral Interrupt (PPI)&lt;/h3>
&lt;p>PPIæ˜¯è·¯ç”±åˆ°&lt;strong>å•ä¸ªCPU&lt;/strong>çš„å¤–è®¾ä¸­æ–­, ä¸åŒçš„CPUå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ä¸­æ–­å·. ä¾‹å¦‚, æ‰€æœ‰CPUéƒ½å¯ä»¥ä½¿ç”¨ä¸­æ–­å·16è¡¨ç¤ºç§æœ‰çš„å®šæ—¶å™¨ä¸­æ–­.&lt;/p>
&lt;h3 id="shared-peripheral-interrupt-spi">Shared Peripheral Interrupt (SPI)&lt;/h3>
&lt;p>SPIæ˜¯å¯è·¯ç”±åˆ°&lt;strong>ä¸€ç»„CPU&lt;/strong>çš„å¤–è®¾ä¸­æ–­, Distributor è´Ÿè´£SPIè·¯ç”±.&lt;/p>
&lt;h3 id="software-generated-interrupt-sgi">Software Generated Interrupt (SGI)&lt;/h3>
&lt;p>SGIæ˜¯ç”±æŸä¸ªCPUäº§ç”Ÿ, è·¯ç”±åˆ°ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªCPU, é€šå¸¸ç”¨äºŽå¤„ç†å™¨é—´é€šä¿¡.&lt;/p>
&lt;h2 id="gicv3-çš„ç»„ä»¶">GICv3 çš„ç»„ä»¶&lt;/h2>
&lt;p>GICv3æž¶æž„ç”±ä»¥ä¸‹é€»è¾‘ç»„ä»¶æž„æˆ:&lt;/p>
&lt;ul>
&lt;li>A Distributor&lt;/li>
&lt;li>A Redistributor for each CPU&lt;/li>
&lt;li>A CPU interface for each CPU&lt;/li>
&lt;li>Interrupt Translation Service components (ITS). å¯é€‰, æš‚ä¸ä»‹ç»&lt;/li>
&lt;/ul>
&lt;p>The Distributor, Redistributor ä¸€èµ·ç»„æˆäº† &lt;em>IRI(Interrupt Routing Infrastructure)&lt;/em>.&lt;/p>
&lt;p>&lt;img src="./IRI.png" alt="iri">{width=&amp;ldquo;10px&amp;rdquo;}&lt;/p>
&lt;h3 id="distributor">Distributor&lt;/h3>
&lt;p>æŽ§åˆ¶SPIå’ŒSGIçš„è·¯ç”±. å¯¹äºŽ SPI, æä¾›äº†ä¸€ä¸‹æŽ¥å£:&lt;/p>
&lt;ul>
&lt;li>å¯åŠ¨/ç¦ç”¨ SPI&lt;/li>
&lt;li>è®¾ç½® SPI çš„ä¼˜å…ˆçº§&lt;/li>
&lt;li>é…ç½®å¯¹äºŽ SPI çš„è·¯ç”±&lt;/li>
&lt;li>è®¾ç½® SPI çš„è§¦å‘æ–¹å¼&lt;/li>
&lt;li>ç”Ÿæˆ message-based SPI&lt;/li>
&lt;li>ä¸ºæ¯ä¸ª SPI åˆ†ç»„&lt;/li>
&lt;li>æŽ§åˆ¶ SPI çš„ &lt;code>pending and active&lt;/code> çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºŽ&lt;code>Distributor&lt;/code>çš„å¤§éƒ¨åˆ†é…ç½®é€šè¿‡&lt;code>GICD_CTLR&lt;/code>å®žçŽ°. åŒ…æ‹¬:&lt;/p>
&lt;ul>
&lt;li>å¯ç”¨ Affinity routing&lt;/li>
&lt;li>ç¦ç”¨å®‰å…¨æ€§&lt;/li>
&lt;li>ä¸­æ–­åˆ†ç»„çš„é…ç½®.&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å…³äºŽDistributor å¯„å­˜å™¨éƒ½å«æœ‰ &lt;code>GICD_&lt;/code> å‰ç¼€, é€šè¿‡ &lt;code>memory-mapped&lt;/code> æ–¹å¼è®¿é—®.&lt;/p>
&lt;/blockquote>
&lt;h3 id="redistributor">Redistributor&lt;/h3>
&lt;ul>
&lt;li>å¯åŠ¨/ç¦ç”¨ SGI å’Œ PPI&lt;/li>
&lt;li>è®¾ç½® SGI å’Œ PPI çš„ä¼˜å…ˆçº§&lt;/li>
&lt;li>è®¾ç½® SGI å’Œ PPI çš„è§¦å‘æ–¹å¼&lt;/li>
&lt;li>ä¸º SGI å’Œ PPI åˆ†é…ç»„&lt;/li>
&lt;li>æŽ§åˆ¶ SGI å’Œ PPI çš„ &lt;code>pending&lt;/code> çŠ¶æ€å’Œ &lt;code>active&lt;/code> çŠ¶æ€&lt;/li>
&lt;li>ä¸Žä¹‹é“¾æŽ¥çš„ CPU çš„ç”µæºç®¡ç†.&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å…³äºŽRedistributor å¯„å­˜å™¨éƒ½å«æœ‰ &lt;code>GICR_&lt;/code> å‰ç¼€, é€šè¿‡ &lt;code>memory-mapped&lt;/code> æ–¹å¼è®¿é—®.&lt;/p>
&lt;/blockquote>
&lt;h3 id="cpu-interface">CPU interface&lt;/h3>
&lt;ul>
&lt;li>Acknowledge ä¸€ä¸ªä¸­æ–­&lt;/li>
&lt;li>æ‰§è¡Œ End Of Interrupt&lt;/li>
&lt;li>Deactivate ä¸€ä¸ªä¸­æ–­&lt;/li>
&lt;li>è®¾ç½® CPU çš„ä¼˜å…ˆçº§Mask&lt;/li>
&lt;li>é…ç½®ä¸­æ–­æŠ¢å &lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å…³äºŽ CPU interface å¯„å­˜å™¨æ˜¯ä»¥ &lt;code>ICC_&lt;/code> ä¸ºå‰ç¼€, è¿˜æœ‰ &lt;code>ICV&lt;/code> for vitual interrupt, &lt;code>ICH&lt;/code> for hypervisor configuration.&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸­æ–­çš„çŠ¶æ€è½¬æ¢">ä¸­æ–­çš„çŠ¶æ€è½¬æ¢&lt;/h2>
&lt;p>&lt;img src="./int-lifestyle.png" alt="">&lt;/p>
&lt;ol>
&lt;li>ç”Ÿæˆä¸­æ–­. ä¸­æ–­å¯èƒ½æ¥è‡ªå¤–éƒ¨ä¿¡å·, æˆ–è€…è½¯ä»¶ç”Ÿæˆ(SGI)&lt;/li>
&lt;li>Distribute. IRI è´Ÿè´£ä¸­æ–­çš„åˆ†ç»„, ä¼˜å…ˆçº§å±è”½ç­‰. å°†åˆé€‚çš„ä¸­æ–­å‘é€åˆ°CPU Interface.&lt;/li>
&lt;li>Deliver. CPU interface å°†ä¸­æ–­å‘é€åˆ°è¿žæŽ¥çš„CPU.&lt;/li>
&lt;li>Activate. CPUè¯»å–IARå¯„å­˜å™¨, å³å‘é€ACK. è¯¥ä¸­æ–­çš„çŠ¶æ€è½¬ä¸ºactive.&lt;/li>
&lt;li>Priority drop. å¤„ç†ç¨‹åºç»“æŸä¹‹åŽ, å†™&lt;code>ICC_EOIR&lt;/code>å¯„å­˜å™¨, end of interrupt&lt;/li>
&lt;li>Deactivation. å†™&lt;code>ICC_DIR&lt;/code>å¯„å­˜å™¨æ¸…é™¤ä¸­æ–­çš„activeæ ‡å¿—ä½. ä¸€èˆ¬æ¥è¯´, end of interrupt å’Œ deactivation å¯é…ç½®æˆåŒæ—¶å‘ç”Ÿ.&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;code>ICC_CTLR_ELx.EOImode&lt;/code> ä½æŽ§åˆ¶æ˜¯å¦ end of interrupt åŒæ—¶å¯¼è‡´ deactivation.&lt;/p>
&lt;p>â“ EOI å’Œ deactivated åˆ†å¼€è¿›è¡Œæš‚æ—¶è¿˜ä¸çŸ¥é“åº”ç”¨åœºæ™¯.&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸­æ–­id-intid">ä¸­æ–­ID: INTID&lt;/h2>
&lt;p>INTID æ˜¯ä¸­æ–­çš„æ ‡è¯†ç¬¦, å®ƒçš„æœ€å¤§å€¼æ˜¯&lt;em>å®žçŽ°å®šä¹‰&lt;/em>çš„.&lt;/p>
&lt;p>INTIDæŒ‰ç…§ä¸­æ–­ç±»åž‹åˆ†ç±»çš„, å¯¹ç…§è¡¨å¦‚ä¸‹:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>INTID&lt;/th>
&lt;th>ä¸­æ–­ç±»åž‹&lt;/th>
&lt;th>Note&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>0-15&lt;/td>
&lt;td>SGI&lt;/td>
&lt;td>æœ¬åœ°çš„, ä¸åŒCPUå¯ä½¿ç”¨åŒä¸€ä¸­æ–­å·ä»£è¡¨ä¸åŒä¸­æ–­&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>16-31&lt;/td>
&lt;td>PPI&lt;/td>
&lt;td>æœ¬åœ°çš„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>32-1019&lt;/td>
&lt;td>SPI&lt;/td>
&lt;td>å…¨å±€çš„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1020-1023&lt;/td>
&lt;td>ç‰¹æ®Šä¸­æ–­&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1056-1119&lt;/td>
&lt;td>æ‰©å±•çš„PPI&lt;/td>
&lt;td>æœ¬åœ°çš„&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4096 â€“ 5119&lt;/td>
&lt;td>æ‰©å±•çš„SPI&lt;/td>
&lt;td>å…¨å±€çš„&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="ç‰¹æ®Šä¸­æ–­å·">ç‰¹æ®Šä¸­æ–­å·&lt;/h3>
&lt;blockquote>
&lt;p>These INTIDs do not require an end of interrupt or deactivation.&lt;/p>
&lt;/blockquote>
&lt;p>1020:&lt;/p>
&lt;p>1021:&lt;/p>
&lt;p>1022:&lt;/p>
&lt;p>1023: è¯»&lt;code>ICC_IAR1_EL1&lt;/code> è¿”å›žè¯¥å€¼è¡¨æ˜Žå½“å‰çš„CPUä¸Šæ²¡æœ‰å¾…å¤„ç†çš„ä¸­æ–­.&lt;/p>
&lt;h2 id="ä¸­æ–­åˆ†ç»„">ä¸­æ–­åˆ†ç»„&lt;/h2>
&lt;p>ä¸ºäº†é…åˆ ARMv8 çš„å¼‚å¸¸æ¨¡åž‹å’Œå®‰å…¨æ¨¡åž‹, GICv3 æ”¯æŒä¸ºæ¯ä¸ªä¸­æ–­é…ç½®ä¸åŒçš„ç»„. ä¸åŒç»„çš„ä¸­æ–­åªèƒ½è·¯ç”±åˆ°ç‰¹å®šçš„å¼‚å¸¸ç­‰çº§å’Œå®‰å…¨çŠ¶æ€è¿›è¡Œå¤„ç†.&lt;/p>
&lt;p>å…±åŒ…å«ä¸‰ä¸ªåˆ†ç»„: Gourp 0, Secure Group 1, Non-secure Group 1.&lt;/p>
&lt;ul>
&lt;li>Group 0çš„ä¸­æ–­éœ€è¦åœ¨EL3 å¤„ç†.&lt;/li>
&lt;li>Secure Group1 çš„ä¸­æ–­éœ€è¦åœ¨ Secure EL1 æˆ–è€… Secure EL2(å¦‚æžœå¯ç”¨äº†è™šæ‹ŸåŒ–)å¤„ç†.&lt;/li>
&lt;li>Non-secure Group 1 çš„ä¸­æ–­éœ€è¦åœ¨ Non-secure EL2 or Non-secure EL1 if not using virtualization&lt;/li>
&lt;/ul>
&lt;p>åŒæ—¶, ä¸­æ–­ä½äºŽå“ªä¸ªç»„ä¹Ÿå†³å®šäº†å…¶è§¦å‘çš„æ˜¯FIQè¿˜æ˜¯IRQ. å¯¹äºŽ AArch64 æ¥è¯´, å¯¹åº”å…³ç³»å¯è§ä¸‹è¡¨:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å½“å‰å¼‚å¸¸ç­‰çº§&lt;/th>
&lt;th>Group 0 çš„ä¸­æ–­&lt;/th>
&lt;th>Secure Group 1 çš„ä¸­æ–­&lt;/th>
&lt;th>Non-secure Group 1&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Secure EL1/0/2&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;td>IRQ&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Non-secure EL1/0/2&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;td>IRQ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EL3&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;td>FIQ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>Group 0 çš„ä¸­æ–­, éœ€è¦åœ¨EL3å¤„ç†, å…¶ä¼˜å…ˆçº§è¾ƒé«˜, æ‰€ä»¥å‡å±žäºŽ FIQ&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸­æ–­è·¯ç”±">ä¸­æ–­è·¯ç”±&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>PPIs are routed directly from the source to the local Redistributor .&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SPIs are routed from the source through the Distributor to the target Redistributor and the associated CPU interface.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SGIs are generated by software through the CPU interface and Redistributor. They are then routed through the Distributor to one or more target Redistributors and the associated CPU interfaces&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="what-is-affinity-routing">What is Affinity Routing?&lt;/h3>
&lt;p>Affinity routing æ˜¯ä¸€ç§åŸºäºŽåœ°å€çš„æ ‡è¯†å¤šä¸ªCPUçš„æ–¹æ³•, ç”¨äºŽä¸­æ–­çš„è·¯ç”±. Affinity value ç”±4ä¸ª8bitå­—æ®µç»„æˆ, ç»“æž„æ˜¯&lt;code>aff3.aff2.aff1.aff0&lt;/code>.&lt;/p>
&lt;p>ç”±äºŽ PPI çš„ä¸­æ–­æºæ˜¯ç›´è¿ž Redistributor çš„, æ‰€ä»¥ä»… SPI å’Œ SGI å¯ä»¥ä½¿ç”¨ Affinity routing.&lt;/p>
&lt;ul>
&lt;li>å¯¹äºŽ SPI, ç›®æ ‡CPUçš„ affinity value é€šè¿‡&lt;code>GICD_IROUTER&amp;lt;n&amp;gt;&lt;/code> è®¾ç½®.&lt;/li>
&lt;li>å¯¹äºŽ SGI, åœ¨ç”Ÿæˆæ—¶å³å¯åŒæ—¶é…ç½®, è¯¦è§ &lt;code>ICC_SGI0R_EL1&lt;/code> å’Œ &lt;code>ICC_SGI1R_EL1&lt;/code>.&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>Aff3.Aff2.Aff1.Aff0 ä¸Ž Aff3.Aff2.Aff2.TargetList&lt;/p>
&lt;p>å¯¹äºŽSPI, ç›®æ ‡çš„CPUåªèƒ½æ˜¯ä¸€ä¸ª, æ•…&lt;code>Aff0&lt;/code>è¡¨ç¤ºè¯¥CPUçš„ID. è€ŒSGIå¯ä»¥é…ç½®åŒæ—¶å‘ç»™å¤šä¸ªCPU, æ‰€ä»¥&lt;code>TargetList&lt;/code>æ˜¯åŸºäºŽä½æ“ä½œçš„, æ¯ä¸ªä½è¡¨ç¤ºä¸€ä¸ªCPU.&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç¼–ç¨‹æŒ‡å¯¼">ç¼–ç¨‹æŒ‡å¯¼&lt;/h2>
&lt;h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–&lt;/h3>
&lt;p>ç”±äºŽ &lt;em>Distributor&lt;/em> æ•´ä¸ªç³»ç»Ÿå…±äº«çš„, æ‰€ä»¥å¿…é¡»åœ¨å…¶ä»–æ ¸å¯åŠ¨ä¹‹å‰, ç”±ä¸»æ ¸å®Œæˆåˆå§‹åŒ–. ç„¶åŽå½“æ‰€æœ‰æ ¸éƒ½å¯åŠ¨åŽ, å„è‡ªå®Œæˆå„è‡ª &lt;em>Redistributor&lt;/em> å’Œ &lt;em>CPU interface&lt;/em> çš„åˆå§‹åŒ–å·¥ä½œ.&lt;/p>
- https://wangloo.github.io/posts/armv8/gicv3/ - @2019 Notepadium.</description></item><item><title>Useful Shell Script Examples</title><link>https://wangloo.github.io/posts/shell-script/</link><pubDate>Wed, 20 Jul 2022 11:54:13 +0800</pubDate><guid>https://wangloo.github.io/posts/shell-script/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/shell-script/ -&lt;h2 id="åˆ¤æ–­æ‰§è¡Œè„šæœ¬æ—¶å¸¦çš„å‚æ•°">åˆ¤æ–­æ‰§è¡Œè„šæœ¬æ—¶å¸¦çš„å‚æ•°&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#111">$#&lt;/span> -ne &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#00a8c8">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;ONE parameter is needed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#111">$1&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;build&amp;#39;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#00a8c8">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># do something&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">elif&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#111">$1&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;run&amp;#39;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#00a8c8">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># do something&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">elif&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#111">$1&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;gdb&amp;#39;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#00a8c8">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># do something&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;Not supported command&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="è‡ªåŠ¨æ‹·è´æ–‡ä»¶åˆ°sd-card">è‡ªåŠ¨æ‹·è´æ–‡ä»¶åˆ°SD Card&lt;/h2>
&lt;blockquote>
&lt;p>TODO&lt;/p>
&lt;ol>
&lt;li>æ·»åŠ è¿›åº¦æ¡&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">sd_path&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">$(&lt;/span>find /media/&lt;span style="color:#111">$USER&lt;/span> -maxdepth &lt;span style="color:#ae81ff">1&lt;/span> -type d -name &lt;span style="color:#d88200">&amp;#34;*-*&amp;#34;&lt;/span>&lt;span style="color:#00a8c8">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#f92672">[&lt;/span> ! -d &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">sd_path&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sleep &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;waiting for inserting SD-Card&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;SD-Card is inserted&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cp ./output/kernel/kernel.bin &lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">sd_path&lt;/span>&lt;span style="color:#d88200">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;Copy completely&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="èŽ·å–æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯å¯é€’å½’è¿›å…¥å­ç›®å½•">èŽ·å–æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯(å¯é€’å½’è¿›å…¥å­ç›®å½•)&lt;/h2>
&lt;p>èŽ·å–&lt;code>dir&lt;/code>è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯, è¿™é‡ŒèŽ·å–çš„æ˜¯æ–‡ä»¶çš„&lt;strong>å®Œæ•´è·¯å¾„&lt;/strong>.&lt;/p>
&lt;blockquote>
&lt;p>TODO&lt;/p>
&lt;ol>
&lt;li>æ“ä½œæ•°ç»„ä¸‹æ ‡çš„æ–¹å¼å¯èƒ½æœ‰å¾…æ”¹è¿›? &lt;code>filenum&lt;/code>æ„Ÿè§‰æ²¡å¿…è¦, æš‚æ—¶è¿˜ä¸ä¼šæ”¹&lt;/li>
&lt;li>é€šè¿‡æ‹¼æŽ¥èŽ·å¾—æ–‡ä»¶ä¿¡æ¯(è·¯å¾„)çš„æ–¹å¼ä¹Ÿæœ‰ç‚¹æ€ªå¼‚&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dir&lt;/span>&lt;span style="color:#f92672">=&lt;/span>./
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">files&lt;/span>&lt;span style="color:#f92672">=()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">filenum&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> getfiles&lt;span style="color:#f92672">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> file in &lt;span style="color:#d88200">`&lt;/span>ls &lt;span style="color:#111">$dir&lt;/span>&lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -d &lt;span style="color:#111">$file&lt;/span> &lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#00a8c8">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cd&lt;/span> &lt;span style="color:#111">$file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> getfiles
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cd&lt;/span> ..
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> files&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">$filenum&lt;/span>&lt;span style="color:#f92672">]=&lt;/span>&lt;span style="color:#00a8c8">$(&lt;/span>&lt;span style="color:#111">pwd&lt;/span> &lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#00a8c8">)&lt;/span>/&lt;span style="color:#00a8c8">$(&lt;/span>basename &lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#00a8c8">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># echo file=$(pwd $file)/$(basename $file)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">let&lt;/span> filenum++
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å¸¦é¢œè‰²çš„è¾“å‡º">å¸¦é¢œè‰²çš„è¾“å‡º&lt;/h2>
&lt;p>ä½¿ç”¨&lt;a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escape code&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>Black 0;30 Dark Gray 1;30
Red 0;31 Light Red 1;31
Green 0;32 Light Green 1;32
Brown/Orange 0;33 Yellow 1;33
Blue 0;34 Light Blue 1;34
Purple 0;35 Light Purple 1;35
Cyan 0;36 Light Cyan 1;36
Light Gray 0;37 White 1;37
&lt;/code>&lt;/pre>&lt;p>Code example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">RED&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;\033[0;31m&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">GREEN&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;\033[0;32m&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">YELLOW&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;\033[1;33m&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">BLUE&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;\033[0;34m&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">CYAN&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;\033[0;36m&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;\033[0m&amp;#39;&lt;/span> &lt;span style="color:#75715e"># No Color&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">YELLOW&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">HELLO, YELLOW&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">GREEN&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">HELLO, GREEN&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">RED&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">HELLO, RED&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">BLUE&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">HELLO, BLUE&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">CYAN&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">HELLO, CYAN&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#########################################################&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># generic functions #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> ERROR&lt;span style="color:#f92672">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">RED&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">[error] &lt;/span>&lt;span style="color:#111">$*&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">exit&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> INFO &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">BLUE&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">[info] &lt;/span>&lt;span style="color:#111">$*&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> WARN &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">YELLOW&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">[warn] &lt;/span>&lt;span style="color:#111">$*&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> LOG &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">echo&lt;/span> -e &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">GREEN&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">[log] &lt;/span>&lt;span style="color:#111">$*&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#111">NC&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span style="color:#111">$LOG&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>INFO &lt;span style="color:#d88200">&amp;#34;This is an infomation&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WARN &lt;span style="color:#d88200">&amp;#34;This is a log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/shell-script/ - @2019 Notepadium.</description></item><item><title>Bit Operation Hacks</title><link>https://wangloo.github.io/posts/codestyle/bit-operation-hacks/</link><pubDate>Sun, 03 Jul 2022 09:44:13 +0800</pubDate><guid>https://wangloo.github.io/posts/codestyle/bit-operation-hacks/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/codestyle/bit-operation-hacks/ -&lt;h2 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º2çš„å¹‚">åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º2çš„å¹‚&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">v&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">v&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">v&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;v is a power of 2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;v is not a power of 2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡">ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡&lt;/h2>
&lt;p>ä¾ç„¶æ˜¯åˆ©ç”¨&lt;code>v &amp;amp; (v -1)&lt;/code>çš„è¿ç®—ç»“æžœä¼šå°†vçš„æœ€ä½Žä½çš„&lt;code>1&lt;/code>(å¦‚æžœæœ‰çš„è¯)ç½®&lt;code>0&lt;/code>.&lt;/p>
&lt;p>å¾ªçŽ¯æ‰§è¡Œæ­¤æ“ä½œå°±å¯ç»Ÿè®¡vä¸­&lt;code>1&lt;/code>çš„æ•°é‡.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">numberof1&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">v&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">count&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">v&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">count&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">v&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">v&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">v&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">count&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å°†ä¸€ä¸ªæ•°å‘ä¸Šå–æ•´ä¸º2çš„å¹‚">å°†ä¸€ä¸ªæ•°å‘ä¸Šå–æ•´ä¸º2çš„å¹‚&lt;/h2>
&lt;p>ç”¨ä¸€ä¸ª&lt;code>1&lt;/code>ä¸€ç›´å·¦ç§», ç›´åˆ°æ¯”è¿™ä¸ªæ•°å¤§ä¸ºæ­¢.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">uint32_t&lt;/span> &lt;span style="color:#75af00">roundup_pow_op_two&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">uint32_t&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">uint32_t&lt;/span> &lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">ret&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å‘ä¸Šå‘ä¸‹å¯¹é½-æ£€æŸ¥æ˜¯å¦å¯¹é½">å‘ä¸Š/å‘ä¸‹å¯¹é½, æ£€æŸ¥æ˜¯å¦å¯¹é½&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/* uintptr_t ä»£è¡¨æŒ‡é’ˆçš„ä½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * åŠ uintptr_tè½¬æ¢çš„åŽŸå› æ˜¯: (void *)ä¸èƒ½è¿›è¡Œè¿ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define IS_ALIGNED(X, align) (((uintptr_t)(const void *)(X)) % (align) == 0)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define ALIGN_UP(X, align) (((X) + ((align) - 1)) &amp;amp; ~((align) - 1))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define ALIGN_DOWN(x, align) ((X) &amp;amp; ~((align) - 1))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define X (0x12345675)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define align (1 &amp;lt;&amp;lt; 2)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">v&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">IS_ALIGNED&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">v&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Given X(0x%x) is not align to 0x%08x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;After align up, new X = 0x%x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ALIGN_UP&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;After align down, new X = 0x%x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ALIGN_DOWN&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Give X(0x%x) is aligned to 0x%08x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;After align up, new X = 0x%x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ALIGN_UP&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;After align down, new X = 0x%x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ALIGN_DOWN&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">X&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">align&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="æ£€æŸ¥ä¸¤ä¸ªæœ‰ç¬¦å·æ•°æ˜¯å¦å¼‚å·">æ£€æŸ¥ä¸¤ä¸ªæœ‰ç¬¦å·æ•°æ˜¯å¦å¼‚å·&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">^&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;They have opposite signs&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;They have same signs&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å¤§å°ç«¯è½¬æ¢">å¤§å°ç«¯è½¬æ¢&lt;/h2>
&lt;p>Â &lt;/p>
&lt;h2 id="å¯¹æŸä¸ªä½çš„getsetclearæ“ä½œ">å¯¹æŸä¸ªä½çš„get/set/clearæ“ä½œ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define GET_BIT(x, bit) ( ((x) &amp;amp; (1ULL &amp;lt;&amp;lt; (bit))) &amp;gt;&amp;gt; (bit) )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define SET_BIT(x, bit) ( (x) |= (1ULL &amp;lt;&amp;lt; (bit)) )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define CLEAR_BIT(x, bit) ( (x) &amp;amp;= ~(1ULL &amp;lt;&amp;lt; (bit)) )
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Release note:&lt;/p>
&lt;ol>
&lt;li>æ·»åŠ å¯¹&lt;code>unsigned long long&lt;/code>é•¿åº¦çš„æ”¯æŒ&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="sign-extending-from-a-varaiable-bit-width">Sign extending from a varaiable bit-width&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">bits&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// number of bits representing the number in x
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0xFFC1&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// ready to get sign-extended
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">rst&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// resulting sign-extended number
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#111">mask&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1U&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">bits&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// mask can be pre-computed if bits if fixed.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#ae81ff">1U&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#111">bits&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// cut x if it holds more bits
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">rst&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">^&lt;/span> &lt;span style="color:#111">mask&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#111">mask&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// excellent trick!
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;INPUT: 0x%x, RESULT: 0x%x&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">rst&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="å­—ç¬¦å­—ç¬¦æ•°ç»„çš„å¤§å°å†™è½¬æ¢">å­—ç¬¦/å­—ç¬¦æ•°ç»„çš„å¤§å°å†™è½¬æ¢&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define TO_LOWER(c) (unsigned char)((c &amp;gt;= &amp;#39;A&amp;#39; &amp;amp;&amp;amp; c &amp;lt;= &amp;#39;Z&amp;#39;) ? (c | 0x20) : c)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define TO_UPPER(c) (unsigned char)((c &amp;gt;= &amp;#39;a&amp;#39; &amp;amp;&amp;amp; c &amp;lt;= &amp;#39;z&amp;#39;) ? (c &amp;amp; ~0x20) : c)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define TO_LOWER_STR(s, len) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for (int i = 0; i &amp;lt; len &amp;amp;&amp;amp; s[i] != &amp;#39;\0&amp;#39;; i++) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> s[i] = TO_LOWER(s[i]); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> } \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define TO_UPPER_STR(s, len) {\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> for (int i = 0; i &amp;lt; len &amp;amp;&amp;amp; s[i] != &amp;#39;\0&amp;#39;; i++) { \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> s[i] = TO_UPPER(s[i]); \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> } \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://wangloo.github.io/posts/codestyle/bit-operation-hacks/ - @2019 Notepadium.</description></item><item><title>Stack and Heap</title><link>https://wangloo.github.io/posts/os-learning/stack-and-heap/</link><pubDate>Tue, 28 Jun 2022 16:41:54 +0800</pubDate><guid>https://wangloo.github.io/posts/os-learning/stack-and-heap/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/os-learning/stack-and-heap/ -&lt;p>Â &lt;/p>
&lt;h2 id="å †çš„å«ä¹‰">å †çš„å«ä¹‰&lt;/h2>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“&lt;code>malloc&lt;/code>åŠ¨æ€ç”³è¯·çš„å˜é‡æ˜¯å­˜æ”¾åœ¨å †ä¸­. æ‰€ä»¥ç›¸æ¯”æ ˆæ¥è¯´, å †æ˜¯åŠ¨æ€çš„.&lt;/p>
&lt;p>å †å æ®è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„å¤§éƒ¨åˆ†, æˆ‘ä»¬å¯èƒ½é€šè¿‡å †æ¥ç”³è¯·&lt;code>1GB&lt;/code>çš„æ•°ç»„, ä½†æ˜¯æ ˆé€šå¸¸ä¸è¡Œ
, å¤§å¤šä¹Ÿå°±å‡ å…†çš„ç©ºé—´.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å †ç©ºé—´çš„ç®¡ç†">å †ç©ºé—´çš„ç®¡ç†&lt;/h2>
&lt;p>è¿›ç¨‹ä¸­å †ç©ºé—´çš„ç®¡ç†æ˜¯&lt;code>è¿è¡Œåº“&lt;/code>è´Ÿè´£çš„, åœ¨Linuxä¸­æ˜¯&lt;code>GLIBC&lt;/code>.&lt;/p>
&lt;p>è¿è¡Œåº“åœ¨åˆå§‹åŒ–æ—¶ä¼šåƒæ“ä½œç³»ç»Ÿç”³è¯·ä¸€å¤§å—çš„å †ç©ºé—´, å†ä¸ºæ¯ä¸ªè¿›è¡Œåˆ†åˆ«åˆ†é…éœ€æ±‚. å½“ç„¶,
å¦‚æžœæŸäº›ç¨‹åºçš„éœ€æ±‚è¿‡å¤§, è¿è¡Œåº“ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>mmap&lt;/code>ç³»ç»Ÿè°ƒç”¨ç›´æŽ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·, ç„¶åŽ
è¿”å›žç»™ç”¨æˆ·è¿›ç¨‹.&lt;/p>
&lt;blockquote>
&lt;p>GLIBCçš„&lt;code>malloc&lt;/code>å‡½æ•°çš„å¤„ç†æ–¹å¼æ˜¯: å¯¹äºŽå°äºŽ&lt;code>128KB&lt;/code>çš„ç”³è¯·, ä¼šä»Žè¿è¡Œåº“&amp;quot;æ‰¹å‘çš„&amp;quot;å †ç©ºé—´
é‡Œåˆ†å‡ºä¸€å—æ¥; ä½†è‹¥ç”³è¯·çš„ç©ºé—´è¿‡å¤§, åˆ™ä½¿ç”¨&lt;code>mmap&lt;/code>ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºåŒ¿åç©ºé—´åˆ†é…ç»™ç”¨æˆ·.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>Linuxä¸­è™šæ‹Ÿåœ°å€å—(VMA)çš„ç®¡ç†ä½¿ç”¨äº†çº¢é»‘æ ‘, å¯ä»¥ç”¨äºŽè¿è¡Œåº“ç®¡ç†è‡ªå·±å‘æ“ä½œç³»ç»Ÿ
&amp;ldquo;æ‰¹å‘&amp;quot;çš„å †ç©ºé—´. ä½¿å¾—ç”¨æˆ·ç¨‹åºåŠ¨æ€ç”³è¯·å’Œé‡Šæ”¾å†…å­˜æ€§èƒ½æé«˜.&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/os-learning/stack-and-heap/ - @2019 Notepadium.</description></item><item><title>åŠ¨æ€é“¾æŽ¥</title><link>https://wangloo.github.io/posts/os-learning/dynamic-link/</link><pubDate>Sun, 26 Jun 2022 19:50:45 +0800</pubDate><guid>https://wangloo.github.io/posts/os-learning/dynamic-link/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/os-learning/dynamic-link/ -&lt;h2 id="é™æ€é“¾æŽ¥å¸¦æ¥çš„é—®é¢˜">é™æ€é“¾æŽ¥å¸¦æ¥çš„é—®é¢˜&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>åƒæ˜¯&lt;code>libc&lt;/code>è¿™ç§å‡ ä¹Žæ¯ä¸ªç¨‹åºéƒ½è¦ç”¨åˆ°çš„åº“, å¦‚æžœæ˜¯é™æ€çš„, é‚£ä¹ˆä¸ä»…æ„å¤–ç€æ¯ä¸ªç¨‹åºçš„
å¯æ‰§è¡Œæ–‡ä»¶å¾ˆå¤§, æµªè´¹ç£ç›˜ç©ºé—´. å¹¶ä¸”å½“ç¨‹åºåŠ è½½åˆ°å†…å­˜æ—¶, å¯èƒ½è®¸å¤šç¨‹åºéƒ½ä¼šç”¨åˆ°&lt;code>printf&lt;/code>
, ä½¿å¾—å†…å­˜ä¸­ä¼šå­˜åœ¨å¥½å¤šä»½çš„&lt;code>printf&lt;/code>æºç .&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»´æŠ¤å’Œæ›´æ–°éš¾. ä¸€æ—¦é™æ€é“¾æŽ¥çš„å…¶ä¸­ä¸€ä¸ªç›®æ ‡æ–‡ä»¶æ›´æ–°, æ‰€æœ‰çš„å¯æ‰§è¡Œç¨‹åºéƒ½è¦é‡æ–°é“¾æŽ¥.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸æ»¡è¶³å±€éƒ¨æ€§åŽŸç†. ä¸Šé¢æåˆ°, å†…å­˜ä¸­åŒæ—¶å­˜åœ¨å¤šä»½çš„&lt;code>printf&lt;/code>æºç ä¼šç ´å&lt;em>å±€éƒ¨æ€§åŽŸç†&lt;/em>çš„.
æ˜¾ç„¶å¦‚æžœæ‰€æœ‰çš„ç¨‹åºå…±äº«ä¸€ä»½&lt;code>printf&lt;/code>æºç çš„æƒ³æ³•æ›´å¥½. å³åŠ¨æ€åŠ è½½.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ç§»æ¤æ€§å·®. é™æ€é“¾æŽ¥, åªè¦æœ‰ä¸€ä¸ªä¾èµ–ç›®æ ‡æ–‡ä»¶çš„å®žçŽ°ä¸åŒ, è½¯ä»¶åŽ‚å•†å°±å¾—ä¸“é—¨å‘å¸ƒä¸€ä¸ª
ç‰ˆæœ¬. è€ŒåŠ¨æ€é“¾æŽ¥åˆ™ä¿¡èµ–å®¢æˆ·ç”µè„‘ä¸Šçš„&lt;em>åŠ¨æ€åº“&lt;/em>, ç›¸å½“äºŽä¸€ä¸ªä¸­é—´å±‚.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Â &lt;/p>
&lt;h2 id="åŠ¨æ€é“¾æŽ¥çš„è¿‡ç¨‹">åŠ¨æ€é“¾æŽ¥çš„è¿‡ç¨‹&lt;/h2>
&lt;p>å¯¹æ¯”é™æ€é“¾æŽ¥ä½¿ç”¨&lt;code>ld&lt;/code>é“¾æŽ¥å™¨åœ¨ç¼–è¯‘åŽå³æ‰§è¡Œé“¾æŽ¥, åŠ¨æ€é“¾æŽ¥åˆ™æ˜¯å°†é“¾æŽ¥è¿‡ç¨‹æŽ¨è¿Ÿåˆ°&lt;strong>è¿è¡Œæ—¶&lt;/strong>,
å³è£…è½½åˆ°å†…å­˜æ—¶.&lt;/p>
&lt;p>è¿™æ ·, é“¾æŽ¥å™¨åœ¨é“¾æŽ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æ—¶å°±æœ‰ä¸¤ç§åšæ³•:&lt;/p>
&lt;ul>
&lt;li>å¯¹äºŽé™æ€ç¬¦å·, æŒ‰ç…§é™æ€é“¾æŽ¥çš„è§„åˆ™è¿›è¡Œ&lt;em>åœ°å€å¼•ç”¨é‡å®šä½&lt;/em>&lt;/li>
&lt;li>å¯¹äºŽåŠ¨æ€ç¬¦å·, é“¾æŽ¥å™¨åˆ™ä»…æ ‡è®°å…¶ä¸ºåŠ¨æ€é“¾æŽ¥ä¸­çš„ç¬¦å·, ä¸è¿›è¡Œå¤„ç†. è€Œæ˜¯ç­‰åˆ°è£…è½½æ—¶ç”±
ä¸“é—¨çš„&lt;em>åŠ¨æ€é“¾æŽ¥å™¨&lt;/em>æ¥å®ŒæˆåŠ¨æ€ç¬¦å·çš„é“¾æŽ¥å·¥ä½œ.&lt;/li>
&lt;/ul>
&lt;p>â‰ï¸ é“¾æŽ¥å™¨å¦‚ä½•ç¡®å®šä¸€ä¸ªç¬¦å·æ˜¯é™æ€çš„oråŠ¨æ€çš„?&lt;/p>
&lt;p>åœ¨åŠ¨æ€å…±äº«å¯¹è±¡(&lt;em>.so)ä¸­ä¿å­˜äº†å®Œæ•´çš„&lt;/em>åŠ¨æ€ç¬¦å·è¡¨*, è¡¨ä¸­å­˜åœ¨çš„ç¬¦å·å³ä¸ºåŠ¨æ€çš„, å¦åˆ™ä¸ºé™æ€.&lt;/p>
&lt;blockquote>
&lt;p>Linuxçš„Cè¯­è¨€è¿è¡Œåº“&lt;code>glib&lt;/code>çš„åŠ¨æ€é“¾æŽ¥ç‰ˆæœ¬å«&lt;code>libc.so&lt;/code>. å®ƒåœ¨å¤–å­˜ä¸Šåªä¿å­˜ä¸€ä»½, æ‰€æœ‰çš„ç¨‹åº
éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒ. æ‰€ä»¥åƒä¸‡ä¸è¦åˆ æŽ‰å®ƒ.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>åŠ¨æ€é“¾æŽ¥æœ‰ä¸€å®šçš„æ€§èƒ½æŸå¤±, å› ä¸ºæ¯æ¬¡è¿è¡Œç¨‹åºæ—¶éƒ½è¦é‡æ–°é“¾æŽ¥, å¹¶ä¸åƒé™æ€é“¾æŽ¥æ˜¯ä¸€åŠ³æ°¸é€¸çš„.
ä¹Ÿæœ‰ä¾‹å¦‚&lt;code>å»¶è¿Ÿç»‘å®š&lt;/code>å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–çš„æ–¹æ³•, å¤§æ¦‚ä»…æœ‰5%çš„æŸè€—, ä¸Žå¸¦æ¥çš„ä¾¿åˆ©ç›¸æ¯”å¯ä»¥å¿½ç•¥ä¸è®¡.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="åœ°å€æ— å…³ä»£ç -pic">åœ°å€æ— å…³ä»£ç  PIC&lt;/h2>
&lt;p>GCCç”ŸæˆåŠ¨æ€åº“æ—¶éœ€è¦æ·»åŠ å‚æ•°&lt;code>-fPIC&lt;/code>, å«ä¹‰å°±æ˜¯ç”Ÿæˆåœ°å€æ— å…³ç &lt;/p>
&lt;p>åœ°å€æ— å…³ç çš„å«ä¹‰æ˜¯ä»£ç ä¸­&lt;strong>ä¸åŒ…å«ä»»ä½•çš„ç»å¯¹åœ°å€å¼•ç”¨&lt;/strong>, å…¨éƒ½æ˜¯&lt;strong>ç›¸å¯¹åœ°å€&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>å¯¹äºŽ&lt;strong>æ¨¡å—å†…&lt;/strong>çš„è·³è½¬/æ•°æ®å¼•ç”¨, ä½¿ç”¨ç›¸å¯¹çš„è·³è½¬/åŠ è½½æŒ‡ä»¤. ä¾‹å¦‚ARMæŒ‡ä»¤é›†ä¸­çš„&lt;code>B&lt;/code>, &lt;code>ADR&lt;/code>, ç»è¿‡æ±‡ç¼–å™¨ä¹‹åŽ, ç›®æ ‡çš„åœ°å€éƒ½ä¼šè½¬ä¸ºç›¸å¯¹äºŽè¯¥æŒ‡ä»¤(PC)çš„åç§».&lt;/li>
&lt;li>å¯¹äºŽ&lt;strong>æ¨¡å—é—´&lt;/strong>çš„è·³è½¬/æ•°æ®å¼•ç”¨, å€Ÿç”¨&lt;em>GOTè¡¨&lt;/em>æ¥é—´æŽ¥å®žçŽ°åœ°å€æ— å…³.&lt;/li>
&lt;/ul>
&lt;p>è€Œå¦‚æžœè¯¥åŠ¨æ€åº“ä¸­å…¨éƒ¨ä½¿ç”¨ç›¸å¯¹åœ°å€, é‚£ä¹ˆåŠ è½½æ—¶ä¹Ÿå°±ä¸éœ€è¦è¿›è¡Œé‡å®šä½, å³æ‰€æœ‰çš„ç¨‹åºéƒ½å¯ä»¥
å…±äº«è¿™äº›åœ°å€æ— å…³ä»£ç .&lt;/p>
&lt;blockquote>
&lt;p>ä¸Šé¢è¯´PICçš„åŠ¨æ€åº“ä¸éœ€è¦é‡å®šä½å…¶å®žæ˜¯é”™è¯¯çš„, åªä¸è¿‡å®ƒçš„é‡å®šä½è¿‡ç¨‹ä¸éœ€è¦ä¿®æ”¹ä»£ç æ®µ,
è€Œæ˜¯è®¾ç½®äº†ä¸€ä¸ªæ”¾ç½®åœ¨æ•°æ®æ®µçš„&lt;em>GOT&lt;/em>è¡¨æ¥å®žçŽ°ä»£ç æ®µéƒ¨åˆ†çš„åœ°å€æ— å…³ç‰¹æ€§.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>çŽ°åœ¨è²Œä¼¼GCC ARMç‰ˆæœ¬åœ¨ç¼–è¯‘åŠ¨æ€åº“æ—¶å¼ºåˆ¶ä½¿ç”¨-fPICé€‰é¡¹, å¦åˆ™ä¼šæŠ¥é”™. å¯¹æ­¤æˆ‘ä¸æ˜¯
éžå¸¸ç¡®å®š!&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ä¸€èˆ¬æ¥è¯´, ä¸å°†ä¸»ç¨‹åºç¼–è¯‘ä¸ºåœ°å€æ— å…³ç . å› ä¸ºä¸»ç¨‹åºä¸éœ€è¦å…±äº«, è€Œä¸”åœ°å€æ— å…³ç çš„è°ƒç”¨
éœ€è¦ä¸¤ä¸ªæŒ‡ä»¤: &lt;code>è®¡ç®—åœ°å€&lt;/code> + &lt;code>è·³è½¬&lt;/code>. å¤šäº†ä¸€æ­¥æ ¹æ®åç§»å¾—åˆ°ç»å¯¹åœ°å€.&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/os-learning/dynamic-link/ - @2019 Notepadium.</description></item><item><title>ELF æ–‡ä»¶çš„é“¾æŽ¥ä¸ŽåŠ è½½</title><link>https://wangloo.github.io/posts/os-learning/elf-format/</link><pubDate>Mon, 20 Jun 2022 16:21:27 +0800</pubDate><guid>https://wangloo.github.io/posts/os-learning/elf-format/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/os-learning/elf-format/ -&lt;h2 id="elf-is-a-file-format">&lt;code>ELF&lt;/code> is a file format&lt;/h2>
&lt;p>Files in &lt;code>ELF&lt;/code> format includes:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>å®žä¾‹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Relocatable File&lt;/td>
&lt;td>è¿™äº›æ–‡ä»¶åŒ…å«äº†ä»£ç å’Œdata, å¯ä»¥è¢«ç”¨æ¥é“¾æŽ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«ç›®æ ‡æ–‡ä»¶.&lt;/td>
&lt;td>&lt;code>.o&lt;/code>, &lt;code>.a&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Executable File&lt;/td>
&lt;td>ç›´æŽ¥å¯æ‰§è¡Œçš„æ–‡ä»¶&lt;/td>
&lt;td>&lt;code>/bin/ls&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Object File&lt;/td>
&lt;td>Including code and data. é“¾æŽ¥å™¨å¯å°†å…¶ä¸Žå…¶ä»–Relocatable Fileæˆ–Shared Object Fileç»“åˆ, ç”Ÿæˆæ–°çš„ç›®æ ‡æ–‡ä»¶. åŠ¨æ€é“¾æŽ¥å™¨å¯å°†å…¶ä¸ŽExecutable Fileç»“åˆ, ä½œä¸ºè¿›ç¨‹æ˜ åƒçš„ä¸€éƒ¨åˆ†æ¥è¿è¡Œ.&lt;/td>
&lt;td>&lt;code>.so&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Core Dump File&lt;/td>
&lt;td>Restore critical infomation when process is terminated unexpectedly&lt;/td>
&lt;td>&lt;code>core dump&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;blockquote>
&lt;p>ðŸ“Œ &lt;code>file&lt;/code> command in Linux can output the format of a file.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="elf-æ–‡ä»¶ç»„æˆçš„ç»“æž„">ELF æ–‡ä»¶ç»„æˆçš„ç»“æž„&lt;/h2>
&lt;pre tabindex="0">&lt;code>+---------------------------------+
| ELF Header | åŒ…å«æè¿°æ•´ä¸ªELFçš„åŸºæœ¬ä¿¡æ¯, å¦‚ç‰ˆæœ¬, å…¥å£åœ°å€...
+---------------------------------+
| .text |
+---------------------------------+
| .data |
+---------------------------------+ ç´§æŽ¥ç€æ˜¯å„ä¸ªæ®µ
| .bss |
+---------------------------------+
| ... |
| other sections |
+---------------------------------+
| | æ®µè¡¨: ä¸Žæ®µç›¸å…³æœ€é‡è¦çš„ç»“æž„
| Section Header table | æè¿°äº†æ¯ä¸ªæ®µçš„name, length, authority...
| |
+---------------------------------+
| String tables |
| Symbol tables |
+---------------------------------+
&lt;/code>&lt;/pre>&lt;p>Â &lt;/p>
&lt;h2 id="åˆ†æželfæ–‡ä»¶çš„å·¥å…·">åˆ†æžELFæ–‡ä»¶çš„å·¥å…·&lt;/h2>
&lt;h3 id="1-objdump">1. objdump&lt;/h3>
&lt;h3 id="2-readelf">2. readelf&lt;/h3>
&lt;p>Â &lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆç›®æ ‡æ–‡ä»¶ä¸­ä»£ç å’Œæ•°æ®è¦åˆ†å¼€æ”¾">ä¸ºä»€ä¹ˆç›®æ ‡æ–‡ä»¶ä¸­ä»£ç å’Œæ•°æ®è¦åˆ†å¼€æ”¾?&lt;/h2>
&lt;p>ä¸€æ–¹é¢, ç¨‹åºè¢«åŠ è½½è¿›å†…å­˜åŽ, ä»£ç æ®µå’Œæ•°æ®æ®µåˆ†åˆ«è¢«æ˜ å°„åˆ°&lt;strong>ä¸¤ä¸ªvirtual memory region&lt;/strong>.
é€šè¿‡MMUçš„æ”¯æŒ, å¯ä»¥å°†ä»£ç æ®µçš„åŒºåŸŸè®¾ç½®ä¸ºåªè¯», é˜²æ­¢æ¶æ„ç¯¡æ”¹.&lt;/p>
&lt;p>å¦ä¸€æ–¹é¢, å½“ä¸‹CPU Cacheå¤šåˆ’åˆ†ä¸º&lt;em>Instruction Cache&lt;/em>å’Œ&lt;em>Data Cache&lt;/em>, å†é…åˆäº’ç›¸ç‹¬ç«‹çš„
åœ°å€åŒºåŸŸèƒ½å¤Ÿæé«˜&lt;strong>å±€éƒ¨æ€§åŽŸç†&lt;/strong>çš„æ•ˆæžœ.&lt;/p>
&lt;p>æœ€åŽ, ä»£ç æ®µå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«(ä¾‹å¦‚éƒ½è°ƒç”¨åŒä¸€å¤–éƒ¨å‡½æ•°), èŠ‚çœå†…å­˜ç©ºé—´.&lt;/p>
&lt;blockquote>
&lt;p>é’ˆå¯¹åµŒå…¥å¼è®¾å¤‡, å¦‚æžœå†…å­˜ç©ºé—´ä¸å¤Ÿå¤§, åªè¯»çš„ä»£ç æ®µå¯å­˜æ”¾åœ¨ROMä¸­&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="å…³äºŽé™æ€åº“">å…³äºŽé™æ€åº“&lt;/h2>
&lt;p>ä¸€ä¸ªé™æ€åº“å¯ä»¥ç®€å•çš„çœ‹ä½œæ˜¯ a set of object file.&lt;br>
è¿™äº› object file å¯èƒ½åŒ…æ‹¬: è¾“å…¥è¾“å‡ºç›¸å…³çš„&lt;code>printf.o&lt;/code>, &lt;code>scanf.o&lt;/code>, æ—¥æœŸæ—¶é—´ç›¸å…³çš„&lt;code>time.o&lt;/code>, &lt;code>date.o&lt;/code>ç­‰.&lt;/p>
&lt;p>â“ ä¸ºä»€ä¹ˆä¸ç›´æŽ¥æä¾›è¿™äº›&lt;em>ç›®æ ‡æ–‡ä»¶&lt;/em>å‘¢?&lt;/p>
&lt;p>è¿™äº›&lt;strong>é›¶æ•£çš„&lt;/strong>æ–‡ä»¶è‹¥ç›´æŽ¥æä¾›ç»™ä½¿ç”¨è€…, å¾ˆå¤§ç¨‹åº¦ä¸Šé€ æˆæ–‡ä»¶ä¼ è¾“, ç®¡ç†ç­‰æ–¹é¢çš„ä¸ä¾¿.&lt;br>
äºŽæ˜¯äººä»¬é€šå¸¸ä½¿ç”¨&lt;code>ar&lt;/code>åŽ‹ç¼©ç¨‹åºå°†è¿™äº›ç›®æ ‡æ–‡ä»¶åŽ‹ç¼©åˆ°ä¸€èµ·.&lt;/p>
&lt;p>â“ å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªé™æ€åº“æ˜¯ç”±å“ªäº›object fileåŽ‹ç¼©åˆ°ä¸€èµ·çš„?&lt;/p>
&lt;p>Shell command&lt;code>ar -t libc.a&lt;/code> å¯ä»¥æŸ¥çœ‹&lt;code>libc.a&lt;/code>ä¸­åŒ…å«çš„æ‰€æœ‰object files.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="elfæ–‡ä»¶åŠ è½½-è¿è¡Œæµç¨‹">ELFæ–‡ä»¶åŠ è½½-è¿è¡Œæµç¨‹&lt;/h2>
&lt;blockquote>
&lt;p>åºŸäº†åŠå¤©åŠ²ç¼–è¯‘ç”Ÿæˆçš„ELFæ–‡ä»¶, æƒ³è¦æœ€ç»ˆè·‘èµ·æ¥åˆ™åŒ…å«çš„instruction and dataå¿…é¡»è¦åœ¨å†…å­˜ä¸­.&lt;/p>
&lt;/blockquote>
&lt;h3 id="é™æ€åŠ è½½ä¸ŽåŠ¨æ€åŠ è½½">é™æ€åŠ è½½ä¸ŽåŠ¨æ€åŠ è½½&lt;/h3>
&lt;p>æˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„åŠžæ³•æ˜¯: æŠŠæ•´ä¸ªELFçš„&lt;strong>æ‰€æœ‰æŒ‡ä»¤å’Œæ•°æ®&lt;/strong>åœ¨è¿è¡Œä¹‹å‰å°±å…¨éƒ¨loadåˆ°å†…å­˜ä¸­. è¿™å°±æ˜¯&lt;em>é™æ€åŠ è½½&lt;/em>.&lt;/p>
&lt;p>æ›´åŠ é«˜æ•ˆçš„åšæ³•æ˜¯: å……åˆ†åˆ©ç”¨&lt;em>å±€éƒ¨æ€§åŽŸç†&lt;/em>, å°†æŒ‡ä»¤å’Œæ•°æ®åˆ’åˆ†ä¸º&lt;strong>æ¨¡å—&lt;/strong>, åªæœ‰å½“è¯¥æ¨¡å—è¢«ä½¿ç”¨æ—¶, æ‰loadè¿›å†…å­˜,
å¦åˆ™å°±åœ¨å¤–å­˜ä¸­è€è€å®žå®žå‘†ç€. è¿™å°±æ˜¯&lt;em>åŠ¨æ€åŠ è½½&lt;/em>.&lt;/p>
&lt;h3 id="åŠ¨æ€åŠ è½½çš„æ­¥éª¤">åŠ¨æ€åŠ è½½çš„æ­¥éª¤&lt;/h3>
&lt;p>å€ŸåŠ©&lt;em>è™šæ‹Ÿå†…å­˜&lt;/em>æŠ€æœ¯, ä¸Šé¢æåˆ°çš„&lt;strong>æ¨¡å—&lt;/strong>çš„æ¦‚å¿µå¯ä»¥è‡ªç„¶çš„è¢«&lt;strong>é¡µ&lt;/strong>(page)ä»£æ›¿.
æˆ‘ä»¬å°†æ‰€æœ‰çš„æŒ‡ä»¤å’Œæ•°æ®æŒ‰ç…§pageä¸ºå•ä½åˆ’åˆ†.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è¿è¡Œè¯¥ELFçš„çº¿ç¨‹è¢«åˆ›å»ºæ—¶, å…¶virtual spaceèŒƒå›´è¢«åˆ’å®š, ä½†å…¶é¡µè¡¨æ˜¯ç©ºçš„, æ²¡æœ‰ä»»ä½•æ˜ å°„.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>OSè¯»å–ELF Header, å»ºç«‹virtual spaceä¸Ž&lt;strong>ELFæ–‡ä»¶&lt;/strong>çš„æ˜ å°„å…³ç³». è¿™ä¸ªæ˜ å°„å…³ç³»çš„è¡¨è¾¾æ–¹å¼æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„&lt;strong>æ•°æ®ç»“æž„&lt;/strong>.
å»ºç«‹è¯¥æ˜ å°„å…³ç³»çš„åŽŸå› æ˜¯: å½“ç¨‹åºè¿è¡Œåˆ°æŸä¸ªåœ°å€å‘çŽ°è¯¥é¡µè¡¨é¡¹æ˜¯ç©ºçš„(ä¾‹å¦‚ &lt;code>call 0x1234&lt;/code>), é‚£ä¹ˆå¿…ç„¶è§¦å‘&lt;code>page fault&lt;/code>.
ç”±OSè´Ÿè´£åˆ°&lt;em>ç‰¹å®šçš„å¤–å­˜åœ°å€&lt;/em>å°†é¡µé¢åŠ è½½åˆ°physical memoryä¸­.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>OSè¦æƒ³çŸ¥é“ç¼ºå¤±çš„å†…å®¹åœ¨ELFæ–‡ä»¶çš„å“ªä¸ªä½ç½®, å°±æ˜¯åˆ©ç”¨è¯¥æ˜ å°„, å³æŸä¸ªæ•°æ®ç»“æž„
&lt;/code>&lt;/pre>&lt;ol start="3">
&lt;li>physical memoryä¸­æœ‰äº†æ‰€éœ€çš„æŒ‡ä»¤æˆ–æ•°æ®åŽ, è¿˜éœ€å»ºç«‹visual memoryåˆ°physical memoryçš„æ˜ å°„, å³åœ¨&lt;em>é¡µè¡¨é¡¹&lt;/em>ä¸­å†™å…¥.
éšç€ç¨‹åºçš„è¿è¡Œ, ä¼šç»§ç»­è§¦å‘&lt;code>page fault&lt;/code>, ä»ŽELFä¸­ä¸æ–­load pageåˆ°physical memory, å»ºç«‹ç¼ºé¡µvisual addrå¤„çš„é¡µè¡¨æ˜ å°„,
æœ€ç»ˆå¡«è¡¥æˆä¸€ä¸ªå®Œæ•´çš„pagetable.&lt;/li>
&lt;/ol>
&lt;p>Â &lt;/p>
&lt;h2 id="æ®µåœ°å€å¯¹é½æŠ€æœ¯">æ®µåœ°å€å¯¹é½æŠ€æœ¯&lt;/h2>
&lt;blockquote>
&lt;p>ç”±å‰é¢åŠ¨æ€åŠ è½½çš„æ­¥éª¤å¯çŸ¥, ELFæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®è¢«æŒ‰pageåˆ’åˆ†. å¹¶åªæœ‰åœ¨ç”¨åˆ°æ—¶æ‰è¢«åŠ è½½åˆ°å†…å­˜,
å¹¶å»ºç«‹&lt;code>è™šæ‹Ÿå†…å­˜-ç‰©ç†å†…å­˜&lt;/code>çš„æ˜ å°„.&lt;/p>
&lt;/blockquote>
&lt;p>å‡è®¾ä¸€ä¸ªELFæœ‰ä¸‰ä¸ªæ®µéœ€è¦è¢«&lt;code>LOAD&lt;/code>, ELFæ®µè¡¨å¦‚ä¸‹:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Segment&lt;/th>
&lt;th>Length&lt;/th>
&lt;th>offset&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>SEG 0&lt;/td>
&lt;td>127 B&lt;/td>
&lt;td>34 B&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SEG 1&lt;/td>
&lt;td>9899 B&lt;/td>
&lt;td>164 B&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SEG 2&lt;/td>
&lt;td>1988 B&lt;/td>
&lt;td>0 B&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="-è¿™ä¸‰ä¸ªæ®µåœ¨elfæ–‡ä»¶ä¸­çš„å¸ƒå±€å¦‚ä½•">â“ è¿™ä¸‰ä¸ªæ®µåœ¨ELFæ–‡ä»¶ä¸­çš„å¸ƒå±€å¦‚ä½•?&lt;/h3>
&lt;p>æ ¹æ®å‰é¢ELFæ–‡ä»¶æ ¼å¼çš„ä»‹ç», è¿™ä¸‰ä¸ªæ®µå¿…ç„¶æ˜¯æŒ¨ç€çš„(ç®€å•è€ƒè™‘, ELFä¸­ä»…æœ‰è¿™ä¸‰ä¸ªæ®µ).&lt;/p>
&lt;h3 id="-è¿™ä¸‰ä¸ªæ®µåœ¨ç‰©ç†å†…å­˜ä¸­çš„å¸ƒå±€">â“ è¿™ä¸‰ä¸ªæ®µåœ¨ç‰©ç†å†…å­˜ä¸­çš„å¸ƒå±€?&lt;/h3>
&lt;p>å‘ç”Ÿ&lt;code>page fault&lt;/code>ä¹‹åŽ, OSä¼šä¸ºé¡µé¢åˆ†é…åˆé€‚çš„ç‰©ç†é¡µé¢, å¦‚åˆ©ç”¨&lt;code>buddy system&lt;/code>ç­‰.&lt;/p>
&lt;p>å¯ä»¥ä¿è¯&lt;em>æ®µå†…&lt;/em>çš„è¿žç»­, ä¸èƒ½ä¿è¯&lt;em>æ®µä¸Žæ®µ&lt;/em>æ˜¯è¿žç»­çš„.&lt;/p>
&lt;blockquote>
&lt;p>æœªä½¿ç”¨æ®µå¯¹é½æŠ€æœ¯ä¹‹å‰, &lt;code>SEG0&lt;/code>çš„é•¿åº¦ä¸è¶³ä¸€é¡µ, ä½†æ˜¯ä¹Ÿç»™å®ƒåˆ†é…ä¸€é¡µçš„ç©ºé—´. åŒç†ä¸º&lt;code>SEG1&lt;/code>åˆ†é…ä¸¤é¡µ, &lt;code>SEG2&lt;/code>åˆ†é…ä¸€é¡µ.
æ€»å…±å ç”¨ &lt;code>1+2+1=5&lt;/code>ä¸ªç‰©ç†é¡µ.&lt;/p>
&lt;/blockquote>
&lt;h3 id="-è¿™ä¸‰ä¸ªæ®µåœ¨ç”¨æˆ·virtual-addrspaceä¸‹çš„å¸ƒå±€å¦‚ä½•">â“ è¿™ä¸‰ä¸ªæ®µåœ¨ç”¨æˆ·virtual addrspaceä¸‹çš„å¸ƒå±€å¦‚ä½•?&lt;/h3>
&lt;p>todo&lt;/p>
&lt;h3 id="-ä½•ä¸ºæ®µåœ°å€å¯¹é½æŠ€æœ¯">â“ ä½•ä¸ºæ®µåœ°å€å¯¹é½æŠ€æœ¯?&lt;/h3>
&lt;p>ä¸Šé¢è¯´äº†, åœ¨ä¸ºè¿™ä¸‰ä¸ªæ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶, è™½ç„¶ä»–ä»¬çš„çœŸå®žå¤§å°è¿œå°äºŽ5ä¸ªé¡µé¢, ä½†ç”±äºŽç®€å•é‡‡ç”¨: &lt;code>æ¯ä¸ªæ®µçš„å¼€å¤´å¿…é¡»æ˜¯page align&lt;/code>,
å¯¼è‡´å®žé™…ä¸Šäº§ç”Ÿäº†å·¨å¤§çš„&lt;strong>å†…éƒ¨ç¢Žç‰‡&lt;/strong>.&lt;/p>
&lt;p>æ®µåœ°å€å¯¹é½å®žé™…ä¸Šå°±æ˜¯åœ¨ä¸ºELFæ–‡ä»¶ä¸­çš„æ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶, ä¸è€ƒè™‘å…¶æ®µçš„ç‹¬ç«‹æ€§, å¼ºåˆ¶æŒ‰ç…§&lt;code>page&lt;/code>æ¥åˆ’åˆ†. åˆ’åˆ†çš„è¡Œä¸ºå¦‚ä¸‹å›¾æ‰€ç¤º.
ç»“æžœå°±æ˜¯ä»…éœ€å ç”¨&lt;code>3&lt;/code>ä¸ªç‰©ç†é¡µé¢.&lt;/p>
&lt;pre tabindex="0">&lt;code>+---+---------------+
| P | SEG0 |
| A +---------------+
| G | |
| E | |
+---+ |
| P | SEG1 |
| A | |
| G | |
| E | |
+---+ |
| P +---------------+
| A | |
| G | SEG2 |
| E | |
+---+---------------+
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>ç›®å‰, gcc(æ›´å‡†ç¡®æ˜¯è¯´æ˜¯GUN ld)é»˜è®¤å¯ç”¨æ®µå¯¹é½æŠ€æœ¯. å„ä¸ªæ®µçš„è™šæ‹Ÿåœ°å€å¹¶ä¸æ˜¯&lt;code>page align&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ðŸ€ ç‰©ç†é¡µé¢åˆ°è™šæ‹Ÿé¡µé¢çš„æ˜ å°„é˜¶æ®µ, é‚£äº›&lt;em>åŒæ—¶åŒ…å«&lt;/em>ä¸¤ä¸ªæ®µçš„é¡µé¢ä¼šè¢«æ˜ å°„ä¸¤æ¬¡, å³ä¸€ä¸ªç‰©ç†é¡µé¢å¯¹åº”ä¸¤ä¸ª
è™šæ‹Ÿé¡µ.&lt;/p>
&lt;p>åŽŸå› æ˜¯: åœ¨ä¸€ä¸ªé¡µé¢çš„ä¸åŒæ®µå¯èƒ½&lt;strong>æƒé™ä¸åŒ&lt;/strong>, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨åŒä¸€æ˜ å°„.&lt;/p>
&lt;/blockquote>
- https://wangloo.github.io/posts/os-learning/elf-format/ - @2019 Notepadium.</description></item><item><title>Improving the quality of C code</title><link>https://wangloo.github.io/posts/codestyle/improve_quality/</link><pubDate>Tue, 14 Jun 2022 17:59:22 +0800</pubDate><guid>https://wangloo.github.io/posts/codestyle/improve_quality/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/codestyle/improve_quality/ -&lt;h2 id="æ·»åŠ æ›´å¤šçš„ç¼–è¯‘é€‰é¡¹comiler-optionsæ¥é˜²æ­¢bug">æ·»åŠ æ›´å¤šçš„ç¼–è¯‘é€‰é¡¹(comiler options)æ¥é˜²æ­¢bug&lt;/h2>
&lt;p>å¯¹äºŽæˆ‘å¸¸ç”¨çš„&lt;code>GCC&lt;/code>, æŽ¨èå¼€å¯ä¸€ä¸‹çš„compiler options:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>-Wall&lt;/code>: enable a lot of common warnings&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-Wno-format-truncation&lt;/code>: warns about the snprintf output buffer not being
large enough for a corresponding â€œ%sâ€ in the format string.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-Werror&lt;/code>: turn warnings into errors.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="åŠ¨æ€ç”³è¯·çš„ç©ºé—´åˆ°åº•è¦ä¸è¦é‡Šæ”¾">åŠ¨æ€ç”³è¯·çš„ç©ºé—´åˆ°åº•è¦ä¸è¦é‡Šæ”¾&lt;/h2>
&lt;p>When using a barebones embedded OS, you absolutely need to tightly manage your memory.&lt;/p>
&lt;p>ä½†æ˜¯, å¦‚æžœä½ æ˜¯å†™åº”ç”¨ä¸šåŠ¡çš„ä»£ç , ç‰¹åˆ«æ˜¯åœ¨å†…å­˜è¶³å¤Ÿçš„åœºæ™¯ä¸‹. æœ€å¥½ä¸è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜,
å› ä¸ºå½“çº¿ç¨‹/è¿›ç¨‹é€€å‡ºæ—¶, æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡Šæ”¾. &lt;strong>æŸäº›æƒ…å†µä¸‹, é‡Šæ”¾å†…å­˜çš„æ“ä½œä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå¢žåŠ é€»è¾‘çš„å¤æ‚åº¦&lt;/strong>.&lt;/p>
&lt;blockquote>
&lt;p>å¦‚æžœä½ æ˜¯ä¸€ä¸ªå†…æ ¸ç¨‹åºå‘˜, åˆ™å¿…é¡»æ‰‹åŠ¨çš„é‡Šæ”¾. ä¸ç”¨æ€€ç–‘.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h3 id="å°½å¯èƒ½åœ¨åˆ›å»ºå˜é‡æ—¶èµ‹åˆå€¼">å°½å¯èƒ½åœ¨åˆ›å»ºå˜é‡æ—¶èµ‹åˆå€¼&lt;/h3>
&lt;p>æ”¾ç½®æŸäº›å˜é‡åˆ›å»ºåŽæ˜¯ &lt;code>magic value&lt;/code>. è€Œä½¿ç”¨è¿™äº›å˜é‡å¯èƒ½ä¸ä¼šç«‹é©¬å¯¼è‡´é”™è¯¯, ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªéšæ‚£.&lt;/p>
&lt;p>ä½†è¿™ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜, æœ‰æ—¶æˆ‘ä»¬å®šä¹‰å˜é‡ä¹‹åŽçš„ä¸ä¹…ä¹‹åŽå°±ä¼šå¯¹å…¶èµ‹äºˆæ­£ç¡®çš„å€¼, è¿™æ—¶å€™åˆå€¼å°±æ˜¯
å¤šä½™çš„. è€Œä¸”ç»´æŠ¤è€…å¯èƒ½è®¤ä¸ºè¿™ä¸ªå€¼æ˜¯meaningful, è¿™å°±è¦æ±‚æˆ‘ä»¬å¦‚æžœè¦èµ‹åˆå€¼, å°±è¦è¯´æ˜Žè¿™ä¸ªå€¼
ä»…ä»…æ˜¯&lt;strong>æ— æ„ä¹‰çš„&lt;/strong>åˆå€¼.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h3 id="ä½¿ç”¨define-enum">ä½¿ç”¨&lt;code>#define&lt;/code>, &lt;code>enum&lt;/code>&lt;/h3>
&lt;p>å¯¹äºŽä»£ç åœ¨ä¸åŒåœ°æ–¹ä½¿ç”¨çš„åŒä¸€ä¸ªå€¼, åº”ä½¿ç”¨&lt;code>#define&lt;/code>æ¥å£°æ˜Žä½¿å¾—ä»£ç &lt;strong>maintainable&lt;/strong>.&lt;/p>
&lt;p>å¦‚æžœè¿™äº›å€¼æœ‰å¤šä¸ªä¸”èƒ½è§„åˆ’ä¸ºåŒä¸€ç±»åˆ«, åˆ™è¿˜å¯å°†&lt;code>#define&lt;/code>çš„æ–¹å¼æ¢ä¸º&lt;code>enum&lt;/code>. è¿™ä¼šä½¿ä»£ç æ›´åŠ &lt;strong>meaningful&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨&lt;code>enum&lt;/code>ä½¿è¿˜è¦æ³¨æ„å…¶æ‰€å å†…å­˜ç©ºé—´åœ¨ä¸åŒæž¶æž„ä¸­å¯èƒ½ä¸åŒçš„é—®é¢˜, see &lt;a href="https://www.cnblogs.com/bluettt/p/16041867.html">enumçš„ä¼˜åŠ¿å’Œæ¼æ´ž&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h3 id="ä½¿ç”¨typedefä¼˜åŒ–function-pointer">ä½¿ç”¨&lt;code>typedef&lt;/code>ä¼˜åŒ–function pointer&lt;/h3>
&lt;p>Â &lt;/p>
&lt;h3 id="é‡å®šä¹‰ä¸€å¥—è‡ªå·±çš„ç±»åž‹">é‡å®šä¹‰ä¸€å¥—è‡ªå·±çš„ç±»åž‹&lt;/h3>
&lt;p>åœ¨å¼€å‘å¤§é¡¹ç›®æ—¶, éœ€è¦è€ƒè™‘å¯ç§»æ¤æ€§çš„æƒ…å†µä¸‹, æœ€å¥½åˆ©ç”¨&lt;code>typedef&lt;/code>å¯¹ç±»åž‹è¿›è¡Œé‡å®šä¹‰.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#if SYSTEM1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">typedef&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">INT32&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">typedef&lt;/span> &lt;span style="color:#00a8c8">long&lt;/span> &lt;span style="color:#111">INT32&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä¸Š, å¯¹äºŽæŸäº›æž¶æž„&lt;code>int&lt;/code>ç±»åž‹å¯èƒ½ä¸æ˜¯32bit, æ­¤æ—¶å°±è¦ä½¿ç”¨&lt;code>long&lt;/code>. è¿™ç§å®šä¹‰çš„æ–¹å¼ä¼šä¿è¯æˆ‘ä»¬çš„ç³»ç»Ÿ
åœ¨ä»»ä½•æž¶æž„ä¸­éƒ½ä¸ä¼šå‡ºçŽ°ç±»åž‹çš„bug. è€Œä¸”ä¹Ÿå¢žåŠ äº†ä»£ç çš„&lt;strong>readability&lt;/strong>.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å–„ç”¨0">å–„ç”¨&lt;code>~0&lt;/code>&lt;/h2>
&lt;p>åœ¨åšåµŒå…¥å¼ç¼–ç¨‹æ—¶, æœ‰æ—¶åœ¨è®¾ç½®æŽ©ç (mask)æˆ–è€…å…¶ä»–æƒ…å†µä¼šè¦ç”¨åˆ°&lt;strong>å…¨1&lt;/strong>çš„å˜é‡å€¼, ä½ æ˜¯å¦ç»å¸¸è¿™æ ·å£°æ˜Ž?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">mask&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0xffff&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æš‚ä¸”ä¸è°ˆ&lt;code>int&lt;/code>ç±»åž‹åˆ°åº•å å¤šå°‘å­—èŠ‚çš„é—®é¢˜. å°±åƒä¸Šé¢ä¸€æ ·, æˆ‘ä»¬ç¨‹åºå‘˜ç»å¸¸å¿˜è®°æŸä¸ªç±»åž‹çš„å¤§å°,
è€Œå°‘æ·»åŠ äº†&lt;code>f&lt;/code>. ä¼šå¯¼è‡´å˜é‡&lt;code>mask&lt;/code>çš„å€¼ä¸æ˜¯å…¨1(32ä½æƒ…å†µä¸‹).&lt;/p>
&lt;p>è¿™æ˜¯è¦å˜æ¢ä¸€ä¸‹æ€ç»´, ä½¿ç”¨&lt;code>~0&lt;/code>çš„å®šä¹‰æ–¹æ³•å°±å¯è½»æ¾åŒ–è§£, æ— éœ€ç®¡å˜é‡çš„ç±»åž‹æ˜¯ä»€ä¹ˆ.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">mask&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="åˆç†çš„ä½¿ç”¨gotoè¯­å¥">åˆç†çš„ä½¿ç”¨&lt;code>goto&lt;/code>è¯­å¥&lt;/h2>
&lt;p>åœ¨å¤§å­¦è¯¾å ‚ä¸­, æˆ‘ä»¬è€å¸ˆè¯´è¿‡ç¦æ­¢ä½¿ç”¨&lt;code>goto&lt;/code>è¯­å¥, ä½†å´æ²¡æœ‰ç»™å‡ºæ˜Žç¡®çš„åŽŸå› .&lt;/p>
&lt;p>å®žé™…ä¸Š, &lt;strong>åˆç†çš„&lt;/strong>ä½¿ç”¨&lt;code>goto&lt;/code>èƒ½å¤Ÿæžå¤§çš„å‡å°‘ç¨‹åºçš„å†—ä½™åº¦.&lt;/p>
&lt;p>&lt;code>goto&lt;/code>è¯­å¥å¸¸ç”¨äºŽç¨‹åºå‡ºçŽ°é”™è¯¯è¦é€€å‡ºæ—¶, å¯èƒ½æœ‰å¤šä¸ªæƒ…å†µä¼šä½¿ç”¨é‡å¤çš„ä»£ç å¤„ç†,
ä¾‹å¦‚é‡Šæ”¾ä¸€äº›allocated memory. ç›¸è¾ƒäºŽä½¿ç”¨&lt;code>flag&lt;/code>, ä½¿ç”¨&lt;code>goto&lt;/code>æ˜¾ç„¶æ›´åŠ clearly and readability.&lt;/p>
&lt;p>æ‰€ä»¥, åœ¨é¢å¯¹é‡å¤çš„é”™è¯¯å¤„ç†ä»£ç æ—¶, æƒ³æƒ³èƒ½ä¸èƒ½ç”¨&lt;code>goto&lt;/code>è¿›è¡Œä¼˜åŒ–. å½“ç„¶, &lt;strong>é¿å…è¿‡æ—©ä¼˜åŒ–&lt;/strong>.&lt;/p>
&lt;blockquote>
&lt;p>æ³¨æ„, &lt;code>goto&lt;/code>å‡ºçŽ°çš„åœºæ™¯å…¶å®žå¾ˆå—é™. Never use a backward &lt;code>goto&lt;/code> or jump into control statements.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="æ°¸è¿œä¸ºä½ çš„å‡½æ•°è®¾ç½®error-return-value">æ°¸è¿œä¸ºä½ çš„å‡½æ•°è®¾ç½®error return value&lt;/h2>
&lt;p>ä¸€æ—¦ä½ çš„å‡½æ•°å¯èƒ½è¢«å…¶ä»–äººè°ƒç”¨, é‚£ä¹ˆå…»æˆè®¾ç½®return valueçš„ä¹ æƒ¯. å³ä¾¿ä½ çŽ°åœ¨çš„å®žçŽ°
å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•é”™è¯¯, ä¹Ÿè¯·è¿”å›ž&lt;code>success&lt;/code>.&lt;/p>
&lt;p>è¿™æ ·åšçš„åŽŸå› æ˜¯, callerå¯ä»¥æ ¹æ®ä½ çš„å®šä¹‰åšé”™è¯¯åˆ¤æ–­, å³ä¾¿ä»¥åŽä½ çš„å®žçŽ°åŠ ä¸Šäº†å‡ºé”™æƒ…å†µ,
ä¸Šå±‚çš„ä»£ç ä¹Ÿä¸éœ€è¦ä¿®æ”¹.&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="å˜é‡ç±»åž‹çš„é€‰æ‹©">å˜é‡ç±»åž‹çš„é€‰æ‹©&lt;/h2>
&lt;ul>
&lt;li>åå­—, ç‰¹å®šä¸å˜çš„å­—ç¬¦ä¸²ä½¿ç”¨&lt;code>const char *&lt;/code>, ç”šè‡³&lt;code>const char const*&lt;/code>&lt;/li>
&lt;li>é•¿åº¦ä½¿ç”¨&lt;code>size_t&lt;/code>&lt;/li>
&lt;li>è¡¨ç¤ºç±»åž‹çš„å‚æ•°å°½å¯èƒ½ä½¿ç”¨&lt;code>enum&lt;/code>&lt;/li>
&lt;li>å¾ªçŽ¯å˜é‡iä½¿ç”¨&lt;code>signed&lt;/code>, é¿å…æº¢å‡ºåŽå‡ºé”™&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;p>&lt;a href="https://www.msweet.org/blog/2020-12-31-how-i-improve-my-c-code-quality.html">How I Improve My (C) Code Quality&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.codeproject.com/Articles/357065/Ten-Fallacies-of-Good-C-Code">Ten Fallacies of Good C Code&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/codestyle/improve_quality/ - @2019 Notepadium.</description></item><item><title>MicroKernel Learning: SeL4</title><link>https://wangloo.github.io/posts/microkernel/sel4/</link><pubDate>Sat, 04 Jun 2022 11:52:51 +0800</pubDate><guid>https://wangloo.github.io/posts/microkernel/sel4/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/microkernel/sel4/ -&lt;h2 id="sel4-capabilities">seL4 Capabilities&lt;/h2>
&lt;p>In seL4, capabilities are stored in &lt;strong>C-space&lt;/strong>. C-space is a hierarchical data structure very similar to &lt;strong>page table&lt;/strong>.&lt;/p>
&lt;ul>
&lt;li>page table is a mapping from virtual address to physical address.&lt;/li>
&lt;li>C-space is a mapping from &lt;strong>object ID&lt;/strong> to &lt;strong>capability&lt;/strong>.&lt;/li>
&lt;li>Kernel object is made up of several &lt;strong>C-nodes&lt;/strong>, just like a page table made up of individual page tables.&lt;/li>
&lt;li>Each C-nodes is an array of cap &lt;em>slots&lt;/em>, which contain capability.&lt;/li>
&lt;/ul>
&lt;p>Inaccessible to userland, you can never hold an &lt;strong>actual capability&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>You can only hold a reference to capability, which pointers into C-space(slot addresses)&lt;/li>
&lt;li>These C-space addresses are called &lt;strong>CPTRs&lt;/strong>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>You don&amp;rsquo;t need to do the transform, because this is typically extracted in some libs.&lt;/p>
&lt;/blockquote>
&lt;p>Capabilities convey specific privilege (acces rights)&lt;/p>
&lt;ul>
&lt;li>Read, Write, Execute, GrantReply(&lt;code>call&lt;/code>), Grant(&lt;code>cap transfer&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>Main operations on capabilities:&lt;/p>
&lt;ul>
&lt;li>&lt;code>Invoke&lt;/code>perform operation on object referred to by cap.
&lt;ul>
&lt;li>For example, map some frame into memory. You need to have capabilities to both the frame and address space.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Copy&lt;/code>|&lt;code>Mint&lt;/code>|&lt;code>Grant&lt;/code>: create copy of cap with &lt;strong>same/lesser&lt;/strong> privilege.&lt;/li>
&lt;li>&lt;code>Move&lt;/code>|&lt;code>Mutate&lt;/code>: transfer to different address with &lt;strong>same/lesser&lt;/strong> privilege.
&lt;ul>
&lt;li>Between C-space or within C-space.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Delete&lt;/code>: invalidate slot(cleans up object if this is the only cap to it)&lt;/li>
&lt;li>&lt;code>Revoke&lt;/code>: delete any derived(eg. copied or minted) caps&lt;/li>
&lt;/ul>
&lt;h3 id="capability-derivation">Capability Derivation&lt;/h3>
&lt;h4 id="mint-operation">MINT OPERATION&lt;/h4>
&lt;p>The &lt;strong>Mint&lt;/strong> operation creates a new, less powerful cap&lt;/p>
&lt;ul>
&lt;li>Can add badge&lt;/li>
&lt;li>Can strip access rights, eg &lt;code>RW-&amp;gt;RO&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">mint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dest&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">src&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">rights&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">badge&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>The first two arguement are &lt;strong>capability pointers(CPTR)&lt;/strong> to a C-space(represented by C-node), which are references inside C-node.&lt;/li>
&lt;li>The &lt;strong>destination C-node cap&lt;/strong> must allow modification&lt;/li>
&lt;li>Then you have the rights and the &lt;em>batch&lt;/em> of the new cap.&lt;/li>
&lt;/ul>
&lt;p>ðŸ“Œ This is an alternative of sending addressed capabilities by &lt;strong>IPC operation&lt;/strong>.
That is what operating system do to set up protection domains for &lt;strong>user level process&lt;/strong>.&lt;/p>
&lt;h4 id="copy-operation">COPY OPERATION&lt;/h4>
&lt;blockquote>
&lt;p>Copy as a version of &lt;em>Mint&lt;/em>.&lt;/p>
&lt;/blockquote>
&lt;p>Â &lt;/p>
&lt;h2 id="sel4-kernel-objects">seL4 Kernel Objects&lt;/h2>
&lt;p>In file &lt;code>libsel4\include\sel4\objecttype.h&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">typedef&lt;/span> &lt;span style="color:#00a8c8">enum&lt;/span> &lt;span style="color:#111">api_object&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">seL4_UntypedObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">seL4_TCBObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">seL4_EndpointObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">seL4_NotificationObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">seL4_CapTableObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#ifdef CONFIG_KERNEL_MCS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">seL4_SchedContextObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">seL4_ReplyObject&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">seL4_NonArchObjectTypeCount&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#111">seL4_ObjectType&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Â &lt;/p>
&lt;h2 id="sel4-system-calls">seL4 System Calls&lt;/h2>
&lt;p>seL4 has &lt;code>11&lt;/code> syscalls:&lt;/p>
&lt;p>&lt;code>Yield()&lt;/code>: invokes scheduler&lt;/p>
&lt;ul>
&lt;li>does NOT require a capability!&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Send()&lt;/code>,&lt;code>Recv()&lt;/code> and variants/combinations thereof: IPC operations&lt;/p>
&lt;ul>
&lt;li>&lt;code>Call()&lt;/code>,&lt;code>ReplyRecv()&lt;/code>: usually invokes by client/server&lt;/li>
&lt;li>&lt;code>Send()&lt;/code>, &lt;code>NBSend()&lt;/code>: send-only and non-blocking version of it.&lt;/li>
&lt;li>&lt;code>Recv()&lt;/code>, &lt;code>NBRecv()&lt;/code>, &lt;code>NBSendRecv()&lt;/code>&lt;/li>
&lt;li>&lt;code>Wait()&lt;/code>, &lt;code>NBWait()&lt;/code>, &lt;code>NBSendWait()&lt;/code>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>We just use &lt;code>Call()&lt;/code> normally, the others are only for bootstrapping protocols and exception handling.&lt;/p>
&lt;/blockquote>
&lt;p>Call() is atomic Send() + reply-object setup + Wait()&lt;/p>
&lt;ul>
&lt;li>cannot be simulated with one-way operations!&lt;/li>
&lt;/ul>
&lt;p>ReplyRecv() is NBSend() + Recv()&lt;/p>
&lt;h3 id="different-object-support-different-operations">Different object support different operations&lt;/h3>
&lt;h4 id="endpoints">ENDPOINTS&lt;/h4>
&lt;p>Endpoints support all 10 IPC variants.&lt;/p>
&lt;h4 id="notifications">NOTIFICATIONS&lt;/h4>
&lt;p>Notifications support:&lt;/p>
&lt;ul>
&lt;li>NBSend() - aliased as Signal()&lt;/li>
&lt;li>Wait()&lt;/li>
&lt;li>NBWait() - aliased as Poll()&lt;/li>
&lt;/ul>
&lt;h4 id="other-objects">OTHER OBJECTS&lt;/h4>
&lt;p>Other objects only supports &lt;code>Call()&lt;/code> operation.&lt;/p>
&lt;ul>
&lt;li>Appear as (kernel-implemented) servers. If you invoking a method on an object, this is done by treating the object as a kernel-implemented server. And you invoke it with a &lt;code>call()&lt;/code> operation just as you do a normal server invocation.&lt;/li>
&lt;li>Each of these kernel objects has a different kernel-defined protocol
&lt;ul>
&lt;li>operations encoded in message tag&lt;/li>
&lt;li>parameters passed in message words&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Mostly hidden behind &lt;strong>syscall&lt;/strong> wrappers, user do not need to know this details.&lt;/li>
&lt;/ul>
&lt;p>Â &lt;/p>
&lt;h2 id="sel4-ipc">seL4 IPC&lt;/h2>
&lt;blockquote>
&lt;p>IPC in seL4 is a way to realize &lt;strong>cross-domain&lt;/strong> invocation.&lt;/p>
&lt;/blockquote>
&lt;p>seL4 IPC is not a mechanism for shipping data. Transfering data is axillary but not the primary purpose.&lt;/p>
&lt;p>seL4 IPC is a protected procedure call, a user-controlled context switch(from clients context into server context).&lt;/p>
&lt;p>Â &lt;/p>
&lt;h2 id="sel4-threads">seL4 Threads&lt;/h2>
&lt;h3 id="creating-a-thread">Creating a thread&lt;/h3>
&lt;ol>
&lt;li>Obtain a TCB object&lt;/li>
&lt;li>Set attributes: V-space, C-space, fault endpoint, IPC buffer&lt;/li>
&lt;li>Set Scheduling parameters:
&lt;ul>
&lt;li>priority, scheduling context, timeout endpoint(maybe MCP)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Set architecture-related registers&lt;/li>
&lt;/ol>
&lt;h3 id="threads-and-stacks">Threads and Stacks&lt;/h3>
&lt;p>Stacks are completely user-managed, kernel doesn&amp;rsquo;t care!&lt;/p>
&lt;blockquote>
&lt;p>Kernel only preserves SP.. on context switch&lt;/p>
&lt;/blockquote>
&lt;p>Stack location, allocation, size must be managed by &lt;strong>userland&lt;/strong>.&lt;/p>
&lt;p>Kernel beware of stack overflow&lt;/p>
- https://wangloo.github.io/posts/microkernel/sel4/ - @2019 Notepadium.</description></item><item><title>HuGo Configuration</title><link>https://wangloo.github.io/posts/hugo/</link><pubDate>Sat, 21 May 2022 17:39:42 +0800</pubDate><guid>https://wangloo.github.io/posts/hugo/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/hugo/ -&lt;h1 id="emoji-support">Emoji Support&lt;/h1>
&lt;p>&lt;a href="https://stackoverflow.com/questions/41047920/adding-emoji-to-a-hugo-page-variable">Adding emoji tutorial&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.webfx.com/tools/emoji-cheat-sheet/">Emoji chart&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/hugo/ - @2019 Notepadium.</description></item><item><title>2019 Stanford Commencement Timcook</title><link>https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/</link><pubDate>Wed, 18 May 2022 19:32:38 +0800</pubDate><guid>https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/</guid><description>Soben's Secret Base https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/ -&lt;h1 id="content">Content&lt;/h1>
&lt;p>Fourteen years ago, Steve stood on this stage and told your predecessors &amp;ldquo;Your time is limited. So don&amp;rsquo;t waste is living someone else&amp;rsquo;s life.&amp;rdquo;&lt;/p>
&lt;p>So what is true then is true now. Don&amp;rsquo;t waste your time living someone else&amp;rsquo;s life.
Don&amp;rsquo;t try to emulate the people who came before you to the exclusion of
everything else, contorting into a shape that doesn&amp;rsquo;t fit.&lt;/p>
&lt;p>Graduates, the fact is, when your time comes, and it will, you will never be ready.
But you&amp;rsquo;re not suppposed to be. Find the hope in the unexpected. Find the hope
int the challenge. Find your vision on the solitary road. Don&amp;rsquo;t get distracted.
There are too many people who want credit without responsibility. Too many who
show up for the ribbon cutting without building anything worth a damn.&lt;/p>
&lt;p>Be different. Leave something worthy. And always remember that you can&amp;rsquo;t take it
with you. You&amp;rsquo;re going to have to pass it on.&lt;/p>
&lt;p>Thank you very much. And Congratulations to the Class of 2019!&lt;/p>
&lt;p>&lt;a href="https://www.youtube.com/watch?v=2C2VJwGBRRw&amp;amp;t=80s">YouTube vidio&lt;/a>&lt;/p>
- https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/ - @2019 Notepadium.</description></item></channel></rss>