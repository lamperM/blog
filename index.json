[{"categories":["C"],"contents":"åœ¨è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯ä¼ é€’ç±»ä¼¼çš„å­ç³»ç»Ÿæ—¶ï¼Œæ¶ˆæ¯ç»å¸¸éœ€è¦å„ç§å‚æ•°ï¼Œ é€šå¸¸æ¶ˆæ¯çš„ä¸ªæ•°å’Œç±»å‹æ˜¯æ ¹æ®æ¶ˆæ¯è‡ªèº«çš„ç±»å‹å†³å®šçš„ã€‚\n1void 2handle_open(..., int flags, int mode); 3void 4handle_read(..., size_t len, int offset); 5// ... æœ‰çš„æ¶ˆæ¯/å‘½ä»¤å‚æ•°æ¯”è¾ƒå¤šï¼Œä¸æƒ³å†™è¿™ä¹ˆé•¿çš„å‚æ•°é‚£å°±æŠŠè¿™äº›å‚æ•°å°è£…åˆ°structé‡Œ\n1struct arg_open { 2 int flag; 3 int mode; 4}; 5struct arg_read { 6 size_t len; 7 int offset; 8}; 9 10// è¿™é‡Œç”¨ç»“æ„ä½“è¿˜æ˜¯ç»“æ„ä½“æŒ‡é’ˆéƒ½å¯ä»¥ï¼Œä¸æ˜¯é‡ç‚¹! 11void 12handle_open(..., struct arg_open *arg); 13void 14handle_read(..., struct arg_read *arg); è¿™ç§æ–¹æ³•æœ‰ä»€ä¹ˆç¼ºç‚¹å‘¢?\n ä¸å…·æœ‰é€šç”¨æ€§ï¼›æ— æ³•ç”¨å‡½æ•°æŒ‡é’ˆæ¥å®ç°è¿›ä¸€æ­¥æŠ½è±¡ï¼Œå³è·³è¡¨ã€‚ \u0026hellip;ï¼ˆæš‚æ—¶æ²¡æƒ³åˆ°ï¼‰  æ‰€ä»¥è¯´ï¼Œä¸€ä¸ªæ›´å¥½çš„æŠ½è±¡æ–¹å¼æ¥äº†ï¼Œå°†æ‰€æœ‰çš„å‚æ•°åˆ©ç”¨unionæ”¾åˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ã€‚\n1struct proto_open { 2 int flag; 3 int mode; 4}; 5struct proto_read { 6 size_t len; 7 int offset; 8}; 9 10// GOOD DESIGN 11struct proto { 12 // ... å¯èƒ½æœ‰å…¬å…±çš„å‚æ•°, ä¾‹å¦‚ID 13 union { 14 struct proto_open open; 15 struct proto_read read; 16 // ... 17 }; 18}; 19 20// å› ä¸ºæ¯ä¸ªç±»å‹çš„æ¶ˆæ¯/å‘½ä»¤éƒ½æœ‰è‡ªå·±çš„å¤„ç†å‡½æ•° 21// æ‰€ä»¥å„ä¸ªå‡½æ•°çŸ¥é“è‡ªå·±åº”è¯¥ä»é‚£ä¸ªunionæˆå‘˜é‡Œå– 22void 23handle_open(..., struct proto *proto) 24{ 25 int flag, mode; 26 flag = proto-\u0026gt;open.flags; 27 mode = proto-\u0026gt;open.mode; 28} 29void 30handle_read(..., struct proto *proto) {...} è¿™æ ·åšçš„æœ€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥ç”¨è·³è¡¨æ¥è®¾è®¡äº†ï¼Œå‡å°‘äº†ä»£ç é‡ï¼Œå¢åŠ äº†æ˜“è¯»æ€§ï¼ï¼\n","date":"2023-11-26T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/c/good_design_proto/","section":"posts","tags":["C"],"title":"Good Design: æŠ½è±¡æ¶ˆæ¯å‚æ•°"},{"categories":["C"],"contents":"å­—èŠ‚åºä¸æ¯”ç‰¹åº å­—èŠ‚åºåˆç§°å¤§å°æ®µï¼Œç½‘ç»œä¸­ä¼ è¾“çš„æ˜¯å¤§ç«¯ï¼Œåœ¨CPUä¸Šå¤„ç†çš„ä¸€èˆ¬æ˜¯å°ç«¯ã€‚\nå­—èŠ‚åºä¸æ¯”ç‰¹åºè½¬æ¢ å­—èŠ‚åºè½¬æ¢ æ¯”ç‰¹åºè½¬æ¢ ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§ç›´æ¥æ³•ï¼Œå¦å¤–æœ‰ä¸€ç§ä¼˜åŒ–çš„æŠ€å·§ã€‚\nï¼ˆ1ï¼‰\n1// Bit reverse 2unsigned char 3bit_reverse(unsigned char x) 4{ 5 unsigned char newx = 0; 6 for (int i = 0; i \u0026lt; 8; i++) { 7 newx |= (((x \u0026gt;\u0026gt; i) \u0026amp; 1) \u0026lt;\u0026lt; (7-i)); 8 } 9 return newx; 10} (2) https://mp.weixin.qq.com/s/KNUH_RmIhUHhuSZLSmN4LQ\n1// Bit reverse(faster) 2// ç¢Ÿå¼äº¤æ¢æ³• 3unsigned char 4bit_reverse_faster(unsigned char x) 5{ 6 x = (x\u0026lt;\u0026lt;4) | (x\u0026gt;\u0026gt;4); // [ 5678 1234 ] 7 x = ((x\u0026lt;\u0026lt;2)\u0026amp;0xcc) | ((x\u0026gt;\u0026gt;2)\u0026amp;0x33); // [ 78 56 34 12 ] 8 x = ((x\u0026lt;\u0026lt;1)\u0026amp;0xaa) | ((x\u0026gt;\u0026gt;1)\u0026amp;0x55); // [ 8 7 6 5 4 3 2 1 ] 9 return x; 10} æµ‹è¯•å·¥å…·å‡½æ•°:\n1int 2to_binary_str(unsigned long val, char *bin_str, int *len) 3{ 4 char *p, *q; 5 int cnt = 0; 6 7 while (val) { 8 char tmp = val \u0026amp; 1; 9 bin_str[cnt++] = tmp+\u0026#39;0\u0026#39;; 10 val = val \u0026gt;\u0026gt; 1; 11 } 12 13 p = bin_str, q = bin_str+cnt-1; 14 while (p \u0026lt; q) { 15 char tmp = *p; 16 *p = *q; 17 *q = tmp; 18 p++, q--; 19 } 20 21 bin_str[cnt] = 0; 22 *len = cnt; 23 return 0; 24} 25 26int main(void) 27{ 28 char bin[65]; 29 int len; 30 unsigned char x = 0b11110000; 31 unsigned char y = 0b10101010; 32 to_binary_str(bit_reverse(x), bin, \u0026amp;len); 33 printf(\u0026#34;bin: %s\\n\u0026#34;, bin); 34 to_binary_str(bit_reverse(y), bin, \u0026amp;len); 35 printf(\u0026#34;bin: %s\\n\u0026#34;, bin); 36 37 assert(bit_reverse(x) == bit_reverse_faster(x)); 38 assert(bit_reverse(y) == bit_reverse_faster(y)); 39 40 return 0; 41} ","date":"2023-11-25T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/c/byte_bit_order/","section":"posts","tags":["C"],"title":"Byte/Bit Order"},{"categories":["Binary"],"contents":"åˆ†æElfæ–‡ä»¶ æ˜ å°„ Segments å¯¹æ ˆè¿›è¡Œé¢„å¤„ç†  1int main(int argc, char **argv, char **envp) {...} è§åˆ°ä¸€ä¸ªmainå‡½æ•°çš„å®šä¹‰ï¼Œä½ æ˜¯å¦è€ƒè™‘è¿‡:\n mainå‡½æ•°ä½¿ç”¨è¿™äº›å‚æ•°çš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ? Elfè¿è¡Œå‰ï¼Œä»–ä»¬æ˜¯å¦‚ä½•è¢«æ­£ç¡®æ”¾ç½®çš„? æˆ‘ä»¬åˆå¦‚ä½•æ­£ç¡®çš„è®¿é—®?   å†…æ ¸ä¸­çš„ElfåŠ è½½å™¨è¿˜éœ€è¦å°†è¾…åŠ©å‘é‡å’Œå…¶ä»–ä¿¡æ¯(argc,argv,envp)ä¸€èµ·æ”¾åœ¨æ ˆä¸Šã€‚ åˆå§‹åŒ–åï¼Œè¿›ç¨‹çš„å †æ ˆå¦‚ä¸‹æ‰€ç¤º(64ä½æ¶æ„ä¸‹):\n1position content size (bytes) + comment 2 ------------------------------------------------------------------------ 3 [ free used for process ] 4 stack pointer -\u0026gt; [ argc = number of args ] 8 5 [ argv[0] (pointer) ] 8 (program name) 6 [ argv[1] (pointer) ] 8 7 [ argv[..] (pointer) ] 8 * x 8 [ argv[n - 1] (pointer) ] 8 9 [ argv[n] (pointer) ] 8 (= NULL) 10 11 [ envp[0] (pointer) ] 8 12 [ envp[1] (pointer) ] 8 13 [ envp[..] (pointer) ] 8 14 [ envp[term] (pointer) ] 8 (= NULL) 15 16 [ auxv[0] (Elf64_auxv_t) ] 16 17 [ auxv[1] (Elf64_auxv_t) ] 16 18 [ auxv[..] (Elf64_auxv_t) ] 16 19 [ auxv[term] (Elf64_auxv_t) ] 16 (= AT_NULL vector) 20 21 [ padding ] 0 - 16 22 23 [ argument ASCIIZ strings ] \u0026gt;= 0 24 [ environment ASCIIZ str. ] \u0026gt;= 0 25 26 (0xbffffffc) [ end marker ] 8 (= NULL) 27 28 (0xc0000000) \u0026lt; bottom of stack \u0026gt; 0 (virtual) 29 ------------------------------------------------------------------------ åœ¨è¿™ä¹‹ä¸Šï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„æ˜¯argcå’Œargvï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦ä»‹ç»ä¸€ä¸‹envpå’Œauxvã€‚\nEnvironment ç¯å¢ƒå˜é‡çš„ç»“æ„å’Œargvç›¸åŒï¼Œéƒ½æ˜¯ä¸€äº›å­—ç¬¦ä¸²æŒ‡é’ˆçš„æ–¹å¼å»è®¿é—®ã€‚ åªä¸è¿‡æ²¡æœ‰ç”¨äºè¡¨ç¤ºæ•°é‡çš„\u0026quot;envc\u0026quot;ï¼Œè€Œæ˜¯ä»¥NULLè¡¨ç¤ºç»“å°¾ã€‚\nAuxiliary Vectors Auxiliary Vectors ç®€ç§°Auxv, OSå†…æ ¸åœ¨åŠ è½½Elfæ—¶, å¯ä»¥å°†ä¸€äº›é”®å€¼å¯¹ç±»å‹çš„æ•°å€¼ä¼ é€’ç»™ç”¨æˆ·æ€ç¨‹åºï¼Œ å³è¿›ç¨‹å¯åŠ¨æ—¶å†…æ ¸å‘ç”¨æˆ·æ€ä¼ é€’ä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚\nAuxvçš„å­˜å‚¨ç»“æ„ä¸æ˜¯argvå’Œenvpé‚£æ ·çš„é—´æ¥å½¢å¼ï¼Œè€Œæ˜¯é¡ºåºå­˜ä¸€äº›Elf64_auxv_tç»“æ„ä½“ï¼Œåœ¨Linuxä¸Šï¼Œç»“æ„ä½“çš„å®šä¹‰åœ¨/usr/include/elf.hä¸­ã€‚\n1typedef struct 2{ 3\tuint64_t a_type; /* Entry type */ 4\tuint64_t a_val; 5} Elf64_auxv_t; å¯ä»¥çœ‹åˆ°å°±æ˜¯ä¸€ä¸ªç±»å‹å’Œæ•°å€¼ï¼Œç›´æ¥å°±èƒ½å­˜ä¸‹ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²çš„å½¢å¼ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨Linuxä¸Šæµ‹è¯•Auxvï¼Œåœ¨å¯åŠ¨ä¸€ä¸ªç”¨æˆ·ç¨‹åºä¹‹å‰åŠ ä¸ŠLD_SHOW_AUXV=1, å¯ä»¥æ‰“å°å‡ºæ‰€æœ‰çš„Auxvã€‚\n1~ $ LD_SHOW_AUXV=1 /bin/ls 2AT_SYSINFO_EHDR: 0x7ffc3b3de000 3AT_HWCAP: 1f8bfbff 4AT_PAGESZ: 4096 5AT_CLKTCK: 100 6AT_PHDR: 0x55a318711040 7AT_PHENT: 56 8AT_PHNUM: 13 9AT_BASE: 0x7f0f5ac91000 10AT_FLAGS: 0x0 11AT_ENTRY: 0x55a3187177d0 12AT_UID: 1000 13AT_EUID: 1000 14AT_GID: 1000 15AT_EGID: 1000 16AT_SECURE: 0 17AT_RANDOM: 0x7ffc3b272ab9 18AT_HWCAP2: 0x2 19AT_EXECFN: /bin/ls 20AT_PLATFORM: x86_64 ä¸€èˆ¬æ¥è¯´ï¼Œæ™®é€šçš„ç”¨æˆ·ç¨‹åºä¸éœ€è¦è·å–å†…æ ¸çš„ä¿¡æ¯ï¼Œä½†å¯¹äºä¸€äº›ä½äºç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„ã€ äº¤äº’éå¸¸ç´§å¯†çš„ç”¨æˆ·æ€ç¨‹åºè€Œè¨€åˆ™æ¯”è¾ƒæœ‰ç”¨ã€‚æ¯”å¦‚è¯´è§£é‡Šå™¨ã€initè¿›ç¨‹ã€å¾®å†…æ ¸OSä¸­çš„root-serviceç­‰ç­‰ã€‚\næµ‹è¯•ä½ çš„Elf Loader åœ¨Elfä¸­è¾“å‡ºè¿™äº›è¾…åŠ©ä¿¡æ¯ï¼Œçœ‹æ˜¯å¦èƒ½é¡ºåˆ©è¯»åˆ°ã€‚è¿™é‡Œåˆ†åˆ«ç»™å‡ºï¼ˆ1ï¼‰åªæ‰“å°Auxvï¼ˆ2ï¼‰æ‰“å°æ‰€æœ‰\n1#include \u0026lt;stdio.h\u0026gt;2#include \u0026lt;elf.h\u0026gt;3 4main(int argc, char* argv[], char* envp[]) 5{ 6 Elf32_auxv_t *auxv; 7 while (*envp++ != NULL); /* from stack diagram above: *envp = NULL marks end of envp */ 8 9 /* auxv-\u0026gt;a_type = AT_NULL marks the end of auxv */ 10 for (auxv = (Elf32_auxv_t *)envp; auxv-\u0026gt;a_type != AT_NULL; auxv++) { 11 if (auxv-\u0026gt;a_type == AT_SYSINFO) 12 printf(\u0026#34;AT_SYSINFO is: 0x%x\\n\u0026#34;, auxv-\u0026gt;a_un.a_val); 13 } 14} 1int main(int argc, char *argv[], char *envp[]) 2{ 3 int i; 4 5 // Print all arguements 6 printf(\u0026#34;argc: %d\\n\u0026#34;, argc); 7 for (i = 0; i \u0026lt; argc; i++) { 8 printf(\u0026#34;argv[%d]: %s\\n\u0026#34;, i, argv[i]); 9 } 10 11 // Print all enviroment variables 12 for (i = 0; envp[i]; i++) { 13 printf(\u0026#34;env[%d]: %s\\n\u0026#34;, i, envp[i]); 14 } 15 16 // Print all auxv 17 Elf64_auxv_t *auxv = (Elf64_auxv_t *)(envp+i+1); 18 for (; auxv-\u0026gt;a_type != AT_NULL; auxv++) { 19 if (auxv-\u0026gt;a_type == AT_PAGESZ) { 20 printf(\u0026#34;AT_PAGESZ: 0x%lx\\n\u0026#34;, auxv-\u0026gt;a_un.a_val); 21 } 22 } 23} è®¾ç½®User Context Reference  About ELF Auxiliary Vectors  ","date":"2023-11-24T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/binary/elf_load/","section":"posts","tags":["Binary"],"title":"Design a Elf Loader"},{"categories":["DevTools"],"contents":"Vimæ’ä»¶YouCompleteMeå›½å†…å®‰è£…  Update 2023/11/23: vimä¸‹ç°åœ¨æˆ‘ä¸ç”¨YCMäº†ï¼Œæ¢æˆCoc.nvimæ¥è¿›è¡Œä»£ç è¡¥å…¨ã€‚ ä¸è¿‡åœ¨æˆ‘çœ‹æ¥å…¶å®æ²¡æœ‰ç‰¹åˆ«æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œæ‰€ä»¥YCMçš„é…ç½®æ³¨æ„äº‹é¡¹è¿˜æ˜¯ç•™åœ¨è¿™å§ã€‚\n YCM æ’ä»¶å¯¹ python, vim çš„ç‰ˆæœ¬å‡æœ‰è¦æ±‚ã€‚\nä¸‹è½½ å¯ä»¥ä½¿ç”¨ vim-plug ç­‰å·¥å…·ä¸‹è½½, ä¹Ÿå¯ä»¥ä¸‹è½½æºç ç„¶åæ‹·è´åˆ°.vimç›®å½•ä¸‹\nç¼–è¯‘ ç¼–è¯‘ç”¨åˆ° python3, è¿™é‡Œæ˜¯é—®é¢˜æœ€å¤šçš„ä¸€æ­¥\n1# ç¼–è¯‘å¹¶æ·»åŠ å¯¹Cçš„æç¤ºæ”¯æŒ 2python3 install.py --clangd-completer --verbose 3 4Searching Python 3.8 libraries... 5... 6Downloading Clangd from https://github.com/ycm-core/llvm/releases/download/13.0.0/clangd-13.0.0-x86_64-unknown-linux-gnu.tar.bz2... ä½¿ç”¨--clangd-completerå‚æ•°æ—¶, è„šæœ¬ä¼šå»ä¸‹è½½ clangd-14.0.0-x86_64-unknown-linux-gnu.tar.bz2 æ–‡ä»¶, æ¯”è¾ƒæ…¢. ä¹Ÿå¯ä»¥æå‰æ ¹æ®æç¤ºçš„ç½‘ç«™è‡ªå·±æ‰‹åŠ¨ä¸‹è½½å‹ç¼©åŒ….\nä¸‹è½½å®Œæˆå, æ”¾åˆ°æœ¬åœ°ç›®å½•ä¸‹:\n1:~/.vim/plugged/YouCompleteMe/third_party/ycmd/third_party/clangd/cache$ ls 2clangd-14.0.0-x86_64-unknown-linux-gnu.tar.bz2 è¿˜éœ€å¯¹è„šæœ¬YouCompleteMe/third_party/ycmd/build.pyè¿›è¡Œä¿®æ”¹, é˜²æ­¢é‡æ–°ä¸‹è½½.\n1def DownloadClangd( printer ): 2 ... 3 MakeCleanDirectory( CLANGD_OUTPUT_DIR ) 4 5 if not p.exists( CLANGD_CACHE_DIR ): 6 os.makedirs( CLANGD_CACHE_DIR ) 7 # æ³¨é‡Šä¸‹é¢çš„è¯­å¥ 8 # elif p.exists( file_name ) and not CheckFileIntegrity( file_name, check_sum ): 9 # printer( \u0026#39;Cached Clangd archive does not match checksum. Removing...\u0026#39; ) 10 # os.remove( file_name ) 11 12 if p.exists( file_name ): 13 printer( f\u0026#39;Using cached Clangd: { file_name }\u0026#39; ) é…ç½® YCM é…åˆä¸€ä¸ªé…ç½®æ–‡ä»¶.ycm_c_c++_conf.py, YCM æœç´¢çš„ä½ç½®åœ¨ vimrc ä¸­æŒ‡å®š:\n1Plug \u0026#39;rdnetto/YCM-Generator\u0026#39;, { \u0026#39;branch\u0026#39;: \u0026#39;stable\u0026#39; }2let g:ycm_global_ycm_extra_conf = \u0026#34;~/.ycm_c_c++_conf.py\u0026#34;å…¶å†…å®¹çš„ example:\n1import os 2import ycm_core 3 4flags = [ 5 \u0026#39;-Wall\u0026#39;, 6 \u0026#39;-Wextra\u0026#39;, 7# \u0026#39;-Werror\u0026#39;, 8 \u0026#39;-Wno-long-long\u0026#39;, 9# \u0026#39;-Wno-variadic-macros\u0026#39;, 10 \u0026#39;-fexceptions\u0026#39;, 11 \u0026#39;-ferror-limit=10000\u0026#39;, 12 \u0026#39;-DNDEBUG\u0026#39;, 13 \u0026#39;-std=c99\u0026#39;, 14 \u0026#39;-xc\u0026#39;, 15 \u0026#39;-isystem/usr/include/\u0026#39;, 16 ] 17 18SOURCE_EXTENSIONS = [ \u0026#39;.cpp\u0026#39;, \u0026#39;.cxx\u0026#39;, \u0026#39;.cc\u0026#39;, \u0026#39;.c\u0026#39;, ] 19 20def FlagsForFile( filename, **kwargs ): 21 return { 22 \u0026#39;flags\u0026#39;: flags, 23 \u0026#39;do_cache\u0026#39;: True 24 } ä½¿ç”¨æ–¹å¼ ğŸ”» å¯¹äºC/C++æ¥è¯´, YCMçš„ä½¿ç”¨æœ€å¥½é…åˆcompilation database æ¥ä½¿ç”¨, ä¾‹å¦‚compiledb. å¦åˆ™, å¯èƒ½å¤´æ–‡ä»¶çš„pathè¯†åˆ«å‡ºé—®é¢˜(stackoverflow).\n2022å¹´2æœˆ13æ—¥æˆ‘ä½¿ç”¨çš„compilation databaseç”Ÿæˆå·¥å…·ä»compiledbæ¢æˆäº†bear, å› ä¸ºbearæ›´å¥½çš„æ”¯æŒé€’å½’, å³æœ‰make -Cçš„æƒ…å†µ.\néœ€è¦çš„compilation databaseç”Ÿæˆå·¥å…·ä»‹ç»: Compilation database â€” Sarcasm notebook\n","date":"2023-11-17T19:28:12+08:00","permalink":"https://wangloo.github.io/posts/tools/vim/ycm/","section":"posts","tags":["tools"],"title":"Vim-YouCompleteMeæ’ä»¶å›½å†…å®‰è£…"},{"categories":["Operating System"],"contents":"ä¼™ä¼´ç³»ç»Ÿçš„ä¼˜åŠ¿ ä½œä¸ºä¸€ä¸ªé¡µåˆ†é…å™¨ï¼Œä¼™ä¼´ç³»ç»Ÿä¸»è¦è§£å†³å¤–éƒ¨ç¢ç‰‡è¿‡å¤šçš„é—®é¢˜ï¼Œ ä¿è¯ç³»ç»Ÿä¸­å°½å¯èƒ½æœ‰å¤§çš„è¿ç»­ç©ºé—´å¯ä»¥ä½¿ç”¨ã€‚\nè¿™ä¹Ÿæ­£æ˜¯ä¼™ä¼´ç³»ç»Ÿè¦è®¾è®¡æˆç›¸é‚»å†…å­˜å—åˆå¹¶çš„åŸå› ã€‚\n","date":"2023-09-18T17:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/mem/buddy/","section":"posts","tags":["linux","Operating System"],"title":"Linux Buddy å†…å­˜åˆ†é…å™¨"},{"categories":["Architecture"],"contents":"ä¸ºä»€ä¹ˆè¦å…³å¿ƒå†…å­˜æ¨¡å‹ å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªçº¦å®šæˆ–è€…è§„åˆ™, æ˜¯ä½“ç³»ç»“æ„å†³å®šçš„ï¼Œå®šä¹‰äº†å†…å­˜çš„æŸäº›å±æ€§å’Œè¡Œä¸ºã€‚ ä¸€èˆ¬å„ä¸ªæ¶æ„ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œæ¯”å¦‚ ARM ä¼šåšåˆå¹¶è®¿å­˜ã€ä¹±åºæ‰§è¡Œè¿™ç±»ä¼˜åŒ–æ–¹æ³•ã€‚\næ‰€ä»¥ï¼ŒæŸäº›æƒ…å†µä¸‹ï¼ŒæŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºå¯èƒ½ä¸ä¸ä½ ç¨‹åºè®¾è®¡çš„ä¸€æ¨¡ä¸€æ ·ï¼Œåªæ˜¯ä¸ºä½ å‘ˆç°çš„ç»“æœç›¸åŒç½¢äº†ã€‚ å½“ç„¶è¿™é‡Œè¾¹è¿˜æœ‰ç¼–è¯‘å™¨æ¥ä¼˜åŒ–ï¼ˆæ£ä¹± hhï¼‰ã€‚\nä¸€èˆ¬ç¨‹åºæ— éœ€å…³å¿ƒå†…å­˜æ¨¡å‹å¸¦æ¥çš„å·®å¼‚ï¼Œé™¤éä½ ä»äº‹åº•å±‚è½¯ä»¶å¼€å‘ï¼ˆåµŒå…¥å¼å¼€å‘ï¼‰è¿™ç§éœ€è¦å’Œå¯„å­˜å™¨æ‰“äº¤é“ï¼Œ æ¶‰åŠç³»ç»Ÿåº•å±‚æœºåˆ¶çš„å®ç°æ—¶ï¼Œä½ å¿…é¡»æŒ‰ç…§å†…å­˜æ¨¡å‹æ¥åˆç†çš„è§„åˆ’ä½ çš„ç¨‹åºã€‚\nå„ç§å†…å­˜æ¨¡å‹ ä¸åŒçš„å¤„ç†å™¨æ¶æ„æœ‰ä¸åŒçš„å†…å­˜æ¨¡å‹.\n ä¾‹å¦‚, ARM æ¶æ„å¯èƒ½ä¼˜åŒ–å†…å­˜è¯»å†™æŒ‡ä»¤çš„é¡ºåº, ä½†æ˜¯ X86/64 æ¶æ„é€šå¸¸ä¸ä¼šè¿™æ ·åš. X86 æ¶æ„çš„æ¯æ¬¡å†…å­˜åŠ è½½æŒ‡ä»¤éƒ½å¸¦æœ‰ acquire è¯­ä¹‰, æ¯æ¬¡å†™å†…å­˜éƒ½å¸¦æœ‰ release è¯­ä¹‰. ARM æ¶æ„å°±ä¸ä¸€å®š, æ‹¿ ARMv8 æ¥è¯´, ä»…æœ‰LDRA/STRLæŒ‡ä»¤å¸¦æœ‰æ­¤å«ä¹‰.   æˆ‘ä»¬ç§°ç±»ä¼¼ ARM æ¶æ„è¡Œä¸ºçš„å†…å­˜æ¨¡å‹ä¸º Relaxed Memory Model\n  å°† X86/64 ä¸Šç¨³å®šè¿è¡Œçš„ Lock-free çš„ä»£ç æ¬åˆ° ARM ä¸Š, å°±ä¸ä¸€å®šæ˜¯å¯è¡Œçš„.\n é¡ºåºä¸€è‡´æ€§æ¨¡å‹ Sequential Consistency Model æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºæ€»æ˜¯å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¸€è‡´.ä¸è®ºæ˜¯å¦å­˜åœ¨å†…å­˜è®¿é—®æŒ‡ä»¤é‡æ’ç­‰ä¼˜åŒ–æ“ä½œ.\nä¸¾ä¸ªä¾‹å­,\n å…ˆå†™åè¯»å†…å­˜çš„æ¨¡å‹ä¸­, æ€»æ˜¯èƒ½å®ç°è¯»å†…å­˜æ—¶å€¼æ˜¯æ–°çš„(ä¸ä¼šè¢«ä¼˜åŒ–æˆå…ˆè¯»åå†™). å¤šæ¡ldræŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºä¹Ÿæ˜¯ä¸¥æ ¼æŒ‰ç…§ç¨‹åºæ‰€å†™   å¤šå¤„ç†å™¨ç¯å¢ƒä¸‹, æ¯ä¸ªæ ¸çš„æ‰§è¡Œé¡ºåºéƒ½æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æŒ‡ä»¤é¡ºåº. å¤šæ ¸ä¹‹é—´çš„åŒæ­¥éœ€è¦ç¨‹åºå‘˜æ¥ä¿è¯.\n å®½æ¾ä¸€è‡´æ€§æ¨¡å‹ Relaxed Consistency Model å„ç§ä¼˜åŒ– buff å æ»¡ï¼Œä¸€èˆ¬åŠ è½½/å­˜å‚¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºä¸èƒ½ä¿è¯ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªè¡Œç»´æŠ¤ã€‚\nè¿™ç§å®½æ³›çš„è§„åˆ™ï¼Œç»™äº†å¤„ç†å™¨å¾ˆå¤§è‡ªä¸»å†³å®šç©ºé—´ï¼Œå®ƒå¯ä»¥æ ¹æ®å½“å‰çš„æƒ…å†µå†³å®šæ˜¯ä¸æ˜¯å¦‚ä½•å¤„ç†ä½ çš„è®¿å­˜æŒ‡ä»¤ã€‚\nå®½æ¾å†…å­˜æ¨¡å‹ä¸‹å‡ ç§ä¿è¯æ­£ç¡®æ€§æªæ–½ \u0026ldquo;volatile\u0026rdquo; å…³é”®å­—  è¿™é‡Œå¯¹volatileçš„æè¿°éƒ½æ˜¯åŸºäº C è¯­è¨€çš„.\nvolatile(JAVA) != volatile(C/C++)\nvolatile(JAVA) == atomic(C/C++)\n volatileè§£å†³çš„æ˜¯ç¼–è¯‘å™¨çš„è¿‡åº¦ä¼˜åŒ–é—®é¢˜ï¼Œ æ·»åŠ äº†volatileå…³é”®å­—è¡¨ç¤ºè¯¥å˜é‡å¯èƒ½éšæ—¶è¢«æ”¹å˜, å³ä¾¿å½“å‰çš„ç¨‹åºä¸­æ²¡æœ‰ä½“ç°, ä¹Ÿå¯èƒ½è¢«å…¶ä»–çš„çº¿ç¨‹ä¿®æ”¹ï¼Œæˆ–è€…å¯¹äºå¯„å­˜å™¨æ¥è¯´è‡ªèº«å°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚\nå¯¹äºæ·»åŠ volatileå…³é”®å­—çš„å˜é‡, ç¼–è¯‘å™¨ä¼šä¸¥æ ¼æŒ‰ç…§ä½ æ‰€å†™çš„æ¥ç¼–è¯‘:\n ä¸ä¼šåˆ é™¤å†…å­˜åˆ†é… ä¸ä¼šåœ¨å¯„å­˜å™¨ä¸­ç¼“å­˜å˜é‡, æ¯æ¬¡è®¿é—®éƒ½ä¼šé‡æ–°è¯»å†…å­˜. ä¸ä¼šæ”¹å˜èµ‹å€¼çš„é¡ºåº  çœ‹ä¸€ä¸ªæœªæ·»åŠ volatileå…³é”®å­—å¯èƒ½å¯¼è‡´çš„é—®é¢˜: ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°, ä½œç”¨æ˜¯ä¸ºåœ¨ç­‰åˆ°è®¾å¤‡å®Œæˆå½“å‰ä»»åŠ¡åå…³é—­è®¾å¤‡.\n1void poweroff(dev_t ID, reg_addr_t *busy) { 2 while(*busy) 3 ; 4 poweroff(); 5} çœ‹ä¸Šå»ä¼¼ä¹æ˜¯æ­£ç¡®çš„, ä½†\u0026quot;è¿‡äºèªæ˜\u0026quot;çš„ç¼–è¯‘å™¨å¯èƒ½è®©è¿™æ®µç¨‹åºå¤±æ•ˆ. ç¼–è¯‘å™¨æ€»è®¤ä¸ºæˆ‘ä»¬çš„ç¨‹åºæ˜¯å•çº¿ç¨‹çš„, å³æ²¡æœ‰äººä¼šæ¥ä¿®æ”¹busy. è¿™ç§è¿‡åˆ†çš„ä¼˜åŒ–å¯¼è‡´æ±‡ç¼–çš„ç»“æœä»…ä»…è¯»busyä¸€æ¬¡, ç„¶åé™·å…¥æ­»å¾ªç¯. æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„.\n1void poweroff(dev_t ID, reg_addr_t *busy) { 2 if (busy) do_endless_while(); 3 poweroff(); 4} å¯¹å…³é”®çš„busyå˜é‡æ·»åŠ volatileå…³é”®å­—å°†æ‹¯æ•‘æˆ‘ä»¬!\n1void poweroff(dev_t ID, reg_addr_t volatile *busy) { 2 while(busy) 3 ; 4 poweroff(); 5}  å»¶ç”³é˜…è¯»ææ–™: ä¸ºä»€ä¹ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨volatileå…³é”®å­—éƒ½æ˜¯é”™è¯¯çš„. åªè¦é”æ­£ç¡®å®ç°, é‚£ä¹ˆè¢«é”é”ä½çš„å˜é‡å°±å®Œå…¨ä¸éœ€è¦volatileæ¥å£°æ˜, å› ä¸ºè·å¾—é”æ—¶å…¶ä»–çš„ core ä¸èƒ½ä¿®æ”¹å®ƒ. è¿™æ˜¯é”æ¥ä¿è¯çš„, ä¸åº”è¯¥æ·»åŠ å¤šæ¬¡ä¸€ä¸¾çš„ volatile!\nWhy the â€œvolatileâ€ type class should not be used â€” The Linux Kernel documentation\n  å†…æ•›æ±‡ç¼–ä¸­çš„ volatile\n  1asm volatile(\u0026#34;\u0026#34;:::\u0026#34;memory\u0026#34;);  volatile å‘ç¼–è¯‘å™¨è¯´æ˜ç¦æ­¢å†…æ•›çš„è¯­å¥ä¸å…¶ä»–è¯­å¥ reorderã€‚ä½†ä¸èƒ½ä¿è¯å†…éƒ¨ reorderï¼Œ é‚£æ˜¯ä¸‹é¢å†…å­˜å±éšœçš„ä»»åŠ¡ \u0026quot;memory\u0026quot; å‘ç¼–è¯‘å™¨è¯´æ˜å¯¹äºæ‰€æœ‰å†…å­˜è®¿é—®æ“ä½œï¼Œä¸èƒ½ä½¿ç”¨ asm ä¹‹å‰é¢„åŠ è½½åˆ°å¯„å­˜å™¨ä¸­çš„å€¼ ï¼Œè€Œå¿…é¡»åœ¨ asm å†…éƒ¨é‡æ–°åŠ è½½ã€‚ä¿è¯å…¶å†…éƒ¨è®¿é—®å†…å­˜å€¼å…·æœ‰å¯è§æ€§å’Œæ­£ç¡®æ€§ã€‚   å†…å­˜å±éšœ Memory Barrier å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æŒ‡ä»¤é¡ºåº, CPUå¹¶ä¸ä¼šä¸¥æ ¼çš„ä¾æ¬¡æ‰§è¡Œ, è€Œæ˜¯è¿›è¡Œæ›´åº•å±‚çš„\u0026quot;ä¼˜åŒ–\u0026quot;æ¥ä¿è¯é«˜æ•ˆç‡, å³CPUä¹±åºæ‰§è¡Œ(Out of order)ã€‚ å†…å­˜å±éšœæŒ‡ä»¤èƒ½å¤Ÿä¿è¯ä¹±åºæ‰§è¡Œä¸ä¼šè·¨è¿‡è¯¥æŒ‡ä»¤ã€‚\næ­£å¦‚ä¸‹é¢çš„ä¾‹å­, ä¸¤æ¡æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰æ•°æ®ç›¸å…³, æ‰€ä»¥æŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„.\n1ldr [x1], x2 # load x2 -\u0026gt; *x1 2str x3, [x4] # store *x4 -\u0026gt; x3 è€Œåœ¨æŒ‡ä»¤ä¸­é—´æ’å…¥ä¸€æ¡å†…å­˜å±éšœæŒ‡ä»¤, å°±èƒ½å¼ºåˆ¶ä¿è¯å†…å­˜å±éšœæŒ‡ä»¤åé¢çš„æŒ‡ä»¤ä¸èƒ½å…ˆäºå…¶å‰é¢çš„æŒ‡ä»¤æ‰§è¡Œ.\n1ldr [x1], x2 # load x2 -\u0026gt; *x1 2# An Memory Barrier Instruction 3str x3, [x4] # store *x4 -\u0026gt; x3 AArch64 å†…å­˜å±éšœæŒ‡ä»¤ AArch64 æä¾›äº†ä¸‰ç§ç±»å‹çš„å±éšœæŒ‡ä»¤, å…¶ä¸­DMBå’ŒDSBå±äºå†…å­˜å±éšœæŒ‡ä»¤:\n ISB(æŒ‡ä»¤åŒæ­¥å±éšœ) DMB(æ•°æ®å†…å­˜å±éšœ) DSB(æ•°æ®åŒæ­¥å±éšœ)  ISB å­—é¢ç¿»è¯‘ä¸ºæŒ‡ä»¤åŒæ­¥, æ‰§è¡ŒåæŒ‡ä»¤æµæ°´çº¿è¢«åˆ·æ–°, åç»­çš„æŒ‡ä»¤éœ€è¦å†æ¬¡fetch. å®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºä¸Šä¸‹æ–‡åŒæ­¥. ARMv8å°†ä¸Šä¸‹æ–‡å®šä¹‰ä¸ºç³»ç»Ÿå¯„å­˜å™¨çš„çŠ¶æ€, å¹¶å°†ä¸Šä¸‹æ–‡æ›´æ”¹æ“ä½œå®šä¹‰ä¸º: Cache, TLBå’Œåˆ†æ”¯é¢„æµ‹å™¨çš„ç»´æŠ¤æ“ä½œ, æˆ–å¯¹ç³»ç»Ÿå¯„å­˜å™¨çš„ä¿®æ”¹.\nè¿™äº›ä¸Šä¸‹æ–‡æ›´æ”¹æ“ä½œå¯¹å…¶åçš„æŒ‡ä»¤æ¥è¯´å¹¶ä¸æ˜¯ç«‹å³å¯è§çš„. åªæœ‰åœ¨å‘ç”Ÿä¸Šä¸Šä¸‹æ–‡åŒæ­¥äº‹ä»¶ä¹‹åæ‰å¯è§. æ‰€æœ‰çš„ä¸Šä¸‹æ–‡åŒæ­¥äº‹ä»¶åŒ…æ‹¬:\n å‘ç”Ÿå¼‚å¸¸ å¼‚å¸¸è¿”å› æ‰§è¡ŒISBæŒ‡ä»¤  æ‰€ä»¥ISBçš„ä½œç”¨å¯ä»¥è¡¨ç¤ºä¸º: åŒæ­¥ISBå‰é¢çš„ä¸Šä¸‹æ–‡æ›´æ”¹æ“ä½œ, å¹¶åˆ·æ–°æŒ‡ä»¤æµæ°´çº¿, ç¡®ä¿åé¢çš„æŒ‡ä»¤å¯è§æ–°çš„ä¸Šä¸‹æ–‡.\næ‰€æœ‰çš„ä¸Šä¸‹æ–‡æ›´æ”¹åéƒ½éœ€è¦æ·»åŠ ISBæŒ‡ä»¤æ¥ä¿è¯åç»­æŒ‡ä»¤æ‰§è¡Œæ—¶, æ›´æ”¹æ“ä½œå·²ç»å®Œæˆ. The following example shows how to enable the floating-point unit and SIMD, which you can do in AArch64 by writing to bit [20] of the CPACR_EL1 register. The ISB is a context synchronization event that guarantees that the enable is complete before any subsequent FPU or NEON instructions are executed.\n1 MRS X1, CPACR_EL1 // Copy contents of CPACR to X1 2 ORR X1, X1, #(0x3 \u0026lt;\u0026lt; 20) // Write to bit 20 of X1. (Enable FPU and SIMD) 3 MSR CPACR_EL1, X1 // Write contents of X1 to CPACR 4 ISB  This does not mean that an ISB is required after each instruction that modifies a processor register. For example, reads or writes to PSTATE fields, ELRs, SPs, and SPSRs always occur in program order relative to other instructions.\n DMB å†…å­˜å±éšœæŒ‡ä»¤ARMçš„å®ç°, ä¸Šé¢å·²ç»ä»‹ç»è¿‡. è¿™é‡Œå†ç»™å‡ºä¸€ä¸ªä¾‹å­:\n1 LDR X0, [X1] // Must be seen by the memory system before the 2 // STR below. 3 DMB ISHLD 4 ADD X2, #1 // May be executed before or after the memory 5 // system sees LDR. 6 STR X3, [X4] // Must be seen by the memory system after the 7 // LDR above. DSB åœ¨DMBçš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥é˜»æ­¢é™¤äº†å†…å­˜è¯»/å†™å¤–çš„å…¶ä»–æŒ‡ä»¤. å¦‚ä¸‹ç¤ºä¾‹ä¿è¯DCçš„æ‰§è¡Œç»“æœä¸ºADDæ“ä½œå¯è§ã€‚\nå…¶åå¯ä»¥è·ŸSEVæŒ‡ä»¤, å®ƒå°†ç­‰å¾…æ­¤å¤„ç†å™¨å‘å‡ºçš„æ‰€æœ‰Cacheã€TLBå’Œåˆ†æ”¯é¢„æµ‹å™¨ç»´æŠ¤æ“ä½œå®Œæˆ.\n1 DC ISW, X5 // operation must have completed before DSB can 2 // complete STR 3 STR X0, [X1] // Access must have completed before DSB can complete 4 DSB ISH 5 ADD X2, X2, #3 // Cannot be executed until DSB completes  ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒDMBå’ŒDSBæŒ‡ä»¤æ¥å—ä¸€ä¸ªå‚æ•°, ç”¨æ¥æŒ‡å®šç”Ÿæ•ˆçš„åœ°å€åŒºåŸŸ.\nLearn the architecture - ARMv8-A memory systems\n å•å‘å±éšœæŒ‡ä»¤ LDAR/STLR ä¸Šé¢ä»‹ç»çš„å±éšœæŒ‡ä»¤èƒ½å¤Ÿä¿è¯,: ç¨‹åºä¸­æ‰€æœ‰åœ¨å±éšœå‰é¢çš„å†…å­˜è®¿é—®åœ¨æ‰§è¡Œå±éšœæŒ‡ä»¤ä¹‹å‰é‚£ä¸€åˆ»å¯¹äºæ‰€æœ‰çš„masteréƒ½æ˜¯å¯è§çš„(visible). è¯´ä¸­å›½è¯å°±æ˜¯æŒ‡å®šå†…å­˜åŸŸ(é€šè¿‡å±éšœæŒ‡ä»¤çš„å‚æ•°æŒ‡å®š)çš„è®¿å­˜æŒ‡ä»¤ä¸èƒ½å¤Ÿè·¨è¿‡å±éšœæŒ‡ä»¤è€Œä¹±åºæ‰§è¡Œ.\n1+----------+ 2| LOAD +\u0026lt;--+ 3+----------+ | valid reorder 4| STORE +\u0026lt;--+ 5+----------+ 6| DMB | 7+----------+ 8| LOAD +\u0026lt;--+ 9+----------+ | valid reorder 10| LOAD +\u0026lt;--+ 11+----------+ 12 13+----------+ 14| LOAD +\u0026lt;--+ 15+----------+ | 16| STORE | | 17+----------+ | invalid reorder 18| DMB | | 19+----------+ | 20| LOAD | | 21+----------+ | 22| LOAD +\u0026lt;--+ 23+----------+ ç„¶è€Œ, è¿™ç§åŒå‘çš„barrierå¤ªè¿‡äºä¸¥æ ¼, ä»¥è‡´äºå¯¼è‡´ä¸å°‘æ€§èƒ½çš„æŸå¤±. æ‰€ä»¥, ARMv8æä¾›ç»™æˆ‘ä»¬å•å‘çš„å†…å­˜å±éšœæŒ‡ä»¤, LDAR/STLR\nLoad-Acquire (LDAR)\né™åˆ¶ç¨‹åºä¸­æ‰€æœ‰åœ¨LDARæŒ‡ä»¤ä¹‹åçš„å†…å­˜è®¿é—®å¿…é¡»åœ¨æ‰§è¡Œå®Œè¯¥LDARæŒ‡ä»¤åæ‰å¯¹å…¶ä»–masterå¯è§.\nç”¨ä¸­å›½è¯è¯´å°±æ˜¯ç¨‹åºä¸­æ‰€æœ‰åœ¨LDARä¹‹åæŒ‡ä»¤çš„å†…å­˜è®¿é—®éƒ½ä¸èƒ½è¢«execution-reorderåˆ°LDARä¹‹å‰.\nå†é€šä¿—ç‚¹, å°±æ˜¯ä»…ä»…è®¾å®šäº†ä¸€ä¸ªreorderçš„ä¸Šé™.\nStore-Release(STLR)\nå¯ä»¥å¯¹æ¯”LDAR, é™åˆ¶ç¨‹åºä¸­æ‰€æœ‰åœ¨STLRä¹‹å‰çš„è®¿å­˜æ“ä½œå¿…é¡»åœ¨æ‰§è¡ŒSTLRä¹‹å‰å°±å¯¹å…¶ä»–masterå¯è§, ä¸èƒ½å†å¾€åå»¶è¿Ÿäº†, é€šä¿—ç‚¹è¯´å°±æ˜¯è®¾ç½®äº†reorderçš„ä¸‹é™.\nç”¨ä¸€å¼ ARMç”¨æˆ·ç¼–ç¨‹æ‰‹å†Œä¸­çš„å›¾æ¥è§£é‡Š, é»‘è‰²ç®­å¤´ä»£è¡¨æ¯æ¡æŒ‡ä»¤æœ€è¿œèƒ½å¤Ÿreorderçš„è·¯å¾„.\n   ç‹¬å è®¿é—®æŒ‡ä»¤?? ","date":"2023-09-10T18:02:04+08:00","permalink":"https://wangloo.github.io/posts/armv8/memory_model_and_barrier/","section":"posts","tags":["armv8"],"title":"ARMv8 å†…å­˜æ¨¡å‹"},{"categories":["Operating System"],"contents":"SystemV IPC Linux å¼•å…¥äº† SystemV ä¸­ IPC çš„é›†ä¸­å®ç°æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼šä¿¡å·é‡ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‚\nå…±äº«å†…å­˜ å…±äº«å†…å­˜åŸºäºæ–‡ä»¶å®ç°ï¼Œç”¨æ“ä½œæ–‡ä»¶çš„æ–¹å¼æ¥æ“ä½œå…±äº«å†…å­˜åŒºã€‚\nåŸç†æ˜¯å¯¹ä¸€å—ç‰©ç†å†…å­˜åšå¤šä¸ªæ˜ å°„ï¼Œç”¨å¼•ç”¨è®¡æ•°æ¥ç»´æŠ¤ï¼Œåªæœ‰å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œæ‰èƒ½é‡Šæ”¾ã€‚\nå…±äº«å†…å­˜çš„ç‰¹ç‚¹æ˜¯ï¼š\n é€Ÿåº¦å¿«ï¼Œä½†è‡ªèº«æ²¡æœ‰åŒæ­¥åŠŸèƒ½ï¼Œéœ€è¦é…åˆå¤–éƒ¨çš„åŒæ­¥æœºåˆ¶ã€‚  ä¿¡å·é‡  ä¸ºä»€ä¹ˆè¯´ä¿¡å·é‡ä¹Ÿæ˜¯ä¸€ç§é€šä¿¡æœºåˆ¶?\nå…¶å®é€šä¿¡å¹¶ä¸ä¸€å®šå°±æ˜¯è¦å‘é€æ•°æ®ï¼Œåªè¦èƒ½å¤Ÿç›¸äº’æ„ŸçŸ¥ï¼Œé€šçŸ¥åˆ°å¯¹æ–¹ï¼Œå°±ç®—æ˜¯ä¸€ç§é€šä¿¡ã€‚ ç±»æ¯”æŠ›åªšçœ¼ä¹Ÿç®—æ˜¯é€šä¿¡çš„ä¸€ç§ã€‚\n æ¶ˆæ¯é˜Ÿåˆ—  å¹¶éåŸºäºæ–‡ä»¶ï¼Œç”±è‡ªå·±çš„ä¸€å¥—APIï¼Œä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ã€‚ æ¶ˆæ¯é˜Ÿåˆ—æ˜¯é¢å‘æ¶ˆæ¯çš„ï¼ˆå¹¶éå­—èŠ‚æµï¼‰ï¼Œæ¶ˆæ¯ç”±ç±»å‹ã€‚ æ¶ˆæ¯é˜Ÿåˆ—æœ‰è‡ªå·±çš„åŒæ­¥æœºåˆ¶ï¼Œæ— éœ€å¤–éƒ¨æ·»åŠ ã€‚  ä¿¡å· å¸¸ç”¨äºçˆ¶å­ä¹‹é—´é€šä¿¡ï¼Œåªè¦ä½ çŸ¥é“äº†å¯¹æ–¹çš„PIDï¼Œå°±å¯ä»¥ç»™å¯¹æ–¹å‘ä¿¡å·ã€‚\nç”¨kill(pid, signal)æ¥å‘é€ä¿¡å·ã€‚\n","date":"2023-09-08T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/os/linux/ipc/linux-ipc/","section":"posts","tags":["Operating System","linux"],"title":"Linux è¿›ç¨‹é—´é€šä¿¡æ¦‚è¿°"},{"categories":["Qemu"],"contents":"æŒ‡ä»¤ç¿»è¯‘ åœ¨ host ä¸Šè¿è¡Œ guest æ¶æ„ä»£ç çš„èƒ½åŠ›ç”± QEMU TCG æ¨¡å—æä¾›ã€‚\nTCG åšæŒ‡ä»¤ç¿»è¯‘çš„æ€è·¯æ˜¯ â€œè¾¹ç¿»è¯‘è¾¹æ‰§è¡Œâ€ï¼Œ å¹¶ä¸”å°†ç¿»è¯‘å·¥ä½œåˆ†ä¸ºå‰åç«¯ï¼Œä¸­é—´ä¼šæœ‰ä¸€å±‚ä¸­é—´æŒ‡ä»¤ï¼Œ è¿™æ ·èƒ½å¤Ÿæ–¹ä¾¿æ·»åŠ å¯¹æ–°æŒ‡ä»¤çš„æ”¯æŒã€‚è¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼äºç°ä»£ç¼–è¯‘å™¨ï¼Œä¹Ÿæ˜¯ç”±ç±»ä¼¼é—´ç»“æœçš„æµç¨‹ï¼Œç§°ä¸º IRã€‚\nTCG æ‰§è¡Œä¸€æ¬¡ç¿»è¯‘çš„å•ä½æ˜¯ Translation Blockï¼Œä»¥åˆ†æ”¯è·³è½¬ã€é¡µè¾¹ç•Œä¸ºåˆ’åˆ†æ¡ä»¶ã€‚\n","date":"2023-09-08T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/qemu/1/","section":"posts","tags":["qemu"],"title":"QEMU å·¥ä½œåŸç†"},{"categories":["Operating System"],"contents":"   åè¯ å«ä¹‰è§£é‡Š     Unix èµ·æºäºBELLå®éªŒå®¤çš„ä¸€ä¸ªæ“ä½œç³»ç»Ÿå®¶æ—, æŒ‡ä»£ä¸€ç±»OSã€‚\nè¿™äº›OSå…±åŒéµå®ˆUnixç‰¹æ€§ï¼Œä½†å„ä¸ªåˆ†æ”¯åœ¨å®ç°ä¸Šæœ‰æ‰€ä¸åŒã€‚\nåŒ…æ‹¬SystemVã€BSDç­‰åˆ†æ”¯   SystemV æ˜¯Unixçš„ç‰¹æ®Šç‰ˆæœ¬ï¼Œç”±AT\u0026amp;Tå…¬å¸å¼€å‘   GNU ç›®æ ‡æ˜¯å¼€å‘ä¸€ä¸ªå®Œå…¨è‡ªç”±ã€å¼€æºçš„OSï¼Œå€Ÿé‰´Unix   Linux OSå†…æ ¸ï¼Œå€Ÿé‰´äº†Linuxã€‚åä¸GNUå·¥å…·é›†ç»“åˆï¼Œç§°ä¸ºGNU/Linux                        ","date":"2023-09-08T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/os/abbreviation/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šç›¸å…³åè¯æ±‡æ€»"},{"categories":["Architecture"],"contents":"å…³äºPMU PMUæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œä¸å’Œä½“ç³»ç»“æ„ç»‘å®šã€‚è€Œæ˜¯æ¯ä¸ªSOCéƒ½å¯ä»¥ä¸åŒã€‚æ¯”å¦‚è¯´Cortex-A53å®ç°äº†PMUv3æ¶æ„ï¼Œä½†åˆ«çš„åŸºäºARMv8æ¶æ„çš„Socå¯èƒ½å®ç°PMUv4æˆ–è€…å…¶ä»–ç‰ˆæœ¬ã€‚\nPMUå†…éƒ¨æœ‰å…­ä¸ªè®¡æ•°å™¨ï¼Œæ‰€ä»¥å¯ä»¥è®°å½•å…­ä¸ªäº‹ä»¶çš„å‘ç”Ÿæ¬¡æ•°ã€‚è®¡æ•°å™¨çš„æ•°å€¼ä¸ä¸€å®šç»å¯¹çš„æ­£ç¡®ï¼Œå› ä¸ºç®¡é“çš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´è¿˜æ˜¯é€šè¿‡é•¿æ—¶é—´è®¡æ•°æ¥å‡å¼±å½±å“ã€‚\nPMUå’ŒETMçš„åŒºåˆ« 1. è®°å½•çš„äº‹ä»¶ä¸åŒ  PMUï¼šCache Missã€åˆ†æ”¯é¢„æµ‹å¤±è´¥ã€TLB Missç­‰ ETMï¼šè®°å½•åˆ†æ”¯æŒ‡ä»¤ã€å†…å­˜å±éšœæŒ‡ä»¤ç­‰æ‰€æœ‰æŒ‡ä»¤çš„æ‰§è¡Œï¼ŒåŒ…æ‹¬åœ°å€ã€ç»“æœç­‰ã€‚ å¦å¤–è¿˜å¯ä»¥è®°å½•æ•°æ®è¯»å†™çš„åœ°å€ã€ç»“æœï¼ˆå¯é€‰ï¼‰ã€‚  2. è®°å½•çš„ç²’åº¦ä¸åŒ  PMUï¼šä»…ç”¨è®¡æ•°å™¨æ¥è®°å½•äº‹ä»¶å‘ç”Ÿçš„æ¬¡æ•° ETMï¼šæŒ‡ä»¤çš„ç±»å‹ã€åœ°å€ã€æ‰§è¡Œç»“æœç­‰ã€‚æ•°æ®è®¿é—®ä¹Ÿç±»ä¼¼ã€‚  æ‰€ä»¥è¯´ï¼ŒETMçš„ä¿¡æ¯é‡å¤§ï¼Œéœ€è¦ä¸“é—¨çš„ç¼“å­˜æœºåˆ¶ã€‚è€ŒPMUåªéœ€åœ¨å®šæ—¶å™¨ç»“æŸæ—¶è®°å½•å‘ç”Ÿçš„æ¬¡æ•°å°±è¡Œï¼Œ ä¸éœ€è¦ä»€ä¹ˆç¼“å­˜ï¼Œæ²¡æœ‰å®é™…çš„æ•°æ®æµã€‚\n","date":"2023-09-02T22:02:04+08:00","permalink":"https://wangloo.github.io/posts/armv8/pmu/","section":"posts","tags":["armv8"],"title":"Cortex-A53 PMUä»‹ç»"},{"categories":["Hugo"],"contents":"footerå±äº partialæ¨¡æ¿ä¹‹ä¸€, åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶footer.html, ç„¶ååœ¨baseofæ¨¡æ¿ä¸­, æŒ‡å®šfooterå†…å®¹æ˜¾ç¤ºçš„ä½ç½®.\n1\u0026lt;body\u0026gt; 2 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; 3 {{- partial \u0026#34;sidebar.html\u0026#34; . -}} 4 \u0026lt;main class=\u0026#34;container\u0026#34;\u0026gt; 5 {{- block \u0026#34;main\u0026#34; . }} 6 {{- end }} 7 {{- partial \u0026#34;footer.html\u0026#34; . -}} 8 \u0026lt;/main\u0026gt; 9 {{- partial \u0026#34;script.html\u0026#34; . -}} 10 \u0026lt;/div\u0026gt; 11 12\u0026lt;/body\u0026gt; ä¸‹é¢å°†æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†, æ·»åŠ å„ç§å†…å®¹åˆ°footeræ¨¡æ¿ä¸­.\næ–‡ä»¶åˆ›å»ºå’Œlastmodeæ—¶é—´  commit: https://github.com/wangloo/hugo-theme-puer/commit/d263d9af65808ff03b2307abfb4db397ae1bcc2a\n æ–‡ä»¶åˆ›å»ºæ—¶é—´æ˜¯è·å–çš„footerä¸­çš„å˜é‡, lastmodå…¶å®ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è·å–, ä½†æ˜¯è¿™æ ·æ¯æ¬¡ä¿®æ”¹éƒ½è¦æ‰‹åŠ¨æ›´æ–°å¤ªå¤æ‚, æˆ‘ä»¬å¯ä»¥å€ŸåŠ©gitè¿½è¸ªçš„æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ¥ä½œä¸ºlastmod, é»˜è®¤ä¸æ˜¯è¿™æ ·çš„, éœ€è¦åœ¨config.tomlä¸­æŒ‡å®š.\n1[frontmatter] 2 lastmod = [\u0026#39;lastmod\u0026#39;, \u0026#39;:git\u0026#39;, \u0026#39;:fileModTime\u0026#39;, \u0026#39;date\u0026#39;, \u0026#39;publishDate\u0026#39;] ç„¶åå°±æ˜¯åœ¨footer.htmlä¸­å¼•ç”¨è¿™ä¸¤ä¸ªå˜é‡å³å¯:\n1\u0026lt;HR width=\u0026#34;100%\u0026#34; id=\u0026#34;EOF\u0026#34;\u0026gt; 2 3{{- if not .Lastmod.IsZero -}} 4 \u0026lt;p style=\u0026#34;color:#777;\u0026#34;\u0026gt;åˆ›å»ºäº: {{ .Date.Format \u0026#34;2006-01-02T15:04:05\u0026#34;}}, Lastmod: {{ .Lastmod.Format \u0026#34;2006-01-02T15:04:05\u0026#34;}}\u0026lt;/p\u0026gt; 5{{- end -}} ","date":"2023-09-02T18:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_7/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(7): footer"},{"categories":["Algorithm"],"contents":"å®é™…ä¸Šæˆ‘åšè¿‡çš„äºŒåˆ†æœç´¢çš„é¢˜ç›®å¹¶ä¸å°‘ï¼Œä½†æ˜¯ä¸€ç›´ä»¥æ¥æ²¡æœ‰é™ä¸‹å¿ƒå»ç ”ç©¶å®ƒçš„ ã€å¾ªç¯æ¡ä»¶ã€‘ã€è¾¹ç•Œè°ƒæ•´ã€‘ã€è¿”å›å€¼ã€‘çš„ç»†èŠ‚ï¼Œé€šè¿‡è¿™ä¸ªé¢˜ç›®å¸Œæœ›è‡ªå·±èƒ½å®Œæ•´ã€ æ¸…æ™°çš„äº†è§£äºŒåˆ†æœç´¢ã€‚\né¢˜ç›® https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array\n ç»™ä½ ä¸€ä¸ªæŒ‰ç…§éé€’å‡é¡ºåºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯·ä½ æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚\nå¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ targetï¼Œè¿”å› [-1, -1]ã€‚\nä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚\n ç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 8 è¾“å‡ºï¼š[3,4]\n  è§£ç­”(python): 1def searchRange(self, nums: List[int], target: int) -\u0026gt; List[int]: 2 3 if nums == []: 4 return [-1, -1] 5 6 # ç¬¬ä¸€æ¬¡äºŒåˆ†ï¼Œç¡®å®šå³è¾¹ç•Œ 7 left, right = 0, len(nums)-1 8 while left \u0026lt;= right: 9 mid = (left + right) // 2 10 if nums[mid] \u0026lt;= target: 11 left = mid+1 12 else: 13 right = mid-1 14 end = right 15 16 # ç¬¬äºŒæ¬¡äºŒåˆ†ï¼Œç¡®å®šå·¦è¾¹ç•Œ 17 left, right = 0, len(nums)-1 18 while left \u0026lt;= right: 19 mid = (left + right) // 2 20 if nums[mid] \u0026lt; target: 21 left = mid+1 22 else: 23 right = mid-1 24 sta = left 25 26 print(sta, end) 27 if end \u0026lt; 0 or sta \u0026gt; len(nums)-1 or nums[sta] != target or nums[end] != target: 28 return [-1, -1] 29 else: 30 return [sta, end] ç»†èŠ‚ å†™å¥½ä¸€ä¸ªäºŒåˆ†æœç´¢å°±æ˜¯éœ€è¦ç¡®å®šä¸‰ä»¶äº‹:\n å¾ªç¯è¾¹ç•Œæ¡ä»¶ è°ƒæ•´è¾¹ç•Œ è¿”å›å€¼  è¿™ä¸‰ä»¶äº‹æ˜¯ç¯ç¯ç›¸æ‰£çš„ï¼Œå…ˆè¯´ç¡®å®šçš„ï¼Œè°ƒæ•´è¾¹ç•Œçš„æ“ä½œä¸€å®šæ˜¯left=mid+1 or right=mid-1, æ•´æ•°çš„äºŒåˆ†ä¸å­˜åœ¨left=midè¿™ç§æ“ä½œï¼Œä»…é™äºæµ®ç‚¹æ•°ä¸­ã€‚\nå†è¯´è¾¹ç•Œæ¡ä»¶ï¼Œæˆ‘ä¸ªäººå–œæ¬¢ä½¿ç”¨å¸¦ç­‰å·çš„åˆ¤æ–­ï¼Œå³while left \u0026lt;= right, è¿™çº¯ç²¹æ˜¯ä¸ªäººä¹ æƒ¯.\né—®é¢˜è½¬åŒ– ä»¥æ±‚å³ä¾§ä¸‹æ ‡ä¸ºä¾‹, å¯ä»¥ç­‰ä»·ä¸º: æœç´¢\u0026lt;=targetçš„æœ€å¤§å€¼. è¿™å…¶å®æ˜¯é—®é¢˜çš„å…³é”®, åªæ˜¯å¦å¤–åŠ ä¸€ä¸ªåˆ¤æ–­è¯´å¦‚æœæ±‚å¾—æ•° ä¸æ˜¯target, è¿”å›ç‰¹æ®Šå€¼å°±è¡Œäº†. å¦‚æœä½ è¿˜æ˜¯ä¸ç†è§£è¿™ä¸¤ä¸ªé—®é¢˜ä¸ºä»€ä¹ˆæ˜¯ç­‰ä»·çš„, é‚£ä¹ˆçœ‹å®Œä¸‹é¢çš„è§£é‡Šåº”è¯¥ä¹Ÿèƒ½æ¸…æ¥š.\nå…ˆè¯´æœç´¢\u0026lt;=targetçš„æœ€å¤§å€¼çš„è®¡ç®—æ–¹æ³•, ä¸€èˆ¬çš„äºŒåˆ†æœç´¢, æœç´¢å®Œæˆä¹‹å, å¦‚æœæ²¡æœ‰æ‰¾åˆ°target, right=left-1, ä¸” right æŒ‡å‘æ¯” target é¦–ä¸ªå°çš„å…ƒç´ ,left æŒ‡å‘é¦–ä¸ªæ¯” target å¤§çš„å…ƒç´ .\né‚£ä¹ˆä»£ç æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆå†™:\n1left, right = 0, n-1 2while left \u0026lt;= right: 3 mid = (left + right) // 2 4 if nums[mid] == target: 5 return mid 6 elif nums[mid] \u0026lt; target: 7 left += 1 8 else: 9 right += 1 10 11return right æ›´è¿›ä¸€æ­¥çš„è¯´, å¦‚æœ\u0026quot;æŠŠtargetä¹Ÿçœ‹ä½œæ˜¯å°äºtarget\u0026quot;, ä¹Ÿå°±æ˜¯è®©å¾ªç¯ä¸åœä¸‹, æœ€åå¹³è¡¡çš„æ¡ä»¶ä¹Ÿä¸€å®šæ˜¯æ»¡è¶³ right æŒ‡å‘æ¯” target é¦–ä¸ªå°çš„å…ƒç´ ,left æŒ‡å‘é¦–ä¸ªæ¯” target å¤§çš„å…ƒç´ ., åªä¸è¿‡æ­¤æ—¶=target ä¹Ÿè¢«ç®—ä½œæ˜¯å°äºtarget, èµ°å°äºtargetçš„å¤„ç†æµç¨‹. æœ€ç»ˆçš„ç»“æœå°±æ˜¯rightæŒ‡å‘çš„å°±æ˜¯target(å¦‚æœå­˜åœ¨), è¦ä¸å°±æ˜¯æ¯”targetå°çš„é‚£ä¸ªæ•°.\näºæ˜¯ä»£ç å°±å¯ä»¥è¢«ä¼˜åŒ–ä¸º:\n1left, right = 0, n-1 2while left \u0026lt;= right: 3 mid = (left + right) // 2 4 if nums[mid] \u0026lt;= target: 5 left += 1 6 else: 7 right += 1 8 9return right å†å®¡åŸé¢˜ ä¸Šè¿°è¿™ç§è¿›ä¸€æ­¥æ€è€ƒçš„æ€æƒ³æ˜¯ä¸æ˜¯ä¸åŸé¢˜ä¸­çš„è¦æ±‚ç±»ä¼¼? æˆ‘å¯ä»¥æœ‰ä¸€è¿ä¸²çš„target, æˆ‘è¦æ±‚çš„æ˜¯æœ€å³è¾¹çš„targetåœ¨å“ª, å¦‚æœæŠŠ=targetä¹Ÿçœ‹ä½œæ˜¯å°äºtarget, è®©å¾ªç¯ç»§ç»­è·‘, æœ€årightæŒ‡å‘çš„å°±æ˜¯æœ€å³è¾¹çš„é‚£ä¸ªtarget.\n","date":"2023-08-20T20:30:35+08:00","permalink":"https://wangloo.github.io/posts/algorithm/bsearch/","section":"posts","tags":["Algorithm"],"title":"ä¸€é“é¢˜æå®šäºŒåˆ†æ³•çš„ç»†èŠ‚"},{"categories":["Life"],"contents":"èƒ¶ç‰‡é£æ ¼å—å¤§ä¼—å–œçˆ± å¯Œå£«çš„ä»·æ ¼ä¸ºä»€ä¹ˆè¢«ç‚’çš„è¶Šæ¥è¶Šé«˜ï¼Ÿå¦‚æœå•è¯´æ˜¯å¤–è§‚ï¼Œé‚£å°¼åº·çš„zfcã€ç´¢å°¼ã€ä½³èƒ½çš„ä¸€äº›å¾®å•å¹¶ä¸è¾“ç»™ä»–å¾ˆå¤šï¼Œ æˆ‘è§‰å¾—å…¶ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› å°±æ˜¯å¯Œå£«çš„èƒ¶ç‰‡æ¨¡æ‹Ÿé£æ ¼ã€‚\nä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘å½“ç„¶çŸ¥é“è¿™äº›éƒ½æ˜¯è½¯ä»¶å±‚é¢çš„ä¸œè¥¿ï¼Œ å…¶ä»–å‚å®¶å¦‚æœæƒ³åšæ˜¯å®Œå…¨å¯ä»¥åšçš„ï¼Œå¯èƒ½ä»–ä»¬å¯¹è¿™å—ä¹Ÿæ²¡ä»€ä¹ˆå…´è¶£ã€‚ä¸å¾—ä¸æ‰¿è®¤å¯Œå£«å¯èƒ½åœ¨è¿™æ–¹é¢åšäº†ä¸€äº› åŠŸå¤«ï¼Œå¾ˆå¯èƒ½å¹¶ä¸å•å•åªæ˜¯é¢œè‰²è°ƒæ•´è€Œå·²ï¼Œå®ƒå¯¹äºé«˜å…‰éƒ¨åˆ†æœ‰æ›´åŠ ç»†è‡´çš„å¤„ç†ã€‚\nä»Šå¤©ä¸»è¦æƒ³è¯´çš„æ˜¯ä¸ºä»€ä¹ˆè¿™ç§å¤è€çš„é£æ ¼ä¼šå†æ¬¡é£é¡ï¼Ÿï¼Œå¦‚ä»Šæ•°ç æ—¶ä»£çš„è¿›æ­¥ä½¿å¾—ä¸€å¼ ç…§ç‰‡çš„æ¸…æ™°åº¦ã€è¿˜åŸçœŸå®è¯šç¨‹åº¦é£™å‡ï¼Œ ä¸ºä½•è¿˜è¦å»è¿½æ±‚è¿™ç§æ¨¡ç³Šä¸åšæ—§å‘¢ï¼Ÿè¿™æ˜¯å®¡ç¾çš„å€’é€€å—ï¼Ÿ\næˆ‘è§‰å¾—ï¼Œæˆ‘ä»¬å¯¹ç¾çš„è®¤è¯†æˆ–è€…è¯´å®šä¹‰å¹¶ä¸æ˜¯éšç€ç§‘æŠ€çš„è¿›æ­¥è€Œè¿›æ­¥çš„ï¼Œæœ‰ä¸€äº›ä¸œè¥¿æ˜¯ä¸éœ€è¦åˆ›æ–°æˆ–è€…è¯´æ— æ³•è¿›è¡Œåˆ›æ–°çš„ï¼Œ è€çš„ã€æ—§çš„å¹¶ä¸ä¸€å®šå°±å·®äºç°ä»£çš„ï¼Œè¡¡é‡ç¾çš„æ ‡å‡†å¯èƒ½å°±æ˜¯å¦‚æ­¤ã€‚\né‚£ä¹ˆæˆ‘å°±æƒ³ï¼Œå…¶ä»–ä¸œè¥¿æ˜¯å¦ä¹Ÿä¼šè¿™æ ·å‘¢ï¼Ÿæ˜¯å¦åœ¨è¿‡äº†å‡ åå¹´å‡ ç™¾å¹´çš„å‘å±•ä¹‹åï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥å†çœ‹ï¼Œè¿˜ä¸å¦‚åŸæ¥å›ºæœ‰çš„ã€‚ æˆ‘æƒ³ä¸­åæ–‡åŒ–å°±åœ¨è¿™ä¹‹åˆ—ï¼Œæˆ‘ä»¬ç›²ç›®çš„å­¦ä¹ è¥¿æ–¹è¿½æ±‚è‡ªç”±ã€ç»å¯¹çš„å¹³ç­‰ï¼Œæˆ‘ç›¸ä¿¡æ—¶é—´ä¼šè¯æ˜è¿™ä¸æ˜¯é€‚åˆä¸­å›½äººçš„ç¤¾ä¼šé£æ°”ã€‚\n","date":"2023-08-20T20:30:35+08:00","permalink":"https://wangloo.github.io/posts/photo/blog/","section":"posts","tags":["photo"],"title":"è¿‘æœŸå¯¹äºæ‘„å½±çš„æ„Ÿæ‚Ÿ"},{"categories":["Hugo"],"contents":"shortcode å¯ä»¥å½“æˆæ˜¯ä¸€äº›å¯¹ html ä»£ç å—å°è£…çš„å‡½æ•°ï¼Œåœ¨å†™ markdown çš„æ—¶å€™å°±ä¼šæ–¹ä¾¿ä¸€äº›ï¼Œ ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œæˆ‘æœ‰æ—¶éœ€è¦å¾€ post ä¸­æ’å…¥å›¾ç‰‡ï¼Œå¹¶è°ƒæ•´å®ƒçš„å¤§å°ï¼Œè¿™æ—¶å€™æ¯æ¬¡éƒ½æ‰‹åŠ¨å†™ä¸€äº› html ç®€ç›´æ˜¯å¤ªéº»çƒ¦äº†ï¼Œä½¿ç”¨ shortcode å°±åƒæ˜¯è°ƒç”¨å‡½æ•°ä¸€æ ·ï¼Œå‘Šè¯‰å®ƒå‡½æ•°åå’Œå¿…è¦çš„å‚æ•°ï¼Œ å®ƒä¼šåœ¨ç”Ÿæˆç½‘é¡µæ—¶è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„ html è¯­æ³•ã€‚\nshortcode åˆ†ä¸ºä¸¤ç§ï¼šHugo é»˜è®¤å’Œè‡ªå®šä¹‰çš„ã€‚Hugo é»˜è®¤æ”¯æŒçš„ shortcode æœ‰è¿™äº› https://gohugo.io/content-management/shortcodes/ ï¼Œè¿™é‡Œé¢åŒæ—¶åŒ…å«äº†å‘Šè¯‰æˆ‘ä»¬å¦‚æœä½¿ç”¨ shortcode çš„åŸºæœ¬è¯­æ³•ã€‚\nå½“ç„¶hugoæ”¯æŒåˆ›å»ºè‡ªå®šä¹‰ shortcodeï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥çœ‹è¿™é‡Œï¼Œ https://gohugo.io/templates/shortcode-templates/ ï¼Œæˆ‘ä¼šå¤§æ¦‚è¯´ä¸€ä¸‹ã€‚\n å®šä¹‰ä¸€ä¸ªæ–°çš„shortcodeï¼Œå³åœ¨layouts/shortcodes/ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„xxx.htmlæ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯ä½ çš„å‡½æ•°å è¿™ä¸ªshortcodeä¼šåšä»€ä¹ˆäº‹ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªhtmlä¸­è¿›è¡Œå®ç°  æ’å…¥é“¾æ¥å›¾ç‰‡ remoteFigureï¼Œå‚è€ƒçš„æ˜¯diaryä¸»é¢˜çš„å®ç°æ”¯æŒè°ƒæ•´å›¾ç‰‡å¤§å°ã€å¡«å……æ ·å¼ã€å¯¹é½ã€æ·»åŠ å›¾ç‰‡æè¿°ç­‰ã€‚\n puer ä¸»é¢˜çš„ Github commit\n ","date":"2023-08-20T18:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_6/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(6): shortcode"},{"categories":["C Language"],"contents":"C ä¸­çš„qsort, python ä¸­çš„sorted()å¾ˆå¤šæ—¶é—´éœ€è¦è‡ªå·±æ„é€ æ¯”è¾ƒçš„è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰æ’åºå‡½æ•°æ€ä¹ˆè¡¡é‡ä¸¤ä¸ªå€¼çš„å¤§å°å…³ç³»ï¼Ÿ\nTL;DR å‡åºçš„å†™æ³•(C-qsort):\n1int cmp(const void *a, const void *b) 2{ 3 return *(int *)a - *(int *)b; 4} 5 6int main(void) 7{ 8 int nums[] = {2, 1, 3, 5, 4}; 9 10 qsort(nums, 5, sizeof(int), cmp); 11 return 0; 12} å‡åºçš„å†™æ³•(python-sorted()):\n1from functools import cmp_to_key 2nums = [2, 3, 1, 4, 5] 3 4nums = sorted(nums, key=cmp_to_key(lambda x,y: x-y)) 5print(nums)  python3 ä¸¢å¼ƒäº†sorted()ä¸­çš„cmpé€‰é¡¹ï¼Œ å…¨éƒ¨ç”¨ key é€‰é¡¹è¿›è¡ŒæŒ‡å®šï¼Œ æ‰€ä»¥éœ€è¦cmp_to_keyè¿›è¡Œè½¬æ¢\n å‡åºçš„å†™æ³•(C++-sort()):\n1// sort()åŸå‹ 2void sort (RandomAccessIterator first, RandomAccessIterator last, Compare comp); 3 4bool cmp(int a, int b){ 5 return a \u0026lt; b; 6} 7 8int main(){ 9 int a[10]={8 ,3 ,10 ,9 ,5}; 10 sort(a,a+10,cmp); 11 return 0; 12} è¯¦è§£ æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œcmp å‡½æ•°çš„ä½œç”¨æ˜¯ç»™æ’åºå‡½æ•°ä¸€ä¸ªæ¯”è¾ƒçš„ä¾æ®ã€‚\n  c å’Œ python çš„ cmp å‡½æ•°å±äºåŒä¸€ç§ï¼Œè¿”å›çš„æ˜¯ int ç±»å‹çš„å€¼ï¼Œä»£è¡¨çš„å«ä¹‰æ˜¯ï¼ša ç›¸å¯¹äº b çš„ä½ç½®ã€‚ è¿”å›æ­£æ•°ä»£è¡¨ a åœ¨ b ä¹‹åï¼Œè´Ÿæ•°åˆ™åä¹‹ã€‚æ‰€ä»¥ç”¨a-bç®—å¼å°±èƒ½è¡¨è¾¾å‡åºæ’åº\n  è€Œ C++è¿”å›çš„åˆ™æ˜¯å¸ƒå°”å€¼ï¼Œä»£è¡¨çš„å«ä¹‰æ˜¯ï¼ša æ’åœ¨ b çš„å‰é¢å—?ï¼Œæ‰€ä»¥ç”¨a\u0026lt;bï¼Œ ä¹Ÿèƒ½è¡¨è¾¾å‡åºæ’åº\n  è¿™æ ·çœ‹èµ·æ¥ï¼Œè²Œä¼¼ c++çš„å†™æ³•æ›´å¥½ç†è§£ä¸€äº›ã€‚\n æœ‰æ—¶æˆ‘ä»¬ä¼šçœ‹åˆ° python ä¸­è¿™æ ·è¡¨ç¤ºå‡åº:\n1lambda x,y: -(x \u0026lt; y) è¿™å…¶å®æ˜¯å’Œx-yçš„æ•ˆæœæ˜¯ç›¸åŒçš„, åªæ˜¯æœ‰çš„æ—¶å€™ä¸€äº›ç±»å‹ä¸èƒ½å¤Ÿç›¸å‡ï¼Œæ¯”å¦‚è¯´å­—ç¬¦ä¸²ï¼Œ ä½†æ˜¯å¯ä»¥ä½¿ç”¨\u0026lt;\u0026gt;æ¯”è¾ƒï¼Œæ‰€ä»¥æ‰§è¡Œè¿™æ ·ä¸€ä¸ªè½¬æ¢çš„å° trickã€‚\n ","date":"2023-08-20T17:59:22+08:00","permalink":"https://wangloo.github.io/posts/c/cmp-func/","section":"posts","tags":["c","python"],"title":"C/python: cmpå‡½æ•°åº”è¯¥æ€ä¹ˆå†™"},{"categories":null,"contents":"æ’åº ä½¿ç”¨sorted()æ¥åš, ä¸ä¿®æ”¹åŸæ¥çš„å˜é‡, è€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ã€‚ è‡ªå®šä¹‰cmpå‡½æ•°çš„ä¾‹å­\n è¢«æ’åºçš„ç±»å‹å¿…é¡»æ˜¯iterableçš„ã€‚\n å­—ç¬¦ä¸² æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² 1def lengthOfLongestSubstring(self, s: str) -\u0026gt; int: 2 mp = {} 3 left, right = 0, 0 4 max_len = 0 5 6 while right \u0026lt; len(s): 7 if s[right] not in mp: 8 mp[s[right]] = 1 9 else : 10 mp[s[right]] += 1 11 12 while mp[s[right]] \u0026gt; 1: 13 mp[s[left]] -= 1 14 left += 1 15 max_len = max(max_len, right-left+1) 16 right += 1 17 return max_len ç‰›å®¢ç½‘å¤„ç†è¾“å…¥ https://blog.nowcoder.net/n/0632a788b94b4923976b7c82c45eca95\nå†™é€’å½’ é‡åˆ°éœ€è¦ç”¨é€’å½’çš„é¢˜ç›®ä¸­, å¸¸å¸¸éœ€è¦ä¼ å€¼å‡ºæ¥. æ¯”å¦‚å†™ä¸€ä¸ªæ±‚ sum(1..n)çš„å‡½æ•°\nè¿™æ ·å†™æ˜¯é”™è¯¯çš„, å› ä¸ºæ¯æ¬¡å¯¹ Sum çš„æ›´æ–°éƒ½æ˜¯å±€éƒ¨çš„, å¹¶ä¸ä¼šå½±å“åˆ° parent frame çš„å€¼. æ‰€ä»¥æœ€åä¼ å‡ºçš„å€¼ä¸€å®šæ˜¯ 0\n1def func(n, Sum): 2 if n == 0: 3 return 4 else: 5 Sum+= n 6 func(n-1, Sum) 7 8result = 0 9func(3, result) æœ‰ä¸¤ä¸ªæ–¹æ¡ˆè§£å†³:\n ä½¿ç”¨å…¨å±€å˜é‡æ¥ä¿å­˜ç»“æœ, è§å…¨å±€å˜é‡ç« èŠ‚ å°†ä¼ å‡ºçš„å‚æ•°ç”¨å¯ä¿®æ”¹çš„ç±»å‹æ¥ä¿å­˜, æ¯”å¦‚è¯´ List. ä»¥ä¸Šä»£ç å¯ä»¥ä¿®æ”¹ä¸º:  1def func(n, Sum): 2 if n == 0: 3 return 4 else: 5 Sum[0] += n 6 func(n-1, Sum) 7 8result = [0] 9func(3, result) å…¨å±€å˜é‡çš„ä½¿ç”¨ åœ¨å†™æœºè¯•é¢˜æ—¶, ä¸€èˆ¬ä¸ä¼šå‡ºç°å‡½æ•°åµŒå¥—, æ‰€ä»¥ç”¨ä¸åˆ°nonlocalå…³é”®å­—.\nåè€Œéœ€è¦ä½¿ç”¨globalå…³é”®å­—, ä½¿ç”¨çš„æ–¹æ³•ä¸º:\n1max_len = 0 2 3def dfs(..): 4 global max_len 5 # åœ¨dfs()ä¸­ä¿®æ”¹æˆ–è€…è®¿é—®çš„max_lenå°±æ˜¯å…¨å±€çš„äº† 6 ... è¿›åˆ¶ä»¥åŠ ascii ç è½¬æ¢ ascii å’Œå­—ç¬¦ç›¸äº’è½¬æ¢, ord()å’Œchr()äº’ä¸ºé€†å‡½æ•°:\n1c = \u0026#39;a\u0026#39; 2ac = ord(c) # 65 3c = chr(ac) # \u0026#39;a\u0026#39; è¿›åˆ¶è½¬æ¢\n å¦‚æœè¦ç”Ÿæˆæ•´å‹æ•°æ®, ä¸ç®¡ä»€ä¹ˆè¿›åˆ¶, ç»Ÿä¸€ä½¿ç”¨int()åœ¨æœ€å¤–å±‚ å¦‚æœè¦ç”Ÿæˆå­—ç¬¦ä¸², ç»Ÿä¸€ä½¿ç”¨format()åœ¨æœ€å¤–å±‚, å½“ç„¶å®ƒå’Œbin(), hex()è¿™ç±»æ˜¯ç­‰ä»·çš„  ä¸‹é¢ç»™å‡ºå‡ ä¸ªå¸¸ç”¨çš„ä¾‹å­:\n1# \u0026#39;1010\u0026#39; -\u0026gt; 10 2int(\u0026#39;1010\u0026#39;, 2) # 10 3# 10 -\u0026gt; \u0026#39;1010\u0026#39; äºŒè¿›åˆ¶å­—ç¬¦ä¸² 4format(10, \u0026#39;b\u0026#39;) # \u0026#39;1010\u0026#39; 5format(10, \u0026#39;#b\u0026#39;) # \u0026#39;0b1010\u0026#39; , ç­‰ä»·äºbin(10)çš„ç»“æœ 6# 10 -\u0026gt; \u0026#39;12\u0026#39; å…«è¿›åˆ¶çš„å­—ç¬¦ä¸² 7format(10, \u0026#39;o\u0026#39;) # \u0026#39;12\u0026#39; 8format(10, \u0026#39;#o\u0026#39;) # \u0026#39;0o12\u0026#39; , ç­‰ä»·äº oct(10)çš„ç»“æœ æµ®ç‚¹æ•°çš„å¤„ç† æµ®ç‚¹æ•°æ‰“å°ç²¾åº¦(å››èˆäº”å…¥)\n1x = 1.23 2print(\u0026#34;{:.1f}\u0026#34;.format(x)) 3print(format(x, \u0026#39;.1f\u0026#39;)) # æˆ‘è‡ªå·±ä¹ æƒ¯ç»Ÿä¸€ä½¿ç”¨æ­¤æ–¹æ³• å­—ç¬¦ä¸²/å­—ç¬¦çš„å¸¸ç”¨å¤„ç†  å­—ç¬¦ä¸²ä¸­å«æœ‰éå­—æ¯è½¬å°å†™/å¤§å†™: å¯ç›´æ¥è°ƒç”¨.lower(), .upper() éå­—ç¬¦ä¼šé»˜è®¤ä¿æŒä¸å˜  string å’Œ list ç›¸äº’è½¬æ¢\n1# list to str 2a = [\u0026#39;h\u0026#39;, \u0026#39;e\u0026#39;, \u0026#39;l\u0026#39;, \u0026#39;l\u0026#39;, \u0026#39;o\u0026#39;] 3s = \u0026#39;\u0026#39;.join(a) 4 5# str ot list 6s = \u0026#39;hello\u0026#39; 7a = list(s) å­—ç¬¦ä¸²æ˜¯å¤šä¸ªæ•°å­—å­—æ®µçš„ç»„åˆ, å¦‚ä½•åˆ†å‰²æ¯ä¸ªå­—æ®µè½¬æˆintå¹¶å­˜å…¥ list:\n1s = \u0026#34;10 20 30\u0026#34; 2s = s.split() 3l = [int(x) for x in s] å­—ç¬¦å’Œæ•´æ•°ä¹‹é—´çš„è½¬æ¢\n1# c = \u0026#39;b\u0026#39; 2c = chr(ord(\u0026#39;a\u0026#39;)+1) 3 4# c = \u0026#39;2\u0026#39; 5c = chr(ord(\u0026#39;1\u0026#39;)+1) å­—ç¬¦ä¸²å›æ–‡åˆ¤æ–­\n1s == s[::-1] ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„æ¬¡æ•°: ä¸ä¸€å®šè¦å€Ÿç”¨å­—å…¸\nstring å’Œå…ƒç»„ä¸€æ ·, æœ‰.count(x)æ–¹æ³•ç»Ÿè®¡ x çš„å‡ºç°æ¬¡æ•°\n1s = input() 2 3for i in s: 4 if s.count(i) == 1: 5 print(i) 6 break 7else: 8 print(\u0026#39;-1\u0026#39;) æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«å¦ä¸€å­—ç¬¦ä¸², ä¸è¦å†ä½¿ç”¨.find() != -1äº† ç›´æ¥ä½¿ç”¨inå…³é”®å­—å³å¯\n1if s1 in s2: 2 print(\u0026#34;s1 is included in s2\u0026#34;) å­—ç¬¦ä¸²åˆ é™¤æŒ‡å®šå­—ç¬¦:\n1s = \u0026#34;hello\u0026#34; 2#åˆ é™¤æ‰€æœ‰ l 3s = s.replace(\u0026#39;l\u0026#39;, \u0026#39;\u0026#39;) 4#åˆ é™¤å‰ä¸€ä¸ª l 5s = s.replace(\u0026#39;l\u0026#39;, \u0026#39;\u0026#39;, 1) å­—å…¸çš„å¸¸ç”¨å¤„ç† å­—å…¸æŒ‰ç…§ value æ’åº:\n1# è¿”å›é™åºçš„value list 2d = {} 3l = list(sorted(d.values(), reverse=True)) 4# è¿”å›æŒ‰valueå‡åºæ’åºçš„çš„å­—å…¸ 5d_sorted = dict(sorted(d.items(),key=lambda x: x[1])) 6# è¿”å›valueé™åºçš„å­—å…¸ 7d_sorted = dict(sorted(d.items(), key=lambda x: -x[1])) 8# è¿”å›æŒ‰valueé™åº,å¦‚æœvalueç›¸åŒæ—¶æŒ‰keyå‡åºæ’åºçš„å­—å…¸ 9d_sorted = dict(sorted(d.items(), key=lambda x: (-x[1], x[0]))) é›†åˆ 1# åˆ›å»ºä¸€ä¸ªç©ºé›†åˆ 2s = set() 3# é›†åˆä¸­æ·»åŠ å…ƒç´  4s.add(123) åˆ—è¡¨çš„å¸¸ç”¨å¤„ç† å»ºç«‹éé‡å¤çš„åˆ—è¡¨, C++ä¸­çš„é›†åˆ(set)\n1s = \u0026#34;abcdabcd\u0026#34; # æƒ³è¦å¾—åˆ°[\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;] 2set_list = [] 3for c in s: 4 if c not in set_list: 5 set_list.append(c) åˆ—è¡¨åˆ é™¤å…ƒç´ \n1l = [1, 2, 3, 3] 2 3l.remove(3) # åˆ é™¤ç¬¬ä¸€ä¸ª3 4 5# åˆ é™¤æ‰€æœ‰3 6for c in l: 7 if c == 3: 8 l.remove(c) å·¥å…·æ¨¡å— lru_cache è£…é¥°å™¨ä¼˜åŒ–é€’å½’\næ³¨æ„, ç”¨æ­¤è£…é¥°å™¨çš„å‡½æ•°å‚æ•°å¿…é¡»ä¸ºhashableçš„, ä¾‹å¦‚ list å°±æ˜¯ unhashable çš„, éœ€è¦è½¬ä¸ºå…ƒç»„: func(tuple(lst))\n1import functools 2 3@functools.lru_cache(2**20) 4def fibonacci(n): 5 ... å…¸å‹é—®é¢˜æ•´ç† ç§°ç ç  ä»¥å°è§å¤§, å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªç ç , è¦ç»Ÿè®¡å¯èƒ½å‡ºç°çš„æ‰€æœ‰é‡è¦, æˆ‘ä»¬çš„æ–¹æ³•æ˜¯:\n å…ˆæ”¾ A, ç»Ÿè®¡æ‰€æœ‰å¯èƒ½ [0, A] å†æ”¾ B, ä¸ä¹‹å‰ç»Ÿè®¡çš„æ‰€æœ‰å¯èƒ½ç›¸åŠ , å»é‡ååŠ å…¥æ‰€æœ‰å¯èƒ½ [0, A, B, A+B] å†æ”¾ C, ä¸ä¹‹å‰ç»Ÿè®¡çš„æ‰€æœ‰å¯èƒ½ç›¸åŠ , å»é‡ååŠ å…¥æ‰€æœ‰å¯èƒ½ [0, A, B, A+B, C, A+C, B+C, A+B+C]  ","date":"2023-08-19T10:30:35+08:00","permalink":"https://wangloo.github.io/posts/python/algo/","section":"posts","tags":["Python"],"title":"Python åšæœºè¯•é¢˜ç›®æŠ€å·§"},{"categories":["Hugo"],"contents":"é€šè¿‡ tag å¯ä»¥å®ç°å¯¹postè¿›è¡Œåˆ†ç±»ï¼Œç”¨åˆ°çš„æ”¯æŒæ˜¯ HUGO Taxonomy Templateï¼ˆåˆ†ç±»æ¨¡æ¿ï¼‰\nåŸç† å®ç°tagçš„åŠŸèƒ½éœ€è¦å®Œæˆä¸¤ç±»é¡µé¢çš„è®¾è®¡ï¼š /tags/ å’Œ /tags/\u0026lt;one-tag\u0026gt;\nå‰è€…å±äº Taxonomy Termsï¼ˆåˆ†ç±»æœ¯è¯­ï¼‰é¡µé¢ï¼Œç”¨åˆ†ç±»æœ¯è¯­æ¨¡æ¿å®ç°ï¼Œ åè€…å±äº Taxonomy List ï¼ˆåˆ†ç±»åˆ—è¡¨ï¼‰é¡µé¢ï¼Œç”¨åˆ†ç±»åˆ—è¡¨æ¨¡æ¿å®ç°ï¼Œä»–ä»¬éƒ½å±äº Taxonomy æ¨¡æ¿ã€‚\nä¸éš¾æ¨æµ‹å‡ºï¼Œåˆ†ç±»æœ¯è¯­æ¨¡æ¿è§„å®šäº†å¦‚ä½•å±•ç°æŸä¸ªåˆ†ç±»æ–¹å¼ï¼Œæ¯”å¦‚è¯´ç”¨äº‘å›¾æ¥å±•ç¤ºtagåˆ†ç±»æ–¹æ³•ã€‚ è€Œåˆ†ç±»listæ¨¡æ¿çš„ä½œç”¨æ˜¯å±•ç¤ºé€‰ä¸­æŸä¸€ç±»ä¹‹åçš„é¡µé¢ï¼Œæ¯”å¦‚è¯´åœ¨äº‘å›¾ä¸­é€‰ä¸­äº†æŸä¸ªtagã€‚\næ›´åŠ è¯¦ç»†çš„æè¿°å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£: https://gohugobrasil.netlify.app/templates/taxonomy-templates/\nè®¾è®¡ æ­£ä¸æ–‡æ¡£ä¸­æ‰€è¯´ï¼Œåˆ†ç±»termsæ¨¡æ¿å¯ä»¥æœ‰å¤šä¸ªæŸ¥æ‰¾çš„ä¼˜å…ˆçº§ï¼š\n  /layouts/taxonomy/.terms.html /layouts/_default/terms.html /themes//layouts/taxonomy/.terms.html /themes//layouts/_default/terms.html   è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæ¯”å¦‚è¯´æˆ‘æœ‰ä¸¤ç§termsï¼Œtagå’Œcategoriesï¼Œæˆ‘æƒ³åœ¨åˆ†ç±»æœ¯è¯­é¡µé¢å¯¹è¿™ä¸¤ç§åˆ†ç±»å±•ç¤ºä¸ç”¨çš„é¡µé¢ï¼Œ å°±å¯ä»¥å®šä¹‰tags.terms.htmlå’Œcategories.terms.html, è€Œæˆ‘ç›®å‰å°±ç”¨terms.htmlï¼Œç®€å•ã€‚\nåˆ†ç±»listæ¨¡æ¿ä¹Ÿæ˜¯ï¼Œä½¿ç”¨æœ€é€šç”¨çš„list.html, å’Œå…¶ä»–çš„listå…¬ç”¨ï¼Œå¹¶æ²¡æœ‰å¯¹åˆ†ç±»liståšå•ç‹¬çš„é¡µé¢ã€‚\n å¯¹åº”çš„ commit: https://github.com/wangloo/hugo-theme-puer/commit/63d8bb762b16a3d4657ba3523d6b6fb38cf5f9ca\nä¸Šé¢çš„commitä¸å°å¿ƒæäº¤äº†menu.html, å®é™…ä¸å±äºtaxonomyçš„ç›®çš„ï¼Œæ‰€ä»¥åœ¨è¿™çº æ­£: https://github.com/wangloo/hugo-theme-puer/commit/0af07f66807b540fd9d3be84e8d7faca7f962c4b\n References  ä¸­æ–‡åšå®¢ä»‹ç»Taxonomy(1): https://hugo-in-action.foofun.cn/zh/docs/part1/chapter4/4/ ä¸­æ–‡åšå®¢ä»‹ç»Taxonomy(2): https://note.qidong.name/2017/10/hugo-taxonomy/  ","date":"2023-08-15T18:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_5/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(5): Tag åˆ†ç±»æ”¯æŒ"},{"categories":["Architecture"],"contents":"ä¹‹å‰åœ¨ç‰¹æ–¯æ‹‰é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°äº† cache çš„ maintain æ“ä½œæœ‰å“ªäº›, ä¸€æ—¶é—´ç«Ÿæƒ³ä¸èµ·ä¸€ä¸ªå‡†ç¡®çš„è¯æ¥, è¿™é‡Œå°±å†å­¦ä¹ ä¸€ä¸‹, æŠŠè¿™ä¸ªå‘å¡«ä¸Šå§ã€‚\nå¯èƒ½ä¸ä¼šè¯´çš„å¾ˆç»†ï¼Œç›®çš„åªæ˜¯æŠŠä¸€äº›æ¦‚å¿µå¤ä¹ ï¼Œåšåˆ°å¿ƒä¸­å¤§è‡´æœ‰æ•°ã€‚\ncache æ˜¯ä¸ªç¡¬ä»¶ cache çš„æœ¬è´¨æ˜¯ä¸€ç§ SRAM, å®¹é‡å¾ˆå°, é€Ÿåº¦å¾ˆå¿«(ns çº§)ã€‚\næ‹¿ Cortex-A53 æ¥è¯´ï¼Œå…±æœ‰ä¸‰çº§ Cacheï¼š\n L1 cache æ˜¯ Core å•ç‹¬çš„ï¼Œåˆ†ä¸ºæ•°æ® cache å’ŒæŒ‡ä»¤ cacheï¼Œå®¹é‡æ˜¯ KB çº§ L2 cache ä¸€èˆ¬æ˜¯ cluster å†…å…±äº«ï¼Œå®¹é‡æ˜¯ MB çº§ L3 cache æ˜¯æ‰€æœ‰ core å…±äº«ï¼Œå®¹é‡æ˜¯ MB çº§  cache æ§åˆ¶å™¨ å•ç‹¬çš„ cache å°±æ˜¯ä¸€ä¸ªå­˜å‚¨è®¾å¤‡ï¼Œå¾—æœ‰ä¸€ä¸ªæ§åˆ¶å™¨å‘Šè¯‰å®ƒå­˜ä»€ä¹ˆä»¥åŠä»€ä¹ˆæ—¶å€™å­˜ã€‚\ncache æ§åˆ¶å™¨çš„ä»»åŠ¡ä¸¾ä¸ªä¾‹å­è¯´ï¼šæ¯”å¦‚ cache miss çš„æ—¶å€™ï¼Œéœ€è¦ä»ä¸»å­˜å‘ cache å›å¡«æ•°æ®ï¼Œç„¶è€Œæ­¤æ—¶ CPU é‚£è¾¹è®°ç€è¦æ•°æ®ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ cache æ“ä½œçš„å•ä½ æ˜¯ cache line å˜›ï¼Œä½†è¿™æ˜¯ cache æ§åˆ¶å™¨ä¼šæœ‰é™å¡«å……ä¸€ä¸ª cache line ä¸­ CPU è¦çš„é‚£ä¸€æ¡ï¼ˆæˆ–å‡ æ¡ï¼‰ï¼Œæœ€ååœ¨åå°é»˜é»˜å¡«å……å®Œå‰©ä¸‹çš„ã€‚\ncache æ§åˆ¶å™¨çš„è¡Œä¸ºæ˜¯ä¸å¯é…ç½®çš„ï¼Œè½¯ä»¶ä¸å¯è§ï¼Œä¸å¯ç¼–ç¨‹ã€‚\ncache policyï¼ˆç­–ç•¥ï¼‰ cache policy å°±è¯´äº†ä¸¤ä»¶äº‹ï¼š\n cache åˆ†é…ï¼šæ‰§è¡Œ load æ“ä½œæ—¶éœ€è¦åˆ†é…å…¥ cache å—ï¼Ÿ cache æ›´æ–°ï¼šæ‰§è¡Œ str ä¿®æ”¹æ•°æ®æ—¶éœ€ä¸éœ€è¦ä¸ä¸»å­˜åŒæ­¥ï¼Ÿ  cache çš„æ›´æ–°æ–¹å¼æœ‰ä¸¤ç§ï¼š\n Write backï¼Œå†™å›ï¼›å³ä»…ä¿®æ”¹ cache ä¸­æ•°æ®ï¼Œç„¶åè®¾ç½®ä¸€ä¸ª dirty æ ‡å¿—ä½ ï¼Œå½“ä¸”ä»…å½“æ­¤ cache line è¢« clean æ—¶æ‰å¯¹ dirty æ•°æ®å›å†™ä¸»å­˜ Write throughï¼Œå†™ç›´é€šï¼›å³æ¯æ¬¡ä¿®æ”¹ cache éƒ½åŒæ­¥ä¿®æ”¹ä¸»å­˜ï¼Œä¹Ÿå°±ä¸éœ€è¦ dirty æ ‡å¿—äº†  cache ç›¸å…³çš„å†…å­˜å±æ€§ ä¸€æ®µå†…å­˜å¯è¢«è®¾ç½®ä¸º cacheable æˆ–è€… uncacheableï¼Œuncacheable çš„å†…å­˜ç›´æ¥è®¿é—®ä¸»å­˜ã€‚\ncacheable åˆå¯åˆ’åˆ†ä¸º inner å’Œ outer ä¸¤ç§ï¼š\n inner: å¯å…¥L1 cacheï¼Œæˆ–è€…L2 cacheï¼Œå®ç°å®šä¹‰ outer: å¯å…¥å¤–éƒ¨æ¿çº§çš„ cache(L3 cache)  cache maintainï¼ˆç»´æŠ¤ï¼‰ ä¸ºä»€ä¹ˆéœ€è¦ç»´æŠ¤cacheï¼Ÿ\n ä¸»å­˜ä¸­çš„å†…å®¹æ›´æ–°äº† æ­¤éƒ¨åˆ†å†…å­˜çš„æƒé™æ”¹äº†æˆ–è€…æ˜ å°„æ”¹äº†  cacheçš„ä¸‰ç§ç»´æŠ¤æ“ä½œï¼ˆè½¯ä»¶å¯è§ï¼‰ï¼š\n [invalidation]: è®¾ç½®cache lineå¯¹åº”çš„invalidä½ã€‚å¸¸è§äºresetæ—¶ï¼Œcacheé‡Œçš„å†…å®¹ä¸å¯ä¿¡ï¼Œ æ‰€ä»¥éœ€è¦å°†æ‰€æœ‰çš„cache invalid [clean]: cleançš„å«ä¹‰æ˜¯æ¸…ç†ï¼Œå°†åŸæœ‰çš„æ ‡è®°ä¸ºdirtyçš„lineéƒ½ä¸ä¸»å­˜è¿›è¡ŒåŒæ­¥ã€‚å½“ç„¶ï¼Œ ä»…æ›´æ–°ç­–ç•¥ä¸º write backçš„æ—¶å€™æ‰éœ€è¦ [zero]: ä»€ä¹ˆä¹Ÿä¸ç®¡ï¼Œç›´æ¥å°†cache lineç½®0ï¼Œæ•°æ®ä¸¢äº†æˆ‘ä¹Ÿä¸å…³å¿ƒ   ä»¥ä¸Šçš„ä¸‰ç§æ“ä½œéƒ½æ˜¯æœ‰ç²’åº¦çš„ï¼ŒåŒ…æ‹¬æ•´ä¸ª cacheã€æŒ‡å®švaèŒƒå›´ã€æŸä¸€è·¯ç­‰ã€‚\n  è½¯ä»¶åªèƒ½é€šè¿‡ä½“ç³»ç»“æ„æä¾›çš„ç»´æŠ¤æŒ‡ä»¤æ¥æ§åˆ¶ cacheã€‚\n ARMv8è·å–Cacheä¿¡æ¯ æƒ³è¦ç®¡ç†å¥½æ•´ä¸ªcacheç³»ç»Ÿ, é¦–å…ˆè¦äº†è§£çš„ä¿¡æ¯æ˜¯:\n ç³»ç»Ÿå®ç°äº†å‡ çº§cache? Cache line æ˜¯å¤šå¤§? å¯¹äºæ¯ä¸€çº§çš„Cache, å®ƒçš„ set/way åˆ†åˆ«æ˜¯å¤šå°‘?  è¿™äº›ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡ARMv8çš„ç³»ç»Ÿæ§åˆ¶å¯„å­˜å™¨æ¥è¯»å–.\nCLIDR_EL1 æ ‡è¯†æ¯ä¸€çº§Cacheçš„ç±»å‹ä»¥åŠç³»ç»Ÿæœ€å¤šæ”¯æŒå‡ çº§Cache.\nCtype\u0026lt;n\u0026gt;å­—æ®µç”¨æ¥æè¿°ç¼“å­˜çš„ç±»å‹. ç³»ç»Ÿæœ€å¤šæ”¯æŒ7çº§ç¼“å­˜, è½¯ä»¶éœ€è¦éå†Ctype\u0026lt;n\u0026gt;å­—æ®µ, å½“è¯»åˆ°çš„å€¼ä¸º000æ—¶, è¯´æ˜è¯¥çº§åŠä»¥ä¸Šéƒ½æ²¡æœ‰å®ç°.\n å…·ä½“æ¯ç§ç±»å‹å¯¹åº”çš„å€¼, å’Œå…¶ä»–å­—æ®µçš„å«ä¹‰, RTFM\n CTR_EL0 è®°å½•äº†Cache lineçš„å¤§å°, ä»¥åŠCacheçš„ç­–ç•¥.\nIminLine: è¡¨ç¤ºæ‰€æœ‰æŒ‡ä»¤cacheä¸­æœ€å°çš„cache line, å•ä½æ˜¯ word.\nDminLine: è¡¨ç¤ºæ‰€æœ‰æ•°æ®cacheä¸­æœ€å°çš„cache line, å•ä½æ˜¯ word.\nL1IP: è¡¨ç¤º L1 æŒ‡ä»¤cacheçš„ç­–ç•¥. RTFM\nCSSELR_EL1 ä¸CSSIDRé…åˆå·¥ä½œ. CSSELRç”¨äºé€‰å®šæŸ¥çœ‹æŸçº§çš„Cache, å†å»è¯»CSSIDRå°±æ˜¯è¯¥çº§Cacheçš„ä¿¡æ¯.\nCSSIDR_EL1 LineSize: è¯¥çº§cacheçš„cache line.\nAssociativity: è¯¥çº§Cacheçš„way\nNumSets: è¯¥çº§Cacheçš„set\n è¯¥å¯„å­˜å™¨çš„å­—æ®µåˆ†å¸ƒä¸æ˜¯å¦å®ç°FEAT_CCIDXæœ‰å…³, RTFM## è·å–Cacheä¿¡æ¯\n ","date":"2023-08-14T22:02:04+08:00","permalink":"https://wangloo.github.io/posts/armv8/cache/","section":"posts","tags":["armv8"],"title":"ARMv8: cacheç›¸å…³çŸ¥è¯†"},{"categories":["HTML/CSS"],"contents":"display æ˜¯è§„å®šå…ƒç´ æ’åˆ—æ–¹å¼çš„å±æ€§ï¼Œæ€»çš„æ¥è¯´ï¼Œå…ƒç´ çš„æ’åˆ—æ–¹å¼å¯åˆ†ä¸¤ç§ï¼šblock å’Œ inlineã€‚\n block çš„å«ä¹‰æ˜¯ï¼Œè¯¥å…ƒç´ é»˜è®¤æƒ…å†µä¸‹çš„ width è¡¨ç°ä¸ºå……æ»¡æ•´ä¸ªçˆ¶å…ƒç´ ï¼Œheight è¡¨ç°ä¸ºæ ¹æ®å†…å®¹å†³å®šã€‚ inline çš„å«ä¹‰æ˜¯ï¼Œè¯¥å…ƒç´ çš„ width å’Œ height éƒ½æ˜¯å¿…é¡»æ ¹æ®å†…å®¹å†³å®šï¼Œä¸èƒ½ä½¿ç”¨æ˜¾ç¤ºçš„widthå’Œheightæ¥æ”¹å˜ã€‚  å³ä¾¿ block å¯ä»¥å»è®¾ç½® width, æ¯”å¦‚ä¸º 50%, ä½†æ˜¯å®ƒæ°¸è¿œå¿…é¡»ç‹¬å ä¸€è¡Œï¼Œä¸‹é¢çš„å…ƒç´ ä¹Ÿä¸ä¼šæ’åˆ°å®ƒçš„ç©ºç™½å¤„ï¼Œ è¿™å°±æ˜¯ block ç§°ä¹‹ä¸º block çš„åŸå› ã€‚\nç»†åˆ†æ¥è¯´ï¼Œå…¶å® display è¿™ä¸ªå±æ€§å…±æœ‰äº”ç§å–å€¼ï¼š block, inline, inline-block, flex, gridã€‚ æˆ‘ä»¬å°†ä¾æ¬¡ä»‹ç»ã€‚\nblock é»˜è®¤ display æ–¹å¼ä¸º block çš„æ ‡ç­¾æœ‰: p, h1-h6, div, li ç­‰\ninline é»˜è®¤ display æ–¹å¼ä¸º inline çš„æ ‡ç­¾æœ‰: span, a, strong\ninline-block inline-block æ˜¯ç»“åˆäº† block å’Œ inline çš„ä¼˜åŠ¿ï¼šæ—¢ä¸å¿…ç‹¬å ä¸€è¡Œï¼Œåˆå¯ä»¥è°ƒæ•´ width å’Œ heightã€‚\nä¸€äº› button ç»å¸¸ä½¿ç”¨çš„ display å°±æ˜¯ inline-blockã€‚\nflex grid ä¸åŒ display æ–‡å­—å±…ä¸­çš„æ–¹æ³• æ–‡å­—å±…ä¸­æ˜¯å¼€å‘ä¸­å¸¸è§çš„éœ€æ±‚ï¼Œç„¶è€Œæ ¹æ® display çš„ä¸åŒï¼Œå†³å®šäº†å®ç°å±…ä¸­çš„æ–¹å¼ä¹Ÿä¸åŒã€‚\nå±…ä¸­å¤§æ¦‚åˆ†ä¸ºæ°´å¹³å±…ä¸­å’Œå‚ç›´å±…ä¸­\næ°´å¹³å±…ä¸­ å¯¹äº inlineã€inline-block æ¥è¯´ï¼Œç›´æ¥è®¾ç½®text-align=centerå³å¯å®ç°ã€‚\nå¯¹äº blockï¼Œè®¾ç½®text-align=centerçš„æ•ˆæœæ˜¯å°† block å†…éƒ¨çš„æ–‡å­—ç›¸å¯¹ä¸ block å±…ä¸­ï¼Œå¹¶ä¸æ˜¯ ç›¸å¯¹äº block çš„çˆ¶å…ƒç´ ã€‚\nä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯æƒ³è®©æ•´ä¸ª block åŒæ—¶å†ç›¸å¯¹äºçˆ¶å…ƒç´ å±…ä¸­ï¼ˆå› ä¸ºblockçš„widthä¸ä¸€å®šæ˜¯100%ï¼‰ æ­¤æ—¶éœ€è¦å¯¹ block å…ƒç´ é¢å¤–æ·»åŠ margin-left=autoå’Œmargin-right=autoå±æ€§ã€‚\nå‚ç›´å±…ä¸­ ç”¨ flex æ¯”è¾ƒæ–¹ä¾¿å®ç°ã€‚\n","date":"2023-08-11T22:02:04+08:00","permalink":"https://wangloo.github.io/posts/html-css/display/","section":"posts","tags":["css"],"title":"å‰ç«¯å­¦ä¹ : display"},{"categories":["HTML/CSS"],"contents":"position å±æ€§å†³å®šäº†ä¸€ä¸ªå…ƒç´ åœ¨é¡µé¢ä¸­çš„æ’æ”¾æ–¹å¼, é€šè¿‡ä¸ topã€bottomã€leftã€right ç»“åˆå¯ä»¥å†³å®šä»»ä¸€å…ƒç´ åœ¨é¡µé¢ä¸­åº”è¯¥åœ¨ä»€ä¹ˆä½ç½®ä¸Šã€‚\nposition çš„å–å€¼å¯ä»¥æ˜¯: static/absolute/relative/fixed/sticky ï¼Œä¸‹é¢æˆ‘å°†ä¾æ¬¡å¯¹ä»–ä»¬çš„ä½¿ç”¨æ–¹æ³•å’Œåœºæ™¯è¿›è¡Œä»‹ç»ã€‚\nstatic static æ˜¯å…ƒç´ é»˜è®¤çš„ positionï¼Œå®ƒä½¿å¾—å…ƒç´ æŒ‰ç…§é¡ºåºæ’åˆ—ï¼ˆä»€ä¹ˆæ ·çš„é¡ºåºå–å†³äºdisplay)ã€‚\nå®ƒä¸èƒ½ä¸ topã€bottom ç­‰å±æ€§ç»“åˆï¼Œå°±æ˜¯æœ€ç®€å•çš„ä¾æ¬¡æ’å¸ƒã€‚\nrelative relative ä¸ static ç›¸æ¯”ï¼Œæ”¯æŒäº† tomã€bottom è¿™äº›å±æ€§ï¼Œä½¿å¾—å…ƒç´ åœ¨ä¾æ¬¡æ’å¸ƒçš„åŒæ—¶ èƒ½è°ƒæ•´ç›¸å¯¹äºä¸Šä¸€ä¸ªå…ƒç´ çš„ä½ç½®å˜åŒ–ã€‚\næ®æˆ‘æ‰€çŸ¥ï¼Œrelative å¹¶ä¸å¸¸è§ã€‚\nabsolute absolute ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç§°çš„\u0026quot;ç»å¯¹å®šä½\u0026quot;ï¼Œ äº§ç”Ÿçš„æ•ˆæœç›¸å¯¹äºçˆ¶å…ƒç´ åšäº†ä¸€äº›åç§»ï¼Œè€Œä¸æ˜¯ä¸Šé¢æ‰€è¯´çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œåªæœ‰çˆ¶å…ƒç´ çš„ä½ç½®æ”¹å˜ï¼Œå®ƒæ‰æŒ‰ç…§åç§»æ•°å€¼è¿›è¡Œæ”¹å˜ã€‚ åç§»æ•°å€¼çš„æŒ‡å®šé€šè¿‡ topã€bottom æ¥å®ç°ã€‚\nabsolute å¯ä»¥ä¸ fixed è¿›è¡Œå¯¹æ¯”ï¼Œä¸¤è€…ç›¸å·®å¾ˆå°ã€‚\n absolute æ— è§† staticã€‚ä¸Šé¢è¯´ absolute æ˜¯åŸºäºçˆ¶å…ƒç´ è¿›è¡Œè°ƒæ•´ï¼Œä»…å½“çˆ¶å…ƒç´ æ˜¯ static æ—¶ä¾‹å¤–ï¼Œabsolute ä¼šè·³è¿‡è¿™ä¸€å±‚ï¼Œæ‰¾å®ƒçš„çˆ·çˆ·å…ƒç´ ã€‚\n fixed fixedçš„å«ä¹‰æ˜¯ä½¿å…ƒç´ çš„æ’åˆ—å§‹ç»ˆå›ºå®šåœ¨é¡µé¢çš„æŸä¸ªä½ç½®ï¼Œæ¢å¥è¯ä¹Ÿå¯ä»¥è¯´å®ƒæ€»æ˜¯åŸºäºbodyåšrelativeçš„ æ’åˆ—ã€‚å½“ç„¶ï¼Œåç§»æ˜¯é€šè¿‡topã€bottomç»™å‡ºçš„ã€‚\nä¸€äº›é¡µé¢çš„å°å¹¿å‘Šç”¨çš„æ’åˆ—å°±æ˜¯fixedã€‚\nsticky stickyåƒé»˜è®¤çš„staticï¼Œä½†å®ƒä¹Ÿæœ‰topã€bottomç­‰å±æ€§å€¼ï¼Œè¿™äº›å€¼æœ‰ç‰¹æ®Šå«ä¹‰ï¼š å½“å…ƒç´ éšç€é¡µé¢æ»šåŠ¨å˜åŒ–ï¼Œè€Œä½¿å…ƒç´ çš„é¡µé¢ç»å¯¹ä½ç½®ï¼ˆç›¸å¯¹äºbodyï¼‰è¾¾åˆ°topã€bottomå€¼æ—¶ï¼Œ ä¾¿å›ºå®šåœ¨é‚£ä¸ä¼šå†ç§»åŠ¨ï¼Œä½¿å…ƒç´ æ°¸è¿œä¸ä¼šè¢«ç§»åŠ¨å‡ºé¡µé¢ã€‚\nçœ‹èµ·æ¥å°±å¥½åƒæ˜¯ç”¨é¡µé¢çš„å¤–æ¡†å¯¹stickyå…ƒç´ ç”»äº†ä¸€ä¸ªç¬¼å­ï¼Œå®ƒæ°¸è¿œè·‘ä¸å‡ºé¡µé¢ä¹‹å¤–ã€‚\nstickyç›®å‰è¢«å¹¿æ³›åº”ç”¨ä¸å¯¼èˆªæ ï¼Œåªè¦è®¾ç½®top=0\n stickyæ˜¯æ–°å¢çš„å±æ€§ï¼ŒæŸäº›æµè§ˆå™¨æ”¯æŒçš„å¯èƒ½ä¸æ˜¯å¾ˆå¥½\n ","date":"2023-08-11T21:02:04+08:00","permalink":"https://wangloo.github.io/posts/html-css/position/","section":"posts","tags":["css"],"title":"å‰ç«¯å­¦ä¹ : position"},{"categories":["Hugo"],"contents":"å­—ä½“æ›¿æ¢  commit: https://github.com/wangloo/hugo-theme-puer/commit/861ca01617c06c83b701506c9a574cc2726d36d8\n ä¿®æ”¹çš„å‚è€ƒï¼š\n ä¸€èˆ¬æ–‡å­—ç”¨æœ€è¿‘å¾ˆç«çš„ã€éœé¹œæ–‡æ¥·ã€‘ ä»£ç ä½¿ç”¨ä¸€äº›æ¯”è¾ƒé€šç”¨çš„ä»£ç å­—ä½“ï¼Œæ³¨æ„ç”¨!importantæé«˜ä¼˜å…ˆçº§  ","date":"2023-08-11T18:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_4/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(4): æ ·å¼æ‰“ç£¨"},{"categories":["Hugo"],"contents":" commit:\n ä¸ºä»€ä¹ˆé€‰æ‹©fast search? hugoæœ¬èº«æ˜¯ä¸æ”¯æŒç«™å†…æœç´¢åŠŸèƒ½çš„, å¦‚æœä½ å†™çš„æ–‡ç« è¾ƒå¤šå°±åªèƒ½æŒ‰ç…§tagå»æ£€ç´¢åˆ†ç±». è¿™æ ·è‡³å°‘ä¹Ÿéœ€è¦ä¸‰æ¬¡ç‚¹å‡»æ“ä½œ, å¦‚æœæ¯ä¸ªé¡µé¢çš„è¾¹æ æˆ–è€…é¡¶æ æœ‰ä¸€ä¸ªæœç´¢æ¡†, èƒ½å¤Ÿ æœç´¢æ–‡ç« çš„å†…å®¹æˆ–è€…æ ‡é¢˜ã€Tagè¿™äº›ï¼Œå¯¹æˆ‘æ¥è¯´æ•ˆç‡å°±èƒ½å¾—åˆ°æ˜¾è‘—æå‡ã€‚\nfast search æ˜¯æˆ‘æ£€ç´¢åˆ°çš„ç›®å‰æ¯”è¾ƒç®€å•ã€æˆç†Ÿçš„æ–¹æ¡ˆï¼Œå®ƒçš„äº®ç‚¹ï¼š\n æœ€å°å¤–éƒ¨ä¾èµ–ï¼ˆæ— éœ€jQueryï¼‰ æ”¯æŒå®ç°é”®ç›˜å”¤å‡º æ— éœ€NPM, gruntç­‰å¤–éƒ¨å·¥å…· æ— éœ€é¢å¤–çš„ç¼–è¯‘æ­¥éª¤ï¼Œä½ åªéœ€è¦åƒå¾€å¸¸ä¸€æ ·æ‰§è¡Œhugo å¯ä»¥æ–¹ä¾¿åœ°åˆ‡æ¢åˆ°ä»»æ„å¯ä½¿ç”¨jsonç´¢å¼•çš„å®¢æˆ·ç«¯æœç´¢å·¥å…·  é›†æˆ é›†æˆçš„æ­¥éª¤æˆ‘æ˜¯å‚ç…§çš„è¿™ç¯‡æ–‡ç«  , fast searchå®˜æ–¹ä¹Ÿæœ‰è¯´æ˜ç±»ä¼¼çš„æ­¥éª¤ï¼Œè¿‡ç¨‹ä¸éš¾ï¼Œå¤§æ¦‚å¯åˆ†ä¸ºï¼š\n  Add index.json file to layouts/_default Add JSON as additional output format in config.toml Add search.js and fuse.js (downloaded from fusejs.io) to static/js Add searchbox html åˆ°ä½ æƒ³å¸ƒå±€çš„ä½ç½® å¯¹searchboxæ·»åŠ æ ·å¼æ–‡ä»¶   å…·ä½“çš„æ­¥éª¤çœ‹åšæ–‡æˆ–è€…å®˜æ–¹æ–‡æ¡£å°±è¡Œï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚\næ”¹åŠ¨ åšäº†ä¸€äº›è®©è‡ªå·±èˆ’æœçš„æ”¹åŠ¨ï¼š\n è®©æœç´¢æ¡†å¸¸é©»ï¼Œåªæ˜¯æœç´¢ç»“æœå¯ä»¥éšè—(ESC) /èšç„¦æœç´¢æ¡†ï¼Œå’Œvimç›¸åŒ ç®€åŒ–æ ·å¼ï¼Œè´´åˆæˆ‘çš„ä¸»é¢˜ æœç´¢ç»“æœåªæ˜¾ç¤ºtitleå°±å¤Ÿ  è¿™æ ·ä»¥åä¸è®ºåœ¨å“ªï¼Œæƒ³è¦åˆ‡æ¢åˆ°ä¸€ç¯‡æ–‡ç« åªéœ€è¦ä¸¤æ¬¡é¼ æ ‡ï¼ˆæˆ–è€…ä¸¤æ¬¡é”®ç›˜ï¼‰å°±èƒ½ç²¾å‡†å®šä½å¹¶æ‰“å¼€ï¼Œä¸å¿…ä½¿ç”¨é¼ æ ‡çš„æ–¹å¼å¯èƒ½æ›´æœ‰ä½œç”¨å“ˆå“ˆã€‚\nTODO  åªèƒ½æœç´¢æ ‡é¢˜ï¼Œä¸èƒ½æœç´¢å†…å®¹ã€tagï¼Ÿ  ","date":"2023-08-11T16:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_3/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(3): ç«™å†…æœç´¢"},{"categories":["Hugo"],"contents":" commit: https://github.com/wangloo/hugo-theme-puer/commit/32abfccc6bafd3763e07b751f0315a5403c6eaff\n ä¸é¡¶æ ç›¸æ¯”ï¼Œæˆ‘æ›´å–œæ¬¢ä¾§è¾¹æ ï¼Œç°åœ¨çš„å±å¹•çºµå‘ç©ºé—´å¾ˆå®è´µã€‚\næœ¬æ–‡åˆ›å»ºäº†ä¾§è¾¹æ æ¨¡æ¿çš„æ¡†æ¶ï¼Œé¢„ç•™äº†æœªæ¥å®ç°å„ç§åŠŸèƒ½çš„å¸ƒå±€ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦partials/ ä¸‹çš„æ–‡ä»¶çš„ä½œç”¨â€”â€”é¡µé¢çš„æŸä¸ªç»„æˆéƒ¨åˆ†ã€‚è€Œ_default/ä¸‹çš„æ¨¡æ¿åˆ™æ˜¯æè¿°ä¸åŒç±»å‹çš„é¡µé¢ã€‚\nå¸ƒå±€ åŸºäºhugoæ¨¡æ¿çš„åˆ†ç±»æ€æƒ³ï¼Œä¾§è¾¹æ å±äºé¡µè¡¨çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥ä¾§è¾¹æ çš„æ¨¡æ¿éœ€è¦æ”¾åœ¨partials/ä¸‹ï¼Œ åŒç†çš„è¿˜æœ‰footerã€tocã€commentç­‰ã€‚æˆ‘ä»¬ç»™ä¾§è¾¹æ æ¨¡æ¿èµ·ä¸€ä¸ªåå­—sidebar.htmlã€‚\nå› ä¸ºæƒ³åœ¨ç«™ç‚¹æ‰€æœ‰çš„é¡µé¢ï¼ˆsectionã€singleã€listï¼‰éƒ½æ˜¾ç¤ºä¾§è¾¹æ ï¼Œ æ‰€ä»¥åœ¨baseof.htmlä¸­éœ€è¦å¼•å…¥sidebaræ¨¡æ¿ï¼š\n1\u0026lt;!DOCTYPE html\u0026gt; 2\u0026lt;html\u0026gt; 3 4\u0026lt;head\u0026gt; 5 6 {{- partial \u0026#34;head.html\u0026#34; . -}} 7 \u0026lt;title\u0026gt; 8 {{ block \u0026#34;title\u0026#34; . }} 9 {{ .Site.Title }} 10 {{ end }} 11 \u0026lt;/title\u0026gt; 12\u0026lt;/head\u0026gt; 13 14\u0026lt;body\u0026gt; 15 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; 16 {{- partial \u0026#34;sidebar.html\u0026#34; . -}} 17 \u0026lt;main class=\u0026#34;container\u0026#34;\u0026gt; 18 {{- block \u0026#34;main\u0026#34; . }} 19 {{- end }} 20 \u0026lt;/main\u0026gt; 21 \u0026lt;/div\u0026gt; 22\u0026lt;/body\u0026gt; 23 24\u0026lt;/html\u0026gt; sidebar.htmlçš„å†…å®¹å°±æ¯”è¾ƒç®€å•äº†ï¼Œç›®å‰çš„è®¡åˆ’æ˜¯æ·»åŠ é¦–é¡µã€TAGå’Œä¸€ä¸ªæœç´¢æ¡†ï¼Œ ä¸ç€æ€¥ï¼Œå…ˆå±•ä½ï¼Œä»¥åå†å®ç°è¿™äº›åŠŸèƒ½ï¼Œæœ¬æ¬¡å…ˆå®ç°æ¡†æ¶ã€‚\n1\u0026lt;div id=\u0026#34;sideContainer\u0026#34; class=\u0026#34;side-container\u0026#34;\u0026gt; 2 \u0026lt;div class=\u0026#34;nav-link-list\u0026#34;\u0026gt; 3 {{/* TODO: å›åˆ°é¦–é¡µ */}} 4 \u0026lt;div class=\u0026#34;a-block nav-link-item \u0026#34; href=\u0026#34;\u0026#34;\u0026gt; 5 BACK 6 \u0026lt;/div\u0026gt; 7 8 {{/* TODO: articles... */}} 9 \u0026lt;div class=\u0026#34;a-block nav-link-item \u0026#34; href=\u0026#34;\u0026#34;\u0026gt; 10 POSTS 11 \u0026lt;/div\u0026gt; 12 13 {{/* TODO: tags */}} 14 \u0026lt;div class=\u0026#34;a-block nav-link-item \u0026#34; href=\u0026#34;\u0026#34;\u0026gt; 15 TAGS 16 \u0026lt;/div\u0026gt; 17 \u0026lt;/div\u0026gt; 18\u0026lt;/div\u0026gt; æ ·å¼ è¿™æ˜¯é¦–æ¬¡æ¥è§¦æ ·å¼çš„ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯ç”¨åˆ°cssè¯­è¨€ã€‚é¡ºä¾¿è¯´ä¸‹ï¼Œæˆ‘éå¸¸æ•¬ä½©è§†é¢‘ç½‘ç«™ä¸Šé‚£äº›å¯¹CSSç©çš„å¾ˆæºœ çš„äººï¼Œæˆ‘è§‰å¾—CSSä¸­çš„ç»†èŠ‚è¿œæ¯”æˆ‘çš„å·¥ä½œä¸­çš„å¤šï¼Œå¯èƒ½ä½ ç³Šå¼„ä¸€ä¸‹èƒ½å¾—åˆ°ä¸€ä¸ªç›¸åŒçš„æ•ˆæœï¼Œä½†æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ å‰ç«¯å·¥ç¨‹å¸ˆæ˜¯è¦æ¸…æ¥šæ¯ä¸ªå±æ€§çš„ä½œç”¨ï¼Œä»–ä»¬ä¹‹é—´æ˜¯å¦‚ä½•æ­é…çš„ï¼Œç»å¯¹ä¸æ˜¯å‡‘å‡ºç»“æœã€‚\nä¸»é¢˜ä¸­å¦‚ä½•æ·»åŠ cssæ–‡ä»¶å‘¢ï¼Ÿåˆ›å»ºæ¨¡æ¿æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºç›®å½• static/css/ï¼Œå…¶ä¸­å¯ä»¥æ”¾ç½®ä¸€äº›cssæ–‡ä»¶ï¼Œ æ¯”å¦‚æˆ‘ä¸ºsidebar.htmlåˆ›å»ºçš„å«style.css, åœ¨æ ·å¼ä¸å¤šçš„æƒ…å†µä¸‹å…¶ä»–éƒ¨åˆ†çš„æ ·å¼ä¹Ÿéƒ½å¯ä»¥æ”¾åœ¨è¿™ã€‚\nä¸åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¦‚ä½•è”ç³»htmlå’Œcsså‘¢ï¼Ÿè¿™å°±ä¸å¾—ä¸æåˆ°partials/ä¸‹çš„å¦ä¸€ä¸ªé‡è¦æ¨¡æ¿head.html, é€šè¿‡baseof.htmlä¸­å®ƒçš„ä½ç½®å°±èƒ½å¤§æ¦‚çŸ¥é“å®ƒçš„ä½œç”¨ï¼š\u0026lt;head/\u0026gt;æ ‡ç­¾çš„æ¨¡æ¿ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æè¿°æ ·å¼çš„cssè¯­æ³•å˜›ã€‚ è¿™å°±æ˜¯htmlå’Œcssè¿æ¥çš„æ¡¥æ¢ã€‚\nä»¥ä¸‹æ˜¯style.cssæ–‡ä»¶å†…å®¹ï¼š\n1.container { 2 padding-left: 25%; 3 width: 75%; 4 min-height: 100vh; 5 white-space: normal; 6 7} 8 9.side-container { 10 position: fixed; 11 top: 0; 12 height: 100vh; 13 width: 25%; 14 text-align: left; 15 padding: 20px 0 50px 0; 16 display: flex; 17 flex-direction: column; 18 justify-content: space-between; 19} 20 21.nav-link-list { 22 flex-grow: 1; 23 .nav-link-item { 24 margin-bottom: 10px; 25 border-right: 2px solid transparent; 26 /* padding: 8px 28px 8px 30px; */ 27 cursor: hand; 28 transition: all 0.2s linear; 29 } 30 } æœ‰äº†ä¾§è¾¹æ åï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨å†…å®¹çš„wrap lineï¼Œä¸”ç›®å‰æš‚æ—¶ç”¨padding-left+width=100%çš„æ–¹å¼ æ¥é¿å…å½“æ–‡å­—è¿‡é•¿å‡ºç°æ»šåŠ¨æ¡æ—¶æ»‘åŠ¨ä¼šç ´åå¸ƒå±€ã€‚ æœ¬è´¨è¿˜æ˜¯ç”±äºä¾§è¾¹æ çš„å®ç°æ˜¯é€šè¿‡paddingæ–¹å¼ï¼Œsidebarå’Œå†…å®¹äº’ç›¸ä¸èƒ½æ„ŸçŸ¥å¯¹æ–¹ã€‚\n","date":"2023-08-11T15:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_2/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(2): æ·»åŠ ä¾§è¾¹æ "},{"categories":["Hugo"],"contents":" æœ¬æ¬¡å¯¹åº”çš„commitï¼Œåº”è¯¥å±äºç«™ç‚¹çš„ä»“åº“ï¼Œå› ä¸ºä»…ä¿®æ”¹ config.toml\n ä»£ç é«˜äº® hugo å†…ç½®ä¸€å¥—highlightå¼•æ“, å‚è§å®˜ç½‘çš„æè¿° , æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¯¹ç«™ç‚¹çš„é…ç½®æ–‡ä»¶(æ³¨æ„ä¸æ˜¯æ¨¡æ¿çš„é…ç½®æ–‡ä»¶)è¿›è¡Œä¿®æ”¹, å°±èƒ½æœ€ç®€å•çš„å®ç°ä»£ç é«˜äº®.\nå¦‚æœä½ éœ€è¦å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰, ä¸”å°†å…¶å›ºåŒ–åˆ°ä½ çš„ä¸»é¢˜ä¸­, é‚£ä¹ˆå°±å¯èƒ½éœ€è¦ä½¿ç”¨highlight.jsæ¥å®Œæˆ, éµå¾ª\u0026quot;æå‰ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº\u0026quot;çš„ç†è®º, æš‚æ—¶ä½¿ç”¨hugoæä¾›çš„é«˜äº®æ”¯æŒå°±èƒ½ç¬¦åˆæˆ‘ä»¬çš„ç›®æ ‡.\nè¿™æ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶config.tomlä¸­å…³äºä»£ç é«˜äº®çš„å¯ç”¨:\n1[markup] 2 [markup.highlight] 3 anchorLineNos = false # è¡Œå·æ ¼å¼åŒ–ä¸º\u0026lt;span\u0026gt; 4 codeFences = true # ä»£ç å›´æ , ä¸å¯ç”¨é«˜äº®æ— æ•ˆ 5 guessSyntax = true # è‡ªåŠ¨æ¨æ–­é«˜äº®è¯­è¨€ 6 hl_Lines = \u0026#39;\u0026#39; # çªå‡ºæ˜¾ç¤ºæŸäº›ç‰¹å®šçš„è¡Œ 7 hl_inline = false # é«˜äº® inline code, ver\u0026gt;=0.101.0 8 lineAnchors = \u0026#39;\u0026#39; #ã€€ä¸ anchorLineNos é…åˆ 9 lineNoStart = 1 # è¡Œå·å¼€å§‹ 10 lineNos = true # æ˜¯å¦æ˜¾ç¤ºè¡Œå· 11 lineNumbersInTable = true # ç”Ÿæˆhtmlä¸­åˆ†å¼€è¡Œå·å’Œä»£ç  12 noClasses = true 13 noHl = false 14 style = \u0026#39;vs\u0026#39; 15 tabWidth = 4 å‚è€ƒ  hugoä»£ç é«˜äº®å¼•æ“æè¿°å¼•å¯¼é¡µ: https://gohugo.io/content-management/syntax-highlighting/ å‚æ•°çš„è¯¦ç»†æè¿°: https://gohugo.io/functions/highlight/  ","date":"2023-08-11T07:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_1/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(1): å†…ç½®æ ·å¼"},{"categories":["Hugo"],"contents":" commit: https://github.com/wangloo/hugo-theme-puer/commit/c014d1fae09eea1fcc44e03c69b6dd4d185f91fd\n èƒŒæ™¯äº¤ä»£ åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä½¿ç”¨hugoä¹Ÿä¸€å¹´å¤šäº†, è®°äº†å‡ åæ¡çš„åšå®¢ï¼Œå¯¹äºä½¿ç”¨é¢‘ç‡å¦‚æ­¤é«˜çš„å·¥å…·æ¥è¯´ï¼Œ æœ‰ä¸€ä¸ªé¡ºçœ¼çš„å¤–è§‚ã€æ–¹ä¾¿çš„åŠŸèƒ½å¸ƒå±€ç®€ç›´æ˜¯æ¢¦å¯ä»¥æ±‚ã€‚\nç„¶è€Œï¼Œè¯•è¿‡äº†è¿™ä¹ˆå¤šçš„ç°æœ‰ä¸»é¢˜ï¼Œå§‹ç»ˆæ²¡æœ‰ä¸€ä¸ªè®©æˆ‘è§‰å¾—æ»¡æ„ï¼Œå¯èƒ½æˆ‘çš„è¦æ±‚è¿‡äºè‹›åˆ»ï¼š\n æœç´¢ï¼›æˆ‘ç»å¸¸éœ€è¦ç¿»é˜…ä¹‹å‰çš„åšå®¢/ç¬”è®°ï¼ŒæœŸæœ›å¯ä»¥æ£€ç´¢Tagï¼Œä¸”ä¸éœ€è¦äºŒæ¬¡ç‚¹å‡»ï¼ˆ ä¸Šæ–¹ç›´æ¥æ˜¯ä¸€ä¸ªæœç´¢æ¡†è€Œä¸æ˜¯ä¸€ä¸ªæŒ‰é’®ï¼‰ã€‚ TOCï¼›è¦æ±‚å¯æ˜¯å±•å¼€æ˜¾ç¤ºä¸‰çº§çš„ç›®å½•ï¼Œä¸”å¸ƒå±€å¥½çœ‹äº›ã€‚ å¤–è§‚ï¼›ç®€æ´ï¼Œä¸èŠ±é‡Œèƒ¡å“¨ï¼Œä»£ç é«˜äº®çœ‹èµ·æ¥èˆ’æœã€‚ xxx  æ‰€ä»¥ï¼Œæ—¢ç„¶Hugoæ˜¯ä¸€ä¸ªå¼€æºçš„ã€ç¤¾åŒºç¯å¢ƒè¾ƒå¥½çš„å·¥å…·ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°è¯•æ‰“é€ ä¸€æ¬¾å±äºè‡ªå·±ä¸»é¢˜å‘¢ã€‚\næˆ‘æ˜¯ä¸€ååµŒå…¥å¼å¼€å‘å·¥ç¨‹å¸ˆï¼Œå¯¹äºå‰ç«¯çš„çŸ¥è¯†ç”Ÿç–ï¼Œå¸Œæœ›åœ¨è‰¯å¥½çš„ç¤¾åŒºç¯å¢ƒä¸‹èƒ½å¸®åŠ©æˆ‘æ—©æ—¥å®Œæˆæ»¡è¶³æˆ‘ä¸ªäººéœ€æ±‚çš„ä¸»é¢˜ã€‚\nè®¡åˆ’  æ­å»ºæ¡†æ¶ åˆ¶ä½œæ¨¡æ¿ï¼Œç†Ÿæ‚‰æ¨¡æ¿çš„æ¦‚å¿µï¼Œå„ä¸ªæ¨¡æ¿è´Ÿè´£çš„åŒºåŸŸ åœ¨ä¸Šé¢çš„äº†è§£è¿‡ç¨‹ä¸­é€æ¸åŠ å…¥å¯¹å¸ƒå±€çš„è°ƒæ•´ï¼Œè¿™ä¸€å—å¯èƒ½éœ€è¦å­¦ä¹ cssçš„çŸ¥è¯† è§‚æ‘©å­¦ä¹ å‰äººçš„ä»£ç ï¼Œç»“åˆç™¾å®¶ä¹‹é•¿ï¼Œç£¨åˆå‡ºé€‚åˆè‡ªå·±çš„å¸ƒå±€å’ŒåŠŸèƒ½  å¼€å§‹åŠ¨æ‰‹ï¼šæ­å»ºè„šæ‰‹æ¶ åˆ›å»ºçš„è¿‡ç¨‹å¯ä»¥å‚è€ƒè¿™ä¸ªåšå®¢ , æˆ‘ä¸»è¦æƒ³æŒ‰ç…§æˆ‘çš„ç†è§£å¯¹æ•´ä¸ªæ¡†æ¶è¿›è¡Œè¯¦ç»†çš„ä»‹ç»ã€‚\nç›®å½•ç»“æ„ 1. 2â”œâ”€â”€ layouts 3â”‚ â”œâ”€â”€ 404.html 4â”‚ â”œâ”€â”€ _default \u0026lt;--- æ­¤æ¬¡é‡ç‚¹ç ”ç©¶ 5â”‚ â”‚ â”œâ”€â”€ baseof.html 6â”‚ â”‚ â”œâ”€â”€ section.html 7â”‚ â”‚ â”œâ”€â”€ single.html 8â”‚ â”‚ â””â”€â”€ list.html 9â”‚ â”œâ”€â”€ index.html \u0026lt;--- æ­¤æ¬¡é‡ç‚¹ç ”ç©¶ 10â”‚ â””â”€â”€ partials 11â”‚ â”œâ”€â”€ footer.html 12â”‚ â”œâ”€â”€ header.html 13â”‚ â”œâ”€â”€ head.html 14â”‚ â””â”€â”€ script.html 15â”œâ”€â”€ LICENSE 16â”œâ”€â”€ static \u0026lt;--- ç›®å‰æ˜¯ç©ºçš„, åç»­å†ç ”ç©¶ 17â”‚ â”œâ”€â”€ css 18â”‚ â””â”€â”€ js 19â””â”€â”€ theme.toml \u0026lt;--- å¹²ä»€ä¹ˆç”¨çš„ä¸æ¸…æ¥š,åç»­ç ”ç©¶ æ­¤æ¬¡é‡ç‚¹æ¢è®¨index.htmlå’Œ_defaultç›®å½•ä¸‹çš„æ–‡ä»¶.\nindex.html æ˜¯æ•´ä¸ªç½‘ç«™çš„é¦–é¡µ, æ‰“å¼€ä½ çš„ç«™ç‚¹æœ€å…ˆçœ‹åˆ°çš„å°±æ˜¯å®ƒçš„å†…å®¹.\n1{{ define \u0026#34;title\u0026#34; }} 2 é¦–é¡µ 3{{ end }} 4 5{{ define \u0026#34;main\u0026#34; }} 6 \u0026lt;p\u0026gt; è¿™é‡Œæ˜¯ä¸ªäººç«™çš„é¦–é¡µ, ä»…å±•ç¤ºç”¨, è¯·DIYè‡ªå·±çš„é¦–é¡µè¦†ç›–å®ƒ :] \u0026lt;/p\u0026gt; 7{{ end }} ä½ å¯èƒ½çœ‹ä¸æ‡‚è¿™æ®µä»£ç , è¿™ä¸æ˜¯æ­£å¸¸çš„html, ä½†é©¬ä¸Šä½ å°±èƒ½æ˜ç™½äº†.\n_dafultä¸‹çš„æ–‡ä»¶è¢«hugoç§°ä¹‹ä¸ºæ¨¡æ¿, é¡¾åæ€ä¹‰ä»–ä»¬çš„å­˜åœ¨æ˜¯ä¸ºäº†å‡å°‘ä»£ç çš„é‡å¤åº¦. ä¸åŒåç§°çš„æ¨¡æ¿ä»£è¡¨äº†hugoå°†é¡µé¢åˆ’åˆ†ä¸ºä¸åŒçš„ç±», è¿™ä¸ªåœ¨å®˜æ–¹æ–‡æ¡£ä¸­åº”è¯¥æœ‰ä»‹ç», åç»­å¯ä»¥æ’å…¥ä¸ªé“¾æ¥(TODO).\n single.html: æ™®é€šé¡µé¢çš„æ¨¡æ¿, æˆ‘ä»¬å†™çš„åšå®¢ä¸­çš„å†…å®¹é¡µé¢å°±ç®—æ˜¯single page list.html: åˆ—è¡¨é¡µé¢çš„æ¨¡æ¿, å¥½å‡ ä¸ªåšå®¢åˆ†å¸ƒåœ¨åŒä¸€ä¸ªå­ç›®å½•ä¸‹, è®¿é—®è¿™ä¸ªç›®å½•çš„ åœ°å€å°±æ˜¯ list page section.html: content/æ˜¯hugoå·¥ç¨‹æ”¾ç½®å†…å®¹çš„ç›®å½•, å…¶ä¸‹éœ€è¦å»ºç«‹å­ç›®å½•, æ¯”å¦‚posts/ä»£è¡¨è¿™æ˜¯ä¸€äº›åšå®¢  baseof.htmléœ€è¦ç€é‡ä»‹ç», å®ƒç›¸å½“äºæ¨¡æ¿çš„æ¨¡æ¿, ç›®çš„æ˜¯ä¸ºäº†æ¶ˆé™¤æ¨¡æ¿ä»£ç ä¸­çš„é‡å¤, å…¶ä¸­ä½¿ç”¨hugoæä¾›çš„blockè¯­æ³•, å»ºç«‹åŸºç¡€æ¨¡æ¿, ç›®å‰æˆ‘ä»¬baseof.htmlçš„å†…å®¹å¦‚ä¸‹:\n1\u0026lt;!DOCTYPE html\u0026gt; 2\u0026lt;html\u0026gt; 3 4\u0026lt;head\u0026gt; 5 {{- partial \u0026#34;head.html\u0026#34; . -}} 6 \u0026lt;title\u0026gt; 7 {{ block \u0026#34;title\u0026#34; . }} 8 {{ .Site.Title }} 9 {{ end }} 10 \u0026lt;/title\u0026gt; 11\u0026lt;/head\u0026gt; 12 13\u0026lt;body\u0026gt; 14 {{- partial \u0026#34;header.html\u0026#34; . -}} 15 \u0026lt;main class=\u0026#34;container\u0026#34;\u0026gt; 16 {{- block \u0026#34;main\u0026#34; . }} 17 {{- end }} 18 \u0026lt;/main\u0026gt; 19 {{- partial \u0026#34;footer.html\u0026#34; . -}} 20 {{- partial \u0026#34;script.html\u0026#34; . -}} 21\u0026lt;/body\u0026gt; 22 23\u0026lt;/html\u0026gt; è¿™è¿˜ç¨å¾®åƒä¸€ç‚¹html, èƒ½çœ‹å‡ºæ˜¯ä¸€ä¸ªhtmlçš„æ¡†æ¶, å…¶ä¸­ç”¨blockå£°æ˜äº†titleå’Œmainå˜é‡.\nå…¶ä»–çš„æ¨¡æ¿æ–‡ä»¶ä¸­(åŒ…æ‹¬index.html), åªè¦å®ç°è¿™ä¸¤ä¸ªå˜é‡, å°±ç›¸å½“äºæŠŠæ•´æ®µçš„ä»£ç éƒ½æ‹·è¿‡æ¥, å¹¶ä¸”å°†{{ block \u0026quot;xx\u0026quot; }} å’Œ {{ end }} ä¹‹é—´çš„å†…å®¹æ›¿æ¢ä¸ºä½ defineçš„å†…å®¹.\nåœ¨baseof.htmlä¸­å¯¹{{ block \u0026quot;xx\u0026quot; }} å’Œ {{ end }} ä¹‹é—´æå‰å¡«å……å°±å®ç°äº†, å¯¹ç½‘é¡µçš„titleè®¾ç½®äº†ä¸€ä¸ªé»˜è®¤å€¼, å¦‚æœé‡å®šä¹‰äº†, é‚£ä¹ˆè¦†ç›–åŸå…ˆçš„é»˜è®¤å€¼. çœ‹index.htmlå°±èƒ½æ˜ç™½, å®ƒå°†ç½‘ç«™çš„titleæ›¿æ¢æˆäº†\u0026quot;é¦–é¡µ\u0026quot;, å†…å®¹ä¹Ÿæ”¹å˜äº†, å…¶ä»–çš„éƒ½æ˜¯ç›¸å½“äºå’Œ baseof.htmlç›¸åŒ.\n è¿™é‡Œä¸ä»‹ç»hugoçš„æ›´å¤šè¯¦ç»†è¯­æ³•ä½¿ç”¨, å®˜æ–¹æ–‡æ¡£ä¸­éƒ½æœ‰\n  è¿™é‡Œå…ˆä¸ä»‹ç»ä¼˜å…ˆçº§çš„æ¦‚å¿µ, å‡è®¾è¿™äº›æ¨¡æ¿æ–‡ä»¶åœ¨å…¨å±€ä¸­åªæœ‰ä¸€ä¸ª\n å‚è€ƒ  https://gohugo.io/templates/base/  ","date":"2023-08-10T17:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/new_theme_0/","section":"posts","tags":["hugo"],"title":"Hugo ä¸»é¢˜åˆ›å»º(0): è„šæ‰‹æ¶"},{"categories":["Openwrt"],"contents":"æ„å»º openWRT  æˆ‘åœ¨æ­¤æ­¥éª¤å¤±è´¥äº†ï¼Œåé¢é¡¹ç›®æ²¡æœ‰ä¾èµ–å®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œ æ‰€ä»¥å¯èƒ½å¯¹ä½ ä¸æ„æˆå‚è€ƒ\n è¿‡ç¨‹å¯å‚è€ƒå®˜æ–¹æ•™ç¨‹, ç¼–è¯‘è¿‡ç¨‹éå¸¸é•¿ï¼Œä½¿ç”¨åˆ°çš„å·¥å…·éå¸¸å¤šï¼Œè¿™é‡Œæä¾›ä¸¤ä¸ªä¼˜åŒ–çš„æ€è·¯:\næå‰å®‰è£…æœ¬åœ°ä¾èµ–ï¼Œå¿˜äº†./scripts/feeds update -aè¿˜æ˜¯./scripts/feeds install -aæ—¶éœ€è¦æ£€æŸ¥ç³»ç»Ÿçš„å„ç§ä¾èµ–, å¯ä»¥æå‰ç»Ÿä¸€å®‰è£…ä¸€æ³¢.\n1sudo apt install g++ 2sudo apt install libncurses5-dev 3sudo apt install zlib1g-dev 4sudo apt install bison 5sudo apt install flex 6sudo apt install unzip 7sudo apt install autoconf 8sudo apt install gawk 9sudo apt install make 10sudo apt install gettext 11sudo apt install gcc 12sudo apt install binutils 13sudo apt install patch 14sudo apt install bzip2 15sudo apt install libz-dev 16sudo apt install asciidoc 17sudo apt install subversion 18sudo apt install python 19sudo apt install git æå‰ä¸‹è½½dl, dlæ˜¯é»˜è®¤åœ¨ç¼–è¯‘æ—¶ä¸‹è½½çš„ä¸€äº›å·¥å…·æºç , ä½ å¯ä»¥å°†ä»–ä»¬æå‰ä¸‹è½½å¥½ æ”¾åˆ°dl/ä¸‹, å³å¯çœå»ä¸‹è½½çš„æ—¶é—´, ç‰¹åˆ«å½“ä½ ä¸èƒ½ç¿»å¢™æ—¶.\nå°±åƒè¿™ä¸ªä»“åº“è¿™æ ·, ä½†æ˜¯å®ƒé‡Œé¢ çš„è½¯ä»¶ç‰ˆæœ¬å¯èƒ½æ¯”è¾ƒè€äº†è€Œä¸”æœ‰çš„è½¯ä»¶æ˜¯ç¼ºå¤±çš„, ä»¥åå¦‚æœçœŸçš„è¦è‡ªå·±ç¼–è¯‘, éœ€è¦æŸ¥makefileå»æ›¿æ¢çœŸæ­£ä¾èµ–çš„è½¯ä»¶å’Œå…¶å¯¹åº”çš„ç‰ˆæœ¬.\næœ€ç»ˆè¿˜æ˜¯å› ä¸ºç¼–è¯‘æŸä¸ªæ¨¡å—å¤±è´¥, ä¸”ç¼–è¯‘æ—¶é—´å¤ªé•¿(è¿äº¤å‰ç¼–è¯‘å·¥å…·é“¾éƒ½éœ€è¦ç°åœºç¼–è¯‘) , å¯¼è‡´æ’æŸ¥å›°éš¾, æ²¡æœ‰ç¼–è¯‘æˆåŠŸã€‚å¥½åœ¨åé¢ä¹Ÿæ²¡æœ‰ç›´æ¥ä¾èµ–ç¼–è¯‘çš„ç»“æœã€‚\nç¼–è¯‘çš„tips  make V=99 build with verbose  ptgen æ­£å¦‚ä¸Šé¢æ‰€è¨€, æˆ‘æœ€ç»ˆæ²¡æœ‰å®Œæ•´çš„ç¼–è¯‘æˆåŠŸã€‚ä½†å…¶ä¸­çš„ä¸€ä¸ªå°å·¥å…·ptgenæ˜¯æˆ‘ éœ€è¦ç”¨çš„åˆ°ï¼Œå®ƒåœ¨è¿‡ç¨‹ä¸­è¢«ç¼–è¯‘å‡ºæ¥äº†ï¼Œç›¸å¯¹ç‹¬ç«‹äº›ã€‚\nptgenæ˜¯OpenWRTå¼€å‘çš„ä¸€ä¸ªç”¨æ¥ç”Ÿæˆgptåˆ†åŒºè¡¨çš„å·¥å…·ï¼Œåˆ›å»ºçš„sdcardé•œåƒï¼Œ åªæœ‰é…åˆåˆ†åŒºè¡¨æ‰èƒ½æ­£ç¡®çš„è¢«bootromåŠ è½½èµ·æ¥ã€‚\nä½¿ç”¨æ–¹æ³•åŠå‚æ•° ptgenä½¿ç”¨çš„å‚æ•°è¯´æ˜:\n1 2ptgen [-v] -h \u0026lt;heads\u0026gt; -s \u0026lt;sectors\u0026gt; -o \u0026lt;outputfile\u0026gt; [-a 0..4] [-l \u0026lt;align kB\u0026gt;] [[-t \u0026lt;type\u0026gt;] -p \u0026lt;size\u0026gt;...] 3 4-v: æŒ‡å®šæ˜¯å¦æ‰“å°è°ƒè¯•ä¿¡æ¯,å¯é€‰ 5-h: æŒ‡å®šèµ·å§‹ç£å¤´å· 6-s: æŒ‡å®šèµ·å§‹æ‰‡åŒºå· 7-o: æŒ‡å®šè¾“å‡ºæ–‡ä»¶å 8-a: æŒ‡å®šæ¿€æ´»åˆ†åŒºä¸ºå“ªä¸ª, å¯é€‰ 9-l: æŒ‡å®šå¤šå°‘KiBå¯¹é½,å¯é€‰ï¼Œè¿™ä¸ªå‚æ•°ä¼šå†³å®šæ¯ä¸ªåˆ†åŒºçš„åç§»æ‰‡åŒºå·ï¼Œéå¸¸é‡è¦ 10-t: æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿåˆ†åŒºæ ‡å¿—ç±»å‹å€¼,æ˜¯0x83æŒ‡linux,0x0bæŒ‡Win95 FAT32,å¯é€‰ 11-p æŒ‡å®šåˆ†åŒºå¤§å°,å¯é€‰ ptgenä½¿ç”¨æ¡ˆä¾‹ è¿™é‡Œè´´å‡ºæˆ‘ä½¿ç”¨ptgenåˆ›å»ºä¸€ä¸ªBananaPi M2 Ultraå¯ä»¥è¯†åˆ«çš„sdå¡é•œåƒæ–‡ä»¶ï¼Œ å¯¹bootfsè¿›è¡ŒæŒ‚è½½å¯æ”¾å…¥ä¸€äº›æ–‡ä»¶ï¼Œåœ¨ubootä¸‹èƒ½è®¿é—®ã€‚\n1#!/bin/bash 2 3if [ -f \u0026#34;sd.img\u0026#34; ]; then 4 echo \u0026#34;warning: sd.img already exist, do nothing\u0026#34; 5 exit 6fi 7 8if [ -f \u0026#34;bootfs.ext4\u0026#34; ]; then 9 echo \u0026#34;warning: bootfs.ext4 already exist, do nothing\u0026#34; 10 exit 11fi 12 13BOOTFS_SIZE=16M 14# make ext4 fs which including kernel.bin 15dd bs=\u0026#34;$BOOTFS_SIZE\u0026#34; if=/dev/zero of=bootfs.ext4 count=1 16sudo mkfs.ext4 bootfs.ext4 17[ -d \u0026#34;./mnt\u0026#34; ] || mkdir ./mnt 18sudo mount -o loop bootfs.ext4 ./mnt 19sudo cp kernel.bin ./mnt 20sudo umount ./mnt 21 22 23# create empty image 24dd bs=32M if=/dev/zero of=sd.img count=1 25 26 27# generate parition table 28# -t 0xc: FAT32 29# -t 0x83: ext4 30set $(./ptgen -o sd.img -h 4 -s 63 -l 1024 -t 0x83 -p \u0026#34;$BOOTFS_SIZE\u0026#34;) 31 32 33BOOTFS_OFFSET=\u0026#34;$(($1 / 512))\u0026#34; 34# write in uboot and bootfs 35dd bs=1024 if=u-boot-sunxi-with-spl.bin of=sd.img seek=8 conv=notrunc 36dd bs=512 if=bootfs.ext4 of=sd.img seek=\u0026#34;$BOOTFS_OFFSET\u0026#34; conv=notrunc 37 38 39echo -e \u0026#34;\\n\\nsd.img is ok\u0026#34; æˆ‘æ­£æ˜¯ä¾èµ–è¿™ä¸ªå·¥å…·ç”Ÿæˆäº†æœ€ç»ˆçš„é•œåƒè€Œå·²ï¼Œå…¶ä»–çš„æ¨¡å—å…¶å®å¹¶ä¸æ˜¯ç‰¹åˆ«éœ€è¦ã€‚ æœ¬æ¥u-bootä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åé¢å‘ç°æˆ‘ç”¨çš„ç¡¬ä»¶(BananaPi M2 Ultra) åœ¨ubootä¸­æœ‰ç›´æ¥çš„defconfigï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¾èµ–openWRTçš„ç¼–è¯‘ç»“æœäº†ã€‚\n","date":"2023-08-05T19:28:12+08:00","permalink":"https://wangloo.github.io/posts/embedded/openwrt/","section":"posts","tags":["tools"],"title":"openwrt å¼€å‘æ—¥è®°"},{"categories":["DevTools"],"contents":"Architecture ARMv8  å¯„å­˜å™¨ã€æŒ‡ä»¤é€ŸæŸ¥ï¼šhttp://hehezhou.cn/arm/  u-boot å…‹éš†ä»“åº“\n1git clone https://github.com/u-boot/u-boot äº¤å‰ç¼–è¯‘toolchain Linaro ç»å¸¸ç”¨æ¥ç¼–è¯‘armv7æ¶æ„çš„ä¸€äº›é¡¹ç›®ã€‚\nhttps://releases.linaro.org/components/toolchain/binaries/\nGNU https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-a/downloads\n ç›®å‰æˆ‘ç»„ç»‡çš„ARM64é¡¹ç›®éƒ½ä½¿ç”¨ aarch64-none-linux-gnu- ä½œä¸ºäº¤å‰ç¼–è¯‘å·¥å…·é›†, ç›´è¾¾é“¾æ¥: https://armkeil.blob.core.windows.net/developer/Files/downloads/gnu-a/10.3-2021.07/binrel/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu.tar.xz\n C GNU å†…è”æ±‡ç¼– https://gcc.gnu.org/onlinedocs/gcc/Using-Assembly-Language-with-C.html#Using-Assembly-Language-with-C\næ„å»ºå·¥å…· è·Ÿæˆ‘ä¸€èµ·å†™makefile PDFï¼šhttps://seisman.github.io/how-to-write-makefile/Makefile.pdf\nåµŒå…¥å¼å¼€å‘å°å·¥å…· ç½‘ç»œè°ƒè¯•å·¥å…· http://free.cmsoft.cn/download/cmsoft/assistant/netassist5.0.3.zip\n å…¶ä»–  Emoji cheat sheet https://www.webfx.com/tools/emoji-cheat-sheet/  Windows10æ­å»ºå±€åŸŸç½‘FTPæœåŠ¡å™¨\n","date":"2023-08-05T19:28:12+08:00","permalink":"https://wangloo.github.io/posts/tools/useful_sites/","section":"posts","tags":["tools"],"title":"å¼€å‘èµ„æ–™ç«™é›†åˆ"},{"categories":["DevTools"],"contents":"å‰è¨€ å†™è¿™ç¯‡åšå®¢çš„èƒŒæ™¯æ˜¯æˆ‘å®åœ¨å¿å—ä¸äº†æ¯æ¬¡æ¢æ–°çš„å¼€å‘æœºå™¨éƒ½å¾—è´¹å¥½å¤§çš„åŠ²æ¥å®Œå…¨æ¢å¤ä»¥å‰çš„ç¯å¢ƒï¼Œ è€Œä¸”ï¼Œæˆ‘å¹³å¸¸å–œæ¬¢æœé›†å„ç§æœ‰ç”¨çš„å·¥å…·ã€å¥½çœ‹çš„ä¸»é¢˜ï¼Œå­—ä½“è¿™äº›ï¼Œå¦‚æœé›¶é›¶æ•£æ•£çš„è®°å½•ï¼Œå¤§æ¦‚ç‡ä¼šå¿˜è®°æˆ–è€…è®°ä¸å¾—æŸäº›ç»†èŠ‚ã€‚\næ‰€ä»¥ï¼Œæœ€åæœŸæœ›è¾¾åˆ°çš„æ˜¯èƒ½å¤Ÿä½¿æˆ‘æ¯æ¬¡åœ¨æ–°æœºå™¨ä¸Šæ­å»ºç¯å¢ƒåªéœ€è¦çœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¯ä»¥äº†ã€‚å› æ­¤è¿™é‡Œä¼šè®°å½•ï¼š\n å¸®åŠ©æå‡å¼€å‘æ•ˆç‡çš„å°å·¥å…· å¥½çœ‹çš„å­—ä½“ã€ä¸»é¢˜ é…ç½®æŸäº›ç¯å¢ƒçš„è¦ç‚¹åŠæ³¨æ„äº‹é¡¹   ğŸ¥€ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æœªå‘ç°ä¸€ç§æ–¹å¼èƒ½å¤Ÿå®Œå…¨è¾¾åˆ°â€œä¸€é”®å¼å¸ƒç½®â€ï¼Œè¿™ä¹Ÿä¸æ˜¯æœ¬æ–‡çš„ç›®çš„ã€‚ ä»˜å‡ºè‡³å°‘åŠå¤©çš„æ—¶é—´çš„ä¸€å®šçš„ï¼Œå¸Œæœ›æœªæ¥èƒ½å‘ç°ä¸€ç§å¥½çš„æ–¹æ³•ã€‚\n å­—ä½“ Fira Code è¿™æ¬¾å­—ä½“é€‚åˆåšç¼–ç¨‹å­—ä½“ï¼Œè›®å¥½çœ‹çš„ã€‚æˆ‘åœ¨ vscode å’Œ terminal ä¸‹éƒ½ä½¿ç”¨äº†è¿™æ¬¾å­—ä½“ã€‚\nè¯¦æƒ…åŠå®‰è£…å‚è€ƒgithub\néœé¹œæ–‡æ¥· å¼€æºçš„ä¸­æ–‡å­—ä½“ï¼Œåšåšå®¢ã€PPT ä¸é”™ã€‚\nè¯¦æƒ…åŠå®‰è£…å‚è€ƒgithub\nvscode vscodeçš„æ‰€æœ‰é…ç½®é€šè¿‡å…¶å†…ç½®çš„syncåŠŸèƒ½å®ç°, ç›®å‰ç”¨çš„æ˜¯Githubè´¦å·åŒæ­¥ã€‚\nUbuntu2004æº æ–°ç‰ˆæœ¬çš„Clangd  Clangdç”¨15+æ‰èƒ½ç”¨vscodeçš„inlay hintåŠŸèƒ½ã€‚\n è·å–ç­¾å\n1wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add - æ·»åŠ æºåœ°å€åˆ°/etc/apt/sources.list, ä¿®æ”¹å®Œååˆ«å¿˜äº†sudo apt update\n1# 15, åç¼€å¯ä»¥æ”¹æˆä½ éœ€è¦çš„ç‰ˆæœ¬å· 2deb http://apt.llvm.org/focal/ llvm-toolchain-focal-15 main 3deb-src http://apt.llvm.org/focal/ llvm-toolchain-focal-15 main æ–°ç‰ˆæœ¬çš„Vim  Vim 8+æ‰æœ‰packæ’ä»¶ç®¡ç†\n 1sudo add-apt-repository ppa:jonathonf/vim ç»ˆç«¯è½¯ä»¶å®‰è£… æºæ›¿æ¢ apt 1sudo apt install python3-pip 2sudo apt install tmux 3sudo apt install fzf 4sudo apt install zsh 5sudo apt install cmake pip3 1# CLI ä»£ç é«˜äº® 2sudo pip3 install pygments shell zsh oh-my-zsh oh-my-zshå¯ä»¥çœ‹ä½œå¯¹zshçš„é…ç½®æ–‡ä»¶åšä¸€å±‚æŠ½è±¡ï¼Œä½¿é…ç½®æ›´æ–¹ä¾¿ã€‚ å¸¦æ¥çš„ç¼ºç‚¹å°±æ˜¯é€Ÿåº¦å˜æ…¢ã€‚\n è¿›å…¥gitç›®å½•ä¸‹å¤ªå¡\nTODOï¼š æ˜¯ä¸»é¢˜çš„åŸå› ï¼Œå¯ä»¥é…ç½®\n é…ç½®æ–‡ä»¶  .bashrc .zshrc .bash_aliase .bash_path  terminal ubuntuè‡ªå¸¦çš„ç»ˆç«¯æˆ‘è§‰å¾—è¿˜ä¸é”™ï¼Œæœ‰äº›äººè¯´Terminitorä¸é”™ï¼Œåˆ†å±åŠŸèƒ½è¿˜æ˜¯æŒºå¸¸ç”¨çš„ï¼\nssh å¯†é’¥ 1ssh-keygen -t rsa -C \u0026#34;cnwanglu@icloud.com\u0026#34; tmux tmux åœ¨è¿œç¨‹å¼€å‘æ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚æˆ‘ä»¬åœ¨ç”¨sshè¿åˆ°æœåŠ¡å™¨æ—¶ç»å¸¸éœ€è¦æœ‰å¤šçª—å£çš„éœ€æ±‚ï¼Œ æ¯”èµ·ç°æœ‰terminalè½¯ä»¶è‡ªå¸¦çš„å¤šçª—å£åŠŸèƒ½(Xshell,mobaxtermç­‰)ï¼Œä½¿ç”¨tmux ä¼šæ›´åŠ æ–¹ä¾¿ã€‚\n çª—å£åˆ›å»ºã€åˆ‡æ¢ç­‰æ–¹å¼å¯ä»¥åšåˆ°ç»Ÿä¸€ï¼Œä¸ç”¨è¿½éšç»ˆç«¯è½¯ä»¶ å¯ä»¥ä¿å­˜ç°åœºï¼Œå³ä¾¿å› ä¸ºç½‘ç»œé—®é¢˜sshæ–­å¼€ï¼Œä¹Ÿèƒ½éšä¾¿æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚å› ä¸º tmuxæ˜¯C/Sæ¶æ„ï¼Œåªè¦æœåŠ¡å™¨ä¸Šçš„serverä¸æ­»ï¼Œæ°¸è¿œå¯ä»¥æ¢å¤ä¹‹å‰çŠ¶æ€ï¼ ç”šè‡³ï¼Œtmuxæä¾›äº†å°†ç°åœºä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ä¸­çš„åŠŸèƒ½ã€‚  reference  Tmuxä½¿ç”¨æ‰‹å†Œ  ç§‘å­¦ä¸Šç½‘ Clash for Linux ç›®å‰clashçš„ä½œè€…å·²ç»åˆ é™¤è·‘è·¯ï¼Œä½†æ˜¯å·²ç»å‘å¸ƒçš„ç‰ˆæœ¬è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ã€‚è¿™ä¸€ç« èŠ‚ä»‹ç»å¦‚ä½•åœ¨Linuxä¸Šç”¨å‘½ä»¤è¡Œé…ç½®Clashã€‚\né¦–å…ˆéœ€è¦å‡†å¤‡å¥½ä¸€äº›æ–‡ä»¶ï¼š\n clashåœ¨linuxä¸­çš„å‘½ä»¤è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›®å‰è¿™é‡Œè¿˜å¯ä»¥ä¸‹è½½ https://github.com/Kuingsmile/clash-core/releasesï¼Œ å»ä¸‹è½½clash-linux-amd64-v1.18.0.gz Country.mmdbä¸ºå…¨çƒIPåº“ï¼Œå¯ä»¥å®ç°å„ä¸ªå›½å®¶çš„IPä¿¡æ¯è§£æå’Œåœ°ç†å®šä½ï¼Œæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶clashæ˜¯æ— æ³•è¿è¡Œçš„ã€‚ ä½†ç›®å‰ç‰ˆæœ¬çš„clashæœ‰ç‚¹é—®é¢˜ï¼Œä¸ä¼šè‡ªåŠ¨ç”ŸæˆMMDBæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œä¸‹è½½ã€‚å»è¿™ä¸ªåœ°æ–¹æˆ–è€…è¿™ä¸ªåœ°æ–¹çœ‹çœ‹ config.yamlä¸ºclashçš„ä»£ç†è§„åˆ™å’Œclashçš„ä¸€äº›å…¶ä»–è®¾ç½®ã€‚ä»£ç†è§„åˆ™ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™ï¼Œé€šè¿‡è®¢é˜…åœ°å€ç›´æ¥ä¸‹è½½å³å¯ã€‚ æ­¤å¤„å°†è®¢é˜…é“¾æ¥ç²˜è´´è¿›åŒå¼•å·ä¸­é—´ã€‚æ³¨æ„ä¸è¦åˆ é™¤åŒå¼•å·ï¼Œä¸è¦åˆ é™¤ç©ºæ ¼ã€‚ wget -O ~/.config/clash/config.yaml \u0026quot;è®¢é˜…é“¾æ¥\u0026quot;ã€‚æˆ–è€…ï¼Œå¦‚æœä½ æœ‰clashçš„å…¶ä»–å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”±å·²æœ‰çš„é…ç½®å¯¼å‡ºã€‚  ä¸‹è½½ä¸Šé¢çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥å‡†å¤‡å¥½å®‰è£…äº†ï¼š\n åˆ›å»º~/.config/clash/ï¼Œå¹¶å°†config.yamlå’ŒCountry.mmdbæ”¾è¿›å»ï¼Œå¦‚æœå·²ç»å­˜åœ¨è¯·å¿½ç•¥ 1mkdir ~/.config/clash/ 2mv Country.mmbd ~/.config/clash/ 3mv config.yaml ~/.config/clash/  è§£å‹clash-linux-amd64-v1.18.0.gzï¼Œå¹¶å°†å¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½® 1gunzip clash-linux-amd64-v1.18.0.gz 2chmod +x clash-linux-amd64-v1.18.0.gz 3mv clash-linux-amd64-v1.18.0 ~/tools/clash-v1.18.0 4cd ~/tools/  è¿è¡Œclashå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœæˆåŠŸè¿è¡Œåº”è¯¥å¯ä»¥çœ‹åˆ°ä»¥ä¸‹LOG 1 $ ./clash-linux-amd64-v1.18.0 2 INFO[0000] Start initial compatible provider æ•…éšœè½¬ç§» 3 INFO[0000] Start initial compatible provider è‡ªåŠ¨é€‰æ‹© 4 INFO[0000] Start initial compatible provider å¤§æœºåœº Big Airport 5 INFO[0000] inbound mixed://:7890 create success. 6 INFO[0000] RESTful API listening at: 127.0.0.1:9090   åˆ°æ­¤ï¼Œclashå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œç”±äºæˆ‘çš„è®¢é˜…åœ°å€æœ‰3æ¡è§„åˆ™ï¼Œæ‰€ä»¥ä¼šæœ‰3æ¡Start initial compatible provider xxxxã€‚\ninbound mixed://:7890 åˆ™ä»£è¡¨å·²ç»å¼€å¯äº†http(å«https)å’Œsocksä»£ç†ï¼Œåªè¦æœåŠ¡å™¨å†…æœ‰è½¯ä»¶æµé‡é€šè¿‡7890è¿™ä¸ªç«¯å£ï¼Œæµé‡éƒ½å°†è¿›å…¥clashä»è€Œè¢«ä»£ç†ã€‚ï¼ˆä½†æœ‰äº›ä¸æ”¯æŒè®¾ç½®ï¼Œåé¢ä¼šè¯´å¦‚ä½•ä½¿ç”¨å…¨å±€ä»£ç†ï¼‰\nRESTful API listening at: [::]:9090ä»£è¡¨clashå·²ç»å¼€å¯äº†uiæ§åˆ¶é¢æ¿ï¼Œæ˜¯çš„ï¼ŒLinuxçš„clashæœ‰å¯è§†åŒ–æ§åˆ¶é¢æ¿ã€‚\néªŒè¯ç§‘å­¦ä¸Šç½‘ æ ¹æ®æˆ‘ä»¬ä¹‹å‰å‰å°è¿è¡Œå¯å¾—çŸ¥ï¼Œé»˜è®¤æ˜¯ç›‘æ§äº†è‡ªå·±çš„7890ç«¯å£ï¼ŒéªŒè¯æ–¹å¼å¯ä»¥é€šè¿‡curlå‘googleå‘é€ä¸€ä¸ªè¯·æ±‚çœ‹æ˜¯å¦èƒ½æ­£å¸¸è¿”å›ã€‚\n1curl --proxy 127.0.0.1:7890 www.google.com è¿”å›æ­£å¸¸ GoogleæˆåŠŸè¿”å›æ•°æ®ï¼Œä»£è¡¨7890ç«¯å£ä»£ç†æ­£å¸¸ï¼Œclashè¿è¡Œæ­£å¸¸ã€‚æ³¨æ„ç›®å‰å¿…é¡»æ‰‹åŠ¨æŒ‡å®šä»£ç†çš„åœ°å€å’Œç«¯å£ï¼Œåé¢ä¼šä»‹ç»å¯ç”¨å…¨å±€ä»£ç†ã€‚\nClashå…¨å±€ä»£ç† å¯ä»¥æ·»åŠ è¿™ä¸ªé…ç½®åˆ°ä½ çš„.bashrc/.zshrcä¸­ï¼Œä½¿å¾—ç»ˆç«¯çš„æ‰€æœ‰è¯·æ±‚éƒ½èµ°ä»£ç†ã€‚\n1export http_proxy=127.0.0.1:7890 2export https_proxy=127.0.0.1:7890 è¿™é‡Œåªè®¾ç½®äº†httpå’Œhttpsï¼Œåˆæ¬¡ä¹‹å¤–ï¼Œè¿˜å¯ä»£ç†å…¶ä»–åè®®ã€‚\nå¯ä»¥åšæˆä¸€ä¸ªshå‘½ä»¤ï¼Œå½“æƒ³ä¸´æ—¶å…³é—­ç§‘å­¦ä¸Šç½‘çš„æ—¶å€™æ‰§è¡Œunproxyã€‚\n1function proxy() { 2 export http_proxy=http://127.0.0.1:7890 3 export https_proxy=$http_proxy 4 echo -e \u0026#34;proxy on!\u0026#34; 5} 6function unproxy(){ 7 unset http_proxy https_proxy 8 echo -e \u0026#34;proxy off\u0026#34; 9} éªŒè¯å…¨å±€ä»£ç†é…ç½®æˆåŠŸåªéœ€è¦å†æ‰§è¡Œä¸€æ¬¡curlå³å¯ï¼Œè¿™æ¬¡æ— éœ€æ‰‹åŠ¨æŒ‡å®šä»£ç†ã€‚\n1curl www.google.com å°†Clashä½œä¸ºä¸€ä¸ªæœåŠ¡ ä½¿clashä¸€ç›´è¿è¡Œåœ¨å‰å°ä¼šå ç”¨ä¸€ä¸ªç»ˆç«¯ï¼Œè€Œä¸”æ€»æ„Ÿè§‰ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯å°†clashä½œä¸ºä¸€ä¸ªæœåŠ¡æ¥æ“ä½œã€‚\n åœ¨/etc/systemd/system/ç›®å½•æ–°å»ºä¸€ä¸ªclash.serviceæ–‡ä»¶ 1[Unit] 2Description=Clash service 3After=network.target 4 5[Service] 6Type=simple 7User=root 8ExecStart=è¿™é‡Œå†™ä½ çš„clashè¿è¡Œçš„ç»å¯¹è·¯å¾„ï¼ˆæœ¬æ–‡ä¸­çš„è·¯å¾„æ˜¯`~/tools/clash-v1.18.0`ï¼‰ 9Restart=on-failure RestartPreventExitStatus=23 10 11[Install] 12WantedBy=multi-user.target  ä¹‹åå°±å¯ä»¥ç”¨systemctlç³»åˆ—å‘½ä»¤æ¥ç¡®è®¤æ˜¯å¦å¯ç”¨æˆåŠŸï¼š 1systemctl status clash æŸ¥çœ‹clashæœåŠ¡ 2systemctl start clash å¯åŠ¨clashæœåŠ¡ 3systemctl stop clash åœæ­¢clashæœåŠ¡ 4systemctl restart clash é‡å¯clashæœåŠ¡ 5systemctl enable clash è®¾ç½®å¼€æœºè‡ªå¯clashæœåŠ¡ 6systemctl daemon-reload å¦‚æœä¿®æ”¹äº†clash.serviceæ–‡ä»¶ï¼Œéœ€è¦æ­¤å‘½ä»¤æ¥é‡è½½è¢«ä¿®æ”¹çš„æœåŠ¡æ–‡ä»¶   Reference  Linuxä¸­å®‰è£…Clashå¹¶ä¸”å®ç°å…¨å±€ä»£ç†ï¼ˆçº¯å‘½ä»¤è¡Œï¼‰ https://github.com/Kuingsmile/clash-core/releases clash-for-linux Ubuntué…ç½® å‘½ä»¤è¡ŒClash æ•™ç¨‹ Clash can\u0026rsquo;t initial MMDB of Country.mmdb  Windowsä¸‹è¿ç§»WSL WSL2ç›®å‰å·²ç»ç›¸å½“å¥½ç”¨äº†ï¼Œåœ¨å¯¹æ€§èƒ½è¦æ±‚ä¸æè‡´çš„åœºæ™¯ä¸‹ç”¨WSLå¼€å‘éå¸¸èˆ’æœã€‚\nè¿ç§»WSLåˆ°åˆ«çš„ä½ç½®/åˆ«çš„æœºå™¨è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œä¹Ÿæœ‰äººå†™äº†è„šæœ¬æ¥åšè¿™äº›ï¼Œå®ƒæ˜¯é’ˆå¯¹è¿ç§»åˆ°å…¶ä»–ç¡¬ç›˜ä½ç½®çš„ï¼Œæ‰€ä»¥æˆ‘è¿™æ¬¡è¿˜æ˜¯è‡ªå·±æ‰‹åŠ¨åšä¸€éï¼ŒåŸç†éƒ½æ˜¯ç›¸åŒçš„ã€‚\næ­¥éª¤ 1. å…³é—­WSL 1# æ£€æŸ¥WSLæ˜¯å¦åœ¨è¿è¡Œ 2wsl -l -v 3 NAME STATE VERSION 4* Ubuntu2004 Running 1 5# å…³é—­ 6wsl --shutdown 2. å¯¼å‡ºWSLé•œåƒ 1wsl --export Ubuntu2004 D:\\Ubuntu2004_202311.tar 3. æ³¨é”€åŸç³»ç»Ÿ(å¯é€‰) 1wsl --unregister Ubuntu2004 4. å°†é•œåƒå‹ç¼©æ–‡ä»¶å¤åˆ¶åˆ°æ–°æœºå™¨/æ–°ä½ç½® å¦‚æœæ˜¯æ–°æœºå™¨ï¼Œè¿˜éœ€è¦é‡æ–°é…ç½®å¥½WSLï¼Œå¼€å¯ä¸€äº›é€‰é¡¹:\n1æ§åˆ¶é¢æ¿-\u0026gt;ç¨‹åº-\u0026gt;å¯ç”¨æˆ–å…³é—­ windows åŠŸèƒ½ï¼Œå¼€å¯ Windows è™šæ‹ŸåŒ–å’Œ Linux å­ç³»ç»Ÿï¼ˆWSL2)ä»¥åŠHyper-Vã€‚ 2 3å‹¾é€‰å®Œæˆåï¼ŒWindows11 ä¼šè‡ªå·±ä¸‹è½½äº›ä¸œè¥¿ï¼Œå¹¶æç¤ºä½ é‡å¯ã€‚ç­‰ç”µè„‘å½»åº•é‡å¯å®Œä»¥åï¼Œè¿›è¡Œåç»­æ“ä½œã€‚ 5. åœ¨æ–°æœºå™¨ä¸Šå¯¼å…¥é•œåƒæ–‡ä»¶ 1wsl --import Ubuntu2004 D:\\wsl\\Ubuntu2004\\ D:\\Ubuntu2004_202311.tar æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒé•¿, æ‰§è¡Œå®Œåè‡³æ­¤WSLå°±è¿ç§»å®Œæ¯•äº†ï¼Œå‰©ä¸‹çš„æ˜¯ä¸€ä¸‹é…ç½®çš„ä¿®æ­£ã€‚\n6. é…ç½® è®¾ç½®é»˜è®¤ç”¨æˆ· è¿™æ ·ç§»è¿‡æ¥ç°åœ¨ç™»é™†å°±æ˜¯rootï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›é…ç½®:\nSet your default user inside your distro by adding the following configuration to your /etc/wsl.conf.\n1[user] 2default=loo If the file doesn\u0026rsquo;t exist create it manually. Then exit your distro, terminate it (wsl -t Ubuntu2004) and start it again.\nè®¾ç½®é»˜è®¤distro 1wsl -s Ubuntu2004 è¿™æ ·å®Œæˆåï¼Œæ‰€æœ‰çš„ä¸€åˆ‡å°±OKäº†ã€‚\nReference  https://zhuanlan.zhihu.com/p/622706723  Linuxç»„ç»‡Dotfiles Linuxå¼€å‘ç¯å¢ƒä¸­çš„è®¸å¤šè½¯ä»¶éƒ½ç”±é…ç½®æ–‡ä»¶ï¼Œé‡æ–°æ£é¼“ä¸€å°æ–°ç¯å¢ƒæ—¶å»é‡æ–°è®¾ç½®è¿™äº›é…ç½®æ–‡ä»¶æ˜¯éå¸¸å¤æ‚çš„ä¸€ä»¶äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘æƒ³ç€ç”¨ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚\n vimrcs ç”¨å•ç‹¬çš„å­ä»“åº“ç®¡ç† vim æ’ä»¶ä½¿ç”¨å•ç‹¬çš„å­ä»“åº“ç®¡ç† å…¶ä»–çš„é…ç½®æ–‡ä»¶æš‚æ—¶éƒ½ä½¿ç”¨mackupç®¡ç†   ä¸å°†vimæ’ä»¶ä¹Ÿå½’äºmackupç®¡ç†çš„åŸå› æ˜¯: æˆ‘çš„.vim/pack/xx/ä¸‹çš„æ‰€æœ‰æ’ä»¶éƒ½æ˜¯é€šè¿‡submoduleçš„æ–¹å¼ç®¡ç†,è¿™æ ·æœ‰åˆ©äºç»´æŠ¤å’Œæ›´æ–°ã€‚ä½†æ˜¯åœ¨mackupçš„ç®¡ç†æ–¹å¼ä¸­æ˜¯å°†æ•´ä¸ªpack/çš„å†…å®¹æ‹·è´è¿‡æ¥ï¼Œè¿™å°±ä¸submoduleçš„ç†å¿µå†²çªäº†ã€‚æ­¤æ—¶å»æ”¹mackupçš„å®ç°ä¸å¦‚å°†vimçš„æ’ä»¶ç³»ç»Ÿå•ç‹¬è¿›è¡Œç»´æŠ¤æ›´å®¹æ˜“ã€‚\n æ–°ç¯å¢ƒæ¢å¤Dotfile  vimrcsçš„æ¢å¤æ–¹æ³•: wangloo/myvimrcs vimæ’ä»¶çš„æ¢å¤æ–¹æ³•: wangloo/myvimpack å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œæ•™ç¨‹å‚è€ƒï¼šwangloo/dotfiles  Reference  Installing Vim(8) plugins with the native pack system  ","date":"2023-07-17T19:28:12+08:00","permalink":"https://wangloo.github.io/posts/tools/dev_env/","section":"posts","tags":["tools"],"title":"å¼€å‘ç¯å¢ƒæ„å»ºæŒ‡å—"},{"categories":["Operating System"],"contents":"slub å’Œ slob æ˜¯åŸºäº slab æ€æƒ³é’ˆå¯¹æŸäº›åœºæ™¯ä¸‹çš„ä¼˜åŒ–å®ç°ã€‚\nSLUB  å½“ slab åˆ†é…å™¨é¢å¯¹è¿‡å¤šçš„ç”³è¯·éœ€æ±‚æ—¶ï¼Œcache ä¸­å°±ä¼šæœ‰å¤šä¸ª slab (struct slab), åœ¨ä»¥å‰çš„ slab åˆ†é…å™¨è®¾è®¡ä¸­ï¼Œ slab æè¿°ç¬¦æ˜¯æ”¾åœ¨ç‰©ç†é¡µä¸­çš„ï¼Œå³ç‰©ç†é¡µçš„ç»“æ„ä¸ºï¼š ï¼ˆslab æè¿°ç¬¦+freelist+å¯¹è±¡ sï¼‰,ç®¡ç†æ•°æ®ç»“æ„çš„å¼€é”€å°±æ¯”è¾ƒå¤§ã€‚åæœŸ SLUB é¦–å…ˆå°† slab æè¿°ç¬¦ä¸struct pageå…±ç”¨ï¼ˆé€šè¿‡ union å®ç°ï¼‰ã€‚åé¢è¯¥æ€æƒ³è¢« SLAB é‡‡çº³ã€‚ SLAB ä¸­æ¯ä¸ª cache node æœ‰ä¸‰ä¸ª list: free, partial, fullï¼Œ ç®¡ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œ SLUB ä¸­åªæœ‰ä¸€ä¸ª partial é“¾è¡¨ã€‚ æ”¾å¼ƒç€è‰²ï¼Œæ•ˆæœä¸æ˜æ˜¾  SLOB SLOB çš„è®¾è®¡æ›´åŠ ç®€æ´ï¼Œåªæœ‰ 600 è¡Œå·¦å³ä»£ç ï¼ˆSLABï¼ŒSLUB éƒ½æ˜¯ 4000+ï¼‰ï¼Œé€‚åˆå°å†…å­˜çš„åµŒå…¥å¼è®¾å¤‡ã€‚\nSLOB ä¸­æ²¡æœ‰å¯¹è±¡çš„æ¦‚å¿µï¼Œæ¯ä¸ª slab ä¸­åˆ†é…çš„å°å—å†…å­˜å¤§å°å¯ä»¥æ˜¯ä¸åŒçš„ï¼Œ é€šè¿‡é•¿åº¦+åç§»æ¥è®°å½•ä¸‹ä¸€ä¸ªå°å—å†…å­˜çš„ä½ç½®ã€‚\nå¦å¤–ï¼ŒSLOB åŸºæœ¬ä¸Šæ”¾å¼ƒäº† cache çš„æ€æƒ³ï¼Œç³»ç»Ÿä¸­é€šè¿‡åˆ›å»ºä¸‰ä¸ªå…¨å±€çš„é“¾è¡¨: small, medium, large, åˆ†åˆ«åº”å¯¹\u0026lt;256b, \u0026lt;1k, \u0026lt;PAGESIZE çš„è¯·æ±‚ï¼Œ slab ç›´æ¥æŒ‚åœ¨è¿™ä¸‰ä¸ªé“¾è¡¨ä¸Šï¼Œå› ä¸º slab ä¸­çš„å†…å­˜åˆ†é…å¤§å°å¯ä»¥ä¸åŒï¼Œ ç”¨ä¸‰ä¸ªé“¾è¡¨å¯ä»¥åŠ é€ŸæŸ¥æ‰¾ã€‚\n ä»æ€æƒ³ä¸Šï¼ŒSLOB ä»…ä»…ä¿ç•™ slab ä¸­åˆ†é…å°å—å†…å­˜çš„æ€æƒ³ï¼Œèˆå¼ƒäº† cache çš„è®¾è®¡æ–¹æ¡ˆï¼Œæ‰€ä»¥å®ç°ä¸Šéå¸¸ç®€å•ã€‚\n ","date":"2023-05-26T18:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/mem/slab3/","section":"posts","tags":["linux","Operating System"],"title":"Linux SLAB å†…å­˜åˆ†é…å™¨(3): SLUB/SLOB"},{"categories":["Operating System"],"contents":"ä¸Šä¸€ç¯‡ä»‹ç»äº†æ•°æ®ç»“æ„ï¼Œè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç» slab åˆ†é…å™¨çš„åˆ†é…å’Œé‡Šæ”¾ç®—æ³•ã€‚\næœ€å¤–å±‚æ¥å£: kmalloc()/kfree() æœ€ä¸Šå±‚çš„æ¥å£æ˜¯kmalloc(size, flag)ã€‚\nslab åˆ†é…å™¨ç»´æŠ¤äº†å¤šä¸ªä¸åŒå¤§å°çš„ kmem_cacheï¼Œæ”¾åœ¨æ•°ç»„kmem_caches[]ä¸­, å…¶å¯¹åº”çš„ object å¤§å°å’Œè¯¥ kmem_cache çš„ name åœ¨å¦ä¸€ä¸ªæ•°ç»„kmalloc_info[] ä¸­ï¼Œå®ƒä»¬çš„ä¸‹æ ‡æ˜¯å¯¹åº”çš„ã€‚ä½¿å¾—æˆ‘ä»¬èƒ½æ ¹æ®è¯·æ±‚åˆ†é…çš„å¤§å°æ¥æ‰¾åˆ°å¯¹åº”çš„struct kmem_cacheç»“æ„ã€‚ ã€ä»£ç ã€‘\nä¸“ç”¨çš„\u0026quot;cache\u0026quot; ä¸Šé¢çš„ç»“æ„ï¼Œä¼šéå†ç³»ç»Ÿåˆå§‹åŒ–åˆ›å»ºçš„ä¸€äº›å†…å­˜æ± ï¼Œæ¥å¯»æ‰¾ä¸€ä¸ªå¤§å°æ»¡è¶³è¦æ±‚çš„ objectï¼Œ ä½†æ˜¯é€šå¸¸ä¸èƒ½æ‰¾åˆ°å¤§å°ç›¸ç­‰çš„ï¼Œå¦‚æœç³»ç»Ÿä¸­å­˜åœ¨çš„å›ºå®š cache ä¸­ object çš„å¤§å°å¤ªç¨€ç–ï¼Œ å°±å®¹æ˜“å‘ç”Ÿç©ºé—´æµªè´¹çš„é—®é¢˜ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæŸä¸ªç‰¹å®šå¤§å°çš„å†…å­˜è¯·æ±‚å†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ cacheï¼Œä»…ä»…ç”¨äºæ»¡è¶³è¿™ä¸€ç±» ç»“æ„ä½“çš„ç”³è¯·ï¼Œä¹Ÿæ˜¯ç¬¦åˆ slab åˆ†é…å™¨å…³äºé¢å‘å¯¹è±¡çš„è®¾è®¡æ€æƒ³ã€‚\nslab åˆ†é…å™¨æä¾›çš„ç›¸å…³æ¥å£æ˜¯:\n kmem_cache_create(): åˆ›å»ºä¸€ä¸ªä¸“ç”¨ cache kmem_cache_alloc()ï¼š ä»æŒ‡å®šçš„ cache é‡Œåˆ†é… object kmem_cache_free(): é‡Šæ”¾å¯¹è±¡åˆ°æŒ‡å®šçš„ cache kmem_cache_destory(): é”€æ¯æŸä¸ª cache  Reference https://blog.csdn.net/u010923083/article/details/116518646?spm=1001.2014.3001.5502\n","date":"2023-05-20T18:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/mem/slab2/","section":"posts","tags":["linux","Operating System"],"title":"Linux SLAB å†…å­˜åˆ†é…å™¨(2): ç®—æ³•"},{"categories":["Operating System"],"contents":" å‚è€ƒçš„ linux kernel ä»£ç ç‰ˆæœ¬ 4.12\n slab æ˜¯ä»€ä¹ˆ slab å±äº linux å†…æ ¸å†…å­˜åˆ†é…å™¨çš„ä¸€ç§ï¼Œæ»¡è¶³ç»†ç²’åº¦çš„å°å—å†…å­˜çš„è¯·æ±‚ã€‚ å†…æ ¸ä¸­è¿˜æœ‰å…¶ä»–çš„å†…å­˜åˆ†é…å™¨ä¾‹å¦‚ä¼™ä¼´ç³»ç»Ÿï¼Œå®ƒæ˜¯æ»¡è¶³é¡µä¸ºå•ä½çš„åˆ†é…è¯·æ±‚ã€‚ å› ä¸ºå†…æ ¸ä¸­å¤§éƒ¨åˆ†çš„åˆ†é…è¯·æ±‚éƒ½ç”¨ä¸åˆ°ä¸€ä¸ªé¡µé‚£ä¹ˆå¤§ï¼Œæ‰€ä»¥ slab çš„å‡ºç°èƒ½å¤Ÿå‡å° å†…å­˜ç¢ç‰‡çš„å‡ºç°ã€‚\nå¦å¤–ï¼Œéå¸¸é‡è¦çš„æ˜¯ï¼Œé™¤äº†åŸºæœ¬çš„å°å—å†…å­˜åˆ†é…ï¼Œ slab çš„æœ€åˆè®¾è®¡å¼€å§‹å°±åŸºäº å¯¹è±¡ç¼“å­˜çš„æ€æƒ³ï¼ŒåŠ é€Ÿåˆ†é…å’Œåˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œä¸‹é¢å°†è¯¦ç»†ä»‹ç»ç¼“å­˜çš„è®¾è®¡æ€æƒ³ã€‚\n slab åˆ†é…å™¨çš„å®ç°åœ¨ linux ä¸­æ˜¯åŸºäºä¼™ä¼´ç³»ç»Ÿçš„ï¼Œslab ç®¡ç†çš„å†…å­˜æ¥æº å°±æ˜¯ä¼™ä¼´ç³»ç»Ÿï¼Œåªæ˜¯è¿›è¡Œâ€œäºŒæ¬¡ç®¡ç†â€ï¼Œ ã€‚\n slab çš„è®¾è®¡æ€æƒ³ å¯¹è±¡ç¼“å­˜ç‰¹æ€§ ç»å¸¸ä¼šåœ¨ slab æ¥å£ä¸­çœ‹åˆ°kmem_cacheè¿™ä¸ªå‰ç¼€ï¼Œæˆ‘æœ€åˆä¹Ÿæœ‰ç–‘é—®è¯´ slab ä¸å°±æ˜¯ä¸€ä¸ªå†…å­˜åˆ†é…ç®—æ³•ï¼Œå’Œ cache æ‰¯ä¸Šä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ\nslab ä¸€èˆ¬ç”¨äºåˆ†é…ä¸€äº›ç»“æ„çš„å†…å­˜ï¼Œæ‹¿struct taskæ¥ä¸¾ä¾‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä¸º struct taskåˆ›å»ºä¸€ä¸ªå†…å­˜æ± ï¼Œé‡Œé¢åŒ…å«äº†è‹¥å¹²å¤§å°ä¸ºsizeof(struct task) çš„å†…å­˜å—ï¼Œç”¨çš„æ—¶å€™ä»é‡Œé¢å–ï¼Œé‡Šæ”¾ä¹‹åå›å½’æ± å­é‡Œå³å¯ã€‚è¿™æ˜¯ slab åˆ†é…å°å—å†…å­˜çš„ åŸºæœ¬æ€æƒ³ã€‚\nå†…æ ¸ä¸­çš„å¾ˆå¤šæ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬åœ¨ç”³è¯·å®Œç©ºé—´ä¹‹åç«‹é©¬åšçš„ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åˆå§‹åŒ–å¯¹è±¡çš„æˆå‘˜ ä¸ºæŸäº›ç‰¹å®šçš„å€¼ï¼Œå¯ä»¥ç§°è¿™ä¸ªè¿‡ç¨‹ä¸ºç»“æ„ä½“(ç±»)çš„æ„é€ å‡½æ•°ï¼Œæ„ä¸ºæ‰€æœ‰å¯¹è±¡éƒ½ä¼š åšçš„é‚£äº›ç›¸åŒçš„äº‹ã€‚æ¯”å¦‚è¯´ï¼Œå¤šæ ¸ç¯å¢ƒä¸‹å¾ˆå¤šç»“æ„ä¸­ä¼šæœ‰é”ï¼Œæˆ–è€…é“¾è¡¨ï¼Œé‚£ä¹ˆç”³è¯·å®Œç©ºé—´ ä¹‹åéƒ½ä¼šåšé”æˆ–é“¾è¡¨åšåˆå§‹åŒ–ï¼Œè¿™æ˜¯å›ºå®šçš„ã€‚å®é™…ä¸Šè¿™äº›æ“ä½œæ¶ˆè€—çš„æ—¶é—´ç”šè‡³å¤§äºç”³è¯· ä¸€å—å†…å­˜ã€‚\nåŸºäºä»¥ä¸Šäº‹å®ï¼Œslab åˆ†é…å™¨åšçš„ç¼“å­˜ä¼˜åŒ–æ˜¯ï¼šä¸ºæ¯ä¸ªç±»åˆ«çš„å†…å­˜æ± éƒ½ç»‘å®šä¸€ä¸ªæ„é€ å‡½æ•° å’Œææ„å‡½æ•°ï¼Œå½“ç”¨å®Œçš„å¯¹è±¡ç©ºé—´è¢«é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨ææ„å‡½æ•°å°†æŸäº›æˆå‘˜çš„å€¼æ¢å¤ä¸ºé»˜è®¤çŠ¶æ€ ï¼Œè¿™æ ·ä¸‹æ¬¡ç”³è¯·çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿å°±è¡Œäº†ï¼Œçœç•¥äº†é‡å¤çš„åˆå§‹åŒ–æµç¨‹ã€‚è€Œæ„é€ å‡½æ•°è¢«è°ƒç”¨çš„ æƒ…å†µä»…ä»…æ˜¯å½“è¯¥å°å—å†…å­˜ç¬¬ä¸€æ¬¡è¢«ç”³è¯·æ—¶ã€‚\nç”±äºè¿™ä¸ªæ€æƒ³ï¼Œæ•´ä¸ªå†…å­˜æ± ä¹Ÿå°±è¢«å£°æ˜ç»“æ„ struct kmem_cache, å®ƒæ˜¯æ•´ä¸ª slab ç®—æ³•çš„é¡¶å±‚æ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†è®¸å¤šç›¸åŒå¤§å°çš„å°å†…å­˜å—ï¼Œslab é€šè¿‡ä¸€äº›ç®—æ³•å¯¹å…¶è¿›è¡Œ ç®¡ç†ã€‚\næ•´ä½“æ•°æ®ç»“æ„çš„è§„åˆ’ ä¸Šé¢è¯´äº†æ•´ä¸ªç³»ç»Ÿçš„é¡¶å±‚ç»“æ„æ˜¯struct kmem_cache, å…¶ä¸­å¯ä»¥å†åˆ’åˆ†ä¸ºå¤šä¸ª\u0026quot;slab\u0026quot;, è¿™ä¸ª slab å°±èƒ½ä»£è¡¨ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„ç‰©ç†é¡µå˜›ï¼Œä» buddy ç”³è¯·æ¥çš„ã€‚\nè¡¨ç¤ºä¸€ä¸ª slab çš„æè¿°ç¬¦å¯ä»¥ä¸struct pageï¼Œå³ç‰©ç†é¡µæè¿°ç¬¦å…±ç”¨ï¼Œåªæ˜¯æœ‰ä¸€äº› ç‰¹å®šçš„æˆå‘˜ä¸åŒï¼Œä½†æ¯•ç«Ÿ slab æè¿°ç¬¦å«ä¹‰ä¸Šæ¥è¯´ä¹Ÿæ˜¯è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªè”ç³»çš„ç‰©ç†é¡µã€‚ åªæ˜¯è¿™äº›ç‰©ç†é¡µä¸­å¯ä»¥å†æ­¤è¿›è¡Œåˆ’åˆ†ä¸ºå°çš„å†…å­˜å—ã€‚\nslab ç®—æ³•ç§°è¿™äº›å°çš„å†…å­˜å—ä¸ºobject, å¯¹è±¡, æ¯ä¸ªkmem_cacheä¸­çš„æ‰€æœ‰ slab ä¸­çš„æ‰€æœ‰ object çš„å¤§å°éƒ½æ˜¯ä¸€è‡´çš„ã€‚\nslabæ‰€æŒ‡å‘çš„è¿ç»­ç‰©ç†é¡µä¸­çš„å†…å®¹=ï¼ˆä¸€å¤§å † object +è¾…åŠ©å¿«é€Ÿå®šä½ object çš„ç»“æ„ï¼‰ã€‚ [å›¾]\nè¿™ä¸ªç»“æ„å°±å·®ä¸å¤šäº†ï¼Œå¦å¤–ï¼Œå¦‚æœè®©kmem_cacheä¸‹çš„æ‰€æœ‰ slab éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œä¸å¥½åˆ¤æ–­é‚£äº› slab ä¸­çš„ object å·²ç»å…¨éƒ¨åˆ†é…äº†ï¼Œå“ªäº› slab æ˜¯ç©ºçš„ï¼Ÿä¸ºäº†æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ï¼Œslab ç®—æ³•è¿˜ å°è£…äº†ä¸€ä¸ªstruct kmem_cache_nodeç»“æ„ï¼Œç»„ç»‡äº†ä¸‰æ¡é“¾è¡¨: free, partial, fullã€‚ ç‰¹å®šçŠ¶æ€çš„ slab æŒ‚åœ¨ç‰¹å®šçš„é“¾è¡¨ä¸Šï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚ã€å›¾ã€‘\nReference https://blog.csdn.net/u010923083/article/details/116518248\n","date":"2023-05-20T17:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/mem/slab1/","section":"posts","tags":["linux","Operating System"],"title":"Linux SLAB å†…å­˜åˆ†é…å™¨(1): æ¦‚è¿°"},{"categories":["Operating System"],"contents":"è½¯ä¸­æ–­ã€taskletã€å·¥ä½œé˜Ÿåˆ—éƒ½æ˜¯ä¸­æ–­ä¸Šä¸‹éƒ¨åˆ†ç¦»çš„å…·ä½“å®ç°æ–¹æ¡ˆã€‚\nè½¯ä¸­æ–­ æˆ‘ä»¬å¯ä»¥å°†æŸäº›ä¸­æ–­é…ç½®ä¸ºè½¯ä¸­æ–­ï¼Œç›¸å½“äºå»ºç«‹ä¸€å¼  INTID åˆ°è½¯ä¸­æ–­çš„æ˜ å°„è¡¨ï¼Œè¿™æ ·åœ¨ ä¸­æ–­åˆ°æ¥æ—¶å°±èƒ½åˆ¤æ–­æ˜¯å¦ä¸ºè½¯ä¸­æ–­ã€‚\nè¿™å¼ â€œè¡¨â€çš„å»ºç«‹æ˜¯é™æ€çš„ï¼Œå³ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚key ä¸º INTIDï¼Œvalue ä¸ºæè¿°ä¸€ä¸ªè½¯ä¸­æ–­ çš„æ•°æ®ç»“æ„ï¼Œåœ¨ä¸‹é¢ä¼šä»‹ç»ã€‚\n è½¯ä¸­æ–­çš„æœåŠ¡å‡½æ•°å¿…é¡»æ˜¯å¯é‡å…¥çš„ï¼Œå³å¤šä¸ª CPU å¯ä»¥åŒæ—¶æ‰§è¡ŒåŒä¸€ä¸ª softirq çš„å¤„ç†å‡½æ•°ï¼Œæ¶‰åŠåˆ°çš„å…¨å±€ç»“æ„å¯ä»¥ç”¨ spinlock é’³åˆ¶ã€‚\n è¡¨ç¤º softirq çš„æ•°æ®ç»“æ„ struct softirq_actionä»£è¡¨ä¸€ä¸ªè½¯ä¸­æ–­ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰æ”¯æŒçš„è½¯ä¸­æ–­ç»„æˆä¸€ä¸ªæ•°æ® softirq_vec[], æ‰€æœ‰çš„è½¯ä¸­æ–­æŒ‰ç…§ä¼˜å…ˆçº§æ¥åˆ†é…ä¸‹æ ‡ã€‚\n1struct softirq_action { 2 // æŒ‡å‘softirqçš„å¤„ç†å‡½æ•° 3 void (*action)(struct softirq_action *); 4}; softirq çš„ä¸­æ–­æµç¨‹ åœ¨ä¸­æ–­çš„ä¸Šéƒ¨ï¼Œå¦‚æœè¯†åˆ«åˆ°å½“å‰ä¸­æ–­æ˜¯ä¸€ä¸ª softirqï¼Œ é‚£ä¹ˆç³»ç»Ÿä¼šæ ‡è®°ä¸€ä¸ªè½¯ä¸­æ–­å‘ç”Ÿï¼Œ å³raise_softirq()å‡½æ•°ã€‚å…¶åšçš„äº‹æƒ…åŒ…æ‹¬:\n æ ‡è®°æŸä¸ªè½¯ä¸­æ–­å‘ç”Ÿï¼Œè®°å½•çš„ç»“æ„æ˜¯irq_cpustate_t.__softirq_pending (è¿™ä¸ªå­—æ®µä½¿loca_softirq_pending()è®¿é—®) å”¤é†’ksoftirqdå†…æ ¸çº¿ç¨‹ï¼Œä¹‹åä»‹ç»  å…‰æ ‡è®°ä¸è¡Œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®ƒä»¬çš„æœåŠ¡å‡½æ•°å‘¢ï¼Ÿ\nå‡ ä¸ªå¯èƒ½çš„æ£€æŸ¥ç‚¹:(1) ä¸­æ–­é€€å‡ºå‰ (2)ksoftirqè¢«å”¤é†’æ—¶\nå¦‚æœåœ¨æ£€æŸ¥ç‚¹å‘ç°æœ‰æ ‡è®°æŒ‚èµ·çš„ softirq(local_softirq_pending() != 0), å†…æ ¸è°ƒç”¨do_softirq()å¤„ç†å®ƒä»¬ï¼š\n å¦‚ä½•in_interrupt()è¿”å›é 0ï¼Œ ç›´æ¥è¿”å›ã€‚æ­¤æ—¶ä»£è¡¨è¦ä¹ˆç¦ç”¨äº† softirqï¼Œè¦ä¹ˆå½“å‰æ˜¯ åœ¨ä¸­æ–­åµŒå¥—çš„ç¯å¢ƒä¸‹ï¼Œä¹Ÿå¯èƒ½æ­£åœ¨æ‰§è¡Œdo_softirq()æ—¶ä¸­æ–­åµŒå¥—çš„ï¼Œè€Œdo_softirq() å‡½æ•°æ˜¯ä¸èƒ½åµŒå¥—æ‰§è¡Œçš„ã€‚ è°ƒç”¨__dosoft_irq(), å¯¹äºlocal_softirq_pending()çš„æ¯ä¸€ä½éƒ½è°ƒç”¨å…¶ softirq_vec[nr]-\u0026gt;action()  è¿™é‡Œæœ‰ä¸ªé‡è¦çš„é—®é¢˜ï¼Œæ­¤æ—¶å¤„äºä¸­æ–­ä¸‹éƒ¨ï¼Œå³å¼€ä¸­æ–­çš„æƒ…å†µï¼Œæ‰€ä»¥åœ¨å¤„ç† softirq æ—¶ä¼šæœ‰æ–°çš„ softirq åˆ°æ¥ï¼Œè¿™é‡Œå°±æœ‰ä¸¤ç§ç­–ç•¥ï¼š\n ä¸æ–­çš„è·å–æœ€æ–°çš„local_softirq_pending(), ç›´åˆ°ä¸å†æœ‰æ–°çš„ softirq äº§ç”Ÿæ‰è¿”å› å¿½ç•¥æ–°æ¥çš„ softirqï¼Œä½¿å…¶åœ¨ä¸‹æ¬¡æ£€æŸ¥ç‚¹å†è¢«å¤„ç†  è¿™ä¸¤ç§æ–¹æ¡ˆå…¶å®å„æœ‰åˆ©å¼Šï¼Œé¦–å…ˆç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œæé«˜äº† softirq çš„å“åº”é€Ÿåº¦ï¼Œä½†å¦‚ä½• softirq è¿‡å¤šæˆ–è€…å¤„ç†æ—¶é—´å¤ªé•¿å°±ä¼šå¯¼è‡´ç”¨æˆ·æ€çº¿ç¨‹å·²çŸ¥å¾—ä¸åˆ°è¿è¡Œï¼›è€Œç¬¬äºŒç§æ–¹æ¡ˆåˆ™ä¼šå¢åŠ  softirq çš„å“åº”å»¶è¿Ÿã€‚\nå®é™…ä¸Šï¼Œsoftirq çš„å¤„ç†å‡½æ•°do_softirq()æ˜¯é‡‡ç”¨æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œå®ƒä¼šåœ¨å†…éƒ¨å¾ªç¯æ£€æŸ¥ 10 æ¬¡ ï¼ˆæ˜¯å¯é…ç½®çš„ï¼‰ï¼Œæ£€æŸ¥æœ‰æ— æ–°çš„ softirq åˆ°æ¥ã€‚å¯¹äºé‚£äº›åœ¨å¾ªç¯ä¹‹ååˆ°æ¥çš„ softirqï¼Œé‚£ä¹ˆ å”¤é†’ ksoftirqd çº¿ç¨‹æ¥å¤„ç†å‰©ä¸‹çš„ï¼Œä¸å»¶è¿Ÿç”¨æˆ·æ€çš„è¿è¡Œã€‚\nksoftirqd å†…æ ¸çº¿ç¨‹ ksoftirqd æ˜¯ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œæ¯ä¸ª CPU éƒ½æœ‰ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯ä¸æ–­æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‚èµ·çš„ softirqï¼Œ å¹¶ æ‰§è¡Œå…¶å¤„ç†å‡½æ•°ã€‚\n1for (;;) { 2 set_current_state(TASK_INTERRUPTABLE); 3 schedule(); 4 while (local_softirq_pending()) { 5 preempt_disable(); 6 do_softirq(); 7 preempt_enable(); 8 } 9} ksoftirqd çš„ä¼˜å…ˆçº§è¾ƒä½ï¼Œè¿™æ ·å½“do_softirq()å¾ªç¯ 10 æ¬¡è¿˜æœ‰æ–°çš„ softirq æ—¶ï¼Œ å”¤é†’ ksoftirqd çº¿ç¨‹ä¸ä¼šè€½è¯¯ç”¨æˆ·æ€çš„æ‰§è¡Œï¼Œä½†å½“ç³»ç»Ÿç©ºé—²æ—¶é—´ï¼ŒæŒ‚èµ·çš„ softirq åˆ ä¼šå¾ˆå¿«å¾—åˆ°å¤„ç†ã€‚\ntasklet tasklet æ˜¯åŸºäºå…¶ä¸­ä¸€ä¸ªè½¯ä¸­æ–­(TASKLET_SOFTIRQ)æ„å»ºï¼Œå…¶å…³ç³»æœ‰ç‚¹åƒçº¿ç¨‹ä¸ç”¨æˆ·æ€ çº¿ç¨‹ä¹‹é—´é‚£ç§åµŒå¥—å…³ç³»ã€‚\ntasklet çš„åˆ†é…å¯ä»¥æ˜¯è¿è¡Œæ—¶ç¡®å®šçš„(ä¾‹å¦‚ä½¿ç”¨ insmod)å¢åŠ æ–°çš„ taskletã€‚\n å†…æ ¸å¯¹ tasklet çš„æœåŠ¡å‡½æ•°è¿›è¡Œäº†æ›´åŠ ä¸¥æ ¼çš„æ§åˆ¶ï¼šä¸èƒ½åœ¨å¤šä¸ª CPU ä¸ŠåŒæ—¶è¿è¡ŒåŒä¸€ä¸ªç±»å‹çš„ tasklet å‡½æ•°(ä¸åŒç±»å‹çš„ tasklet å¯ä»¥)ã€‚ï¼Œè¿™æ ·å°±ä½¿å¾— tasklet æœåŠ¡å‡½æ•°ä¸å¿…éå¾— å®ç°ä¸ºå¯é‡å…¥çš„ï¼Œ ç®€åŒ–é©±åŠ¨å¼€å‘è€…çš„å·¥ä½œã€‚\n è¡¨ç¤º tasklet çš„æ•°æ®ç»“æ„ æè¿°ä¸€ä¸ª tasklet çš„æ•°æ®ç»“æ„ä¸ºtasklet_struct, æˆå‘˜åŒ…æ‹¬:\n1struct tasklet_struct { 2 // æŒ‡å‘ä¸‹ä¸€ä¸ªtaskletï¼Œæ‰€æœ‰taskleté“¾è¡¨ä¸²è” 3 struct tasklet_struct *next; 4 unsigned long state; 5 // tasklet å¯¹åº”çš„å¤„ç†å‡½æ•° 6 void (*func)(unsigned long); 7 // func ä¸­å¯ä»¥ä½¿ç”¨çš„æ•°æ® 8 unsigned long data; 9}; tasklet çš„ä¸­æ–­æµç¨‹ TASKLET_SOFTIRQçš„ action æŒ‡å‘éå†æ‰€æœ‰tasklet_structçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ æ‰§è¡Œæ¯ä¸ª tasklet çš„func()ã€‚\nå·¥ä½œé˜Ÿåˆ— å·¥ä½œé˜Ÿåˆ—åˆ›å»ºäº†ä¸€ä¸ªå†…æ ¸çº¿ç¨‹kworker, åŸç†ä¸ksoftirqdå·®ä¸å¤šã€‚\nä¸»è¦çš„åŒºåˆ«æ˜¯ksoftirqdè¿è¡Œåœ¨ä¸­æ–­çš„ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå…¶è°ƒç”¨äº†do_softirq(), è€Œä¸­æ–­ä¸Šä¸‹æ–‡ä¸­æ˜¯ç¦ç”¨ç”¨æˆ·æŠ¢å çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å‘ç”Ÿè°ƒåº¦(ä¸å½±å“åµŒå¥—ä¸­æ–­)ã€‚\n ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­ç¦æ­¢æŠ¢å çš„åŸå› æ˜¯å¼€å¯äº†ä¸­æ–­åµŒå¥—ï¼Œä»£ä»·æ˜¯å¿…é¡»ç¦æ­¢æŠ¢å ã€‚ å¦‚æœåŒæ—¶å…è®¸ä¸­æ–­åµŒå¥—å’ŒæŠ¢å ï¼Œé‚£ä¹ˆâ€œåµŒå¥—çš„â€ä¸­æ–­è¿”å›æ—¶å¦‚æœå‘ç”Ÿäº†è°ƒåº¦ï¼Œ è¿”å›åˆ«çš„é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹å»äº†ï¼Œæ­¤æ—¶åˆçº§çš„ä¸­æ–­è¿˜æœªç»“æŸã€‚å¦‚æ­¤æ—¶åœ¨æ–°è¿›ç¨‹é‡Œ åˆå‘ç”Ÿäº†åˆçº§ç±»å‹åŒæ ·çš„ä¸­æ–­ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‘ç”Ÿæ•°æ®ä¸ä¸€å®šæˆ–è€…æ­»é”ã€‚\n å·¥ä½œé˜Ÿåˆ—æ˜¯è¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ã€‚æ­¤æ—¶å½“ç„¶å¯ä»¥å‘ç”Ÿ æŠ¢å ï¼Œæ‰€ä»¥å·¥ä½œé˜Ÿåˆ—é€‚ç”¨äºé‚£ç§éœ€è¦ä¸­æ–­æœåŠ¡å‡½æ•°éœ€è¦å‘ç”Ÿè°ƒåº¦çš„æƒ…å†µï¼Œ æ¯”å¦‚è¯´è°ƒç”¨äº†sleep().\nå·¥ä½œé˜Ÿåˆ— ","date":"2023-05-13T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/interrupt/softirq/","section":"posts","tags":["Operating System"],"title":"Linux ä¸­æ–­ç®¡ç†: è½¯ä¸­æ–­/tasklet/å·¥ä½œé˜Ÿåˆ—"},{"categories":["Operating System","C Language"],"contents":"linux å†…æ ¸ä¸ºåˆ›å»ºã€ç”¨å•é“¾è¡¨è§£å†³å†²çªçš„å“ˆå¸Œè¡¨ã€‘è®¾è®¡äº†ä¸“é—¨çš„æ•°æ®ç»“æ„ hlistã€‚\nhlist æ•´ä½“æ¥è¯´æ˜¯å¸¦å¤´ç»“ç‚¹çš„åŒå‘é“¾è¡¨ï¼Œå¤´ç»“ç‚¹çš„ç±»å‹ä¸ºhlist_head, æ™®é€šèŠ‚ç‚¹ çš„ç±»å‹ä¸ºhlist_node. ä¸ºä»€ä¹ˆè¦åŒºåˆ«ä¸¤ç§ç±»å‹ï¼ŸèŠ‚çº¦ç©ºé—´ï¼Œ å› ä¸ºå“ˆå¸Œè¡¨çš„ è¡¨é¡¹ç±»å‹å¯ä»¥æ˜¯hlist_head, å®ƒå…¶å®ä¸éœ€è¦prevæŒ‡é’ˆ, æ¯”èµ·ä¸€èˆ¬çš„ç»“ç‚¹ï¼Œä¸€ä¸ª å“ˆå¸Œè¡¨èƒ½èŠ‚çº¦ä¸€åŠçš„ç©ºé—´ã€‚\næ‰€ä»¥ä¸€ä¸ªå“ˆå¸Œè¡¨å’Œå¤´ç»“ç‚¹çš„ç»“æ„å¯è¡¨ç¤ºä¸º:\n1struct hlist_head { 2 struct hlist_node *first; 3}; 4struct hlist_head table[TALBE_SZ]; äºŒè±¡æ€§ ä»»ä½•äº‹ç‰©éƒ½å…·æœ‰äºŒè±¡æ€§ï¼ŒåŒºåˆ†ä¸¤ç§ç±»å‹èŠ‚çº¦ç©ºé—´çš„ç©ºé—´ï¼Œä¹Ÿå¸¦äº†ä¸€ä¸ªé—®é¢˜ï¼š é¦–ä¸ªhlist_nodeç»“ç‚¹çš„prevæŒ‡å‘å“ªå‘¢ï¼Ÿ\næ­£å¸¸æƒ…å†µä¸‹è‚¯å®šæ¯«ä¸çŠ¹è±«çš„æŒ‡å‘å¤´ç»“ç‚¹ï¼Œå³hlist_headï¼Œä½†æ³¨æ„æ­¤æ—¶ç±»å‹æ˜¯ ä¸åŒçš„ï¼Œprevä¸èƒ½åŒæ—¶æ˜¯struct hlist_head*å’Œstruct hlist_node *ã€‚\nè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼Œé¦–å…ˆå¯ä»¥ä½¿é¦–ä¸ªç»“ç‚¹çš„prev=NULL, è¿™æ ·è™½ç„¶é¿å…äº†ç±»å‹å¼•å‘çš„ é—®é¢˜ï¼Œä¹Ÿèƒ½ä¿è¯åŠŸèƒ½æ­£ç¡®ï¼Œä½†æ˜¯å´ç ´åäº†ä¸€è‡´æ€§ï¼Œä½¿å¾—æ“ä½œçš„å¤æ‚åº¦ä¸Šå‡ï¼Œå¢åŠ äº†è®¸å¤š åˆ¤æ–­åˆ†æ”¯ã€‚\n1// delelt a node 2void del_node(struct hlist_head *head, struct hlist_node *node) 3{ 4 // è¿™ä¸ªif æœ¬æ¥æ˜¯ä¸éœ€è¦çš„ï¼Œç”šè‡³å‚æ•°çš„head ä¹Ÿä¸éœ€è¦ä¼ ï¼Œ 5 // æ›´å¥½çš„å¤„ç†æ–¹å¼è§è§£å†³æ–¹æ¡ˆ2 6 if (node == head-\u0026gt;first) { 7 head-\u0026gt;first = node-\u0026gt;next; 8 } 9 else { 10 node-\u0026gt;prev-\u0026gt;next = node-\u0026gt;next; 11 } 12 13 if (node-\u0026gt;next) { 14 node-\u0026gt;next-\u0026gt;prev = node-\u0026gt;prev; 15 } 16} 17// insert a node 18void add_node_before(struct hlist_head *head, struct hlist_node *new 19 struct hlist_node *next) 20{ 21 // è¿™ä¸ªif æœ¬æ¥æ˜¯ä¸éœ€è¦çš„ï¼Œå‚æ•°headä¹Ÿæ˜¯ä¸éœ€è¦ä¼ é€’çš„ 22 if (next == head-\u0026gt;first) { 23 new-\u0026gt;prev = NULL; 24 head-\u0026gt;first = new; 25 } 26 else { 27 new-\u0026gt;prev = next-\u0026gt;prev; 28 new-\u0026gt;prev-\u0026gt;next = new; 29 } 30 new-\u0026gt;next = next; 31 next-\u0026gt;prev = new; æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ: **prev æ”¹å˜struct hlist_nodeçš„æ„æˆï¼Œä½¿ç”¨äºŒçº§æŒ‡é’ˆ:\n1struct hlist_node { 2 struct hlist_node *next; 3 struct hlist_node **pprev; 4}; ä½¿å¾—æ¯ä¸ªç»“ç‚¹çš„pprev = \u0026amp;(prev_node-\u0026gt;next), é¦–å…ˆç±»å‹æ˜¯ç»Ÿä¸€çš„ï¼Œå…¶æ¬¡åˆ é™¤å’Œæ·»åŠ  éƒ½æ— éœ€é¢å¤–çš„åˆ†æ”¯äº†ã€‚\n1void del_node(struct hlist_node *node) 2{ 3 *(node-\u0026gt;pprev) = node-\u0026gt;next; 4 if (node-\u0026gt;next) 5 node-\u0026gt;next-\u0026gt;pprev = node-\u0026gt;pprev; 6} 7void add_node(struct hlist_node *new, struct hlist_node *next) 8{ 9 new-\u0026gt;pprev = next-\u0026gt;pprev; 10 *(new-\u0026gt;pprev) = new; 11 new-\u0026gt;next = next; 12 next-\u0026gt;pprev = \u0026amp;(new-\u0026gt;next); 13} Ref:\n **prev å¯ä»¥æé«˜åˆ é™¤çš„æ•ˆç‡ stackoverflow  ","date":"2023-05-11T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/data_struct/hlist/","section":"posts","tags":["c","linux"],"title":"Linux å†…æ ¸æ•°æ®ç»“æ„ hlist"},{"categories":["Operating System"],"contents":"ç®¡é“å±äºå®ç°è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œæ­£å¦‚å…¶åï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨ä¸€å¤´è¯»ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹åœ¨ä¸€å¤´å†™ã€‚\nç®¡é“è¢«çœ‹åšæ˜¯æ‰“å¼€çš„æ–‡ä»¶ï¼Œä½†åœ¨å·²å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿä¸­æ²¡æœ‰ç›¸åº”çš„å®ä½“ï¼Œå³å¹¶ä¸æ˜¯ä¸€ä¸ª çœŸæ­£çš„æ–‡ä»¶ã€‚\nç®¡é“çš„åˆ›å»ºå’Œä½¿ç”¨ å¯ä»¥ä½¿ç”¨pipe()ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºä¸€ä¸ªç®¡é“(åé¢ä¼šä»‹ç»å¦ä¸€ä¸ªæ–¹å¼)ï¼Œå…¶è¿”å›ä¸€å¯¹æ–‡ä»¶ æè¿°ç¬¦ï¼Œä¸€ä¸ªç”¨æ¥å†™ä¸€ä¸ªç”¨æ¥è¯»ã€‚å¿…é¡»è¿”å›ä¸¤ä¸ªæè¿°ç¬¦çš„åŸå› æ˜¯ï¼š POSIX åªå®šä¹‰äº†åŠåŒå·¥ çš„ç®¡é“ï¼Œæ‰€ä»¥è¯»å†™éœ€è¦ä¸¤ä¸ªç«¯å£ã€‚\n POSIX å¦å¤–è¦æ±‚ä½¿ç”¨ä¸€ä¸ªæè¿°ç¬¦å‰éœ€è¦å…³é—­å¦ä¸€ä¸ªæè¿°ç¬¦ã€‚ ä½† Linux ä¸­åˆ™å¯ä»¥ä¸å…³é—­ï¼Œ å¯ä»¥å®ç°å…¨åŒå·¥ï¼Œä½†ä¸ºäº†å¯ç§»æ¤æ€§ï¼Œ ä¸€èˆ¬è¿˜æ˜¯å°†å¦ä¸€ä¸ªå…ˆå…³é—­ã€‚\n ç”¨ls | moreç»„åˆå‘½ä»¤æ¥è§£é‡Šå¦‚ä½•ä½¿ç”¨pipe()å®ç°é€šä¿¡:\n shell è°ƒç”¨pipe(), è¿”å› fd3(å¯¹åº”è¯»é€šé“),fd4(å¯¹åº”å†™é€šé“) ä¸¤æ¬¡è°ƒç”¨ fork() åˆ›å»ºä¸¤ä¸ªå­è¿›ç¨‹ï¼Œç”±äºå±äºä¸åŒçš„åœ°å€ç©ºé—´ï¼Œ æ‰€ä»¥æ“ä½œè‡ªå·±çš„æ–‡ä»¶æè¿°ç¬¦ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œä½†éƒ½æŒ‡å‘åŒä¸€ä¸ªç®¡é“ çˆ¶è¿›ç¨‹è°ƒç”¨close()å…³é—­è¿™ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦  ç¬¬ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œlsç¨‹åºï¼Œå…¶æ“ä½œå¦‚ä¸‹ï¼Œ\n è°ƒç”¨dup2(fd4, stdout), æ‰§è¡Œæ–‡ä»¶æè¿°ç¬¦çš„æ‹·è´ï¼Œä»æ­¤stdout å°±ä»£è¡¨ç®¡é“çš„å†™é€šé“ ç”±äºstdoutä»£è¡¨å†™é€šé“ï¼Œæ‰€ä»¥å¯å°† fd3 å’Œ fd4 å‡å…³é—­ exec()æ‰§è¡Œlsç¨‹åºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…¶è¾“å‡ºç»“æœåˆ° stdoutï¼Œ å½“ä¸‹å³ç®¡é“çš„å†™é€šé“ï¼Œå³å‘ç®¡é“ä¸­å†™äº†æ•°æ®  ç¬¬äºŒä¸ªå­è¿›ç¨‹æ‰§è¡Œmoreç¨‹åºï¼Œå…¶æ“ä½œå¦‚ä¸‹ï¼š\n è°ƒç”¨dup2(fd3, stdin), ä»æ­¤stdinä»£è¡¨ç®¡é“çš„è¯»é€šé“ åŒæ ·å¯ä»¥å°† fd3 å’Œ fd4 å…³é—­ exec()æ‰§è¡Œmoreç¨‹åºï¼Œç”±äºç°åœ¨stdinå°±æ˜¯ç®¡é“çš„è¯»é€šé“, ä¸Šé¢çš„å­è¿›ç¨‹å‘ç®¡é“ä¸­å†™äº†æ•°æ®ï¼Œæ‰€ä»¥stdinç°åœ¨æœ‰æ•°æ®ï¼Œmore å¯ä»¥æ­£å¸¸è¾“å‡º  popen(): æ›´ç®€å•çš„ API å½“ç®¡é“çš„ä½¿ç”¨æ˜¯å•å‘çš„ï¼Œå³æŸä¸ªè¿›ç¨‹ä»…ä»…æƒ³çŸ¥é“å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œè¾“å‡ºï¼Œæˆ–è€… æŸä¸ªè¿›ç¨‹æƒ³æŠŠæ•°æ®çŒå…¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ã€‚\næ­¤æ—¶ Linux C åº“ä¸­çš„popen()å’Œpclose()ç®€åŒ–ä½¿ç”¨pipe()ä¸­ è°ƒç”¨dup2(), close()è¿™äº›ç¹ççš„æ­¥éª¤ã€‚\npopen()æ¥å—ä¸¤ä¸ªå‚æ•°: å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å’Œä½¿ç”¨æ–¹å¼ type, è¿”å› ä¸€ä¸ªæŒ‡å‘ FILE çš„æŒ‡é’ˆã€‚\npopen()åšçš„äº‹åŒ…å«:\n pipe()åˆ›å»ºä¸€ä¸ªç®¡é“ åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œæ‰§è¡Œ:  å¦‚æœä½¿ç”¨æ–¹å¼æ˜¯ r, ç»‘å®šç®¡é“çš„å†™é€šé“åˆ°stdout, å¦åˆ™ç»‘å®šè¯»é€šé“ åˆ°stdin. å…³é—­pipe()è¿”å›çš„ä¸¤ä¸ªæè¿°ç¬¦ exec()æ‰§è¡ŒæŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶   å›åˆ°çˆ¶è¿›ç¨‹ï¼Œå¦‚æœä½¿ç”¨æ–¹å¼æ˜¯ r, Â·å…³é—­ç®¡é“çš„å†™é€šé“ã€‚å¦åˆ™å…³é—­è¯»é€šé“ è¿”å›ç®¡é“å‰©ä¸‹çš„æ–‡ä»¶æè¿°ç¬¦åœ°å€  è¿™æ ·çˆ¶å­è¿›ç¨‹å°±èƒ½å•å‘é€šä¿¡äº†ï¼Œå¦‚ä½•ä½¿ç”¨æ–¹å¼æ˜¯ r, çˆ¶è¿›ç¨‹å¯ç”¨popen() è¿”å›çš„ FILE æ¥è¯»å–å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºï¼›ç›¸åï¼Œçˆ¶è¿›ç¨‹å¯å‘ FILE ä¸­å†™æ•°æ® åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å…¥ã€‚\nå› ä¸ºè¿”å›çš„æ˜¯ FILE æŒ‡é’ˆï¼Œæ‰€ä»¥é€šå¸¸é…åˆfprintf(), fscanf(), fgets() è¿™ç±»å‡½æ•°ä½¿ç”¨ã€‚\npclose()ç­‰å¾…popen()åˆ›å»ºçš„å­è¿›ç¨‹ç»“æŸã€‚\npopen()æ ·ä¾‹ çˆ¶è¿›ç¨‹è¯»\n1#include \u0026lt;stdio.h\u0026gt;2#include \u0026lt;unistd.h\u0026gt;3 4int main(void) 5{ 6 FILE *fp = NULL; 7 char s1[32], s2[32]; 8 9 fp = popen(\u0026#34;ls\u0026#34;, \u0026#34;r\u0026#34;); 10 11 // read the first two files and print their name 12 fscanf(fp, \u0026#34;%s %s \u0026#34;, s1, s2); 13 printf(\u0026#34;s1 = %s, s2 = %s\\n\u0026#34;, s1, s2); 14 15 // close the read side of pipe 16 pclose(fp); 17 return 0; 18} çˆ¶è¿›ç¨‹å†™\n1#include \u0026lt;stdio.h\u0026gt;2#include \u0026lt;unistd.h\u0026gt;3 4int main(void) 5{ 6 FILE *fp = NULL; 7 char s1[32], s2[32]; 8 9 fp = popen(\u0026#34;wc -l\u0026#34;, \u0026#34;w\u0026#34;); 10 fprintf(fp, \u0026#34;one\\ntwo\\nthree\\n\u0026#34;); 11 pclose(fp); 12 13 return 0; 14} ","date":"2023-05-11T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/ipc/pipe/","section":"posts","tags":["Operating System"],"title":"Linux è¿›ç¨‹é—´é€šä¿¡(1): ç®¡é“"},{"categories":["Operating System"],"contents":"Linux ä¸­å…¶å®å¹¶ä¸åŒºåˆ«è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œéƒ½ç”¨task_structæ¥æè¿°ï¼Œå¯ä»¥è¯´ å®ƒä»¬ä¹‹é—´çš„è”ç³»å¤§äºåŒºåˆ«ã€‚\nåˆ›å»ºè¿›ç¨‹çš„æ¥å£æ˜¯fork()ï¼Œ åˆ›å»ºçº¿ç¨‹çš„æ¥å£æ˜¯pthread_create()ï¼Œ ä½†æ˜¯å®ƒä»¬æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨çš„clone()ç³»ç»Ÿè°ƒç”¨ï¼Œ åªæ˜¯å‚æ•°ä¸åŒè€Œå·²ã€‚\nå½“ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹å‘èµ·åˆ›å»ºçº¿ç¨‹çš„è¯·æ±‚æ—¶ï¼Œä¸åƒåˆ›å»ºè¿›ç¨‹é‚£æ ·é‡æ–°ç”³è¯·mm_struct å’Œæ‰“å¼€çš„æ–‡ä»¶ç­‰ç»“æ„ï¼Œ è€Œæ˜¯ç›´æ¥å°†æŒ‡é’ˆèµ‹å€¼ä¸ºçˆ¶è¿›ç¨‹çš„å€¼ï¼Œæ‰€ä»¥å®ƒå’Œçˆ¶è¿›ç¨‹å…±äº«åŒä¸€ä¸ª åœ°å€ç©ºé—´è¿™äº›ã€‚\n ä¸Šé¢è¯´çš„çˆ¶è¿›ç¨‹ï¼Œå› ä¸ºæ²¡æœ‰çˆ¶çº¿ç¨‹çš„æ¦‚å¿µï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹çš„task_structä¹Ÿæ˜¯ä¸€ä¸ª çº¿ç¨‹ï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€ç©ºé—´ä¹Ÿæ˜¯æœ€ç»ˆæŒ‡å‘æŸä¸ªè¿›ç¨‹çš„ï¼Œæ‰€ä»¥çˆ¶äº²å’Œæ–°çš„çº¿ç¨‹å°±æ˜¯åŒç­‰ åœ°ä½äº†ã€‚\n å†è¯´è¯´ PIDï¼ŒPID èƒ½å¤Ÿå”¯ä¸€çš„æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹æ‰€æœ‰çš„çº¿ç¨‹çš„ PID éƒ½ä¸çˆ¶è¿›ç¨‹ ç›¸åŒï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æ ‡è¯†çº¿ç¨‹çš„ä»å±å…³ç³»å‘¢ï¼Ÿ\ntask_struct.tgidæ ‡è¯†è‡ªå·±æ‰€å½’å±çš„è¿›ç¨‹ IDï¼Œæˆ–è€…å«ä¸»çº¿ç¨‹ IDï¼Œåæ­£å°±æ˜¯åœ°å€ç©ºé—´ çš„çœŸæ­£æ¥æºã€‚ è€Œè¿›ç¨‹å¦‚ä½•çŸ¥é“è‡ªå·±åˆ›å»ºäº†å“ªäº›çº¿ç¨‹å‘¢ï¼Ÿï¼Œ é€šè¿‡task_struct.children é“¾è¡¨æ¥æŸ¥æ‰¾ï¼Œä½†è¿™é‡Œé¢å³æœ‰å­è¿›ç¨‹åˆæœ‰çº¿ç¨‹ï¼Œéœ€è¦è¿‡æ»¤ã€‚\n æœ‰çš„åœ°æ–¹ä¼šä½¿ç”¨ä¸€ä¸ªåè¯ ç®¡ç†çº¿ç¨‹ï¼Œ å…¶å®å°±æ˜¯çº¿ç¨‹å…±äº«çš„åœ°å€ç©ºé—´è¿™äº›çš„åŸä¸»ã€‚\n å†…æ ¸çº¿ç¨‹ å†…æ ¸çº¿ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œå½“ç„¶ä¹Ÿæ˜¯ç”¨task_structæ¥æè¿°ï¼Œå†…æ ¸çº¿ç¨‹çš„ç‰¹æ®Šç‚¹ï¼š\n mmæˆå‘˜=NULLï¼Œæ²¡æœ‰ç”¨æˆ·ç©ºé—´çš„æ•°æ®ï¼Œä¸èƒ½è®¿é—®ç”¨æˆ·ç©ºé—´ æ¯ä¸ªå†…æ ¸çº¿ç¨‹æœ‰ç§æœ‰æ•°æ®ï¼Œç”¨set_child_tidæˆå‘˜æŒ‡å‘ï¼Œ æ˜¯ä¸€ä¸ªstruct kthreadç»“æ„ï¼Œç”¨to_kthread()æ¥è®¿é—®ç§æœ‰æ•°æ®  å†…æ ¸çº¿ç¨‹ä¹Ÿåƒæ™®é€šçº¿ç¨‹ä¸€æ ·å‚ä¸è°ƒåº¦ï¼Œå…¶åˆ›å»ºçš„åœ°æ–¹åœ¨å†…æ ¸ï¼Œä½¿ç”¨kthread_create() åˆ›å»ºï¼Œä¸èƒ½ç”±ç”¨æˆ·æ€åˆ›å»ºã€‚\nå†…æ ¸çº¿ç¨‹ä¸€èˆ¬è´Ÿè´£æ‰§è¡Œä¸€äº›å†…æ ¸ä»»åŠ¡ï¼Œæ¯”å¦‚è½¯ä¸­æ–­ å°±æœ‰ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œæ¥ä¸“é—¨æ‰§è¡Œåˆ°æ¥ä¸­æ–­çš„æœåŠ¡å‡½æ•°ä¸­ä¸ç€æ€¥çš„éƒ¨åˆ†ã€‚\n","date":"2023-05-10T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/process/thread/","section":"posts","tags":["Operating System"],"title":"Linux è¿›ç¨‹ä¸çº¿ç¨‹çš„å…³ç³»"},{"categories":null,"contents":"ä¸ ARMv7 ç›¸æ¯”çš„æ”¹åŠ¨  æŒ‡ä»¤é›†ï¼š æ–°å¢ A64 æŒ‡ä»¤é›†ï¼Œ ä½†ä¹Ÿå…¼å®¹åŸæ¥çš„ A32 æŒ‡ä»¤é›† æƒé™ç­‰çº§ï¼š AArch64 ä¸‹æ–°å¢ EL0-EL3 å¼‚å¸¸ç­‰çº§ï¼Œå¯¹åº” V7 çš„ç‰¹æƒç­‰çº§ é€šç”¨å¯„å­˜å™¨ï¼š31 ä¸ªé€šç”¨å¯„å­˜å™¨ï¼ŒV7 15 ä¸ª è™šæ‹Ÿåœ°å€é•¿åº¦ï¼š64 ä½çš„åœ°å€é•¿åº¦ï¼Œç†è®ºæ”¯æŒ 256TB çš„å¯»å€èŒƒå›´  ","date":"2023-05-09T21:19:01+08:00","permalink":"https://wangloo.github.io/posts/armv8/introduce/","section":"posts","tags":["armv8"],"title":"ARMv8 åŸºç¡€æ¦‚å¿µ"},{"categories":["C Language"],"contents":"C++å‡ ä¹æ˜¯ C çš„è¶…é›†ï¼Œåªæœ‰å¾ˆå°‘çš„ C çš„ç‰¹æ€§åœ¨ C++ä¸­ä¸æ”¯æŒ\nC++å¢åŠ äº†éœ€è¦æ–¹ä¾¿å®ç°é¢å‘å¯¹è±¡ç‰¹æ€§çš„è¯­æ³•å’Œå°è£…ï¼Œå½“ç„¶è¿™äº›ç”¨ C åº”è¯¥ä¹Ÿèƒ½å®ç°ï¼Œ åªä¸è¿‡ C++ä½¿å…¶å®ç°èµ·æ¥æ›´ç®€å•ã€‚\n C++ æ”¹è¿›äº†ä¸€äº› C ä¸­çš„ç¼ºç‚¹ï¼Œæ¯”å¦‚ new è‡ªåŠ¨è®¡ç®—å¤§å°é¿å…å‡ºé”™ C++ å¢åŠ ä¸€äº›è¯­æ³•ç³–ï¼Œæ¯”å¦‚è¿­ä»£å™¨ç­‰ C++ åŸç”Ÿæ”¯æŒä¸€äº›æ–¹ä¾¿çš„åº“æ–‡ä»¶ï¼Œæ¯”å¦‚ STL åº“  ","date":"2023-05-09T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/c/c_and_cpp/","section":"posts","tags":["c"],"title":"C å’Œ C++ çš„åŒºåˆ«ä¸è”ç³»"},{"categories":["Binary"],"contents":"æƒ³è¦æè¿°ä¸€ä¸ªå˜é‡ï¼Œå¿…é¡»çŸ¥é“å®ƒç±»å‹ä¿¡æ¯ï¼Œæ‰èƒ½çŸ¥é“å˜é‡çš„å¤§å°ã€è¾“å‡ºçš„æ ¼å¼ç­‰ã€‚\nDwarf ä¸º C è¯­è¨€å®šä¹‰äº†ä¸€äº›æè¿°æ•°æ®ç±»å‹çš„ DIEï¼ŒåŒ…æ‹¬ basetype, array,pointer, structure\u0026hellip;\nbasetype ä»Šå¤©æˆ‘ä»¬å…ˆä»‹ç»æœ€ç®€å•çš„ basetypeã€‚\nbasetype æ˜¯æŒ‡é‚£äº› C è¯­è¨€è‡ªèº«å®šä¹‰çš„åŸºç¡€ç±»å‹ï¼Œåƒint, doubleè¿™äº›ã€‚\nbasetype ç±»å‹çš„ DIE é€šå¸¸æœ‰å±æ€§:\n DW_AT_name: basetype çš„åç§° DW_AT_byte_size: è¯¥ basetype å ç©ºé—´å¤§å°  ä¸‹é¢ç»™å‡ºæè¿°intå’Œdoubleçš„ DIE å±•ç¤º(è¿˜æ˜¯é€šè¿‡objdumpå·¥å…·è¾“å‡ºï¼‰ï¼š\n1 \u0026lt;1\u0026gt;\u0026lt;43\u0026gt;: Abbrev Number: 3 (DW_TAG_base_type) 2 \u0026lt;44\u0026gt; DW_AT_byte_size : 4 3 \u0026lt;45\u0026gt; DW_AT_encoding : 5\t(signed) 4 \u0026lt;46\u0026gt; DW_AT_name : int 5 6 \u0026lt;1\u0026gt;\u0026lt;60\u0026gt;: Abbrev Number: 4 (DW_TAG_base_type) 7 \u0026lt;61\u0026gt; DW_AT_byte_size : 8 8 \u0026lt;62\u0026gt; DW_AT_encoding : 4\t(float) 9 \u0026lt;63\u0026gt; DW_AT_name : (indirect string, offset: 0x9): double Array æ•°ç»„è¡¨ç¤ºä¸º DW_TAG_array çš„ DIEï¼Œé€šå¸¸å«æœ‰å±æ€§:\n DW_AT_typeï¼š æŒ‡å‘æ•°ç»„å…ƒç´ çš„ DIE  æ•°ç»„çš„é•¿åº¦ä¿¡æ¯å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿæ¯ä¸ª array DIE çš„æ¯ä¸ª child éƒ½ä»£è¡¨ä¸€ä¸ªç»´åº¦ä¿¡æ¯ï¼Œæœ€å·¦è¾¹çš„ child æè¿°ç¬¬ä¸€ä¸ªç»´åº¦ä¿¡æ¯ã€‚\næè¿°ç»´åº¦ä¿¡æ¯çš„ DIE ä¸º DW_TAG_subrange_type, å…¶åŒ…å«ä¸¤ä¸ªå±æ€§:\n DW_AT_type: æŒ‡å‘æ‰€å± array çš„ DIE DW_AT_upper_bound: è¡¨ç¤ºæ•°æ®åœ¨è¯¥ç»´åº¦ä¸‹çš„é•¿åº¦, æ•°å€¼æ˜¯-1 çš„  æ‰€ä»¥è¦å¾—åˆ°ä¸€ä¸ªæ•°ç»„çš„æ€»é•¿åº¦ï¼Œéœ€è¦éå†å…¶ DIE çš„æ‰€æœ‰ childã€‚\nä¸‹é¢ç»™å‡ºä¸€ä¸ªäºŒç»´æ•°ç»„int var_array[3][5]çš„ç›¸å…³ DIE ä¿¡æ¯:\n1 \u0026lt;1\u0026gt;\u0026lt;43\u0026gt;: Abbrev Number: 3 (DW_TAG_base_type) 2 \u0026lt;44\u0026gt; DW_AT_byte_size : 4 3 \u0026lt;45\u0026gt; DW_AT_encoding : 5\t(signed) 4 \u0026lt;46\u0026gt; DW_AT_name : int 5 \u0026lt;1\u0026gt;\u0026lt;4a\u0026gt;: Abbrev Number: 4 (DW_TAG_array_type) 6 \u0026lt;4b\u0026gt; DW_AT_type : \u0026lt;0x43\u0026gt; 7 \u0026lt;4f\u0026gt; DW_AT_sibling : \u0026lt;0x60\u0026gt; 8 \u0026lt;2\u0026gt;\u0026lt;53\u0026gt;: Abbrev Number: 5 (DW_TAG_subrange_type) 9 \u0026lt;54\u0026gt; DW_AT_type : \u0026lt;0x60\u0026gt; 10 \u0026lt;58\u0026gt; DW_AT_upper_bound : 2 11 \u0026lt;2\u0026gt;\u0026lt;59\u0026gt;: Abbrev Number: 5 (DW_TAG_subrange_type) 12 \u0026lt;5a\u0026gt; DW_AT_type : \u0026lt;0x60\u0026gt; 13 \u0026lt;5e\u0026gt; DW_AT_upper_bound : 4 14 \u0026lt;2\u0026gt;\u0026lt;5f\u0026gt;: Abbrev Number: 0 ","date":"2023-05-09T16:51:49+08:00","permalink":"https://wangloo.github.io/posts/binary/dwarf/1_basetype/","section":"posts","tags":["Binary","ELF"],"title":"DWARF(2): basetypeç±»å‹"},{"categories":["Binary"],"contents":"Dwarf æŠŠæºæ–‡ä»¶ä¸­æ¯ä¸ªå¯æè¿°çš„æ¨¡å—ï¼ˆä¾‹å¦‚å‡½æ•°ï¼Œå˜é‡ï¼Œç»“æ„ä½“çš„å£°æ˜ç­‰ï¼‰æè¿°ä¸ºä¸€ä¸ª DIE (Debugging Information Entry)ï¼Œæ‰€ä»¥æ¯ä¸ªæºæ–‡ä»¶å¯ä»¥æè¿°ä¸ºè‹¥å¹² DIE çš„ç»„åˆã€‚\næ¯ä¸ª DIE ç”±ä¸€ä¸ª tag å’Œè‹¥å¹² attribute-val é”®å€¼å¯¹æ„æˆ:\n tag: æè¿°æ­¤ DIE çš„ç±»å‹ attribute-val: æè¿°æ­¤ DIE çš„ä¸€äº›ç»†èŠ‚å±æ€§ï¼Œé¡¹ç›®æ ¹æ® DIE çš„ç±»å‹ä¸åŒè€Œæœ‰å·®åˆ«  å„ä¸ª DIE ä¹‹é—´ä¼šç›¸äº’è”ç³»ï¼Œä¸€ä¸ª DIE å¯èƒ½å«æœ‰ parentï¼Œè‹¥å¹²çš„ child å’Œ siblingï¼Œ å®ƒä»¬ä¹‹é—´ç»„æˆæ ‘çš„ç»“æ„ã€‚\næŸ¥çœ‹ä¸€ä¸ª ELF çš„æ‰€æœ‰ DIE ELF æ–‡ä»¶ä¸­çš„æ‰€æœ‰ DIE å­˜å‚¨åœ¨.debug_info section ä¸­ï¼Œé€šè¿‡ GNU utils ä¸­çš„objdumpå·¥å…· å¯ä»¥è§£æä¸ºå¯é˜…è¯»çš„ç»“æ„:\n1objdump --dwarf=info \u0026lt;file\u0026gt; è‹¥æˆ‘ä»¬æœ‰ä¸€ä¸ª demo.c å¦‚ä¸‹:\n1void func(void) { 2 int var_local; 3} ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶åï¼Œ æ‰§è¡Œä¸Šè¿°çš„objdumpå‘½ä»¤ï¼Œ å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼ˆèŠ‚é€‰ï¼‰ï¼š\n1 \u0026lt;1\u0026gt;\u0026lt;68\u0026gt;: Abbrev Number: 5 (DW_TAG_subprogram) 2 \u0026lt;69\u0026gt; DW_AT_external : 1 3 \u0026lt;69\u0026gt; DW_AT_name : (indirect string, offset: 0x32): func 4 \u0026lt;6d\u0026gt; DW_AT_decl_file : 1 5 \u0026lt;6e\u0026gt; DW_AT_decl_line : 3 6 \u0026lt;6f\u0026gt; DW_AT_decl_column : 6 7 \u0026lt;70\u0026gt; DW_AT_prototyped : 1 8 \u0026lt;70\u0026gt; DW_AT_low_pc : 0x1129 9 \u0026lt;78\u0026gt; DW_AT_high_pc : 0xb 10 \u0026lt;80\u0026gt; DW_AT_frame_base : 1 byte block: 9c (DW_OP_call_frame_cfa) 11 \u0026lt;82\u0026gt; DW_AT_GNU_all_call_sites: 1 12 \u0026lt;2\u0026gt;\u0026lt;82\u0026gt;: Abbrev Number: 6 (DW_TAG_variable) 13 \u0026lt;83\u0026gt; DW_AT_name : (indirect string, offset: 0x28): var_local 14 \u0026lt;87\u0026gt; DW_AT_decl_file : 1 15 \u0026lt;88\u0026gt; DW_AT_decl_line : 4 16 \u0026lt;89\u0026gt; DW_AT_decl_column : 9 17 \u0026lt;8a\u0026gt; DW_AT_type : \u0026lt;0x43\u0026gt; ä¸Šè¿°ä¾‹å­ä¸­èŠ‚é€‰äº†ä¸¤ä¸ª DIEï¼Œåˆ†åˆ«æ˜¯å‡½æ•°func()å’Œå±€éƒ¨å˜é‡var_local, å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„ tag æ˜¯ä¸åŒçš„ï¼Œä¸”éƒ½å…·æœ‰ä¸€ç³»åˆ—å±æ€§ã€‚\nå¹¶ä¸”ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ª DIE çš„å…³ç³»å¯ä»¥ä»é¦–åˆ—\u0026lt;\u0026gt;ä¸­çš„æ•°å­—å¾—çŸ¥ï¼Œæ•°å­—ä»£è¡¨ DIE æ„æˆæ ‘çš„ æ·±åº¦ï¼Œæ­¤ä¾‹å­ä¸­\u0026lt;1\u0026gt;ä¸‹é¢ç´§é çš„\u0026lt;2\u0026gt;å°±è¡¨ç¤º\u0026lt;2\u0026gt;æ˜¯\u0026lt;1\u0026gt;çš„ childã€‚ç†è®ºä¸Šä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå±€éƒ¨å˜é‡ æ˜¯å±äºå¯¹åº”çš„å‡½æ•°ä½“çš„ã€‚\nå°ç»“ ä¹‹åçš„ç« èŠ‚æ‰“ç®—ä»‹ç» Dwarf æ˜¯å¦‚ä½•æè¿°æºæ–‡ä»¶ä¸­çš„ä¸åŒå¯¹è±¡çš„(å‡½æ•°,å˜é‡,æ•°æ®ç±»å‹ç­‰)\n","date":"2023-05-09T15:51:49+08:00","permalink":"https://wangloo.github.io/posts/binary/dwarf/0_basic/","section":"posts","tags":["Binary","ELF"],"title":"DWARF(1): åŸºç¡€"},{"categories":["C Language"],"contents":"å†…å­˜å¯¹é½ä¸ºä½•è¢«éœ€è¦ æ¶æ„è§„å®šäº†æ•°æ®ç±»å‹å¤§å°çš„åŒæ—¶ï¼Œä¹Ÿè§„å®šäº†å¯¹è¿™äº›ç±»å‹çš„å˜é‡åˆæ³•è®¿é—®çš„å¯¹é½è¦æ±‚ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡ä¸èƒ½éšä¾¿çš„æ”¾åœ¨å†…å­˜çš„ä»»æ„ä½ç½®ï¼Œèµ·å§‹åœ°å€å¿…é¡»æ»¡è¶³ç‰¹å®šçš„å¯¹é½è¦æ±‚ï¼Œ å¯¹ä¸æ»¡è¶³è¦æ±‚çš„å˜é‡å¼ºè¡Œè®¿é—®å°±å«åšéå¯¹é½è®¿é—®ï¼Œ éå¯¹é½è®¿é—®é€šå¸¸ä¼šè§¦å‘å¼‚å¸¸ã€‚\nä¸€èˆ¬æ•°æ®ç±»å‹çš„å¯¹é½è¦æ±‚ å¯¹äºä¸€èˆ¬çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ int, long, char è¿™äº›ï¼Œè¦æ±‚å…¶å˜é‡åœ°å€å¯¹é½åˆ°è‡ªèº«å¤§å°ï¼Œ æ¯”å¦‚ ARM64 ä¸­ï¼Œint å˜é‡çš„åœ°å€å¿…é¡»å¯¹é½åˆ° 4 å­—èŠ‚ï¼Œlong å˜é‡åœ°å€å¿…é¡»å¯¹é½åˆ° 8 å­—èŠ‚ç­‰ç­‰ã€‚\né‚£ä¹ˆå¯¹äº*(int *)0x1001 = 1234;, è¿™ç±»çš„å†…å­˜è®¿é—®å°±å«éå¯¹é½çš„å†…å­˜è®¿é—®ã€‚\n å³ ï¼ˆå˜é‡ addr % å˜é‡ size) ï¼= 0, å°±ç§°ä¸ºéå¯¹é½å†…å­˜è®¿é—®ã€‚\n ç»“æ„ä½“çš„å¯¹é½è¦æ±‚ ä¸Šé¢è¯´çš„è¿˜éƒ½æ˜¯ä¸€èˆ¬çš„æ•°æ®ç±»å‹ï¼Œå¯¹äºç»“æ„ä½“è¿™ç§å¤æ‚çš„ç±»å‹ï¼Œå¯¹é½çš„è¦æ±‚ä¹Ÿå¤æ‚äº›ã€‚\n é¦–å…ˆæ˜¯ç»“æ„ä½“æˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ»¡è¶³å…¶è‡ªèº«çš„å¯¹é½è¦æ±‚ ç„¶åæ˜¯ç»“æ„ä½“å˜é‡è‡ªèº«çš„èµ·å§‹åœ°å€çš„å¯¹é½è¦æ±‚æ˜¯å…¶æ‰€æœ‰æˆå‘˜çš„æœ€å¤§å¯¹é½è¦æ±‚ã€‚  ç„¶è€Œä¸¤ä¸ªè¦æ±‚å‡æ»¡è¶³æœ‰æ—¶å€™æ ¹æœ¬ä¸å¯èƒ½ï¼Œæ¯”å¦‚ä¸€ä¸ªç»“æ„ä½“å£°æ˜ä¸º:\n1struct foo { 2 char mem1; 3 int mem2; 4 short mem3; 5}; ä¸å¯èƒ½åŒæ—¶åšåˆ° foo å˜é‡å’Œå…¶æˆå‘˜ mem2 åŒæ—¶æ»¡è¶³å¯¹é½åˆ° 4 å­—èŠ‚ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šä¾æ® ä¸Šé¢çš„ä¸¤æ¡è¦æ±‚åœ¨æˆå‘˜ä¹‹é—´æ·»åŠ  paddingã€‚\né™¤äº†å˜é‡ä¸­é—´æ·»åŠ  padding å¤–ï¼Œåœ¨æœ«å°¾ä¹Ÿä¼šæ·»åŠ ï¼Œä½¿å¾—ç»“æ„ä½“æ•°ç»„å®¹æ˜“æ»¡è¶³å¯¹é½éœ€æ±‚ã€‚\næœ€å foo å˜é‡åœ¨å†…å­˜ä¸­çš„æ ·å­å¯èƒ½æ˜¯:\n1struct foo { 2 char mem1; 3 char _pad1[3]; // ä¿è¯ç»“æ„ä½“å’Œæˆå‘˜å‡å¯¹é½æ­£ç¡® 4 int mem2; 5 short mem3; 6 char _pad2[2]; // ä¿è¯ã€ç»“æ„ä½“æ•°ç»„ã€‘å¯¹é½æ­£ç¡® 7};  è‹¥ç»“æ„ä½“çš„æˆå‘˜è¿˜æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåµŒå¥—æ“ä½œå°±å¯ä»¥äº†ï¼Œç¼–è¯‘å™¨å¯ä»¥ handleã€‚\n  å¯¹äºç»“æ„ä½“çš„å®šä¹‰æ¥è¯´ï¼Œè‹¥ä¸æƒ³æ·»åŠ  paddingï¼Œå¯ä»¥ä½¿ç”¨__attribute((packed)) æ¥å£°æ˜ã€‚ å¸¸ç”¨äºä¸€äº›æ•°æ®åŒ…çš„å£°æ˜ï¼Œé™¤éä½ æ¸…æ¥šè‡ªå·±ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œè¦ä¸åˆ«ç”¨ã€‚\n å¦‚ä½•åšåˆ°å†…å­˜å¯¹é½ ä¸Šé¢ä¸€èŠ‚è¯´æ˜äº†å„ä¸ªç±»å‹çš„å˜é‡å¯¹äºå†…å­˜å¯¹é½çš„éœ€æ±‚ï¼Œåªè¦æ˜¯å„ä¸ªç±»å‹å˜é‡çš„åœ°å€æ»¡è¶³è¦æ±‚äº†ï¼Œ å¯¹æ‰€æœ‰å˜é‡çš„è®¿é—®ä¹Ÿå°± OK äº†ã€‚é‚£ä¹ˆå¦‚ä½•ä¿è¯æ¯ä¸ªå˜é‡åœ°å€éƒ½æ»¡è¶³éœ€æ±‚å‘¢ï¼Ÿ\nå¯¹äºé™æ€åˆ†é…çš„å˜é‡ï¼Œå³åœ¨ç¼–è¯‘é“¾æ¥æ—¶æœŸå°±èƒ½ç¡®å®šåœ°å€ï¼Œç”±ç¼–è¯‘å™¨å®Œæˆè¿™é¡¹å·¥ä½œã€‚ç¼–è¯‘å™¨ä¿è¯ åˆ†é…ç»™è¿™äº›å˜é‡çš„åœ°å€æ˜¯æ»¡è¶³å¯¹é½è¦æ±‚çš„ï¼Œè¿™ä¸ªå®Œå…¨ä¸ç”¨æ‹…å¿ƒã€‚\nå¯¹äºè¿è¡Œæ—¶åŠ¨æ€åˆ†é…çš„å˜é‡ï¼Œä¾‹å¦‚malloc()æ¥å£è¿”å›çš„ï¼Œå…¶å® malloc æœ¬èº«ä¸çŸ¥é“è¦ç”³è¯· ç©ºé—´çš„å¯¹é½è§„åˆ™ï¼Œå› ä¸ºå®ƒåªæ¥å—ä¸€ä¸ª size ä½œä¸ºå‚æ•°ã€‚ æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†ä¿è¯æ»¡è¶³æ‰€æœ‰çš„ å¯¹é½è¦æ±‚ï¼Œmalloc() è¿”å›çš„åœ°å€æ€»æ˜¯æ»¡è¶³æœ€å¤§çš„å¯¹é½è¯·æ±‚ï¼Œå³æŒ‡é’ˆçš„å¤§å° 8 å­—èŠ‚ã€‚\n malloc() çš„å®é™…æ•ˆæœä¸è¿è¡Œåº“çš„å®ç°æœ‰å…³ï¼Œå¹¶ä¸æ˜¯è§„å®šæ­»çš„ã€‚ä¸è¿‡æˆ‘è¿˜æ²¡æœ‰è§è¿‡ä¸æ˜¯ æŒ‰ç…§æœ€å¤§å¯¹é½è¦æ±‚åˆ†é…çš„å®ç°æ–¹æ³•:)\n AArch64 å¯¹éå¯¹é½è®¿é—®çš„æ”¯æŒ éå¯¹é½è®¿é—®çš„ç»“æœæ˜¯æ¶æ„å®šä¹‰çš„ï¼Œ ä¸åŒçš„æ¶æ„å¯èƒ½é€ æˆçš„ç»“æœä¸åŒï¼š\n æ¶æ„å¯èƒ½æ”¯æŒéå¯¹é½è®¿é—®ï¼ŒæˆåŠŸè¯»å–æ•°æ® æ¶æ„ä¸æ”¯æŒéå¯¹é½è®¿é—®ï¼Œäº§ç”Ÿå¼‚å¸¸  AArch64 æ¶æ„æ”¯æŒ 16ã€32ã€64 å’Œ 128 ä½çš„éå¯¹é½è®¿é—®ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªå‰ææ¡ä»¶:\n å…³é—­ç³»ç»Ÿçš„å¯¹é½æ£€æŸ¥: SCTLR_ELx.A bit æ¥æ§åˆ¶ exclusive load/store å’Œ load-acuqire/store-release ä¸¤ç±»æŒ‡ä»¤å¿…é¡»æ˜¯å¯¹é½è®¿é—®çš„ ã€‚è¿™å°±è¡¨ç¤ºæ„å»ºä¿¡å·é‡å’Œå…¶ä»–é”æœºåˆ¶æ—¶å¿…é¡»æ˜¯å¯¹é½è®¿é—®çš„ éå¯¹é½è®¿é—®ä»…â€œæ™®é€šå†…å­˜â€å¯ç”¨ï¼Œ\u0026quot;Device memory\u0026ldquo;å¿…é¡»æ˜¯å¯¹é½è®¿é—®çš„   AArch64 éå¯¹é½è®¿é—®çš„åŸç†æ˜¯åˆ†è§£ä¸ºå¤šæ¬¡çš„è®¿å­˜ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œä¸”æ€§èƒ½æ˜¯è¾ƒå·®çš„ã€‚\n  è™½ç„¶ AArch64 æ”¯æŒéå¯¹é½è®¿é—®ï¼Œ ä½†ç¼–è¯‘å™¨é»˜è®¤è¿˜æ˜¯ä¼šç”Ÿæˆæ»¡è¶³å¯¹é½è¦æ±‚çš„ä»£ç ã€‚\n ","date":"2023-05-08T17:19:44+08:00","permalink":"https://wangloo.github.io/posts/c/alignment/","section":"posts","tags":["arm64","c","Operating System"],"title":"C è¯­è¨€çš„å†…å­˜å¯¹é½è¦æ±‚"},{"categories":["TODO"],"contents":"å½“è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œå°±é¢„ç•™äº†ä¸€å—ç‰¹æ®Šçš„çº¿æ€§åŒºï¼Œå…¶å¼€å§‹åœ°å€å’Œç»“æŸåœ°å€å•ç‹¬ä¿å­˜åœ¨ mm_struct.start_brkå’Œmm_strcut.brkæˆå‘˜ä¸­ï¼Œå¹¶ä¸ç”±vm_area_struct é“¾æ¥ï¼Œè¿™å—ç‰¹æ®Šçš„çº¿æ€§åŒºå°±å«å †ã€‚\nè¿›ç¨‹ä½¿ç”¨çš„malloc()å’Œfree()ç­‰ç›¸å…³ API éƒ½æ˜¯æ“çºµçš„å †ç©ºé—´ã€‚\nä¿®æ”¹å †ç©ºé—´çš„æ¥å£ å¯¹ç”¨æˆ·æ€è¿›ç¨‹æ¥è¯´ï¼Œæä¾›brk()ç³»ç»Ÿè°ƒç”¨æ¥ä¿®æ”¹è‡ªèº«çš„å †ç©ºé—´ã€‚\nbrk(): å‚æ•°addr, æ•ˆæœæ˜¯ä¿®æ”¹mm_struct.brkåˆ° addrï¼Œå³ä¿®æ”¹ä¸€ä¸ªå †çš„ç»“æŸåœ°å€ã€‚\nbrk() ç³»ç»Ÿè°ƒç”¨çš„å®ç°ï¼Œåœ¨å†…æ ¸æ€æ˜¯è°ƒç”¨do_mmap()æ‰©å……å †ï¼Œæˆ–è€…do_unmap()ç¼©å°å †ã€‚ å¹¶ä¸”ç§»åŠ¨mm_struct.brkçš„å€¼è€Œå·²ï¼Œè¿™æ˜¯ brk()çš„å®ç°ã€‚\n ç”¨æˆ·æ€è¿›ç¨‹è¿˜æœ‰ä¸€ä¸ªæ¥å£: sbrk(), å‚æ•°æ˜¯å­—èŠ‚ï¼Œä»£è¡¨æ‰©å……çš„å­—èŠ‚æ•°ã€‚ å…¶ä¸‹å±‚è¿˜æ˜¯è°ƒç”¨çš„ brk()ã€‚\n malloc()çš„å®ç° è¿›ç¨‹åˆšåˆ›å»ºæ—¶ï¼Œå †ç©ºé—´çš„å¤§å°ä¸º 0ï¼Œ å³bkr==start_brkã€‚\nè°ƒç”¨malloc()ï¼Œå³å¯¹å †ç©ºé—´æ‰©å……ï¼Œä¸Šé¢ä»‹ç»äº†ä¿®æ”¹å †ç©ºé—´çš„æ¥å£ï¼Œ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨brk()æ¥å®ç°malloc().\nå¯¹äºè¿›ç¨‹æœ¬èº«æ¥è¯´ï¼Œåªèƒ½é€šè¿‡brk()ç®€å•çš„å¢åŠ /å‡å°‘å †çš„æ€»å¤§å°ï¼Œè¿™æ ·åšçš„æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ã€‚ æ¯”å¦‚è¿ç»­æ‰§è¡Œäº†ä¸‰æ¬¡malloc(), å¦‚æœè¦å°†ä¸­é—´çš„åœ°å€ free æ‰ï¼Œå…¶å®æ˜¯æ— æ³•å®ç°çš„ã€‚\nè€Œä¸”è¿™ç§æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡malloc()éƒ½è¦ä½¿ç”¨brk()ç³»ç»Ÿè°ƒç”¨ï¼Œæ•ˆç‡ä¹Ÿæ˜¯å¾ˆä½çš„ã€‚\næ‰€ä»¥ï¼Œé€šå¸¸åœ¨ C åº“åˆ™ä¸€å±‚ï¼Œå³malloc()å’Œbrk()ä¹‹é—´ï¼Œä¼šæœ‰ä¸€å±‚å¯¹å †å†…å­˜çš„ç®¡ç†ï¼Œ åŒ…å«ç¢ç‰‡å›æ”¶ï¼Œå†…å­˜æ± ç­‰ç®—æ³•æ¥é¿å…é¢‘ç¹çš„ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ã€‚\n","date":"2023-05-08T10:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/addrspace/heap/","section":"posts","tags":["Operating System"],"title":"Linux è¿›ç¨‹åœ°å€ç©ºé—´ å †çš„ç®¡ç†"},{"categories":["Operating System"],"contents":"å½“å‰å­˜åœ¨çš„é—®é¢˜ æœªå¯ç”¨å†™æ—¶å¤åˆ¶æ—¶ï¼Œfork()åˆ›å»ºå­è¿›ç¨‹åœ°å€ç©ºé—´çš„æµç¨‹å¦‚ä¸‹:\n åŠ¨æ€ç”³è¯·å­è¿›ç¨‹çš„é¡µè¡¨ åŠ¨æ€ç”³è¯·å­è¿›ç¨‹çš„ç‰©ç†é¡µé¢ï¼Œå¤§å°å’Œçˆ¶è¿›ç¨‹çš„ç›¸åŒ åˆ›å»ºçˆ¶è¿›ç¨‹è™šæ‹Ÿåœ°å€-æ–°ç‰©ç†é¡µçš„æ˜ å°„åˆ°å­è¿›ç¨‹é¡µè¡¨ memcpy()å°†çˆ¶è¿›ç¨‹æ‰€æœ‰é¡µé¢æ‹·è´åˆ°å­è¿›ç¨‹åœ°å€ç©ºé—´ä¸‹  è¿™æ ·åšæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ åœ¨fork()çš„å¸¸è§„è°ƒç”¨ç¯å¢ƒä¸‹ï¼Œfork()ä¹‹å æ¥çš„ä¸€èˆ¬æ˜¯exec()ç±»å‡½æ•°ï¼Œå³è½½å…¥ä¸€ä¸ªæ–°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç»§ç»­ç”¨çˆ¶è¿›ç¨‹ çš„æƒ…å†µä¸å¤šã€‚\nè¿™æ ·çš„è¯ï¼Œä¸Šè¿°è¿‡ç¨‹ä¸­memcpy()çˆ¶è¿›ç¨‹çš„é¡µé¢å°±æ˜¯å¤šä½™çš„ï¼Œè€Œä¸”å¦‚æœ çˆ¶è¿›ç¨‹æ¯”è¾ƒå¤§ï¼Œä¼šéå¸¸è€—æ—¶ã€‚\nå†™æ—¶å¤åˆ¶çš„ä¼˜åŒ– æ‰§è¡Œ fork() æ—¶ï¼Œä¸ç»™å­è¿›ç¨‹åˆ†é…æ–°çš„ç‰©ç†é¡µï¼Œè€Œæ˜¯å°†çˆ¶è¿›ç¨‹çš„é¡µè¡¨é¡¹ å®Œå…¨çš„æ‹·è´åˆ°å­è¿›ç¨‹ä¸­ï¼Œç»“æœå°±æ˜¯çˆ¶å­è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æŒ‡å‘åŒä¸€ä¸ªç‰©ç†åœ°å€ã€‚\næ¢å¥è¯è¯´ï¼Œè¿™æ ·åšå°±ä¸éœ€è¦memcpy()çˆ¶è¿›ç¨‹æ‰€æœ‰çš„é¡µé¢ï¼Œä»…ä»…æ˜¯memcpy()ä¸€ä»½ çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œç»™å­è¿›ç¨‹ç”¨ã€‚\n é‚£ä¹ˆæ˜¯å¦è¿æ–°é¡µè¡¨éƒ½ä¸ç”³è¯·ï¼Œç›´æ¥ç”¨çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Ÿ\næ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæœ¬è´¨ä¸Šçˆ¶å­è¿›ç¨‹æ‹¥æœ‰ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œ æœ€åéƒ½è¦åˆ†éš”å¼€ï¼ˆæ— è®ºæ˜¯å¦æ‰§è¡Œexec()ï¼‰ï¼Œæ‰€ä»¥æ²¡å¿…è¦ æ¨è¿Ÿé¡µè¡¨çš„ç”³è¯·ï¼Œæœ¬èº«ä¸æ€ä¹ˆè€—æ—¶ã€‚\nä½†æ˜¯åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œç¡®å®ä½¿ç”¨åŒä¸€å¼ é¡µè¡¨ã€‚\n å½“ç„¶ï¼Œä»…è®¾è®¡åˆ°è¿™æ­¥æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæŒ‰ç†æ¥è¯´çˆ¶å­è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œå¯¹å­è¿›ç¨‹çš„ ä¿®æ”¹ä¸åº”è¯¥å½±å“çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚\næ‰€æœ‰ï¼Œåœ¨ copy å®Œé¡µè¡¨åï¼Œä¼šå°†çˆ¶å­è¿›ç¨‹çš„æ‰€æœ‰åœ°å€ç©ºé—´ï¼ˆå®é™…æ˜¯é¡µè¡¨é¡¹ï¼‰è®¾ç½® ä¸ºåªè¯»å±æ€§ï¼Œå½“çˆ¶/å­è¿›ç¨‹å°è¯•ä¿®æ”¹åœ°å€ç©ºé—´æ—¶ï¼Œè§¦å‘å¼‚å¸¸ï¼Œé…åˆç‰¹å®šçš„ å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œä¸ºå…¶åˆ›å»ºä¸€ä¸ªæ–°çš„å±‹é‡Œä¹Ÿï¼Œæ‹·è´åŸæ¥çš„+æ‰§è¡Œä¿®æ”¹ã€‚\nä¸‹å›¾æ˜¯å¯¹ä¸Šè¿°æƒ…å†µçš„æè¿°ï¼Œä»…ç»™å‡ºä¸€ä¸ªé¡µé¢çš„ç¤ºä¾‹ï¼Œå¯ä»¥æ¨å¹¿åˆ°æ•´ä¸ªåœ°å€ç©ºé—´ï¼š\n1 VMA VMA 2 â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” 3Parent â”‚ â”‚ â”‚ Parent â”‚ â”‚ 4 â”‚ â”‚ â”‚ â”‚ â”‚ 5 â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ 6 â”‚ â”œâ”€â”€â”€â”€â” â”‚ â”‚ â”œâ”€â”€â”€â”€â” 7 â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ PMA Write â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ PMA 8 â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”€â”€â”€â”€â”¼â”€â”€â”€â–º â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” 9 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 10 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 11 â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ 12 â”œâ”€â”€â”€â”€â–ºâ”‚ â”‚ Read â”‚ â””â”€â”€â”€â”€â–ºâ”‚ â”‚ RW 13 â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ only â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ 14Child â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Child â”‚ â”‚ â”‚ â”‚ 15 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ 16 â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”Œâ”€â–ºâ”‚ â”‚ RW 17 â”‚ â”œâ”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ 18 â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ 19 â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ 20 â”‚ â”‚ â”‚ â”‚ â”‚ 21 â”‚ â”‚ â”‚ â”‚ â”‚ 22 â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ 23 â”‚ è¿™æ ·å°±å®Œç¾äº†å— å®é™…ä¸Šä¸æ˜¯çš„ï¼Œæ‹·è´çˆ¶è¿›ç¨‹çš„é¡µè¡¨å’Œvm_area_structå°±ä¸å å†…å­˜äº†å—ï¼Ÿ\nå½“é¡µè¡¨æ˜¯ç¨€ç–çš„ï¼Œvm_area_structçš„æ•°é‡è¿‡å¤šæ—¶ï¼Œå…¶æœ¬èº«çš„æ•°æ®ç»“æ„ å°±ä¼šå ç”¨å¾ˆå¤§çš„ç©ºé—´ã€‚\nå°± AArch64 æ¥è¯´ï¼Œé’ˆå¯¹é¡µè¡¨è¿‡å¤§çš„é—®é¢˜ï¼Œæä¾›äº† 2M å’Œ 1G çš„å·¨å‹é¡µ(Huge Page) å¯ä¾›é€‰æ‹©ï¼Œèƒ½åœ¨ç”³è¯·å¤§è€Œç¨€ç–çš„é¡µé¢æ—¶æ˜¾è‘—çš„å‡å°‘é¡µè¡¨çš„å¤§å°ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº† TLB çš„ å‘½ä¸­ç‡ï¼Œå› ä¸ºåŒæ ·å¤§å°çš„å†…å­˜å¤§é¡µåªéœ€è¦ä¸€ä¸ª TLB è¡¨é¡¹å³å¯ã€‚\nç„¶è€Œï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µæ›´åŠ ä¸¥é‡ï¼Œè‹¥fork()åçˆ¶è¿›ç¨‹å†™äº†åœ°å€ç©ºé—´çš„å†…å®¹ï¼Œ å¦‚ä¸Šæ‰€è¯´å°±è¦æ‹·è´è¿™äº›ç‰©ç†é¡µé¢ï¼Œæ­¤æ—¶å¦‚æœå†™çš„é¡µé¢è¿‡å¤šå¯èƒ½å‘ç”Ÿfork()åˆ°exec() é‚£ä¸€æ®µé—´éš”æ—¶é—´é‡Œçš„ç‰©ç†å†…å­˜å ç”¨æé«˜ã€‚è™½ç„¶è¿™ç§æƒ…å†µæå°‘å‘ç”Ÿï¼Œå‰æå¿…é¡»æ˜¯å†…å­˜ åˆ†é…ç¨€ç–+çˆ¶è¿›ç¨‹ä¿®æ”¹çš„å†…å­˜ä¹Ÿæ˜¯ç¨€ç–çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®Œå…¨å¿½ç•¥è¿™ç§æƒ…å†µã€‚\nå½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜ä¸èƒ½å½’æ ¹äº COWï¼Œè€Œæ˜¯fork()å¸¦æ¥çš„ï¼Œfork()åº”è¯¥æä¾›å‚æ•° ç»™é‚£äº›å­è¿›ç¨‹ç«‹é©¬è°ƒç”¨exec()çš„åœºæ™¯ï¼Œå°±ä¸ç”¨æ‹·è´çˆ¶è¿›ç¨‹çš„è¿™äº›æ•°æ®ç»“æ„äº†ã€‚\n","date":"2023-05-08T09:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/addrspace/cow/","section":"posts","tags":["Operating System"],"title":"Linux è¿›ç¨‹åœ°å€ç©ºé—´ å†™æ—¶å¤åˆ¶"},{"categories":["TODO"],"contents":"ä½•ä¸ºè¿›ç¨‹åœ°å€ç©ºé—´? è¿›ç¨‹åœ°å€ç©ºé—´ç”±å…è®¸è¿›ç¨‹ä½¿ç”¨çš„è‹¥å¹²çº¿æ€§åœ°å€åŒºåŸŸ(ä¹Ÿç§°\u0026quot;è™šæ‹Ÿå†…å­˜åŒºåŸŸ\u0026quot;)æ„æˆã€‚\næ¯ä¸ªçº¿æ€§åŒºåŸŸç”±èµ·å§‹åœ°å€ã€é•¿åº¦å’Œå±æ€§æ¥æè¿°ã€‚\nåœ¨è¿›ç¨‹åˆšåˆ›å»ºæ—¶ï¼Œå…¶åœ°å€ç©ºé—´ä»…åŒ…å« 3 ä¸ªçº¿æ€§åŒºï¼Œåˆ†åˆ«æ˜¯ï¼šä»£ç æ®µã€æ•°æ®æ®µå’Œå †åŒºï¼Œå…¶ä¸­ å †åŒºçš„åˆå§‹å¤§å°ä¸º 0ã€‚\n æ ˆåŒºè™½ç„¶ä¹Ÿå±äºè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åŒºåŸŸï¼Œä½†è¿™ä¸ªåŒºåŸŸå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å°†å…¶ å½’äºå†…æ ¸ç®¡ç†ï¼Œå¹¶éè¿›ç¨‹æœ¬èº«ã€‚\n çº¿æ€§åŒºå¢åŠ çš„å…¸å‹æƒ…å†µ:\n ä½¿ç”¨mmap()ä¸ºä¸€ä¸ªæ–‡ä»¶æ˜ å°„å†…å­˜ç©ºé—´ åˆ›å»ºä¸€ä¸ª IPC å…±äº«çº¿æ€§åŒºä¸å…¶ä»–è¿›ç¨‹åä½œ è°ƒç”¨malloc()æ‰©å¼ è‡ªå·±çš„å †åŒº  Linux æè¿°åœ°å€ç©ºé—´çš„æ•°æ®ç»“æ„ åœ¨è¿›ç¨‹çš„ tcb ä¸­ï¼Œæè¿°åœ°å€ç©ºé—´ç›¸å…³çš„ç»“æ„éƒ½ä¿å­˜åœ¨æˆå‘˜mmä¸­ï¼Œå…¶ç±»å‹ä¸ºstruct mm_struct, å…¶ä¸­é‡è¦çš„æˆå‘˜æœ‰ï¼š\n mmap(struct vm_area_struct*): æŒ‡å‘æ‰€æœ‰çº¿æ€§åŒºçš„é“¾è¡¨å¤´ mm_rb(struct rb_root): æŒ‡å‘æ‰€æœ‰çº¿æ€§åŒºå¯¹è±¡çº¢é»‘æ ‘çš„æ ¹ pgd(pgd_t *): æŒ‡å‘è¿›ç¨‹çš„é¡µè¡¨ mmlist(struct list_head): æŒ‡å‘ä¸‹ä¸€ä¸ªåœ°å€ç©ºé—´æè¿°ç¬¦(æ‰€æœ‰è¿›ç¨‹çš„åœ°å€ç©ºé—´æè¿°ç¬¦ è¢«é“¾æ¥èµ·æ¥)  Linux æè¿°çº¿æ€§åŒºçš„æ•°æ®ç»“æ„ ç”¨struct vm_area_structæè¿°ä¸€ä¸ªçº¿æ€§å»ï¼Œå…¶ä¸­é‡è¦çš„æˆå‘˜æœ‰:\n vm_mm(struct mm_struct *): æŒ‡å‘æ‰€å±çš„åœ°å€ç©ºé—´æè¿°ç¬¦ vm_start(unsigned long): æ­¤çº¿æ€§åŒºçš„å¼€å§‹ vm_end(unsigned long): ä¸‹ä¸€ä¸ªçº¿æ€§åŒºçš„å¼€å§‹(æ­¤çº¿æ€§åŒºç»“æŸåœ°å€+1ï¼‰ vm_next(struct vm_area_struct *): æŒ‡å‘è¿›ç¨‹çº¿æ€§åŒºçš„ next vm_rb(struct rb_node): æ­¤çº¿æ€§åŒºå¯¹åº”çº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹  æ­¤çº¿æ€§åŒºçš„å¤§å°å°±å¯ä»¥è¡¨ç¤ºä¸º: vm_end - vm_start.\nè¿›ç¨‹åœ°å€ç©ºé—´æ‰€æœ‰çº¿æ€§åŒºçš„ç»„ç»‡ è¿›ç¨‹æ‹¥æœ‰çš„æ‰€æœ‰çº¿æ€§åŒºé€šè¿‡å•é“¾è¡¨ä¸²è”ï¼ˆæŒ‰åœ°å€æ’åºï¼‰ï¼Œç¬¬ä¸€ä¸ªåŒºåœ¨mm_struct-\u0026gt;mmap, ä¸‹ä¸€æ¬¡ é€šè¿‡vm_area_struct-\u0026gt;vm_nextæ‰¾åˆ°ï¼Œä¾æ¬¡ç±»æ¨ã€‚å¹¶ä¸”ï¼Œmmstruct-\u0026gt;map_countæˆå‘˜ è®°å½•äº†è¿›ç¨‹æ‰€æœ‰çº¿æ€§åŒºçš„æ•°é‡ã€‚\nçº¢é»‘æ ‘ä¼˜åŒ–æŸ¥æ‰¾ æ­£å¸¸æ¥è¯´ï¼Œæƒ³è¦æŸ¥æ‰¾æŸä¸ªåœ°å€æ˜¯å¦å­˜åœ¨äºè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œéå†ä¸Šè¿°é“¾è¡¨çš„æ•ˆç‡æ˜¯ O(n).\nå› æ­¤ï¼ŒLinux2.6 å¼•å…¥çº¢é»‘æ ‘æ¥ä¼˜åŒ–æŸ¥æ‰¾é€Ÿåº¦ï¼Œ æ‰€æœ‰çº¿æ€§åŒºåŒæ—¶ç»„ç»‡æˆä¸€ä¸ªçº¢é»‘æ ‘ï¼Œ é¦–éƒ¨é€šè¿‡mm_struct.mm_rbæŒ‡å‘ã€‚ ç„¶åæ¯ä¸ªçº¿æ€§åŒºçš„vm_area_struct.vm_rb å­˜å‚¨èŠ‚ç‚¹çš„é¢œè‰²å’ŒåŒäº²ä¿¡æ¯ã€‚\nç°åœ¨ï¼Œå½“éœ€è¦æ’å…¥/åˆ é™¤ä¸€ä¸ªçº¿æ€§åŒºæè¿°ç¬¦æ—¶ï¼Œç”¨çº¢é»‘æ ‘æŸ¥æ‰¾å‰åå…ƒç´ ï¼Œå†æ“ä½œé“¾è¡¨è¿›è¡Œæ’å…¥ã€‚\nåˆ†é…ä¸€ä¸ªçº¿æ€§åŒº æ¥å£æ˜¯do_mmap(), å‚æ•°ä¸º:\n file, offset; å¦‚æœæœ‰æ–‡ä»¶æ˜ å°„ addr, len prot; è¯¥çº¿æ€§åŒºçš„æƒé™  æ­¥éª¤å¤§è‡´åŒ…å«:\n ç”¨çº¢é»‘æ ‘ç¡®å®šæ–°çº¿æ€§åŒºçš„å‰åï¼Œ å¯¹åº”find_vma_prepare() slab åˆ†é…ä¸€ä¸ªstruct vma_area_structï¼Œå¹¶åˆå§‹åŒ– æ“ä½œé“¾è¡¨æ’å…¥ï¼Œå¯¹åº”vma_link()  é‡Šæ”¾ä¸€ä¸ªçº¿æ€§åŒº æ¥å£æ˜¯do_munmap()\næ­¥éª¤å¤§è‡´åŒ…å«:\n çº¢é»‘æ ‘ç¡®å®šè¦åˆ é™¤çº¿æ€§åŒºçš„ä½ç½®ï¼Œä»¥åŠåšåˆ†å‰²ï¼ˆå¿…è¦æ—¶ï¼‰ è°ƒç”¨detach_vmas_to_unmapped()å°†å…¶ä»é“¾è¡¨ä¸­åˆ é™¤ unmap_region()åˆ é™¤é¡µè¡¨é¡¹ é‡Šæ”¾ vma_area_struct çš„ç©ºé—´  ","date":"2023-05-07T14:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/addrspace/addrspace/","section":"posts","tags":["Operating System"],"title":"Linux è¿›ç¨‹åœ°å€ç©ºé—´ æ¦‚è¿°"},{"categories":["Operating System"],"contents":"Linux ä¸ºä»€ä¹ˆè¦å¼•å…¥ä¿¡å·? ä¿¡å·æ˜¯ç”¨æˆ·è¿›ç¨‹æ„ŸçŸ¥å¤–éƒ¨äº‹ä»¶çš„ä¸€ç§æ–¹å¼ã€‚å†…æ ¸å¯ä»¥å‘é€ä¿¡å·ç»™ç”¨æˆ·ç¨‹åºï¼Œå½“ç„¶ç”¨æˆ·ç¨‹åºä¹‹é—´ä¹Ÿå¯ä»¥äº’ç›¸å‘é€ä¿¡å·ï¼Œè¿›ç¨‹é€šè¿‡å¯¹æŸä¸ªä¿¡å·ç»‘å®šHandlerå®ç°å¯¹ä¿¡å·çš„å“åº”ã€‚\næ‰€ä»¥è¯´ä¿¡å·ä¹Ÿå±äºè¿›ç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§é€šä¿¡æ¯”è¾ƒç®€å•ç›´æ¥ï¼Œç›®æ ‡è¿›ç¨‹åªèƒ½çŸ¥é“ä¿¡å·æ¥æºçš„PIDï¼Œæ— æ³•ç›´æ¥é™„å¸¦å…¶ä»–æ•°æ®ã€‚\nä¿¡å·ä¼ é€’çš„åŸç† æ¯ä¸ªè¿›ç¨‹çš„TCBé‡Œéƒ½æœ‰ä¸€æ¡é“¾è¡¨å­˜è¯¥è¿›ç¨‹ç­‰å¾…çš„æ‰€æœ‰ä¿¡å·ï¼Œç»™æŸä¸ªè¿›ç¨‹å‘é€ä¿¡å·å°±è¡¨ç¤ºä¸ºæŒ‚ä¸€ä¸ªèŠ‚ç‚¹åˆ°ç›®æ ‡è¿›ç¨‹çš„æ­¤é“¾è¡¨ä¸Šï¼Œå†…æ ¸å‘é€ä¿¡å·å½“ç„¶å¯ä»¥ç›´æ¥æ“ä½œï¼Œè¿›ç¨‹ä¹‹é—´çš„è¯ä¼šè½¬æ¢æˆç³»ç»Ÿè°ƒç”¨é—´æ¥å®Œæˆã€‚å½“ç›®æ ‡è¿›ç¨‹è¢«è°ƒåº¦æ—¶ä¼šæ£€æŸ¥å¹¶å¤„ç†ç­‰å¾…çš„æ‰€æœ‰ä¿¡å·ã€‚\n ç›®æ ‡è¿›ç¨‹åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªåŒç§ç±»å‹çš„ä¿¡å·å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸Šä¸€ä¸ªåŒç§ä¿¡å·æ²¡æœ‰è¢«å¤„ç†ï¼Œé‚£ä¹ˆä¹‹ååˆ°æ¥çš„åŒç±»ä¿¡å·ä¼šè¢«å¿½ç•¥ã€‚\n æ›´è¯¦ç»†çš„è¯´ï¼Œè¿™ä¸ªä¿¡å·çš„é˜Ÿåˆ—ï¼ˆé“¾è¡¨ï¼‰ä¸æ­¢ä¸€æ¡ï¼Œåˆ†ä¸ºè¿›ç¨‹ç»„å…±äº«å’Œè¿›ç¨‹ç§æœ‰çš„æŒ‚èµ·é˜Ÿåˆ—ã€‚ æ‰èƒ½å®ç°æŸäº›ä¿¡å·æ˜¯å‘é€ç»™æ•´ä¸ªè¿›ç¨‹ç»„çš„ï¼Œæ¯”å¦‚kill()ï¼Œè€Œä¸€äº›æ˜¯æŒ‡å®šæŸä¸ªè¿›ç¨‹çš„ï¼Œ æ¯”å¦‚tkill().\nä¿¡å·è¢«å¤„ç† å¯¹ç›®æ ‡è¿›ç¨‹æ¥è¯´ï¼Œå®ƒå¯ä»¥æå‰è®¾ç½®è‡ªå®šä¹‰çš„handlerï¼Œæ‰€ä»¥åœ¨å…¶TCBä¸­è¿˜éœ€è¦è®°å½•å¯¹äºæ¯ä¸ªä¿¡å·çš„å¤„ç†æ–¹å¼ã€‚å¯èƒ½æœ‰ä¸‰ç§ï¼šignore, default handler, user-defined handlerã€‚\nå½“è¿›ç¨‹è¢«è°ƒåº¦è·å¾—CPUæ—¶ï¼Œåœ¨è¿”å›ç”¨æˆ·æ€æ‰§è¡Œä»£ç ä¹‹å‰ä¼šæ£€æŸ¥æ˜¯å¦æœ‰æŒ‚èµ·çš„ä¿¡å·ã€‚å¦‚æœæœ‰åˆ™æ‰§è¡Œå¯¹åº”çš„handlerã€‚\n è¿™ä¸ªè¿‡ç¨‹å¯¹åº”å†…æ ¸å‡½æ•°do_signal()ã€‚\n æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè‡ªå®šä¹‰çš„ä¿¡å·å¤„ç†å‡½æ•°æ˜¯åœ¨ç”¨æˆ·æ€çš„, è€Œdo_signal()æ˜¯å‘ç”Ÿåœ¨ å†…æ ¸æ€ï¼Œæ‰€ä»¥å†…æ ¸è¦åšä¸€äº›ç‰¹æ®Šçš„æ“ä½œï¼š\n åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ç”¨æˆ·æ ˆï¼Œä¸èƒ½ç ´åä¿å­˜çš„åŸæ¥ç”¨æˆ·æ€ç¯å¢ƒ ELR(è¿”å›åœ°å€) = è‡ªå®šä¹‰å¤„ç†ç¨‹åºï¼Œå’Œå…¶ä»–çš„ç”¨æˆ·æ€ç¯å¢ƒæ„å»º è¿”å›ç”¨æˆ·æ€ï¼ŒCPU ä¼šæ‰§è¡Œå¤„ç†å‡½æ•° æ‰§è¡Œå®Œæ¯•åï¼Œé€šè¿‡ä¹‹å‰å¯¹ç”¨æˆ·æ ˆçš„ç‰¹æ®Šæ„å»ºï¼Œä½¿å¾—ç¨‹åºæ¥ä¸‹æ¥ä¼šè¿è¡Œä¸€ä¸ª syscall (sys_sigreturn), è¿”å›å†…æ ¸æ€ å¦‚ä¸Šè¿°æ“ä½œæ£€æŸ¥å®Œæ‰€æœ‰æŒ‚èµ·çš„ä¿¡å· å½“æ‰€æœ‰ä¿¡å·éƒ½è¢«å¤„ç†å®Œæˆåï¼Œåˆ™æ¢å¤ç”¨æˆ·è¿›ç¨‹çš„åŸæœ‰ç¯å¢ƒï¼Œç»§ç»­æ‰§è¡Œ  ","date":"2023-05-05T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/signal/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šä¿¡å·çš„ç”±æ¥å’Œå®ç°åŸç†"},{"categories":["Operating System"],"contents":"ä¸ºä½•éœ€è¦åŒæ­¥äº’æ–¥æœºåˆ¶ åŒæ­¥äº’æ–¥å­˜åœ¨çš„æ„ä¹‰åªé’ˆå¯¹å¤šä¸ªä»»åŠ¡éƒ½ä¼šä¿®æ”¹åŒä¸€å—å†…å­˜çš„åœºæ™¯ã€‚è¿™å—å†…å­˜ä¹Ÿå«ä¸´ç•ŒåŒºï¼Œ è¦æ±‚æ˜¯å¿…é¡»å„ä¸ªä»»åŠ¡ç‹¬å è®¿é—®çš„ã€‚æ¯”å¦‚è¯´è®¸å¤šçº¿ç¨‹éƒ½ä¼šå¾€ ringbuffer ä¸­å¡«æ•°æ®ï¼Œ å¿…é¡»ä½¿ç”¨åŒæ­¥äº’æ–¥æœºåˆ¶æ‰èƒ½ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ã€‚\næ‰€ä»¥è¯´ï¼Œåœ¨ä»¥ä¸‹çš„åœºæ™¯ä¸­ï¼Œæ— éœ€è€ƒè™‘åŒæ­¥äº’æ–¥ï¼š\n å¦‚æœä½ åªæœ‰1ä¸ªCPUï¼Œè¯¥CPUä¸Šåªè¿è¡Œ1ä¸€ä¸ªçº¿ç¨‹ å¦‚æœä¼šå­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯å¤šä¸ªcoreæˆ–è€…ä¸€ä¸ªcoreä¸Šçš„å¤šçº¿ç¨‹ç¯å¢ƒï¼‰ï¼Œä½†æ˜¯ä»–ä»¬ä¸ä¼šæ¶‰åŠåŒä¸€å—å†…å­˜ å³ä¾¿æ˜¯å¤šä¸ªçº¿ç¨‹è®¿é—®äº†åŒä¸€å—å†…å­˜ï¼Œä½†æ˜¯éƒ½æ˜¯è¯»æ“ä½œ   éœ€è¦åŒæ­¥äº’æ–¥çš„åœºæ™¯åœ¨OSå†…æ ¸å’Œç”¨æˆ·æ€ç¨‹åºä¸­éƒ½å¾ˆå¸¸è§ï¼š\n å†…æ ¸ä¸­å¸¸è§çš„ä¸´ç•Œèµ„æºåŒ…æ‹¬ï¼šå¯¹å†…å­˜åŒºåŸŸçš„å¼•ç”¨è®¡æ•°æ“ä½œï¼Œæˆ–è€…å¯¹è°ƒåº¦é˜Ÿåˆ—çš„ä¿®æ”¹æ“ä½œç­‰ã€‚ ç”¨æˆ·æ€é‚£å°±æ›´ä¸ç”¨è¯´äº†ï¼ŒåŒæ­¥äº’æ–¥çš„åœºæ™¯å¾ˆå¤šï¼Œæ¯”å¦‚å…¸å‹çš„è¯»è€…å†™è€…é—®é¢˜(Buffer)  å› ä¸ºOSå†…æ ¸å’Œç”¨æˆ·æ€ç¨‹åºçš„æƒé™ä¸åŒï¼Œæ‰€ä»¥å®ç°åŒæ­¥äº’æ–¥çš„æ–¹æ¡ˆä¹Ÿä¸å¤ªç›¸åŒã€‚\n åŒæ­¥äº’æ–¥çš„å¸¸è§æ–¹æ¡ˆ per-cpu å˜é‡ OS å†…æ ¸é‡Œæœ‰äº›æ•°æ®ç»“æ„å¦‚æœä¸éœ€è¦CPUä¹‹é—´å…±äº«ï¼Œå¯ä»¥å®šä¹‰æˆper-cpuå½¢å¼ã€‚\n æ¯”å¦‚è¯´è°ƒåº¦é˜Ÿåˆ—ï¼Œæ¯ä¸ªCPUåªå…³å¿ƒè‡ªå·±æ ¸ä¸Šé˜Ÿåˆ—çš„æƒ…å†µï¼Œå¦‚æœæƒ³è¦è®¿é—®å…¶ä»–CPUçš„ï¼Œ æ¯”å¦‚è¿›ç¨‹è¿ç§»è¯·é€šè¿‡æ ¸é—´é€šä¿¡IPIæ¥åšï¼Œå¹¶ä¸èƒ½ç›´æ¥è®¿é—®ã€‚\n  per-cpu å˜é‡é€šå¸¸è¢«å®‰æ’åœ¨ä¸åŒçš„ cache lineï¼Œé¿å… cache çš„é¢‘ç¹åˆ·æ–°\n  ä¼˜ç‚¹ï¼šå¤š CPU ä¹‹é—´äº’ä¸å¹²æ‰° ç¼ºç‚¹ï¼š  è¦æ±‚é€»è¾‘ç‹¬ç«‹ï¼Œ æå°‘æ•°ä¸´ç•Œèµ„æºå¯ä»¥å®ç°ä¸º per-CPU å½¢å¼ éœ€è¦è€ƒè™‘å†…æ ¸æŠ¢å çš„å½±å“ï¼Œå¦‚æœOSå†…æ ¸ä¿®æ”¹percpuå˜é‡æ—¶è¢«è°ƒåº¦ï¼Œæ–°çš„è¿›ç¨‹ä¹Ÿå¯èƒ½ä¿®æ”¹è¿™ä¸ªå˜é‡ã€‚ å¦‚æœåœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­å¯èƒ½ä¿®æ”¹ï¼Œè¿˜éœ€è¦å¦å¤–å…³é—­å†…æ ¸ä¸­æ–­ã€‚    åŸå­æ“ä½œ å¦‚æœä¸´ç•Œèµ„æºåªæ˜¯ä¸€ä¸ªåŸºç¡€ç±»å‹å˜é‡ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªFlagæˆ–è€…å¼•ç”¨è®¡æ•°ã€‚é‚£ä¹ˆå®ç°åŒæ­¥äº’æ–¥çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå¤šä¸ªCPUåŒæ—¶å¯¹ä¸€ä¸ªå˜é‡åšä¿®æ”¹(flag++)ï¼Œç»“æœæ˜¯ä¸å¯çŸ¥çš„ã€‚è¿™æ˜¯å› ä¸ºä¸€æ¬¡ä¿®æ”¹å…¶å®åœ¨å¤„ç†å™¨æ¥çœ‹åˆ†ä¸ºä¸‰æ­¥:\n load mem =\u0026gt; register update register store register =\u0026gt; mem  ISA ä¼šæä¾›ä¸€äº›åŸå­æ“ä½œçš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸‰æ­¥ç»‘å®šåœ¨ä¸€èµ·ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªcoreæ‰§è¡Œäº†å†™åŠ¨ä½œï¼Œä¼šå¯¹è¯¥å†…å­˜æ€»çº¿ç‹¬å ï¼Œ åªæœ‰æ­¤æ¬¡å†™å…¥å®Œæˆåï¼Œå…¶ä»–coreæ‰èƒ½å‘èµ·å†™å…¥è¯·æ±‚ã€‚\n è¿™å°±è¡Œäº†ï¼Ÿå¹¶ä¸æ˜¯\nåŸå­æ“ä½œåªèƒ½æ’é™¤ä¸Šé¢æè¿°çš„é—®é¢˜å‡ºç°ï¼Œä½†æ˜¯å¤šCPUæƒ…å†µä¸‹çš„åŒæ­¥äº’æ–¥è¿˜å¾ˆå¤æ‚ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªCoreä¿®æ”¹äº† è¿™ä¸ªå˜é‡ï¼Œè‡³äºå…¶ä»–coreèƒ½ä¸èƒ½çœ‹åˆ°è¿™æ¬¡å†™æ“ä½œï¼Œå°±å’Œ memory consistency å’Œ cache coherence ç›¸å…³ï¼Œ å®é™…åº”ç”¨ä¸­è¿˜éœ€è¦è€ƒè™‘è¿™äº›æ¥ä¿è¯é€»è¾‘çš„æ­£ç¡®æ€§ã€‚\n åŸå­æ“ä½œæŒ‡ä»¤çš„ç‰¹æƒçº§åˆ«æ˜¯ç”¨æˆ·çº§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´OSå†…æ ¸å’Œç”¨æˆ·æ€ç¨‹åºéƒ½å¯ä»¥ç”¨ï¼Œæ¯”å¦‚è¯´C++å°±æä¾›äº†ç›¸åº”çš„åŸå­æ“ä½œåº“å‡½æ•°ã€‚\n ç¼ºç‚¹ï¼šä»…é€‚ç”¨äºä¸´ç•Œèµ„æºæ˜¯ç®€å•çš„åŸºç¡€æ•°æ®ç±»å‹çš„æƒ…å†µã€‚å½“ç„¶ï¼Œå¤æ‚æ“ä½œçš„åŒæ­¥äº’æ–¥å®ç°åº•å±‚ä¹Ÿæ˜¯åœ¨åŸå­æ“ä½œä¸Šåšå°è£…  é”å’Œä¿¡å·é‡ é”çš„å®ç°åº•å±‚å°±æ˜¯åˆ©ç”¨äº†åŸå­æ“ä½œï¼Œé”åº”ç”¨çš„åœºæ™¯åŒ…å«OSå†…æ ¸å’Œç”¨æˆ·æ€:\n OSå†…æ ¸:  è‡ªæ—‹é” Spinlock äº’æ–¥é” Mutex è¯»å†™é”ä»¥åŠå…¶æ”¹è¿›ç‰ˆ RCU   ç”¨æˆ·æ€:  Futexï¼ˆFast Userspace mutex)     å…³äºä¿¡å·é‡\nä¿¡å·é‡å’Œé”çš„æœ¬è´¨æ˜¯ç›¸åŒçš„ï¼Œä¹¦ç±ä¼šå†™ä¿¡å·é‡æ˜¯è§£å†³åŒæ­¥é—®é¢˜ï¼Œé”æ˜¯è§£å†³äº’æ–¥é—®é¢˜ã€‚äºŒå€¼ä¿¡å·é‡å°±æ˜¯äº’æ–¥é”ã€‚\n é€‰æ‹©åˆé€‚çš„åŒæ­¥äº’æ–¥æœºåˆ¶ (1) å†…æ ¸ä¸­é¿å…ä½¿ç”¨è‡ªæ—‹é”: è·å–ä¸åˆ°é”çš„ CPU ä¼šä¸€ç›´æ­»ç­‰ï¼Œæµªè´¹ CPU èµ„æº\n(2) è‹¥ä¸´ç•ŒåŒºä»…ä»…æ˜¯ä¸€ä¸ªå…±äº«çš„æ•´æ•°å˜é‡æ“ä½œï¼Œé‚£ä¹ˆç”¨åŸå­æ“ä½œå³å¯å®Œæˆï¼Œä¸éœ€è¦å¤æ‚çš„é”ã€‚ ä¾‹å¦‚å„ç±»æ•°æ®ç»“æ„çš„å¼•ç”¨è®¡æ•°é€šå¸¸å£°æ˜ä¸º atomic_tã€‚\nReferences  Let\u0026rsquo;s Talk Locks!  ","date":"2023-05-04T20:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/sync/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šåŒæ­¥äº’æ–¥æœºåˆ¶"},{"categories":["Operating System"],"contents":"tracepoint æ˜¯ Linux trace system ä¸­ data source ä¹‹ä¸€ï¼Œ å…¶ trace çš„å¯¹è±¡æ˜¯ kernelï¼Œå±äºä¸€ç§é™æ€çš„æ’æ¡©æ–¹æ³•ã€‚\n æ·»åŠ å’Œåˆ é™¤éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å†…æ ¸æºç  å¯ä»¥å‘ä¸Šæä¾›æ¥å£ï¼Œå¯ä»¥é€šè¿‡ frontend æ¥å¼€å¯æˆ–è€…å…³é—­ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ•°æ®å¤„ç†æ–¹å¼ åœ¨ disable æ—¶ï¼Œ ä»…æœ‰ä¸€æ¬¡ if åˆ¤æ–­çš„æŸè€—ï¼Œæ‰€ä»¥æ•ˆç‡è¿˜ç®—é«˜ã€‚ä½†ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ã€‚  tracepoint çš„ç»„æˆ çœ‹å…¶æºç struct tracepointå°±èƒ½çŸ¥é“å®ƒçš„ç»„æˆç»“æ„ï¼š\n1struct tracepoint { 2 const char *name; 3#define TP_STATE_DISABLE 0 4#define TP_STATE_ENABLE 1 5 int state; 6 7 // å¹¶éç”¨äºæ³¨å†Œhookçš„å‡½æ•°ï¼Œè€Œæ˜¯æ³¨å†Œhookæ—¶çš„hook 8 int (*reghook)(void); 9 void (*unreghook)(void); 10 11 // åœ¨tracepointè§¦å‘æ—¶å°†è°ƒç”¨çš„hook 12 struct tracepoint_hook *hooks; 13};  name: æ˜¯è¯¥ tracepoint çš„åç§° state: ç”¨äºæ§åˆ¶å…¶å¼€å…³çŠ¶æ€ hooks: æ˜¯ä¸€ç³»åˆ—çš„å‡½æ•°æŒ‡é’ˆï¼Œå½“ tracepoint hit æ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šè¢«ä¾æ¬¡è°ƒç”¨ reghook/unreghook: åœ¨æ³¨å†Œ/æ³¨é”€ hook æ—¶å°†è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥è¾“å‡ºä¸€äº›æç¤ºä¿¡æ¯  ä¸ºäº†æä¾›å¯¹ tracepoint æ“ä½œçš„æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ª tracepoint æ—¶ï¼Œä¼šåŒæ—¶å®šä¹‰ä¸€ç³»åˆ—åŠŸèƒ½å‡½æ•°, åŒ…æ‹¬ï¼š\n æ”¾åœ¨å†…æ ¸ä»£ç ä¹‹ä¸­çš„æ’æ¡©å‡½æ•°ï¼›å…¶è¢«è°ƒç”¨è¯´æ˜ tracepoint hitï¼Œ å¦‚æœ enable çŠ¶æ€ï¼Œ åˆ™ä¾æ¬¡æ‰§è¡Œå…¶ hook ç”¨äºæ³¨å†Œ hook çš„æ¥å£ï¼›ä¸ºè¯¥ tracepoint æ·»åŠ æ–°çš„ hook æ³¨é”€æŸä¸ª hook çš„æ¥å£ï¼›  tracepoint å·¥ä½œåŸç† ç±»ä¼¼äºä¸€èˆ¬çš„æ—¥å¿—è®°å½•å‡½æ•°ï¼Œ åœ¨åˆé€‚çš„ä½ç½®æ”¾ç½®trace_##event()ä½œä¸ºâ€œæ’æ¡©â€ï¼Œè¿è¡Œåˆ° æ­¤å¤„ä»£è¡¨è¯¥åšä¸€äº›äº‹äº†ï¼Œè‡³äºåšä»€ä¹ˆäº‹ä¸æ˜¯ tracepoint è¯¥ç®¡çš„ã€‚å®ƒåªèƒ½è´Ÿè´£æä¾›ç»™ä½ ä¸€äº›æ¥å£ ï¼Œè®©ä½ èƒ½æŠŠâ€œåšäº‹â€çš„å‡½æ•°ä¸ tracepoint è”ç³»èµ·æ¥ï¼Œåˆ°æ—¶å€™è§¦å‘æ—¶è°ƒç”¨å®ƒä»¬ã€‚\nè¿™å°±æ˜¯ä¸Šé¢è¯´çš„ï¼Œtracepoint ä»…è´Ÿè´£ data source è¿™ä¸€éƒ¨åˆ†ã€‚\nå°ç»“ ä¸‹ä¸€èŠ‚å°†ä»‹ç»å¦‚ä½• Linux trace system ä¸­çš„æ•°æ®è®°å½•ç»„ä»¶ï¼Œæ¯•ç«Ÿæ¯æ¬¡è§¦å‘éƒ½è¾“å‡ºåˆ°æ§åˆ¶å°è¿˜æ˜¯ å¤ªä¹±äº†ï¼Œè€Œä¸”ä¸æ˜¯ trace è¿™ä¸ªç³»ç»Ÿçš„å·¥ä½œå†…å®¹ï¼ˆlog ç³»ç»Ÿåº”è¯¥æ˜¯å¹²è¿™ä¸ªçš„ï¼‰ã€‚\n","date":"2023-04-23T23:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/trace/tracepoint/","section":"posts","tags":["linux","Operating System","trace"],"title":"Linux Trace(1): Tracepoint"},{"categories":["Architecture"],"contents":"ä»è¿›å…¥ IRQ/FIQ ä¸­æ–­å‘é‡å¼€å§‹ï¼Œä¸­æ–­å¤„ç†çš„å®Œæ•´æµç¨‹:\n ä¿å­˜ä¸Šä¸‹æ–‡ åˆ‡æ¢ä¸­æ–­æ ˆï¼Œä¸ºè¿›å…¥â€œçœŸæ­£çš„â€ä¸­æ–­æœåŠ¡ç¨‹åºåšå‡†å¤‡ æ‰§è¡ŒçœŸæ­£çš„ä¸­æ–­æœåŠ¡ç¨‹åº æ¢å¤ä¹‹å‰çš„ä¸Šä¸‹æ–‡  â€œçœŸæ­£çš„â€ä¸­æ–­æœåŠ¡ç¨‹åº â€œçœŸæ­£çš„â€æ„ä¸ºä¸ç®—é‚£äº›å¯¹äºæ‰€æœ‰å¼‚å¸¸ã€ä¸­æ–­æ¥è¯´éƒ½ç›¸åŒçš„â€œå¥—è¯â€ ï¼Œåªè®¨è®ºå¯¹äºä¸­æ–­ç‰¹æœ‰çš„è¡Œä¸ºã€‚\næ‰¿è®¤ä¸€ä¸ªä¸­æ–­ çœŸæ­£çš„ä¸­æ–­æœåŠ¡ç¨‹åºä»æ¥å— CPU Interface ä¼ æ¥çš„ä¸­æ–­ å¼€å§‹ç®—èµ·ï¼Œè¿™ä¸€æ­¥çš„å®ç°é€šè¿‡è¯»å–ICC_IAR1_EL1, è¿”å›å½“å‰ ä¸­æ–­çš„ INTIDã€‚\næ‹¿åˆ° INTID åï¼Œå°±æ ¹æ®ä¸åŒçš„ ID è°ƒç”¨å„è‡ªå¯¹åº”åœºæ™¯ä¸‹çš„æœåŠ¡å‡½æ•°ï¼Œ æ¯”å¦‚è‹¥ INTID æ˜¯å¯¹åº”ä¸æ—¶é’Ÿä¸­æ–­ï¼Œé‚£ä¹ˆæ­¤æ­¥éœ€è¦æ¸…æ¥šçŠ¶æ€å¯„å­˜å™¨ã€ é‡æ–°å¼€å¯æ—¶é’Ÿå®šæ—¶å™¨ã€‚\næ ‡è®°ä¸­æ–­å¤„ç†å®Œæ¯• åšå®Œç›¸å¹²çš„äº‹æƒ…åï¼Œéœ€è¦å°†è¯¥ä¸­æ–­æ ‡è®°ä¸ºå·²å®Œæˆï¼Œæ–¹ä¾¿åé¢çš„ä¸­æ–­è¿›æ¥ï¼Œ ä¹Ÿå°±æ˜¯ä¸Šä¸€èŠ‚è¯´çš„ä¼˜å…ˆçº§ä¸‹é™å’Œä¸­æ–­å¤±æ•ˆè¿‡ç¨‹ã€‚\nGICv3 æ”¯æŒå°†è¿™ä¸¤æ­¥åˆä¸ºä¸€æ¬¡æ“ä½œï¼Œå®é™…æˆ‘ä»¬ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œé€šè¿‡å†™å…¥ ICC_EOI1_EL1å¯„å­˜å™¨æ¥å®Œæˆæ ‡è®°å¤„ç†å®Œæˆã€‚æ­¤ä¸­æ–­çš„çŠ¶æ€ä¹Ÿå°±ä» active-\u0026gt;inactive.\n ä¸­æ–­æœåŠ¡ç¨‹åºä¸­ï¼Œæ‰¿è®¤ä¸­æ–­å’Œæ ‡è®°å®Œæˆä¸¤æ­¥æ“ä½œåº”è¯¥æ˜¯ç”¨ while å¾ªç¯ åŒ…è£¹èµ·æ¥çš„ã€‚\nåå¤çš„è¯»å– IARã€æ ‡è®°ä¸­æ–­å·²å®Œæˆ\u0026hellip; å¦‚æœæ­¤æ—¶è¯¥ CPU ä¸Šå·²ç»æ²¡æœ‰ ä¸­æ–­å¾…å¤„ç†äº†ï¼Œè¯»å– IAR ä¼šè¿”å›ç‰¹æ®Š INTID: 1023\n ä¸­æ–­çš„ä¸Šä¸‹éƒ¨æœºåˆ¶ ä¸­æ–­æœåŠ¡å‡½æ•°çš„åœç•™æ—¶é—´åº”è¯¥è¶ŠçŸ­è¶Šå¥½ï¼Œå¦åˆ™å½±å“å…¶ä»–ä»»åŠ¡å ç”¨ CPUï¼Œè¿™æ˜¯è€ç”Ÿå¸¸è°ˆçš„ã€‚\nä»¥ä¸Šè§‚ç‚¹å­˜åœ¨çš„åŸå› æ˜¯ï¼šä¸­æ–­æœåŠ¡å‡½æ•°ä¸­æ˜¯å…³é—­ä¸­æ–­çš„ï¼ŒCPU åªæœ‰ä¸²è¡Œçš„å¤„ç†å®Œå½“å‰ ä¸­æ–­åï¼Œ æ‰èƒ½ç»§ç»­åšä¸‹ä¸€ä»¶äº‹æƒ…ï¼Œå³ä¾¿æ˜¯é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¹Ÿå¾—ç­‰å¾…ï¼Œå› ä¸ºæ—¶é’Ÿä¸­æ–­è¢«å…³é—­ï¼\næ‰€ä»¥ Linux åœ¨ 2.6 å¼•å…¥äº†ä¸­æ–­çš„ä¸Šä¸‹éƒ¨æœºåˆ¶ï¼Œå°†æ•´ä¸ªä¸­æ–­æœåŠ¡å‡½æ•°æ‹†åˆ†ä¸ºä¸Šéƒ¨å’Œä¸‹éƒ¨:\n ä¸Šéƒ¨ï¼šé‚£äº›ä¸èƒ½è¢«æ‰“æ–­çš„æ­¥éª¤ï¼Œæ¯”å¦‚ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œæ‰¿è®¤å’Œæ ‡è®°ä¸­æ–­å®Œæˆç­‰ ä¸‹éƒ¨ï¼šå®½æ¾çš„ç®¡ç†æ–¹å¼ï¼Œæ‰§è¡Œè¿‡ç¨‹å°±ç®—è¢«æ‰“æ–­ä¹Ÿæ²¡å…³ç³»ï¼ŒæŒ‡çš„å°±æ˜¯ä¸Šé¢è¯´çš„å¯¹åº”å„è‡ªä¸­æ–­ åº”ç”¨åœºæ™¯ä¸‹çš„æœåŠ¡å‡½æ•°ï¼Œæ¯”å¦‚ä¸€ä¸ªæŒ‰é”®è§¦å‘ä»£è¡¨çš„å®é™…è¡Œä¸º  ARMv8 å¦‚ä½•æ”¯æŒä¸­æ–­ä¸Šä¸‹éƒ¨ ARMv8 ä¸­ï¼Œè¿›å…¥å¼‚å¸¸å‘é‡æ˜¯è‡ªåŠ¨å…³ä¸­æ–­çš„ï¼Œå¯æ‰§è¡Œmsr DAIFClr, #immæ¥æ‰‹åŠ¨å¼€å¯ã€‚\næ‰€ä»¥è¯´ï¼Œç›´åˆ°æ‰‹åŠ¨å¼€ä¸­æ–­ä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½å±äºä¸­æ–­çš„ä¸Šéƒ¨ã€‚\né‚£ä¹ˆï¼Œåº”è¯¥åœ¨ä½•æ—¶å¼€å¯ä¸­æ–­å‘¢ï¼Ÿæˆ‘è®¤ä¸ºåˆ†å‰²åçš„æ­£ç¡®ä¸­æ–­å¤„ç†æµç¨‹åº”è¯¥æ˜¯ï¼š\n æ‰¿è®¤ä¸€ä¸ªä¸­æ–­ æ ¹æ® INTID æ ‡è®°å…¶åº”è¯¥åšçš„è¡Œä¸ºï¼Œæ³¨æ„åªæ˜¯æ ‡è®° æ ‡è®°è¯¥ä¸­æ–­å®Œæˆ å¾…è¯¥ CPU ä¸Šçš„æ‰€æœ‰ä¸­æ–­éƒ½å®Œæˆåï¼Œå¼€ä¸­æ–­ éå†æ£€æŸ¥æ‰€æœ‰æ ‡è®°ï¼Œå¦‚æœæœ‰å¾…å®Œæˆçš„ä»»åŠ¡åœ¨æ­¤æ—¶æ‰§è¡Œ  ä¸Šé¢è¯´çš„æ ‡è®°å’Œæ‰§è¡Œè¿‡ç¨‹å¯ä»¥ç”¨è®¸å¤šæ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬ softirq, tasklet, workqueue ç­‰ï¼Œ éƒ½å±äºå®ç°ä¸­æ–­ä¸Šä¸‹éƒ¨æœºåˆ¶çš„å®ç°ã€‚\nsoftIRQ softirq å®šä¹‰äº†ä¸€äº›ä¸­æ–­äº‹ä»¶å’Œå¤„ç†å‡½æ•°ï¼Œåœ¨ä¸­æ–­çš„ä¸ŠåŠéƒ¨ä¸­ï¼Œå¦‚æœ INTID å±äºå®šä¹‰çš„è½¯ä¸­æ–­ ä¹‹ä¸€ï¼Œ åˆ™æ·»åŠ æ ‡å¿—å…¶å¤„ç†å‡½æ•°éœ€è¦è¢«æ‰§è¡Œï¼Œåªæ˜¯æ ‡å¿—ï¼Œå¹¶ä¸å®é™…æ‰§è¡Œã€‚\nå½“ä¸­æ–­æœåŠ¡ç¨‹åºé€€å‡ºä¹‹å‰ï¼Œä¼šéå†è½¯ä¸­æ–­åˆ—è¡¨ä¸­çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰éœ€è¦å¤„ç†çš„ï¼Œåˆ™è°ƒç”¨æ³¨å†Œçš„å¤„ç†å‡½æ•°ã€‚\næ³¨æ„ï¼Œè½¯ä¸­æ–­å¤„ç†å‡½æ•°çš„æ‰§è¡Œæ˜¯åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹åªèƒ½ç­‰å¾…ä¸­æ–­å®Œæˆæ‰èƒ½æœ‰æœºä¼šè¢«è°ƒç”¨ï¼Œ æ‰€ä»¥è½¯ä¸­æ–­çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œ å¦‚æœéœ€è¦æ‰§è¡Œçš„å¤„ç†å‡½æ•°è¿‡å¤šï¼Œä¼šå¯¼è‡´ä¸€èˆ¬çº¿ç¨‹é•¿æ—¶é—´ä¸èƒ½è¢«è°ƒåº¦ã€‚\nåŒæ ·åœ°ï¼Œå› ä¸ºå¤„ç†å‡½æ•°çš„æ‰§è¡Œåœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æ‰§è¡Œå¯èƒ½å¯¼è‡´è¿›ç¨‹ç¡çœ çš„æ“ä½œï¼Œ ä¾‹å¦‚ç”³è¯·é”ï¼Œå¯èƒ½å¯¼è‡´ä¼˜å…ˆçº§åè½¬ã€‚\ntasklet workqueue ","date":"2023-04-13T23:51:49+08:00","permalink":"https://wangloo.github.io/posts/armv8/gicv3/3/","section":"posts","tags":["armv8"],"title":"ARMv8 ä¸­æ–­ç®¡ç†(3): ä¸­æ–­æœåŠ¡ç¨‹åº"},{"categories":["Operating System"],"contents":"æŠ¢å çš„å«ä¹‰ æŠ¢å æŒ‡çš„æ˜¯å¼ºåˆ¶ä½¿ä¸€ä¸ªä»»åŠ¡è®©å‡º CPU ç»™å…¶ä»–ä»»åŠ¡ã€‚\næŠ¢å æ˜¯è°ƒåº¦å™¨åšçš„ï¼Œæ¯æ¬¡æ‰§è¡Œschedule()å°±å¯èƒ½å‘ç”Ÿä¸€æ¬¡æŠ¢å ï¼Œæ‰€ä»¥ æŠ¢å å‘ç”Ÿçš„åœ°ç‚¹æ˜¯å†…æ ¸ï¼Œä¹Ÿå°±æ˜¯schedule()çš„æ‰§è¡Œç¯å¢ƒã€‚\nç”¨æˆ·æŠ¢å  ä¸å†…æ ¸æŠ¢å ç›¸å¯¹åº”çš„æ˜¯ç”¨æˆ·æŠ¢å ï¼Œç”¨æˆ·æŠ¢å ä¸æ˜¯æŒ‡æŠ¢å å‘ç”Ÿçš„åœ°ç‚¹ï¼Œå› ä¸º ä¸Šé¢è¯´äº†æŠ¢å å‘ç”Ÿçš„åœ°ç‚¹ä¸€å®šæ˜¯å†…æ ¸ã€‚\næ‰€ä»¥ç”¨æˆ·æŠ¢å çš„å«ä¹‰æ˜¯ï¼šæŠ¢å çš„æ—¶æœºæ˜¯ç”¨æˆ·æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æŠ¢å å‘ç”Ÿä¹‹å‰ï¼Œ ç³»ç»Ÿæ­£å¤„äºç”¨æˆ·æ€ã€‚\nç”¨æˆ·æŠ¢å çš„ç»å…¸åœºæ™¯æ˜¯æ—¶é’Ÿä¸­æ–­ï¼Œç”¨æˆ·è¿›ç¨‹ 1 æ‰§è¡Œçš„å¥½å¥½åœ°ï¼Œè¢«æ—¶é’Ÿä¸­æ–­æ‰“æ–­ ç„¶åä¸­æ–­è¿”å›æ—¶æ‰§è¡Œé‡è°ƒåº¦ï¼Œé€‰æ‹©äº†æ–°çš„ç”¨æˆ·è¿›ç¨‹ 2ã€‚å…¶ä»–çš„å¯èƒ½ç”¨æˆ·æŠ¢å çš„åœºæ™¯ è¿˜æœ‰ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶ï¼Œ æ€»ä¹‹æ˜¯å†…æ ¸è¿”å›ç”¨æˆ·æ€æ—¶éƒ½ä¼šå‘ç”Ÿç”¨æˆ·æŠ¢å ã€‚\nå†…æ ¸æŠ¢å  å¯ç”¨å†…æ ¸æŠ¢å å¢åŠ äº†ç³»ç»Ÿä¸­å‘ç”ŸæŠ¢å çš„ç‚¹ï¼Œå³æŠ¢å å‰ç³»ç»Ÿæ­£å¤„äºå†…æ ¸ã€‚\nå½“ä¸€ä¸ªè¿›ç¨‹æ­£å¤„äºå†…æ ¸æ€æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œæ¯”å¦‚æ‰§è¡Œmmap()ç³»ç»Ÿè°ƒç”¨çš„ä»»åŠ¡ï¼Œåœ¨ æœªå¼€å¯å†…æ ¸æŠ¢å çš„æƒ…å†µä¸‹ï¼Œä¸­æ–­è¿”å›æ—¶åªå¯èƒ½ç»§ç»­æ‰§è¡Œå½“å‰è¿›ç¨‹çš„ä»»åŠ¡ï¼Œä¸ä¼š å‘ç”Ÿè°ƒåº¦ã€‚\nå½“å¯ç”¨å†…æ ¸æŠ¢å æ—¶ï¼Œä¸Šè¿°æƒ…å†µä¸‹è‹¥å‘ç”Ÿä¸­æ–­ï¼Œç³»ç»Ÿåœ¨é€€å‡ºä¸­æ–­åï¼Œå³ä½¿æ­¤æ—¶ä¸æ˜¯ è¿”å›ç”¨æˆ·æ€ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œschedule()ï¼Œå³å¯ä»¥å‘ç”ŸæŠ¢å ã€‚æ­¤ä¹‹è°“å†…æ ¸æŠ¢å ã€‚\næŠ¢å å‘ç”Ÿçš„æ¡ä»¶ å¯ç”¨å†…æ ¸æŠ¢å ä¹‹åï¼Œå…¶å®æŠ¢å çš„è¿‡ç¨‹ä¹Ÿä¸åŒºåˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œåªè¦æ»¡è¶³æ¡ä»¶éƒ½ä¼š æ‰§è¡Œschedule()ã€‚\næ‰§è¡Œé‡è°ƒåº¦çš„æ¡ä»¶æœ‰ä¸¤ä¸ª:\n æ˜¯å¦éœ€è¦é‡è°ƒåº¦? æ˜¯å¦å¯ä»¥é‡è°ƒåº¦?  æ˜¯å¦éœ€è¦é‡è°ƒåº¦ä¹Ÿå°±æ˜¯ä½•æ—¶æ‰§è¡Œschedule()çš„é—®é¢˜ï¼Œå¤§æ¦‚åŒ…å«ä»¥ä¸‹çš„åœºæ™¯:\n æ—¶é’Ÿä¸­æ–­ æ–°è¿›ç¨‹åˆ›å»º ä¿®æ”¹è¿›ç¨‹çš„ nice å€¼ ä¸­æ–­è¿”å›å†…æ ¸æ€ å†…æ ¸æ¢å¤ä¸ºå¯æŠ¢å (ä¸‹é¢ä¼šä»‹ç»)  ç„¶è€Œæœ‰ä¸€äº›æƒ…å†µä¸å¯ä»¥é‡æ–°è°ƒåº¦ï¼Œæ¯”å¦‚å†…æ ¸ä¸­ä¸€äº›å…³é”®çš„æ­¥éª¤ï¼Œé‚£äº›ä¸èƒ½è¢«æ‰“æ–­çš„ åŸå­æ“ä½œã€‚\nåœ¨å…³é”®æ­¥éª¤ä¹‹å‰ï¼Œéœ€è¦è°ƒç”¨preempt_disable()ï¼Œæ­¤æ—¶ linux ä¼šåœ¨ tcb ä¸­ä¼šæ”¹å˜ preempt_countçš„å€¼ï¼Œè¿™ä¸ªæ“ä½œä¸æ˜¯å…³é—­ä¸­æ–­ï¼Œè€Œæ˜¯åœ¨ä¸­æ–­è¿”å›æ—¶å³ä½¿æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„å…¶ä»–è¿›ç¨‹ï¼Œ åªè¦è¯¥å€¼ä¸ç¬¦åˆè¦æ±‚ï¼Œé‡è°ƒåº¦ä¹Ÿä¸ä¼šå‘ç”Ÿã€‚\nå…³é”®æ­¥éª¤æ‰§è¡Œå®Œï¼Œè°ƒç”¨preempt_enable()ï¼Œæ­¤æ—¶ä¸ºäº†å»æ»¡è¶³å…³é”®åŒºåŸŸå†…å¯èƒ½ æœ‰æ–°åŠ å…¥çš„é«˜ä¼˜å…ˆçº§è¿›ç¨‹ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡é‡è°ƒåº¦ï¼Œè¿™ä¹Ÿæ­£æ˜¯ä¸Šé¢æ‰€è¯´éœ€è¦é‡è°ƒåº¦çš„åœºæ™¯ä¹‹ä¸€ã€‚\n","date":"2023-04-13T23:51:49+08:00","permalink":"https://wangloo.github.io/posts/os/linux/schedule/kernel_preempt/","section":"posts","tags":["linux","Operating System"],"title":"Linux å†…æ ¸æŠ¢å "},{"categories":["Architecture"],"contents":"ä¸€ä¸ªä¸­æ–­å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚åŒ…æ‹¬:\n äº§ç”Ÿä¸­æ–­ ä¸­æ–­åˆ†å‘: by Distributor or Redistributor ä¸­æ–­ä¼ é€’: deliver to CPU Interface ä¸­æ–­æ¿€æ´»: pending-\u0026gt;active ä¼˜å…ˆçº§ä¸‹é™: priority drop ä¸­æ–­å¤±æ•ˆ: active-\u0026gt;inactive  ä¸­æ–­çš„äº§ç”Ÿ å¤–è®¾ä¼ æ¥ä¸­æ–­ä¿¡å·ï¼Œæˆ–è€…å¤„ç†å™¨è§¦å‘ SGIï¼Œ GIC æ­¤æ—¶å°†è¯¥ä¸­æ–­æ ‡è®°ä¸ºpendingçŠ¶æ€ã€‚\nä¸­æ–­çš„åˆ†å‘ ä¸­æ–­ç”Ÿå‘½å‘¨æœŸä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œæ ¹æ®ä¸­æ–­çš„ç±»å‹ä¸åŒå¯èƒ½ç”± Distributor å’Œ Redistributor è´Ÿè´£åˆ†å‘å·¥ä½œã€‚\nåˆ†å‘å™¨æŸ¥é…ç½®å¾—åˆ°æ­¤ä¸­æ–­çš„ä¼˜å…ˆçº§ï¼Œç›®çš„ CPU ç­‰ä¿¡æ¯ã€‚æ­¤æ—¶å¯èƒ½æœ‰å¤šä¸ªä¸­æ–­æƒ³è¦å‘å¾€åŒä¸€ CPUï¼Œ ä¼˜å…ˆçº§å†³å®šå…ˆåˆ†å‘å“ªä¸ªä¸­æ–­ã€‚å°†å…¶é¡ºåˆ©åˆ†å‘ç›®çš„ CPU çš„ CPU Interface\nä¸­æ–­ä¼ é€’ CPU Interface åšæœ€åä¸€æ­¥æ£€æŸ¥ï¼Œæ˜¯å¦æ»¡è¶³ä¼˜å…ˆçº§å±è”½? æ˜¯å¦ç¬¦åˆæŠ¢å æ¡ä»¶?\nå¦‚æœæ¡ä»¶éƒ½æ»¡è¶³ï¼Œç»™ CPU ä¸€ä¸ªä¿¡å·ï¼ŒCPU å‡†å¤‡æ¿€æ´»ä¸­æ–­\nTODO: å…³äºrunning priority å’Œ highest pending priorityçš„è§£é‡Š\nä¸­æ–­æ¿€æ´» CPU æ­¤æ—¶å°†è§¦å‘ IRQ/FIQï¼Œæ‰§è¡Œå¯¹åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚\nä¸­æ–­æœåŠ¡ç¨‹åºä¸­éœ€è¦æ˜¾å¼çš„æ‰§è¡Œä¸€äº›æ“ä½œå°†ä¸­æ–­çŠ¶æ€ç”± pending ç½®ä¸º activeã€‚\n å¼‚å¸¸å‘é‡ï¼ˆä¸­æ–­å¤„ç†å‡½æ•°ï¼‰çš„è¯¦ç»†æ­¥éª¤è§ä¸‹ä¸€èŠ‚\n ä¼˜å…ˆçº§ä¸‹é™å’Œä¸­æ–­å¤±æ•ˆ  ä¼˜å…ˆçº§ä¸‹é™å’Œä¸­æ–­çš„å¤±æ•ˆå¯ä»¥é…ç½®ä¸ºåŒæ—¶å‘ç”Ÿï¼Œå®é™…ä¸­æˆ‘ä»¬ä¹Ÿæ˜¯è¿™ä¹ˆä½¿ç”¨çš„ã€‚\nTODO: ä½•ç§æƒ…å†µä¸‹éœ€è¦å°†å…¶åˆ†å¼€ï¼Ÿ\n ä¸­æ–­æœåŠ¡å‡½æ•°ç»“æŸåï¼Œéœ€è¦æ‰§è¡Œä¸€äº›é¢å¤–çš„æ­¥éª¤æ¥ä½¿ä¸­æ–­å¤±æ•ˆï¼Œä¾¿äºåœ¨è¯¥ CPU ä¸Š pending çš„å…¶ä»–ä¸­æ–­èƒ½å¤Ÿè¿›æ¥ã€‚\nä¼˜å…ˆçº§ä¸‹é™æ„å‘³ç€é™ä½æŠ¢å çš„ä¼˜å…ˆçº§é™åˆ¶ï¼Œå…è®¸ CPU ä¸Šç­‰å¾…çš„å…¶ä»–ä¸­æ–­è¿›æ¥ã€‚\nç„¶åæ‰§è¡Œä¸­æ–­å¤±æ•ˆè¿‡ç¨‹ï¼Œå°†å…¶çŠ¶æ€ç”± active-\u0026gt;inactiveï¼Œ è‡³æ­¤ä¸­æ–­çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸç»“æŸã€‚\nå°ç»“ ä¸­æ–­æ¿€æ´»åˆ°ä¸­æ–­å¤±æ•ˆçš„æ•´ä¸ªè¿‡ç¨‹éƒ½å±äºä¸­æ–­æœåŠ¡ç¨‹åºçš„éƒ¨åˆ†ï¼Œç”±å¼€å‘è€…æ˜¾å¼æ§åˆ¶ï¼Œ å°†åœ¨ä¸‹ä¸€èŠ‚è¿›è¡Œä»‹ç»ã€‚\n","date":"2023-04-12T23:51:49+08:00","permalink":"https://wangloo.github.io/posts/armv8/gicv3/2/","section":"posts","tags":["armv8"],"title":"ARMv8 ä¸­æ–­ç®¡ç†(2): ä¸­æ–­çš„ç”Ÿå‘½å‘¨æœŸ"},{"categories":["Architecture"],"contents":"ARMv8 ä¸­æ–­ç³»ç»Ÿçš„æ¶æ„ GIC çš„è¾“å…¥ä¸ºè®¸å¤šçš„ä¸­æ–­çº¿ï¼Œä½†è¾“å‡ºåˆ° CPU çš„åªæœ‰ IRQ å’Œ FIQ ä¸¤ç§ï¼Œ æ‰€ä»¥å°±è¦ç”± GIC åšä¸­æ–­çš„åˆ†å‘å’Œè¿‡æ»¤å·¥ä½œã€‚\næ€»ä½“æ¥è¯´ï¼Œæ•´ä¸ªä¸­æ–­ç³»ç»Ÿæ¶æ„ä»åº•å‘ä¸Šå¯åˆ†ä¸ºä¸‰éƒ¨åˆ†:\n ç¡¬ä»¶æ¥å£ï¼›å¤–è®¾çš„å¼•è„š ä¸­æ–­æ§åˆ¶å™¨ï¼›æ¡¥æ¢ï¼Œå‘ä¸‹æä¾›å¼•è„šè¿æ¥å¤–è®¾ï¼Œå‘ä¸Šè¿æ¥ CPU åœ¨åˆé€‚çš„æ—¶é—´ è§¦å‘ä¸­æ–­ä¿¡å·ï¼Œå……å½“ä¸­æ–­ç³»ç»Ÿçš„ä¸»ç®¡ ä¸­æ–­å¤„ç†å‡½æ•°ï¼›GIC å°†ä¸­æ–­ä¿¡å·ä¼ é€’åˆ° CPU åï¼ŒCPU æ‰§è¡Œä¸­æ–­å¤„ç†å‡½æ•°  1+-----------+ +-----------+ 2| Process | | Process | 3+---------+-+ ++----------+ 4 | | 5 +-+--------+----+ 6 | | 7 | GIC | 8 | | 9 +-------+-------+ 10 | 11 +-------------+----------+ 12 | Peripheral Device | 13 +------------------------+ ä¸­æ–­æ§åˆ¶å™¨ GICv3  GIC çš„æœ‰è®¸å¤šç‰ˆæœ¬ï¼Œæœ¬æ–‡çš†ä»¥ GIC version3 ä¸ºä¾‹ä»‹ç», ç®€ç§°ä¸º GICv3\n å¦‚ä¸Šæ‰€è¿°ï¼ŒGIC åœ¨ä¸­æ–­ç³»ç»Ÿä¸­å……å½“â€œç®¡å®¶â€çš„ä½œç”¨ã€‚å¦‚æœå°† CPU æ¯”ä½œè€æ¿ï¼Œ åˆ°æ¥çš„ä¸­æ–­æ¯”ä½œçº¦è§è€æ¿çš„å‘˜å·¥ï¼Œé‚£ä¹ˆ GIC å°±æ˜¯ç§˜ä¹¦ï¼Œç»Ÿç­¹å®‰æ’ä½•äººä½•æ—¶ ä¸è€æ¿è°ˆè¯ã€‚\nGICv3 çš„ç»„æˆå¤§æ¦‚å¯åˆ†ä¸º 3 éƒ¨åˆ†:\n Distributor Redistributor CPU Interface  å¦‚æœå°†ä¸Šé¢æ¶æ„å›¾ä¸­çš„ GIC æ‹†å¼€ï¼Œå¤§æ¦‚çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚èƒ½å¤Ÿæ³¨æ„åˆ°é™¤äº† GIC è¢«ç»†åˆ†å¤–ï¼Œå¤–è®¾ä¸­æ–­æºä¹Ÿåˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåœ¨ä¸‹é¢ä¸­æ–­åˆ†ç±»ä¸­ä¼šè¯¦ç»† ä»‹ç»ã€‚\n1+----------------+ +----------------+ 2| Process | | Process | 3+--+----------+--+ +--+----------+--+ 4 | CPU | | CPU | 5 | Interface| | Interface| 6 +----+-----+ +----+-----+ 7 | | 8 +------+-------+ +------+-------+ 9 | Reditributor | | Reditributor +-----+ 10 +----------+---+ +--+-----------+ | 11 | | | 12 +---+-------------+-----+ | 13 | | | 14 | Distributor | | 15 | | | 16 +-----------+-----------+ | 17 | | 18 +---------+--------+ +-------+---------+ 19 |Peripheral Device | |Peripheral Device| 20 | (SPI) | | (PPI) | 21 +------------------+ +-----------------+ Distributor è´Ÿè´£å…¨å±€ä¸­æ–­çš„åˆ†å‘\nRedistributor Redistributor æ˜¯ GICv3 ç›¸è¾ƒäº v2 æ–°å¼•å…¥çš„éƒ¨ä»¶ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå¼•å…¥ Redistributor çš„ ä¸»è¦åŸå› æ˜¯: æé«˜ä¸­æ–­ç›¸åº”çš„æ•ˆç‡ã€‚ åœ¨ä»¥å‰ï¼Œæ— è®ºæ˜¯å…¨å±€ä¸­æ–­è¿˜æ˜¯ç§æœ‰ä¸­æ–­éƒ½æ˜¯é€šè¿‡ä¸€ä¸ª Distributor åˆ†å‘ï¼Œå¦‚æœä¸­æ–­åˆ°æ¥çš„æ¯”è¾ƒé¢‘ç¹ï¼Œåˆ™å¯èƒ½äº§ç”Ÿå»¶è¿Ÿã€‚\nRedistributor å°±ä¸»è¦è´Ÿè´£ç§æœ‰ä¸­æ–­çš„åˆ†å‘ï¼Œå‡è½»äº† Distributor çš„è´Ÿæ‹…ã€‚\nCPU Interface ç‰©ç†ç»“æ„ä¸Šä¾é™„ä¸ CPUï¼Œè€Œä¸æ˜¯ GICã€‚ä¸»è¦è´Ÿè´£æ§åˆ¶ä¸­æ–­è¢« CPU æ¥æ”¶çš„è¿‡ç¨‹ï¼Œ å³ä¸­æ–­çŠ¶æ€ pengding , active, inactive çš„åˆ‡æ¢ã€‚\nåŒæ—¶ï¼Œ CPU Interface è¿˜è´Ÿè´£ä¼˜å…ˆçº§çš„è¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆä¼˜å…ˆçº§æ¡ä»¶çš„ä¸­æ–­æ‰ä¼šè¢« CPU å“åº”ã€‚ ç›¸å…³çš„å¯„å­˜å™¨æœ‰ICC_PMR_EL1ï¼ŒICC_RPR_EL1ç­‰\nä¸­æ–­æŠ¢å çš„é…ç½®ä¹Ÿæ˜¯ç”±å…¶å®Œæˆï¼Œè¯¦è§ICC_BPRx_EL1å¯„å­˜å™¨ã€‚\nGICv3 Affinity Rounting GICv3 ä»¥å‰éƒ½æ˜¯ç”¨ target-list, æ¥è®¾ç½®ä¸­æ–­åˆ°è¾¾çš„ç›®çš„ CPUï¼Œè¿™ç§æ–¹å¼ç±»ä¼¼äºä½å›¾ï¼Œ ä»¥å‰åªæœ‰ 8bit æ¥åšè¿™ä¸ªï¼Œæ‰€ä»¥é‡‡ç”¨ GICv2 çš„ç³»ç»Ÿæœ€å¤šæ”¯æŒ 8 ä¸ª CPUã€‚\nè€Œ GICv3 å¼•å…¥äº† Affinity value æ¥æ”¯æŒæ›´å¤šçš„ CPUï¼Œç±»ä¼¼äº IP åœ°å€çš„æ–¹æ³•ï¼Œç”¨ 4 ä¸ª 8bit æ¥æ ‡è¯†ã€‚å¯ä»¥å†™ä½œa.b.c.d\n c: ä¸€èˆ¬æ˜¯æŒ‡æŸä¸ª cluster d: è½¬å‘æ—¶ä¼šå¡«å…¥ target-listï¼ŒæŒ‡å®šå¤šä¸ª CPUï¼Œæœ€å¤š 8 ä¸ª(ä¸‹å›¾çš„å½¢å¼è¿˜æ²¡æœ‰å°†dè½¬ä¸ºtargetlist)      æ‰€ä»¥ç”¨ Affinity value è™½ç„¶èƒ½æŒ‡å®šå¤§äº 8 ä¸ª CPUï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½å‘å¾€ä¸€ä¸ª cluster å†…çš„æœ€å¤š 8CPUã€‚\n GICv3 ä¸­æ–­çš„åˆ†ç±»ä¸æ ‡è¯† åœ¨ä½¿ç”¨ GICv3 çš„ç³»ç»Ÿä¸Šï¼Œä¸­æ–­è¢«åˆ’åˆ†ä¸º 4 ç§ç±»å‹:\n spi: å…¨å±€çš„ä¸­æ–­ï¼Œå¯ä»¥è¢«è·¯ç”±åˆ°ä»»æ„çš„ä¸€ä¸ªæˆ–å¤šä¸ª CPUã€‚ä¸€èˆ¬å¯¹åº”æ‰€æœ‰ CPU å…±ç”¨ çš„å¤–è®¾ï¼Œä¾‹å¦‚ä¸²å£ä¸­æ–­ã€‚ ppi: æ¯ä¸ª CPU ç§æœ‰çš„ä¸­æ–­ï¼Œåªèƒ½è¢«è·¯ç”±åˆ°è¯¥ CPUã€‚å¯¹åº”ä¸ CPU ç§æœ‰çš„å¤–è®¾ä¸­æ–­ï¼Œ ä¾‹å¦‚ CPU å†…éƒ¨å®šæ—¶å™¨ä¸­æ–­ã€‚ sgi: CPU è§¦å‘çš„ä¸­æ–­ï¼Œå¯ä»¥è¢«è·¯ç”±åˆ°ä»»æ„ CPUã€‚ä¸€èˆ¬ç”¨äºæ ¸é—´é€šä¿¡ä½¿ç”¨ã€‚ lpi: message-based interrupts è¿™é‡Œä¸åšä»‹ç».  ä¸­æ–­æ ‡è¯†: INTID CPU å¦‚ä½•åŒºåˆ†å½“å‰æ¥çš„ä¸­æ–­æ˜¯æ¥è‡ªå“ªä¸ªå¤–è®¾çš„ä¸­æ–­ä¿¡å·? ç­”æ¡ˆæ˜¯é€šè¿‡ INTIDï¼Œå®ƒæ˜¯ GIC å®šä¹‰çš„ä¸­æ–­æ ‡è¯†ç¬¦ï¼ŒCPU é€šè¿‡è¯»å–å¯„å­˜å™¨ICC_IAR1_EL1å°±èƒ½å¾—çŸ¥å½“å‰å¤„ç†ä¸­æ–­çš„ INTIDã€‚\nINTID æŒ‰ç…§ä¸­æ–­ç±»å‹åˆ†ç±»çš„, å¯¹ç…§è¡¨å¦‚ä¸‹:\n   INTID ä¸­æ–­ç±»å‹ Note     0-15 SGI æœ¬åœ°çš„, ä¸åŒ CPU å¯ä½¿ç”¨åŒä¸€ä¸­æ–­å·ä»£è¡¨ä¸åŒä¸­æ–­   16-31 PPI æœ¬åœ°çš„   32-1019 SPI å…¨å±€çš„   1020-1023 ç‰¹æ®Šä¸­æ–­    1056-1119 æ‰©å±•çš„ PPI æœ¬åœ°çš„   4096 â€“ 5119 æ‰©å±•çš„ SPI å…¨å±€çš„     æ‰©å±•ä¸­æ–­å·çš„æœ€å¤§å€¼æ˜¯å®ç°å®šä¹‰çš„, å¯ä»¥åœ¨GICD_TYPER.IDbitsä¸­è¯»å–ã€‚\n ç‰¹æ®Šä¸­æ–­å·  ç‰¹æ®Šä¸­æ–­ä¸éœ€è¦ end of interrupt or deactivation è¿‡ç¨‹.\n   1020:\n  1021:\n  1022:\n  1023: è¯»ICC_IAR1_EL1 è¿”å›è¯¥å€¼è¡¨æ˜å½“å‰çš„ CPU ä¸Šæ²¡æœ‰å¾…å¤„ç†çš„ä¸­æ–­ï¼Œ ç¼–ç¨‹æ—¶å¯å½“åšwhileé€€å‡ºçš„æ ‡å¿—\n  å°ç»“ è¿™èŠ‚ä¸»è¦æ€»ç»“ ARMv8 ä¸­æ–­ç³»ç»Ÿçš„æ€»ä½“æ¶æ„å’Œ GICv3 çš„ç»„æˆç»“æ„ï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç» ä¸€ä¸ªä¸­æ–­çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä¸­æ–­çš„çŠ¶æ€è½¬æ¢ï¼Œä»¥åŠåœ¨æ­¤è¿‡ç¨‹ä¸­å„ä¸ªç»„ä»¶çš„ä½œç”¨ã€‚\n","date":"2023-04-12T21:51:49+08:00","permalink":"https://wangloo.github.io/posts/armv8/gicv3/1/","section":"posts","tags":["armv8"],"title":"ARMv8 ä¸­æ–­ç®¡ç†(1): æ¶æ„ä¸GICv3"},{"categories":["Architecture"],"contents":"æœ‰äº†è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¹‹åï¼ŒMMU å¯ä»¥æŠ½è±¡å‡ºä¸€äº›å¯é…ç½®çš„å†…å­˜å±æ€§ã€‚\nä¾‹å¦‚ï¼Œé…ç½®æŸä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸä¸ºä¸å¯æ‰§è¡Œã€ä¸è¢« cache ç­‰ï¼Œä¸å¯æ‰§è¡Œçš„å±æ€§ æœ‰åŠ©äºé˜²èŒƒæ”»å‡»ï¼Œä¸è¿›å…¥ cache ç»å¸¸åˆ’åˆ†ç»™å¤–è®¾ Memory-mapped åŒºåŸŸã€‚\nå†…å­˜å±æ€§å’Œå†…å­˜ç±»å‹ é¦–å…ˆï¼Œæˆ‘ä»¬æ²¡æ³•ç›´æ¥è®¾ç½®å†…å­˜ç±»å‹ï¼Œæˆ‘ä»¬èƒ½è®¾ç½®çš„æ˜¯ä¸€äº›ç»†ç²’åº¦çš„å†…å­˜å±æ€§å­—æ®µï¼Œ æ¯”å¦‚è¯´æƒé™(WRX)ã€cacheableã€shareable ç­‰ã€‚\næˆ‘ä»¬è¯´çš„å†…å­˜ç±»å‹ä¹Ÿå°±æ˜¯æŸäº›æœ‰æ„ä¹‰çš„å±æ€§å­—æ®µç›¸äº’ç»„åˆï¼ŒARM ç»™å‡ºäº†ä¸¤ç§å†…å­˜ç±»å‹: æ™®é€šå†…å­˜å’Œè®¾å¤‡å†…å­˜ã€‚\n  æ™®é€šå†…å­˜ä¼šå¯ç”¨æ¶æ„æä¾›çš„æ‰€æœ‰ä¼˜åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚åˆå¹¶è®¿å­˜ã€ä¹±åºæ‰§è¡Œç­‰ã€‚æ‰€ä»¥ æ™®é€šå†…å­˜æœ‰æœ€é«˜çš„æ€§èƒ½ï¼Œä½†åŒæ—¶ä¸æ˜¯é‚£ä¹ˆçš„â€œå®‰å…¨â€ï¼Œéœ€è¦åº•å±‚äººå‘˜æ‰‹åŠ¨ä½¿ç”¨ å†…å­˜å±éšœç­‰æ‰‹æ®µä¿è¯æŸäº›æƒ…å†µä¸‹çš„é¡ºåºæ€§è¦æ±‚ã€‚\n  è®¾å¤‡å†…å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œå¸¸æ˜ å°„åˆ°å¤–è®¾çš„ Memory-mapped åŒºåŸŸã€‚å¯¹äºè®¾å¤‡æ¥è¯´ï¼Œ é‚£äº›æé«˜æ€§èƒ½çš„æŠ€æœ¯ä¼šé€ æˆä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æŸäº›å¯„å­˜å™¨çš„é…ç½®å¿…é¡»æŒ‰ç…§é¡ºåºï¼Œ è¿™æ—¶å°±ä¸èƒ½ä½¿ç”¨ä¹±åºæ‰§è¡Œã€‚è®¾å¤‡å†…å­˜å°±ç‰ºç‰²äº†æ€§èƒ½ï¼Œä¼˜å…ˆä¿è¯æ­£ç¡®æ€§ã€‚\n  é…ç½®å†…å­˜ç±»å‹ä¹Ÿæ˜¯é€šè¿‡é¡µè¡¨é¡¹ä¸­çš„å…¶ä¸­ä¸€ä¸ªå±æ€§å­—æ®µ: AttrIndx[2:0], å®ƒä¸ç³»ç»Ÿå¯„å­˜å™¨MAIR_EL1é…åˆå®ç°ã€‚\nå…·ä½“è¡¨ç°ä¸º: mair_el1å¯„å­˜å™¨è¢«åˆ’åˆ†ä¸º 8 ä¸ªå­—æ®µï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªå­—æ®µå†™å…¥ ä¸åŒçš„å€¼å¯ä»£è¡¨ä¸åŒçš„å†…å­˜ç±»å‹å’Œä¸€äº›é…å¥—å±æ€§ï¼Œå…·ä½“çš„çœŸå€¼è¡¨å¯ä»¥å‚è§ mair_el1å¯„å­˜å™¨çš„æè¿°ã€‚\n mair_el1ä¸­å†…å­˜ç±»å‹é…å¥—å±æ€§åªæ˜¯å±æ€§çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å’Œè®¾å¤‡ç±»å‹ç»‘å®šçš„é‚£éƒ¨åˆ†ã€‚\n cacheable\u0026amp;shareable å‚»å‚»åˆ†ä¸æ¸… å…ˆè¯´ cacheableï¼Œä¸€æ®µå†…å­˜è¢«è®¾ç½®ä¸º non-cacheable å±æ€§è¯´æ˜ä¸ä¼šè¿›å…¥ cacheï¼Œ inner-cacheable æ˜¯å®ç°å®šä¹‰çš„ï¼Œå¯èƒ½æŒ‡è¿› L1 cache/L2 cacheï¼Œ outer-cacheable è¯´æ˜ä¼šè¿›å…¥ L3 cacheã€‚\nè¦æ³¨æ„ï¼Œåªæœ‰æ™®é€šå†…å­˜æ‰æ”¯æŒé…ç½®æ˜¯å¦è¿›å…¥ cacheï¼Œæ‰€æœ‰çš„è®¾å¤‡å†…å­˜éœ€è¦ non-cacheableã€‚\n å†…å­˜æ”¯æŒé…ç½®ä¸ºæ˜¯å¦è¢« cacheableï¼Œè¿™åœ¨mair_el1çš„å­—æ®µä¸­é…ç½®ã€‚\n shareable è¯´çš„æ˜¯ä¸€å—å†…å­˜çš„å¤–éƒ¨å¯è§æ€§ï¼Œå¤–éƒ¨ä¸å¯è§å¹¶ä¸æ˜¯çœŸçš„çœ‹ä¸åˆ°ï¼Œåªæ˜¯è¯´ä¸ä¿è¯å€¼çš„æ­£ç¡®æ€§ã€‚\nshareable å±æ€§å’Œ cacheable å…¶å®æ˜¯æœ‰å…³è”çš„ï¼Œä»–ä»¬ä¿©æ¯”å¦‚é…åˆä½¿ç”¨ï¼Œä¸èƒ½éšä¾¿è®¾ç½®:\n å¦‚æœä¸€å—å†…å­˜æ˜¯ cacheable çš„ï¼Œåˆ™éœ€è¦ç¡¬ä»¶æä¾› cache çš„ä¸€è‡´æ€§ç»´æŠ¤æœºåˆ¶ã€‚ å¦‚æœä¸èƒ½ä¿è¯ cache çš„ä¸€è‡´æ€§ï¼Œæƒ³è¦å¯ç”¨ shareable å°±å¿…é¡»æ˜¯ non-cacheable å¯¹äº non-cacheable çš„å†…å­˜ï¼Œä¸€å®šæ˜¯ shareable çš„ï¼Œ ä¸éœ€è¦é…ç½®ã€‚å› ä¸ºæ­¤æ—¶å¯¹æ•°æ®çš„ä¿®æ”¹ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¯»å–æ“ä½œäº¦æ˜¯å¦‚æ­¤ï¼Œä¸€å®š æ˜¯å¤–éƒ¨å¯è§çš„  å¦‚ä½•è®¾ç½®å†…å­˜å±æ€§  ç›¸å…³å†…å®¹å¯ä»¥åœ¨ ARMv8 arm æ‰‹å†Œ D5.3.3 Attuibute fields in stage 1 VMSAv8-64 Block and Page descriptors ä¸­æ‰¾åˆ°å‚è€ƒ\n å¯¹äºæ¯ä¸€ä¸ªè¡¨ç¤ºå†…å­˜å—(block)çš„é¡µè¡¨é¡¹ï¼Œéƒ½æœ‰ä¸¤ä¸ªå±æ€§å­—æ®µ: lower attr å’Œ upper attr.\nä»¥ä¸‹ä»»ä½•ç±»å‹æˆ–è€…å±æ€§çš„è®¾ç½®éƒ½æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªå­—æ®µå®Œæˆçš„ã€‚\n","date":"2023-04-12T08:01:33+08:00","permalink":"https://wangloo.github.io/posts/armv8/memory_attr/","section":"posts","tags":["armv8"],"title":"AArch64 å†…å­˜å±æ€§ä¸å†…å­˜ç±»å‹"},{"categories":null,"contents":"ä¸ºä»€ä¹ˆå†™ å› ä¸ºå¹³å¸¸çš„å·¥ä½œä¸­å¾ˆå°‘ç”¨åˆ°python, ä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤ pythonæ˜¯ä¸€é—¨ä¼˜ç§€çš„è¯­è¨€, å¯¹äºæˆ‘ç›®å‰è¦å‡†å¤‡ç§‹æ‹›çš„æƒ…å†µæ¥çœ‹, æœ‰çš„å…¬å¸åšé¢˜å¦‚æœæ”¯æŒpythoné‚£ä¼šç®€å•å¾ˆå¤š, åŒæ ·çš„ä»£ç ,ç”¨Cå†™è¦100è¡Œ, æ¢åˆ°pythonæœ€å¤š30æå®š.\næœ‰äººè¯´C++ä¹Ÿå¯ä»¥å•Š,è€Œä¸”å¯¹äºå¸¸ç”¨Cçš„äººæ¥è¯´å­¦ä¹ é—¨æ§›æ›´ä½, ä½†æ˜¯æˆ‘å®åœ¨æ˜¯å—ä¸äº† C++çš„è¯­æ³•, åŒ…æ‹¬ä½†ä¸é™äºæ¨¡æ¿ã€è¿­ä»£å™¨ï¼ŒSTLæ“ä½œï¼Œæ„Ÿè§‰æœ‰ç‚¹å››ä¸åƒçš„å‘³é“ã€‚ å½“ç„¶ï¼Œè¿™åªæ˜¯æˆ‘çš„ä¸ªäººä¹ æƒ¯ï¼Œä½¿ç”¨C++çš„äººä¹Ÿæ˜¯å¾ˆå¤šçš„ï¼Œè¿˜æ˜¯æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯ é€‰æ‹©ä¸€å¥—è¶æ‰‹çš„å·¥å…·æ¯”è¾ƒå¥½ã€‚\nå› ä¸ºæˆ‘å…¶ä»–æ—¶é—´åŸºæœ¬éƒ½åœ¨ç”¨Cï¼Œæ‰€ä»¥åœ¨æœ¬ç¯‡æ–‡ç« ä¸­æˆ‘ä¼šæ›´å¤šæ‹¿Cæ¥è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·æ›´å¥½è®°å¿†ã€‚\næˆ‘å­¦ä¹  Python çš„çŸ¥è¯†ç‚¹æ¥æº:\n ã€ŠPython å­¦ä¹ æ‰‹å†Œ ç¬¬ 4 ç‰ˆã€‹æå†›ç­‰ UCB CS61A  åˆ—è¡¨ list åˆ—è¡¨æ”¯æŒä¸‹æ ‡ç´¢å¼•ï¼Œæ‰€ä»¥å®ƒå°±åƒCè¯­è¨€ä¸­çš„â€œæ•°ç»„â€ï¼Œåˆ—è¡¨æ”¯æŒå¤§å°åŠ¨æ€å¢é•¿ï¼Œæ‰€ä»¥æ›´åƒâ€œæ•°ç»„plusâ€ï¼Œç±»ä¼¼C++ä¸­çš„vectorå§ï¼ˆä¸å¤ªç¡®å®šï¼‰ã€‚\nåˆ—è¡¨æ”¯æŒå®šé•¿å£°æ˜æˆ–å˜é•¿å£°æ˜ï¼Œåƒåˆ›å»ºä¸€äº›flagåˆ—è¡¨ï¼Œç”¨ä¸‹æ ‡è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œå®šé•¿åˆ›å»ºå°±æ˜¯å¿…è¦çš„ã€‚\nç›¸å…³æ“ä½œ åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ ä»¥ä¸‹çš„åˆ›å»ºæ“ä½œéƒ½æ˜¯æ”¯æŒçš„:\n1# åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ 2lst = [] 3# åˆ›å»ºä¸€ä¸ªå¸¦æœ‰åˆå€¼çš„åˆ—è¡¨ 4lst = [1, 2] 5# åˆ›å»ºäºŒç»´ç©ºåˆ—è¡¨ 6# åº”ç”¨çš„åœºæ™¯æ˜¯: æŒ‰ç…§ç´¢å¼•æ¥ä¿®æ”¹list, æ­¤æ—¶å¦‚æœå•çº¯çš„åˆå§‹åŒ–list=[], 7# é‚£ä¹ˆå¯¹list[1].append()ä¼šæç¤ºè¶…å‡ºèŒƒå›´. æ‰€ä»¥æˆ‘ä»¬è¦æå‰è§„å®šlistçš„é•¿åº¦, 8# å³å°†listå£°æ˜ä¸ºç›®æ ‡é•¿åº¦çš„äºŒç»´list. 9lst = [[] for _ in range(5)] 10# åˆ›å»ºå®šé•¿åˆ—è¡¨å¹¶é™„åˆå€¼ 11lst = [0 for _ in range(5)] 12# åˆ›å»ºäºŒç»´å®šé•¿åˆ—è¡¨å¹¶é™„å¤„ç½®0 13lst = [[0 for _ in range(5)] for _ in range(5)] ä»¥ä¸‹çš„æ–¹å¼æ˜¯é”™è¯¯çš„! å› ä¸ºæ¯ä¸ªå­åˆ—è¡¨éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡, ä¿®æ”¹ä¸€ä¸ªä¼šåŒæ­¥å…¶ä»–çš„\n1lst = [[]] * 5 List çš„é«˜çº§æ„å»ºæ–¹æ³•ï¼Œå……åˆ†åˆ©ç”¨pythonçš„çµæ´»æ€§:\n1\u0026gt;\u0026gt;\u0026gt; odds = [1, 3, 5, 7, 9] 2\u0026gt;\u0026gt;\u0026gt; [x+1 for x in odds] 3[2, 4, 6, 8, 10] 4\u0026gt;\u0026gt;\u0026gt; [x for x in odds if 25 % x == 0] 5[1, 5] å…¶ä»–æ“ä½œ  ç›´æ¥ä½¿ç”¨ +, *è¿ç®—ç¬¦å®ç°å¤šä¸ªåˆ—è¡¨çš„ç»„åˆ, ä¸å­—ç¬¦ä¸²ç±»ä¼¼ append: ä¸ºåˆ—è¡¨å¢åŠ ä¸€ä¸ªå¯¹è±¡(æœ«å°¾) pop(pos): åˆ é™¤åˆ—è¡¨ä¸­çš„æŸä¸ªå…ƒç´ (æŒ‰ä½ç½®)ï¼Œå¹¶è¿”å›å…¶å€¼ insert(pos, val): åœ¨åˆ—è¡¨çš„ä»»æ„ä½ç½®æ’å…¥å¯¹è±¡ remove: åˆ é™¤åˆ—è¡¨ä¸­çš„æŸä¸ªå…ƒç´ (æŒ‰å†…å®¹) å¤šçº§åˆ—è¡¨æ˜¯è¢«æ”¯æŒçš„ï¼ŒåƒäºŒç»´æ•°ç»„ä¸€æ ·ï¼Œä½†æ˜¯æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨å†…ç½®çš„åˆ—è¡¨æ¥å®ç°ã€‚ \u0026hellip;  Python å†…ç½®ç±»å‹ å®ä¾‹çš„ç±»å‹å¯ä»¥é€šè¿‡å†…ç½®å‡½æ•°type()æ¥æŸ¥çœ‹ã€‚\nå­—ç¬¦ä¸² å®šä¹‰ä¸€ä¸ª python å­—ç¬¦ä¸²\n1S = \u0026#39;Spam\u0026#39; æ”¯æŒç´¢å¼•å…¶ä¸­å…ƒç´ ï¼Œä¹Ÿæ”¯æŒåå‘ç´¢å¼•ï¼ˆå³ä»å³è¾¹å¼€å§‹è®¡ç®—ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´è´Ÿçš„ç´¢å¼•å·ä¼šç®€å•åœ°ä¸å­—ç¬¦ä¸²çš„é•¿åº¦ç›¸åŠ ã€‚\n1\u0026gt;\u0026gt;\u0026gt; S[0] 2\u0026#39;S\u0026#39; 3\u0026gt;\u0026gt;\u0026gt; S[-1] 4\u0026#39;m\u0026#39; 5\u0026gt;\u0026gt;\u0026gt; S[len(S)-1] 6\u0026#39;m\u0026#39; python ä¹Ÿæ”¯æŒå­—ç¬¦ä¸²åˆ†ç‰‡æ“ä½œï¼Œå·¦è¾¹ç•Œçš„é»˜è®¤å€¼ä¸º 0ï¼Œå³è¾¹ç•Œçš„é»˜è®¤å€¼ä¸ºå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚\n1\u0026gt;\u0026gt;\u0026gt; S[1:] 2\u0026#39;pam\u0026#39; 3\u0026gt;\u0026gt;\u0026gt; S[0:3] 4\u0026#39;Spa\u0026#39; 5\u0026gt;\u0026gt;\u0026gt; S[:-1] 6\u0026#39;Spa\u0026#39; å­—ç¬¦ä¸²å¯¹äº+æ“ä½œç¬¦çš„è¡¨ç°æ˜¯å­—ç¬¦ä¸²çš„è¿æ¥ï¼Œè¿™ä½“ç°äº† python çš„å¤šæ€æ€§ã€‚ å­—ç¬¦ä¸²åˆ›å»ºåæ— æ³•ç›´æ¥é€šè¿‡ç´¢å¼•æ”¹å˜å…¶å…ƒç´ ï¼Œå¯ä»¥è½¬è€Œé€šè¿‡åŒåå¯¹è±¡è¦†ç›–æ¥å®ç°ï¼š\n1\u0026gt;\u0026gt;\u0026gt; S[0] = \u0026#39;z\u0026#39; 2Traceback (most recent call last): 3 File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; 4TypeError: \u0026#39;str\u0026#39; object does not support item assignment 5\u0026gt;\u0026gt;\u0026gt; S = \u0026#39;z\u0026#39; + S[1:] 6\u0026gt;\u0026gt;\u0026gt; S 7\u0026#39;zpam\u0026#39; å­—ç¬¦ä¸²æ”¯æŒçš„å±æ€§ï¼Œä¾‹å¦‚.find()å¯ä»¥é€šè¿‡å†…ç½®å‘½ä»¤ dir(S)æ¥æŸ¥çœ‹ã€‚\n dir å‡½æ•°ä»…ä»…ç»™å‡ºäº†æ–¹æ³•çš„åç§°ï¼Œå¦‚æœæƒ³æŸ¥è¯¢å…¶å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥åˆ©ç”¨å†…ç½®å‡½æ•°help(S.find)ã€‚\n string çš„ä¸‰ç§å½¢å¼ Python å…è®¸å­—ç¬¦ä¸²è¢«åŒ…æ‹¬åœ¨å•å¼•å·æˆ–è€…åŒå¼•å·ä¸­(å®ƒä»¬çš„å«ä¹‰ç›¸åŒï¼‰ï¼Œå®ƒä¹Ÿå…è®¸åœ¨ä¸‰ä¸ªå¼•å·ï¼ˆå•æˆ–åŒå‡å¯ï¼‰ä¸­åŒ…å«å¤šè¡Œå­—ç¬¦ä¸²å¸¸é‡ï¼Œå½“ Python è„šæœ¬ä¸­åµŒå…¥åƒ HTML è¿™æ ·çš„å†…å®¹æ—¶ï¼Œè¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚\n1\u0026gt;\u0026gt;\u0026gt; msg = \u0026#34;\u0026#34;\u0026#34; 2... aaaaa 3... bbbbb 4... ccccc 5... \u0026#34;\u0026#34;\u0026#34; 6\u0026gt;\u0026gt;\u0026gt; msg 7\u0026#39;\\naaaaa\\nbbbbb\\nccccc\\n\u0026#39; å­—å…¸ é”®å€¼å¯¹\næ”¯æŒé€šè¿‡ key ç´¢å¼•æ¥ä¿®æ”¹ï¼Œ æ‰€ä»¥ä¸å­—ç¬¦ä¸²å’Œåˆ—è¡¨ä¸åŒã€‚\n1\u0026gt;\u0026gt;\u0026gt; D = {} 2\u0026gt;\u0026gt;\u0026gt; D[\u0026#39;name\u0026#39;] = \u0026#39;Bob\u0026#39; 3\u0026gt;\u0026gt;\u0026gt; D[\u0026#39;age\u0026#39;] = 40 4\u0026gt;\u0026gt;\u0026gt; D 5{\u0026#39;name\u0026#39;: \u0026#39;Bob\u0026#39;, \u0026#39;age\u0026#39;: 40} å­—å…¸ä¹Ÿæ”¯æŒåµŒå¥—æ“ä½œï¼Œåœ¨ json ä¸­å¸¸ç”¨\nå­—å…¸çš„æ“ä½œ  keys() è¿”å› key çš„åˆ—è¡¨ value() è¿”å› value çš„åˆ—è¡¨ item(): è¿”å›(key,value)æ„æˆçš„å…ƒç»„åˆ—è¡¨  å­—å…¸çš„é™åˆ¶  åœ¨python3.6ä¹‹å‰å­—å…¸æ˜¯ unordered, å³å­˜å‚¨çš„é¡ºåºä¸æŒ‰ç…§åŠ å…¥æ—¶é—´; è€Œåœ¨python3.6+, å­—å…¸æ”¹ä¸º ordered. key æ˜¯å”¯ä¸€çš„, å¦‚æœä½ æƒ³è®©ä¸€ä¸ª key å¯¹åº”å¤šä¸ªå€¼, å°†å…¶ value è®¾ç½®ä¸º list æ˜¯ä¸€ç§æ–¹æ¡ˆ! list åªèƒ½æ˜¯ value, ä¸èƒ½æ˜¯ key  å…ƒç»„ å…ƒç¥–åƒä¸€ä¸ªä¸å¯æ”¹å˜çš„åˆ—è¡¨\n1\u0026gt;\u0026gt;\u0026gt; T = (1, 2, 3, 4) 2\u0026gt;\u0026gt;\u0026gt; T 3(1, 2, 3, 4) å…¶ä¸“æœ‰çš„æ–¹æ³•ï¼š\n index(x) è¿”å› x æ‰€åœ¨å…ƒç»„ä¸­çš„ä¸‹æ ‡ count(x) è®¡ç®— x åœ¨å…ƒç»„ä¸­å‡ºç°çš„æ¬¡æ•°   ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å…ƒç»„ï¼Ÿ ä¸€èˆ¬æ¥è¯´ï¼Œå…ƒç»„ä¸å¦‚åˆ—è¡¨é‚£æ ·å¸¸ç”¨ï¼Œå› ä¸ºå®ƒçš„ä¸å¯è¢«æ”¹å˜çš„ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿèµ‹äºˆäº†å…ƒç»„å¤©ç„¶çš„å®Œæ•´æ€§çº¦æŸï¼Œå¯åº”ç”¨åœ¨æœŸæœ›ä¸ä¼šè¢«æ”¹å˜çš„åœºæ™¯ä¸­\n åŸºç¡€è¯­æ³• iterator 1l = [1, 2, 3] 2k = iter(l) # å¾—åˆ°ä¸€ä¸ªå¯ä»¥éå†çš„iterator 3next(k) # get 1 4next(k) # get 2 iterator ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥ç­‰ä»·äºä¸€ä¸ª for å¾ªç¯!\nlist çš„ iterator åƒæ˜¯ä¸€ä¸ª list, ä¸åŒçš„æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ª\u0026quot;ç›‘è§†è€…\u0026quot;ä¼šè®°å½•ä½ å½“å‰æ‰€åœ¨çš„ä½ç½®, ä½¿å¾—ä½ å¯ä»¥è°ƒç”¨ä¸€äº›æ–¹æ³•(next()) æ¥å¾—åˆ°å½“å‰ä½ç½®çš„å…ƒç´ , å¹¶ç›‘è§†ä¸‹ä¸€ä¸ªä½ç½®çš„å…ƒç´ .\nå½“ç„¶, ä¸ä»…ä»… list æœ‰å¯¹åº”çš„ iterator, å¯¹äºå…¶ä»–æ•°æ®ç»“æ„æ¥è¯´äº¦æ˜¯å¦‚æ­¤.\n å¦‚æœåœ¨éå†kçš„é€”ä¸­æ”¹å˜äº†éå†å¯¹è±¡çš„ç»“æ„(ä¾‹å¦‚lst.append(4)), è¯¥ iterator å°†ä¸å¯å†ç”¨!\næ‰€ä»¥ä»¥ä¸‹ä»£ç çš„è¡Œä¸ºæ˜¯é”™è¯¯çš„:\n1lst = [1, 2, 3] 2for item in lst: 3 if item == 1: 4 lst.remove(1) å¯ä»¥ä¸“é—¨åˆ›å»ºä¸€ä¸ª lst çš„å‰¯æœ¬ç”¨äºå¾ªç¯:\n1for item in list(lst): 2 ... ä½†ä¿®æ”¹å…¶ä¸­çš„å€¼ä¸å½±å“(ä¾‹å¦‚lst[0] = 0)\n å¦ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…æ˜¯: å¦‚æœä½¿ç”¨list()æ–¹æ³•åˆ›å»ºä¸€ä¸ª iterator çš„ list, python å®é™…çš„è¡Œä¸ºæ˜¯ è°ƒç”¨next()ç›´åˆ°ç»“å°¾æ¥å¾—åˆ°å…ƒç´ å¹¶æ’å…¥æ–°çš„ list. æ‰€ä»¥ä¸‹é¢çš„ä»£ç è¡Œä¸ºå°±å®¹æ˜“ç†è§£äº†:\n1t = iter([1, 2, 3]) 2list(t) # [1, 2, 3] 3list(t) # [] Python å†…ç½®åŠŸèƒ½å‡½æ•° èšåˆå¯ç´¢å¼•çš„ç±»å‹ ä¸€äº›å†…ç½®çš„åŠŸèƒ½å‡½æ•°å¯ä»¥å°†å¯ç´¢å¼•çš„å‚æ•°è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„æ•°å€¼. ä¾‹å¦‚ range, list ç­‰.\nsum(iterable[, start]) è¿”å›å¯ç´¢å¼•çš„å‚æ•°å…ƒç´ ä¹‹å’Œ(ä¸èƒ½æ˜¯å­—ç¬¦ä¸²), åŠ ä¸Š start(é»˜è®¤æ˜¯ 0). å½“ iterable ä¸ºç©ºæ—¶, è¿”å› start\n ä¸ºä»€ä¹ˆè¦æœ‰ä¸€ä¸ªstart? ä½¿å¾—å¦‚æœè¾“å…¥å­—ç¬¦ä¸²ç»„æˆçš„åˆ—è¡¨(å¯ä»¥æ˜¯å…¶ä»–å¯ç´¢å¼•çš„æ•°æ®ç»“æ„), ä¼šæŠ›å‡ºå¼‚å¸¸. è¯¦è§ä¸‹é¢å®ä¾‹\n 1\u0026gt;\u0026gt;\u0026gt; sum([2, 3, 4]) 29 3\u0026gt;\u0026gt;\u0026gt; sum([\u0026#39;2\u0026#39;, \u0026#39;3\u0026#39;, \u0026#39;4\u0026#39;]) 4Traceback (most recent call last): 5 File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; 6TypeError: unsupported operand type(s) for +: \u0026#39;int\u0026#39; and \u0026#39;str\u0026#39; å…¶å®ç°çš„åŸç†æ˜¯: ä¿è¯å‰é¢iterableä¸­å…ƒç´ æ±‚å’Œçš„ç»“æœä¸startçš„ç±»å‹ç›¸åŒ. ä¾‹å¦‚:\n1\u0026gt;\u0026gt;\u0026gt; sum([2, 3, 4], 5) 214 3\u0026gt;\u0026gt;\u0026gt; sum([[2, 3], [4]], []) 4[2, 3, 4] 5\u0026gt;\u0026gt;\u0026gt; sum([[2, 3], [4]]) 6Traceback (most recent call last): 7 File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; 8TypeError: unsupported operand type(s) for +: \u0026#39;int\u0026#39; and \u0026#39;list\u0026#39; max 1max(iterable[, key=func]) -\u0026gt; value 2max(a, b, c, ...[,key=func]) -\u0026gt; value keyæ˜¯ç”¨æ¥é¢„å¤„ç†æ•°æ®çš„, é»˜è®¤ä¸º lambda x: x\nå…¶ä»–ç‰¹æ€§ nonlocalå£°æ˜ ä½¿ç”¨æ–¹æ³•:\n1nonlocal \u0026lt;name\u0026gt; æ•ˆæœ: åœ¨å£°æ˜æŸä¸ªå˜é‡ä¸ºnonlocalä¹‹å, å¯¹å…¶æ‰€æœ‰èµ‹å€¼è¯­å¥, éƒ½ä¸ä¼šå»ºç«‹ä¸€ä¸ªå±€éƒ¨çš„ç»‘å®š, è€Œæ˜¯å°†è¯¥å˜é‡é‡æ–°ç»‘å®šåˆ°å½“å‰ frame å‘ä¸Šèƒ½æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªéå±€éƒ¨ frameä¸­å¯¹è¯¥å˜é‡çš„ç»‘å®š.\nç®€å•æ¥è¯´, å°±æ˜¯å¯¹è¯¥å˜é‡çš„æ‰€æœ‰èµ‹å€¼æ“ä½œéƒ½æ”¹ä¸ºæ“ä½œèƒ½æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå…¨å±€(è¿™ä¸ªå…¨å±€æ˜¯ç›¸å¯¹çš„)åŒåå˜é‡. å½“ç„¶, å¦‚æœæ‰¾ä¸åˆ°ä¸€ä¸ªåŒåå…¨å±€å˜é‡, å°±æŠ›å‡ºå¼‚å¸¸.\nä¸‹é¢çš„ä¾‹å­ä¸­, å¦‚æœåœ¨withdrew()ä¸­ä¸å°†balanceå£°æ˜ä¸º nonlocal:\n if è¯­å¥æ˜¯å¯ä»¥é€šè¿‡çš„, å› ä¸ºè®¿é—®balanceä¼šæ‰¾åˆ°å½“å‰ frame çš„ parent, å³make_withdraw()ä¸­å£°æ˜çš„balance. è€Œ python å¤„ç†èµ‹å€¼æ“ä½œå°±ä¸ä¸€æ ·äº†. ä»–ä¼šé»˜è®¤å°†balanceç»‘å®šåˆ°å±€éƒ¨, è€Œ è¿™å°±ä¸ if è¯­å¥äº§ç”Ÿäº†å†²çª, ä¼šæŠ›å‡ºå¼‚å¸¸.  æ‰€ä»¥å°±éœ€è¦nonlocalçš„å£°æ˜, å‘Šè¯‰ python: èµ‹å€¼è¯­å¥ä¹Ÿå¾—å»ä¸Šé¢ frame ä¸­æ‰¾ä¸€ä¸ªå…¨å±€çš„.\n1# make_withdraw å»ºç«‹ä¸€ä¸ªé“¶è¡Œè´¦æˆ·, å¹¶ç»™å‡ºåˆå§‹é‡‘é¢, 2# å…¶è¿”å›ä¸€ä¸ªå‡½æ•°withdrew(), è°ƒç”¨è¯¥å‡½æ•°çš„è¡Œä¸ºæ˜¯ä» 3# é“¶è¡Œè´¦æˆ·é‡Œæ‰£æ¬¾ 4def make_withdraw(balance): 5 def withdraw(amount): 6 nonlocal balance 7 if amount \u0026gt; balance: 8 return \u0026#39;Insufficient funds\u0026#39; 9 balance = balance - amount 10 return balance 11 return withdraw 12 13wd = make_withdraw(20) 14wd(8) Python åŠ¨æ€ç±»å‹ å¯¹è±¡çš„åƒåœ¾å›æ”¶ åœ¨ Python ä¸­ï¼Œæ¯å½“ä¸€ä¸ªå˜é‡è¢«èµ‹äºˆäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹‹å‰å¯¹è±¡å ç”¨çš„ç©ºé—´å°±ä¼šè¢«å›æ”¶ã€‚\n1\u0026gt;\u0026gt;\u0026gt; x = 42 2\u0026gt;\u0026gt;\u0026gt; x = 3.14 3\u0026gt;\u0026gt;\u0026gt; x = \u0026#34;hello\u0026#34; å¯¹è±¡çš„å¼•ç”¨å€¼åœ¨æ­¤è¿‡ç¨‹ä¸­è¢«é€ä¸ªå›æ”¶ï¼Œæ¯æ¬¡ x æŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒPython å°†è‡ªåŠ¨å›æ”¶åŸæ¥å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚\nPython ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥å®ç°è¯¥åŠŸèƒ½ã€‚ä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤äº†ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè®°å½•äº†å½“å‰å¼•ç”¨è¯¥å¯¹è±¡çš„å˜é‡æ•°ç›®ï¼Œä¸€æ—¦è®¡æ•°å€¼å˜æˆ 0ï¼Œåˆ™å…¶ç©ºé—´è¢«å›æ”¶ã€‚\næ·±æ‹·è´å’Œæµ…æ‹·è´ 1L1 = [2, 3, 4] 2L2 = L1 äº§ç”Ÿçš„ç»“æœæ˜¯ï¼Œ L1 æ˜¯ä¸€ä¸ªåŒ…å«äº†å¯¹è±¡ 2ã€3ã€4 çš„åˆ—è¡¨ï¼Œå½“ç„¶åˆ—è¡¨è‡ªèº«ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ã€‚L1 æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå¼•ç”¨äº†è¯¥åˆ—è¡¨çš„å¯¹è±¡ã€‚è¿è¡Œ L2 çš„èµ‹å€¼æ“ä½œåï¼ŒL1 å’Œ L2 å¼•ç”¨äº†ç›¸åŒçš„å¯¹è±¡ã€‚\næ­¤æ—¶å¦‚æœä½¿ç”¨ç´¢å¼•å¯¹ L1 åˆ—è¡¨çš„æŸä¸ªå…ƒç´ è¿›è¡Œä¿®æ”¹ï¼Œç”±äº L1 å’Œ L2 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œç›¸å½“äº L2 ä¹Ÿåšäº†ä¿®æ”¹ã€‚è¿™å°±æ˜¯æµ…æ‹·è´\næµ…æ‹·è´æ˜¯é»˜è®¤çš„ï¼Œå¦‚æœä½ å¸Œæœ›ä½¿ç”¨æ·±æ‹·è´ï¼Œå³æ‹·è´å¯¹è±¡ï¼Œè€Œä¸æ˜¯åˆ›å»ºç´¢å¼•ã€‚å¯¹äºåˆ—è¡¨æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨åˆ†ç‰‡æ¥å®ç°\n1L1 = [2, 3, 4] 2L2 = L1[:] å¯¹äºå…¶ä»–çš„å†…ç½®ç±»å‹ï¼Œæœ‰çš„ä¹Ÿå¯ä»¥ç”¨ X.copy()æ–¹æ³•ï¼›è€Œä¸”æ ‡å‡†åº“çš„copyæ¨¡å—æœ‰ä¸€ä¸ªé€šç”¨çš„èµ‹å€¼ä»»æ„å¯¹è±¡ç±»å‹çš„æ–¹æ³•ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç”¨äºåµŒå¥—æ·±æ‹·è´çš„ç‰¹æ®Šæ–¹æ³•ã€‚\n1import copy 2X = copy.copy(Y) # åªæ·±æ‹·è´top-level 3X = copy.deepcopy(Y) # åµŒå¥—è¿›è¡Œæ·±æ‹·è´ åˆ¤æ–­ç›¸ç­‰ åŸºäºä¸Šè¿°æ·±æ‹·è´å’Œæµ…æ‹·è´çš„ç†è®ºï¼Œå°±æœ‰å…³äº Python ä¸­å˜é‡åˆ¤æ–­ç›¸ç­‰çš„æ–¹æ³•ã€‚ Python ä¸­æœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ£€æŸ¥å˜é‡æ˜¯å¦ç›¸ç­‰ï¼š\n == æ“ä½œç¬¦ï¼šæµ‹è¯•ä¸¤ä¸ªå˜é‡å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å…·æœ‰ç›¸åŒçš„å€¼ isæ“ä½œç¬¦ï¼šæ£€æŸ¥å¯¹è±¡çš„åŒä¸€æ€§ï¼Œå³æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯ä¸€ç§æ›´åŠ ä¸¥æ ¼çš„ç›¸ç­‰æ€§åˆ¤æ–­  å­—ç¬¦ä¸² ç‰¹æ®Šå­—ç¬¦çš„è½¬ä¹‰ å­—ç¬¦ä¸²ä¸­çš„\\nä¼šè¢«è¯†åˆ«ä¸ºæ¢è¡Œç¬¦ï¼Œä¸ C è¯­è¨€ç±»ä¼¼ï¼Œä½† Python ä¸è¯†åˆ«ç»“æŸç¬¦(\\0)\nåœ¨å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå¼•å·ä¹‹å‰è¾“å…¥rï¼Œä¼šå…³é—­è½¬ä¹‰æœºåˆ¶ï¼Œå°†åæ–œæ å½“åšæ™®é€šå­—ç¬¦æ¥ä¿æŒã€‚å¸¸ç”¨ä¸ Windows ç¯å¢ƒä¸­æ‰“å¼€æ–‡ä»¶\n1file = open(r\u0026#39;C:\\my\\path\\file.txt\u0026#39;, \u0026#39;w\u0026#39;) ç´¢å¼•å’Œåˆ†ç‰‡ åˆ†ç‰‡çš„å¸¸è§ä½œç”¨\nå¤„ç†å‚æ•° åœ¨ç³»ç»Ÿå‘½ä»¤è¡Œä¸­å¯åŠ¨ python ç¨‹åºæ—¶ï¼Œè·å–é™„åŠ çš„å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨å†…ç½®çš„ sys æ¨¡å—ä¸­çš„ argv å±æ€§ï¼š\n1# file echo.py 2import sys 3print(sys.argv) 4 5% python echo.py -a -b -c 6[\u0026#39;echo.py\u0026#39;, \u0026#39;-a\u0026#39;, \u0026#39;-b\u0026#39;, \u0026#39;-c\u0026#39;] é€šå¸¸ä½ åªå¯¹è·Ÿéšåœ¨ç¨‹åºååè¾¹çš„å‚æ•°æ„Ÿå…´è¶£ï¼Œè¿™å°±æ˜¯åˆ†ç‰‡çš„å…¸å‹åº”ç”¨ï¼Œsys.argv[1:]å°±èƒ½æ»¡è¶³ä½ \nå¤„ç†æ–‡ä»¶ åˆ†ç‰‡ä¹Ÿå¸¸å¸¸ç”¨ä½œæ¸…ç†è¾“å…¥æ–‡ä»¶çš„å†…å®¹ã€‚å¦‚æœçŸ¥é“ä¸€è¡Œä¼šä»¥æ¢è¡Œç¬¦ç»“å°¾ï¼Œå°±å¯ä»¥ä½¿ç”¨line[:-1]ï¼ŒæŠŠè¿™è¡Œå»é™¤æœ€åä¸€ä¸ªå­—ç¬¦ä¹‹å¤–çš„å†…å®¹æå–å‡ºæ¥ã€‚\n å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå»é™¤æ¢è¡Œç¬¦å¸¸å¸¸æ¨èé‡‡ç”¨line.rstripæ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•å°†ä¼šæ­£ç¡®çš„å¤„ç†æœ€åä¸€è¡Œçš„æƒ…å†µã€‚\n å­—ç¬¦ä¸²å’Œå…¶ä»–ç±»å‹è½¬æ¢ å­—ç¬¦ä¸²å’Œæ•´æ•°\n1\u0026gt;\u0026gt;\u0026gt; int(\u0026#34;42\u0026#34;), str(42) 2(42, \u0026#39;42\u0026#39;) å­—ç¬¦å’Œ ASCII ç \n1\u0026gt;\u0026gt;\u0026gt; ord(\u0026#39;s\u0026#39;) 2115 3\u0026gt;\u0026gt;\u0026gt; chr(115) 4\u0026#39;s\u0026#39; ä¿®æ”¹å­—ç¬¦ä¸² å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜åºåˆ—ï¼Œå³ä¸èƒ½é€šè¿‡ç´¢å¼•æ¥ä¿®æ”¹ã€‚\nè‹¥æƒ³æ”¹å˜ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦åˆ©ç”¨åˆå¹¶ã€åˆ†ç‰‡è¿™æ ·çš„å·¥å…·æ¥å»ºç«‹ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™åŸå§‹å­—ç¬¦ä¸²å˜é‡\n1S = S[:4] + \u0026#39;Bureger\u0026#39; å¦‚æœä¸å¾—ä¸å¯¹ä¸€ä¸ªè¶…é•¿å­—ç¬¦ä¸²è¿›è¡Œå¤šå¤„çš„ä¿®æ”¹ï¼Œä¸ºäº†ä¼˜åŒ–è„šæœ¬çš„æ€§èƒ½å’Œä»£ç ï¼Œå¯èƒ½éœ€è¦å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ”¯æŒåŸå¤„ä¿®æ”¹çš„å¯¹è±¡ï¼Œå¦‚ List\n1\u0026gt;\u0026gt;\u0026gt; S = \u0026#39;spammy\u0026#39; 2\u0026gt;\u0026gt;\u0026gt; L = list(S) 3\u0026gt;\u0026gt;\u0026gt; L 4[\u0026#39;s\u0026#39;, \u0026#39;p\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;m\u0026#39;, \u0026#39;m\u0026#39;, \u0026#39;y\u0026#39;] å¯¹äº L å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥ä¿®æ”¹ï¼Œå®Œæˆåéœ€è¦å°†å…¶è½¬æ¢å›å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²çš„joinæ–¹æ³•æ¥å®ç°:\n1\u0026gt;\u0026gt;\u0026gt; S = \u0026#39;\u0026#39;.join(L) Python ä¸­çš„ sprintf 1\u0026gt;\u0026gt;\u0026gt; \u0026#39;That is %d%sbird!\u0026#39; % (1, \u0026#39;dead\u0026#39;) 2That is 1 dead bird å­—ç¬¦ä¸²çš„æ–¹æ³• see Python standard manual\nåˆ—è¡¨ åˆ—è¡¨ä¸å­—å…¸éƒ½æ˜¯å…¶ä»–å¯¹è±¡çš„é›†åˆã€‚\nåˆ—è¡¨èƒ½å¤Ÿå®Œæˆ C ä¸­ç»“æ„ä½“çš„å·¥ä½œï¼Œä¸éœ€è¦æ‰‹åŠ¨å®ç°ã€‚\nPython ä¸­çš„åˆ—è¡¨æ˜¯ï¼š\n ä»»æ„å¯¹è±¡çš„æœ‰åºé›†åˆ é€šè¿‡åç§»è¯»å– å¯å˜é•¿åº¦ã€å¼‚æ„ä»¥åŠä»»æ„åµŒå¥— å¯¹è±¡å¼•ç”¨çš„æ•°ç»„ã€‚ç±»ä¼¼ä¸ C è¯­è¨€ä¸­çš„æŒ‡é’ˆæ•°ç»„  åˆ—è¡¨å®ç° LIFO åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œä¼šä½¿ç”¨åˆ—è¡¨çš„popå’Œappendæ–¹æ³•ï¼Œå®ç°å¿«é€Ÿçš„ LIFO å¯¹æˆ˜ç»“æ„ã€‚\nå­—å…¸ å­—å…¸å¯ä»¥ç§°ä½œ Python ä¸­æœ€çµæ´»çš„å†…ç½®æ•°æ®ç»“æ„ã€‚å­—å…¸å½“ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡ key æ¥å­˜å–ï¼Œè€Œä¸æ˜¯é€šè¿‡åç§»ï¼Œç±»ä¼¼ C++çš„ mapã€‚\nä½œä¸ºå†…ç½®ç±»å‹ï¼Œå­—å…¸å¯ä»¥å–ä»£è®¸å¤šæœç´¢ç®—æ³•å’Œæ•°æ®ç»“æ„ã€‚æœ‰æ—¶ä¹Ÿèƒ½æ‰§è¡Œå…¶ä»–è¯­è¨€ä¸­çš„è®°å½•ã€ç¬¦å·è¡¨çš„åŠŸèƒ½ï¼Œå¯ä»¥è¡¨ç¤ºç¨€ç–ï¼ˆå¤šæ•°ä¸ºç©ºï¼‰çš„æ•°æ®ç»“æ„ç­‰ã€‚\nå­—å…¸çš„ä¸»è¦å±æ€§å¦‚ä¸‹ï¼š\n ä»»æ„å¯¹è±¡çš„æ— åºé›†åˆ å¯å˜é•¿ã€å¼‚æ„ã€ä»»æ„åµŒå¥— å¯¹è±¡å¼•ç”¨çš„æ•£åˆ—è¡¨ã€‚å­—å…¸çš„åº•å±‚å®ç°æ˜¯æ•£åˆ—è¡¨ï¼Œä¸€å¼€å§‹å¾ˆå°ï¼Œæ ¹æ®è¦æ±‚å¢é•¿ã€‚   åˆ—è¡¨å’Œå­—å…¸ï¼Œä¸ä¼šç»å¸¸ç”¨å¸¸é‡æ¥åˆ›å»ºï¼Œå¸¸ä½¿ç”¨åŠ¨æ€æ–¹æ³•\n ç”¨å­—å…¸æ¨¡æ‹Ÿçµæ´»çš„åˆ—è¡¨ åˆ—è¡¨å¯¹åœ¨å…¶æœ«å°¾å¤–çš„å…ƒç´ èµ‹å€¼æ˜¯éæ³•çš„ï¼š\n1\u0026gt;\u0026gt;\u0026gt; L = [] 2\u0026gt;\u0026gt;\u0026gt; L[99] = 1 3Traceback (most recent call last): 4 File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; 5IndexError: list assignment index out of range è™½ç„¶ä½ å¯ä»¥é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å¤§ç©ºé—´ï¼Œä½†è¿™ç§æƒ…å†µç”¨å­—å…¸æ›´ä¸ºæ–¹ä¾¿ã€‚å­—å…¸çš„ key ä¸ºæ•´æ•°æ—¶ï¼Œå¯ä»¥æ•ˆä»¿åˆ—è¡¨åœ¨åç§»èµ‹å€¼æ—¶å¢é•¿ï¼š\n1\u0026gt;\u0026gt;\u0026gt; D = {} 2\u0026gt;\u0026gt;\u0026gt; D[99] = \u0026#39;spam\u0026#39; 3\u0026gt;\u0026gt;\u0026gt; D[99] 4\u0026#39;spam\u0026#39; 5\u0026gt;\u0026gt;\u0026gt; D 6{99: \u0026#39;spam\u0026#39;} å¥½å¤„æ˜¯ï¼Œ æ­¤æ—¶çš„ D ä»…æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œçœ‹ä¸Šå»å¥½åƒæ˜¯æœ‰ 100 ä¸ªå…ƒç´ ã€‚\nå­—å…¸æè¿°ç¨€ç–æ•°æ®ç»“æ„ å­—å…¸åˆ›å»ºçš„æ–¹æ³• å…±æœ‰å››ç§ä¸åŒçš„æ–¹æ¡ˆï¼š\n1{\u0026#39;name\u0026#39;: \u0026#39;mel\u0026#39;, \u0026#39;age\u0026#39;: 45} 2 3D = {} 4D[\u0026#39;name\u0026#39;] = \u0026#39;mel\u0026#39; 5D[\u0026#39;age\u0026#39;] = 45 6 7dict(name=\u0026#39;mel\u0026#39;, age=45) 8dict([(\u0026#39;name\u0026#39;, \u0026#39;mel\u0026#39;), (\u0026#39;age\u0026#39;, 45)]) ä¸Šé¢å››ç§æ–¹æ¡ˆå»ºç«‹çš„å­—å…¸æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬åˆ†åˆ«åº”ç”¨ä¸ä¸åŒçš„æ¡ä»¶ï¼š\n å¦‚æœä½ å¯ä»¥äº‹å…ˆæ‹¼å‡ºæ•´ä¸ªå­—å…¸ï¼Œé‚£ä¹ˆç¬¬ä¸€ç§æ˜¯å¾ˆæ–¹ä¾¿çš„ å¦‚æœä½ éœ€è¦ä¸€æ¬¡åŠ¨æ€åœ°å»ºç«‹å­—å…¸çš„ä¸€ä¸ªå­—æ®µï¼Œç¬¬äºŒç§æ¯”è¾ƒåˆé€‚ ç¬¬ä¸‰ç§å…³é”®å­—å½¢å¼æ‰€éœ€ä»£ç é‡æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯ key å¿…é¡»éƒ½æ˜¯å­—ç¬¦ä¸²æ‰è¡Œ å¦‚æœä½ éœ€è¦åœ¨ç¨‹åºè¿è¡Œæ—¶æŠŠ key å’Œ value é€æ­¥æ„å»ºæˆåºåˆ—ï¼Œé‚£ä¹ˆç”¨ç¬¬å››ç§  å¦‚ä»Šçš„ Python ä»£ç ä¸­ï¼Œç¬¬ä¸‰ç§æ–¹å¼æ¯”è¾ƒæµè¡Œã€‚\n","date":"2023-04-01T10:30:35+08:00","permalink":"https://wangloo.github.io/posts/python/basic/","section":"posts","tags":["Python"],"title":"Python åŸºç¡€çŸ¥è¯†"},{"categories":["Operating System"],"contents":"Kconfig ä»‹ç» Kconfig æ˜¯ä¸€ä¸ªé€šç”¨çš„é…ç½®ç³»ç»Ÿï¼Œæœ€åˆç”± Linux å¼€å‘ï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„å¯æ‰©å±•çš„é…ç½®è¯­è¨€ï¼Œ å®ç°å·¥ç¨‹çš„æ¨¡å—åŒ–å’Œå¯å®šåˆ¶éœ€æ±‚ã€‚\nåœ¨ç®€å•çš„å·¥ç¨‹ä¸­ï¼Œæˆ–è®¸æˆ‘ä»¬ä½¿ç”¨ç®€å•çš„ C è¯­è¨€å®å°±èƒ½è§£å†³é—®é¢˜ï¼Œä¸å¿…ç”¨åˆ° Kconfigã€‚ ä½†å¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¹¶ä¸åªæ˜¯ä¸€ä¸ªé€‰é¡¹çš„å¼€å¯å’Œå…³é—­ï¼Œå¹¶ä¸åªæ˜¯å½±å“åˆ°æºä»£ç ï¼Œè¿˜æœ‰åŸºäº Makefile çš„ç¼–è¯‘å·¥ä½œã€‚å¹¶ä¸”ï¼Œå½“å¯é…ç½®çš„é€‰é¡¹å¢åŠ æ—¶ï¼Œå¼€å‘è€…æ‰‹åŠ¨ç®¡ç†è¿™äº›é…ç½®é€‰é¡¹å°±æ˜¾å¾—ä¸é‚£ä¹ˆæ™ºèƒ½äº†ã€‚\nKconfig çš„å‡ºç°ä½¿å¾—ä¸Šè¿°å·¥ä½œå˜å¾—è½»æ¾ï¼š\n åœ¨ build å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢æ¥é€‰æ‹©æ­¤æ¬¡æ„å»ºå¯ç”¨äº†å“ªäº›ç¼–è¯‘é€‰é¡¹, (menuconfig) å¯¹äºä¸åŒçš„å‚å•†é©±åŠ¨ï¼Œå¯ä»¥æœ‰ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå‚å•†å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªé»˜è®¤çš„ config æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„åº”ç”¨è¿™äº›é»˜è®¤é€‰é¡¹è¿›è¡Œç¼–è¯‘, æˆ–è€…åŸºäºè¿™äº›é»˜è®¤é€‰é¡¹è¿›è¡Œæ”¹åŠ¨ï¼Œä¿å­˜ä¸ºè‡ªå·±çš„é…ç½®é¡¹æ–‡ä»¶(defconfig) é€‰é¡¹ä¹‹é—´å¯ä»¥å»ºç«‹ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼Œåªæœ‰ A å¯ç”¨æ—¶ï¼ŒBCD é€‰é¡¹æ‰æœ‰æ„ä¹‰ã€‚å¯¹æ­¤ Kconfig æä¾›äº†ä¸€å¥—ç®€å•ä¸Šæ‰‹çš„ç¼–è¾‘è¯­è¨€  Kconfig çš„ä½¿ç”¨å¿…é¡»é…åˆ Makefile è¿›è¡Œï¼Œåº”è¯¥è¯´ï¼ŒKconfig ä¸ Makefile ç»“åˆæ˜¯ç®€åŒ–äº† Kconfig çš„ä½¿ç”¨æ­¥éª¤ã€‚\nKconfig çš„ä½¿ç”¨æ–¹æ³• æˆ‘ä»¬å¸¸ç”¨çš„åŠŸèƒ½å¤§æ¦‚åŒ…æ‹¬ï¼š\n ä½¿ç”¨ä¸€äº›é»˜è®¤é…ç½®æ–‡ä»¶æ¥æ„å»ºé¡¹ç›® è‡ªå®šä¹‰é…ç½®æ„å»ºé¡¹ç›® å°†æŸå¥—é…ç½®é€‰é¡¹ä¿å­˜ä¸‹æ¥ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨  åœ¨åˆ†åˆ«ä»‹ç»è¿™äº›åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ä¹‹å‰ï¼Œå…ˆå¾—è¯´æ˜è¿™äº› Kconfig ä¸­å„ç§é…ç½®æ–‡ä»¶çš„ç”¨é€”äº†ï¼Œè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„ã€‚\n Kconfig: Kconfig ä¸ä»…åœ¨æ ¹ç›®å½•ï¼Œè¿˜å¯èƒ½å­˜åœ¨äºå„çº§å­ç›®å½•ä¸‹ã€‚é‡Œé¢çš„å†…å®¹æ˜¯æ•´ä¸ª Kconfig ç³»ç»Ÿçš„æ‰€æœ‰é…ç½®é¡¹ï¼Œä»¥åŠæ¯ä¸ªé…ç½®é¡¹çš„é»˜è®¤å€¼ã€æè¿°ç­‰ã€‚å¦‚æœæƒ³è¦æ·»åŠ ã€åˆ é™¤é…ç½®é¡¹ï¼Œéœ€è¦æ”¹åŠ¨è¿™ä¸ªæ–‡ä»¶ xxxdefconfig: xxx å¯ä»¥æ›¿æ¢ä¸ºä»»æ„å­—ç¬¦ï¼Œè¿™äº›éƒ½æ˜¯é»˜è®¤çš„é…ç½®é¡¹ï¼Œé€šå¸¸ç”±å¼€å‘äººå‘˜æä¾›ç»™ä½¿ç”¨è€… .config: è¿™ä¸ªæ–‡ä»¶å­˜åœ¨äºæ ¹ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å«ä»–å½“å‰é…ç½®ã€‚å¯ä»¥æŠŠä»–å½“ä¸ºæœåŠ¡ä¸ä¸€æ¬¡æ„å»ºçš„â€œä¸´æ—¶æ–‡ä»¶â€ï¼Œæ¯æ¬¡æ„å»ºéƒ½æ˜¯åŸºäºå½“å‰é…ç½®è¿›è¡Œçš„ autoconfig.h: ç”± Kconfig ç³»ç»Ÿæ ¹æ®å½“å‰æ„å»ºä½¿ç”¨çš„é…ç½®è‡ªåŠ¨ç”Ÿæˆçš„å¤´æ–‡ä»¶ï¼ŒC æºä»£ç å¯ä»¥é€šè¿‡å®ƒæ¥çŸ¥é“å½“å‰çš„é…ç½®æƒ…å†µ  å…¶å®å®ƒä»¬ä¹‹é—´çš„å…³ç³»ä¸æ˜¯é‚£ä¹ˆå¤æ‚ï¼Œåˆ°åº•æ˜¯è°æ ¹æ®è°ç”Ÿæˆçš„è°ï¼Œä¸‹é¢å°†è¦è¯´æ˜ã€‚\nä½¿ç”¨é»˜è®¤é…ç½®(xxxdefconfig) ä¸€èˆ¬æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ª SDKï¼Œå‚å•†ä¼šæä¾›ä¸€äº›é»˜è®¤çš„é…ç½®é¡¹ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚æˆ‘ä»¬çš„ä½¿ç”¨æ–¹æ³•ä¸€èˆ¬æ˜¯æ‰§è¡Œmake xxxdefconfigï¼Œmake ä¼šè°ƒç”¨ Kconfig ç¨‹åºæ¥è¯»å–è¿™ä¸ª defcofig æ–‡ä»¶ï¼Œç„¶åç”Ÿæˆå½“å‰é…ç½®ï¼ˆå³.configï¼‰\nxxxdefconfigä¸­çš„é…ç½®é¡¹æ˜¯éœ€è¦å’ŒKconfigæ–‡ä»¶é…åˆçš„ï¼Œå…¶ä¸­çš„å±æ€§å’Œå€¼éƒ½æ˜¯ Kconfig ä¸­æ”¯æŒçš„é…ç½®é¡¹ã€‚å¹¶ä¸”ï¼Œxxxdefconfig ä¸ä¼šè®°å½• Kconfig æ¯ä¸ªé¡¹ç›®çš„å€¼ï¼Œåªæ˜¯è®°å½•é‚£äº›éé»˜è®¤å€¼çš„å˜åŒ–ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†æ–‡ä»¶å¤§å°ã€‚\n ä»¥ä¸Šè¡Œä¸ºå¯ä»¥é€šè¿‡æ‰§è¡Œmake xxxdefconfigåï¼ŒæŸ¥çœ‹.configå’Œxxxdefconfigçš„æ–‡ä»¶å·®å¼‚æ¥éªŒè¯\n æ”¹å˜å½“å‰é…ç½® æ€»æ˜¯ä½¿ç”¨é»˜è®¤é…ç½®å¯ä¸è¡Œï¼Œé‚£ä¹ˆæ€ä¹ˆä¿®æ”¹å½“å‰é…ç½®å‘¢? ä¸€ç§æ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ˜¯ä¿®æ”¹defconfigæˆ–è€….configï¼Œå–å†³äºä½ æƒ³ä½ è¿™æ¬¡æ›´æ”¹æ°¸è¿œæœ‰æ•ˆï¼Œè¿˜æ˜¯åªæ˜¯è¿™æ¬¡ç¼–è¯‘æœ‰æ•ˆï¼Œå…¶å®ï¼Œæœ€å¥½ä¸è¦æ”¹åŠ¨å‚å•†ç»™çš„é»˜è®¤é…ç½®ï¼Œä½ å¯ä»¥å¤åˆ¶ä¸€ä»½ï¼Œç„¶åè¿›è¡Œä¿®æ”¹ã€‚\nè¿™é‡Œè¦ä»‹ç»ä¸ Kconfig é…åˆä½¿ç”¨çš„å·¥å…·â€”â€”menuconfigï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº¤äº’å¼çš„é…ç½®èœå•ï¼Œæ¯”é¢å¯¹ Kconfig çš„è¯­è¨€æ¥ä¿®æ”¹é…ç½®æ›´åŠ æ–¹ä¾¿ã€‚å¯ä»¥æŠŠ menuconfig ç†è§£ä¸º Kconfig çš„ä¸€ä¸ªå‰ç«¯ã€‚\nmenuconfig çš„ä½¿ç”¨æ–¹å¼æ˜¯æ‰§è¡Œmake menuconfig, å®ƒä¼šåŠ è½½å½“å‰é…ç½®çš„å†…å®¹ï¼ˆæˆ–è€…æ˜¯ Kconfig ä¸­å®šä¹‰çš„é»˜è®¤å€¼ï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå›¾å½¢åŒ–çš„èœå•ï¼Œä¿®æ”¹åè¿˜æ˜¯ä¿å­˜ä¸º.configã€‚æ¯æ¬¡æ„å»ºéƒ½æ˜¯ä½¿ç”¨æœ€æ–°çš„å½“å‰é…ç½®ï¼Œå°±è¾¾åˆ°äº†ä¸´æ—¶ä¿®æ”¹é…ç½®çš„æ•ˆæœäº†ã€‚è¿™ä¸æ¯”ç›´æ¥ä¿®æ”¹.configæ–¹ä¾¿å¤šäº†ï¼Ÿ\nä¿å­˜å½“å‰é…ç½® æœ‰æ—¶ï¼Œæˆ‘ä»¬å‘ç°å½“å‰è¿™ä¸ªé…ç½®å¾ˆå¥½ï¼Œæƒ³è¦å°†å…¶ä¿å­˜ä¸ºæ–°çš„defconfigæ–‡ä»¶ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡éƒ½ä¿®æ”¹å½“å‰é…ç½®äº†ã€‚Kconfig å½“ç„¶ä¹Ÿæ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå«åšsavedefconfigã€‚\nä½¿ç”¨çš„æ–¹æ³•æ˜¯:make savedefconfigï¼Œ ä¼šå°†å½“å‰é…ç½®(.config)ä¸­çš„å†…å®¹æå–ä¸ºä¸€ä¸ª defconfig çš„æ–‡ä»¶ï¼Œä¿å­˜çš„ä½ç½®å–å†³äº Kconfig çš„é…ç½®ï¼ˆä¸€èˆ¬æ˜¯conf.cçš„æºç ä¸­ï¼‰ï¼Œæˆ‘ä»¬å¯¹ä»–æ”¹ä¸ªåå­—å°±æˆä¸ºè‡ªå·±çš„é…ç½®äº†ã€‚ä¸‹æ¬¡æ‰§è¡Œmake xxxdefconfig å³å¯å¥—ç”¨è¿™ä¸€å¥—é…ç½®\nå…¶ä»–çš„åŠŸèƒ½\u0026hellip; Kconfig æä¾›çš„åŠŸèƒ½å¾ˆå¤šï¼ŒåŒ…æ‹¬ï¼šä¸€é”®å¯ç”¨æ‰€æœ‰çš„é…ç½®é€‰é¡¹ã€æœ€å°çš„æ„å»ºé€‰é¡¹ç­‰ç­‰ï¼Œä½†æ˜¯ä¸å¸¸ç”¨å°±ä¸ä»‹ç»äº†ã€‚\nKconfig ç³»ç»Ÿçš„å·¥ä½œåŸç† ä¸Šé¢è¯´é“ï¼ŒKconfig çš„ä½¿ç”¨æ˜¯éœ€è¦é…åˆä¿®æ”¹ Makefile çš„ï¼Œåœ¨ Makefile ä¼šå¢åŠ å‡ ä¸ªç›®æ ‡: %defconfig, savedefconfig, menuconfigã€‚ å®ƒä»¬å‘ä¸Šç»™ç”¨æˆ·æä¾›é€‰é¡¹ï¼Œå‘ä¸‹è°ƒç”¨ Kconfig ç³»ç»Ÿçš„åŠŸèƒ½æ¥å£ã€‚\nKconfig ç³»ç»Ÿä¸»è¦ä»»åŠ¡æ˜¯ç”±confç¨‹åºå®Œæˆï¼Œå®ƒæ˜¯ä¸€ä¸ª host ç¨‹åºï¼Œè´Ÿè´£è§£æ Kconfigï¼Œdefconfig ç­‰æ–‡ä»¶çš„å†…å®¹ï¼Œå®ŒæˆåŠŸèƒ½çš„å®ç°ã€‚è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç¨‹åºæ˜¯mconfï¼Œå®ƒè´Ÿè´£å®ç° menuconfig çš„åŠŸèƒ½ã€‚\n","date":"2023-03-28T16:15:03+08:00","permalink":"https://wangloo.github.io/posts/os/linux/kconfig/","section":"posts","tags":null,"title":"Linux Kconfig æ¦‚è¿°"},{"categories":["C Language"],"contents":"æšä¸¾ç±»å‹çš„ä¼˜åŠ¿ æšä¸¾ç±»å‹å®Œå…¨å¯è¢«å®å®šä¹‰æ›¿ä»£ï¼Œç±»å¦‚\n1enum Furniture { 2\tDOOR = 1, 3\tDESK, 4\tLOCK, 5} ä¸ä¸‹é¢çš„ä»£ç ç­‰æ•ˆ\n1#define DOOR 1 2#define DESK 2 3#define LOCK 3 é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨ä¸¤ç§è®¾è®¡æ–¹æ³•ä¸­é€‰æ‹©å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ enum ä¼šæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n æé«˜ä»£ç é”®å…¥æ•ˆç‡ï¼›ä»…é€‚ç”¨äºæ‰€éœ€å˜é‡çš„å€¼æ˜¯è¿ç»­çš„æ•´æ•°ï¼Œå°±åƒä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥åªç»™ç¬¬ä¸€ä¸ª DOOR èµ‹å€¼ï¼Œå…¶ä½™çš„å€¼ç´¯åŠ ã€‚å¦‚æœé¦–ä¸ªå˜é‡çš„å€¼è¦æ±‚æ˜¯ 0ï¼Œç”šè‡³æ¯ä¸€ä¸ªéƒ½æ— éœ€æ˜¾å¼èµ‹å€¼ æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼›å¯ä»¥åˆ’å®šèŒƒå›´ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šæ£€æŸ¥ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œå¶å°”ä¼šæœ‰ç”¨ æé«˜ä»£ç çš„å¯è¯»æ€§ï¼›ä¾‹å¦‚ DOOR, DESK, LOCK\u0026hellip; éƒ½å±äºå®¶å…·ï¼Œå‡å®šä¹‰åœ¨ Furniture ä¸­  æšä¸¾ç±»å‹æ‰€å çš„å¤§å° æšä¸¾ç±»å‹æ‰€å å†…å­˜çš„å¤§å°ï¼Œå³æšä¸¾å˜é‡çš„å¤§å°ã€‚\nç”±äºæšä¸¾å˜é‡çš„èµ‹å€¼ï¼Œä¸€æ¬¡åªèƒ½å­˜æ”¾æšä¸¾ç»“æ„ä¸­çš„æŸä¸ªå¸¸æ•°ã€‚æ‰€ä»¥ æšä¸¾å˜é‡çš„å¤§å°ï¼Œå®è´¨æ˜¯å¸¸æ•°æ‰€å å†…å­˜ç©ºé—´çš„å¤§å°ï¼ˆå¸¸æ•°ä¸º int ç±»å‹ï¼Œå½“å‰ä¸»æµçš„ç¼–è¯‘å™¨ä¸­ä¸€èˆ¬æ˜¯ 32 ä½æœºå™¨å’Œ 64 ä½æœºå™¨ä¸­ int å‹éƒ½æ˜¯ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œæšä¸¾ç±»å‹æ‰€å å†…å­˜å¤§å°ä¹Ÿæ˜¯è¿™æ ·ã€‚\næ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— è®ºæšä¸¾å˜é‡çš„å€¼æ˜¯å¤šå°‘ï¼Œéƒ½æ˜¯å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚å³æ‰§è¡Œï¼š\n1printf(\u0026#34;sizeof(enum Furniture) = %d\\n\u0026#34;, sizeof(enum Furniture)); è¾“å…¥çš„ç»“æœæ˜¯ 4ã€‚\nç¼–è¯‘é€‰é¡¹ï¼š-fshort-enums GCC ä¸‹å…³äºè¿™ä¸ªç¼–è¯‘é€‰é¡¹çš„ä»‹ç»ï¼š\n -fshort-enums Allocate to an enum type only as many bytes as it needs for the declared range of possible values. Specifically, the enum type is equivalent to the smallest integer type that has enough room. Warning: the -fshort-enums switch causes GCC to generate code that is not binary compatible with code generated without that switch. Use it to conform to a non-default application binary interface.\n æ„æ€æ˜¯è¯´ä½¿ç”¨-fshort-enums åï¼Œå¯¹æ”¹æšä¸¾ç±»å‹æ‰€å ç©ºé—´çš„åˆ†é…å°±ä¼šæŒ‰ç…§å®é™…å˜é‡çš„å ç”¨ç©ºé—´ï¼Œè€Œéæ€»æ˜¯ 4 å­—èŠ‚ã€‚\nå¯ç”¨è¯¥é€‰é¡¹ä¹‹åï¼Œå†æ‰“å°å®ƒçš„ size å°±ä¼šæ˜¯ 1ï¼Œå› ä¸ºç”¨ 1 ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤ºæ‰€æœ‰æšä¸¾å˜é‡çš„å€¼ï¼ˆDOOR=1ï¼ŒDESK=2ï¼ŒLOCK=3ï¼‰.\nè¿™ä¸ªâ€œ1â€ä¸å†æ˜¯å›ºå®šçš„ï¼Œæ ¹æ®å…¶ä¸­æšä¸¾å˜é‡å€¼çš„ä¸åŒï¼ŒåŠ¨æ€è°ƒæ•´enum Furnitureçš„å¤§å°ã€‚\n1enum Furniture { 2\tDOOR = 256, 3\tDESK, 4\tLOCK, 5} å†æ‰“å°å®ƒçš„ sizeï¼Œç»“æœä¸º 2ã€‚å› ä¸ºå€¼ 256 æ— æ³•ç”¨ 1 ä¸ªå­—èŠ‚å­˜ä¸‹ã€‚\nenum æ½œåœ¨çš„å¯ç§»æ¤æ€§é—®é¢˜ çœ‹ä¼¼å¥½åƒå¯ç”¨è¯¥é€‰é¡¹ä¼šèŠ‚çº¦ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œæ˜¯çš„ã€‚ä½†å®ƒä¹Ÿæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼Œå…¶ä¸€å°±æ˜¯å¯ç§»æ¤æ€§é—®é¢˜ã€‚\nä¾‹å¦‚ä½ ç¼–å†™çš„åº”ç”¨åœ¨ç¼–è¯‘æ—¶æ²¡æœ‰å¯ç”¨äº†è¯¥â€œä¼˜åŒ–â€é€‰é¡¹ï¼Œé»˜è®¤é‡‡ç”¨ 4 å­—èŠ‚å­˜å‚¨æšä¸¾å˜é‡ã€‚è€Œé“¾æ¥çš„åº“æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶å´ä½¿ç”¨äº†â€œä¼˜åŒ–â€é€‰é¡¹ï¼Œåˆ™åº“å†…éƒ¨æ­¤æšä¸¾ç±»å‹çš„å¤§å°å¯èƒ½ä¸º 1 å­—èŠ‚ã€‚è‹¥æ­¤æ—¶æ°å¥½ä½ æœ‰è°ƒç”¨æŸä¸ªåº“ APIï¼Œå°† enum å˜é‡ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚\nä¸ºé¿å…ä¸åŒåº“å’Œåº”ç”¨ç¨‹åºä½¿ç”¨â€œä¼˜åŒ–â€é€‰é¡¹çš„å·®å¼‚é€ æˆæ½œåœ¨çš„å±é™©ï¼Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯å¼ºåˆ¶ä½¿ enum å˜é‡å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œæ— è®ºå…¶æ˜¯å¦å¼€å¯â€œä¼˜åŒ–â€ã€‚å®ç°æ–¹å¼æ˜¯åœ¨ enum å˜é‡æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆå‘˜ XXXX_END = 0xFFFFFï¼Œä¾‹å¦‚ï¼š\n1enum Furniture { 2 DOOR = 1, 3 DESK, 4 LOCK, 5 END = 0xFFFFF, 6} ","date":"2023-03-09T17:18:57+08:00","permalink":"https://wangloo.github.io/posts/c/enum/","section":"posts","tags":["c"],"title":"C è¯­è¨€enumçš„ä½¿ç”¨"},{"categories":["C Language"],"contents":"å‡½æ•°æŒ‡é’ˆ æŒ‡é’ˆçš„æ•°ç»„ or æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ? 1\u0026gt;\u0026gt; int (*p)[10] pæ˜¯æŒ‡é’ˆ, æŒ‡å‘é•¿åº¦ä¸º10çš„æ•°ç»„. åŠ æ‹¬å·æ˜¯ä¸ºäº†å¼ºè°ƒpæ˜¯ä¸€ä¸ªæŒ‡é’ˆ, åŒºåˆ«åŒ…å«10ä¸ªæŒ‡é’ˆçš„array. 2\u0026gt;\u0026gt; int *(p[10]) pæ˜¯æ•°ç»„, å®ƒçš„å…ƒç´ ç±»å‹æ˜¯int *, åŠ æ‹¬å·æ˜¯ä¸ºäº†å¼ºè°ƒpæ˜¯æ•°ç»„. 3\u0026gt;\u0026gt; int *p[10] ç­‰æ•ˆäºint *(p[10]) ç¨‹åºçš„å†…å­˜åˆ†å¸ƒ æˆ‘ä»¬å†™çš„é«˜çº§è¯­è¨€ä»£ç æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶è¢«æ“ä½œç³»ç»ŸåŠ è½½ã€æ‰§è¡Œã€‚ ELFæ–‡ä»¶æ˜¯ç”±ä¸€ä¸ªä¸ªsectionç»„æˆçš„ï¼Œé‚£ä¹ˆç¨‹åºé‡Œçš„å˜é‡ã€æŒ‡ä»¤éƒ½æ˜¯å¦‚ä½•æ’å¸ƒçš„å‘¢ï¼Ÿ\n   åœ°å€ç©ºé—´å„éƒ¨åˆ† å†…å®¹ æ˜¯å¦ä¸å¯æ‰§è¡Œæ–‡ä»¶ç›¸å¯¹åº”     ä»£ç æ®µ æ‰€æœ‰çš„å¯æ‰§è¡Œä»£ç , å±æ€§ä¸€èˆ¬ä¸ºåªè¯» æ˜¯, åŠ è½½æ—¶ç›´æ¥æ˜ å°„   æ•°æ®æ®µ åˆå§‹åŒ–é0çš„å…¨å±€å˜é‡å’Œå±€éƒ¨staticå˜é‡ æ˜¯, åŠ è½½æ—¶ç›´æ¥æ˜ å°„   bssæ®µ æœªåˆå§‹åŒ–æˆ–åˆå§‹åŒ–0çš„å…¨å±€å˜é‡å’Œå±€éƒ¨staticå˜é‡ æ˜¯, åŠ è½½æ—¶éœ€è¦æ¸…ç©º   æ ˆ å±€éƒ¨å˜é‡, å‚æ•°ä¼ é€’ç­‰ æ— , OSåˆ†é…ç©ºé—´, ç¼–è¯‘å™¨ç»´æŠ¤   å † åŠ¨æ€ç”³è¯·çš„ç©ºé—´ æ— , OSåˆ†é…ç©ºé—´   å¸¸é‡åŒº å®šä¹‰çš„å¸¸é‡å­—ç¬¦ä¸²ç­‰ æ˜¯, æœ‰æ—¶å’Œä»£ç æ®µåˆå¹¶åˆ°ä¸€èµ·     æœ‰çš„äººå–œæ¬¢è¯´â€œé™æ€åŒºâ€è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä¹Ÿä¸€ç›´è¢«å¿½æ‚ ä¸ç†è§£ä»€ä¹ˆå«é™æ€åŒºã€‚å®é™…ä¸Šå°±æ˜¯è¡¨ç¤º å­˜å‚¨å‡½æ•°å†…éƒ¨staticå˜é‡çš„åŒºåŸŸï¼Œæœ¬è´¨ä¸Šå±äºæ•°æ®æ®µçš„ä¸€éƒ¨åˆ†ã€‚\n  staticå£°æ˜çš„å…¨å±€å˜é‡ï¼Œå¯¹äºç¼–è¯‘å™¨æ¥è¯´æœ‰ä»€ä¹ˆåŒºåˆ«å¯¹å¾…?\né™¤äº†é¢„ç¼–è¯‘æ—¶ä¸ä¼šå»ºç«‹ç¬¦å·å¤–æ²¡æœ‰åŒºåˆ«ã€‚\n  å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡å¯ä»¥é‡åå—ï¼Ÿ\nå¯ä»¥é‡åã€‚å› ä¸ºå±€éƒ¨å˜é‡ç”¨æ ˆæ¥ç›¸å¯¹ç´¢å¼•å°±å¯ä»¥ï¼Œä¸éœ€è¦ç¬¦å·ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿå†²çªã€‚ è€Œå…¨å±€å˜é‡éƒ½æ˜¯ç”¨ç¬¦å·æ¥ç´¢å¼•çš„ã€‚é»˜è®¤è®¿é—®çš„æ˜¯å±€éƒ¨å˜é‡ï¼Œå¦‚æœå¸Œæœ›è®¿é—®å…¨å±€å˜é‡ï¼Œ éœ€è¦ä½¿ç”¨::val += 1;çš„è¯­æ³•ã€‚\n çµæ´»æ•°ç»„æˆå‘˜ Flexiable Array Member  C99æ”¯æŒçš„ç‰¹æ€§ï¼Œç›®çš„æ˜¯ä¸ºäº†èŠ‚çº¦ç©ºé—´ï¼ˆçµæ´»æ•°ç»„æˆå‘˜æœ¬èº«ä¸å ç©ºé—´ï¼Œè§ä¸‹è¾“å‡ºï¼‰ ä½¿ç”¨çµæ´»æˆå‘˜å¯ä»¥ç”¨äºå®ç°stringç»“æ„ï¼Œé•¿åº¦åŠ¨æ€åˆ†é… çµæ´»æˆå‘˜å¿…é¡»æ˜¯ç»“æ„çš„æœ€åä¸€ä¸ªæˆå‘˜ï¼Œä¸”æ­¤ç»“æ„ä½“ä¸èƒ½åªåŒ…å«ä¸€ä¸ªçµæ´»æˆå‘˜ï¼ˆæœ€å°‘ä¿©ï¼‰ ä½¿ç”¨äº†çµæ´»æˆå‘˜åï¼Œå°±ä¸èƒ½ç”¨ç»“æ„ä½“ä¹‹é—´ç›´æ¥\u0026quot;=\u0026ldquo;èµ‹å€¼äº†ï¼Œæ”¹ç”¨memcpy() å«æœ‰çµæ´»æˆå‘˜çš„ç»“æ„ä½“ä¸èƒ½åµŒå…¥å…¶ä»–ç»“æ„ä½“ä¸­  1#include \u0026lt;stdio.h\u0026gt;2#include \u0026lt;stdlib.h\u0026gt;3 4struct st { 5 int memb1; 6 int memb2; 7 int memb3[]; // flexiable array member 8}; 9 10int main(void) 11{ 12 13 printf(\u0026#34;sizeof struct st: %ld\\n\u0026#34;, sizeof(struct st)); 14 15 /* instantiate */ 16 struct st *st1; // åªèƒ½åŠ¨æ€åˆ†é… 17 int memb3_len = 10; 18 19 st1 = malloc(sizeof(struct st) + memb3_len*sizeof(int)); 20 21 /* use */ 22 for (int i = 0; i \u0026lt; memb3_len; i++) 23 st1-\u0026gt;memb3[i] = i; 24 25 for (int i = 0; i \u0026lt; memb3_len; i++) 26 printf(\u0026#34;st1-\u0026gt;mem3[%d] = %d\\n\u0026#34;, i, st1-\u0026gt;memb3[i]); 27 28 29 free(st1); 30 return 0; 31} è¾“å‡ºç»“æœ:\n1sizeof struct st: 8 2st1-\u0026gt;mem3[0] = 0 3st1-\u0026gt;mem3[1] = 1 4st1-\u0026gt;mem3[2] = 2 5st1-\u0026gt;mem3[3] = 3 6st1-\u0026gt;mem3[4] = 4 7st1-\u0026gt;mem3[5] = 5 8st1-\u0026gt;mem3[6] = 6 9st1-\u0026gt;mem3[7] = 7 10st1-\u0026gt;mem3[8] = 8 11st1-\u0026gt;mem3[9] = 9 åŸºç¡€æ¶æ„ 1// å‡½æ•°æŒ‡é’ˆ 2\u0026gt;\u0026gt; int (*f)(int) è¯´æ˜fæ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ, åŠ æ‹¬å·ä¸ºäº†åŒºåˆ«è¿”å›å€¼ä¸ºint*çš„å‡½æ•° 3\u0026gt;\u0026gt; f = function; å‡½æ•°æŒ‡é’ˆçš„èµ‹å€¼ 4\u0026gt;\u0026gt; (*f)(x) å‡½æ•°æŒ‡é’ˆæŒ‡å‘å‡½æ•°çš„è°ƒç”¨, å¯ç®€åŒ–ä¸ºf(x). ä½†æ˜¯å®¹æ˜“å°†fè¯¯è®¤ä¸ºæ˜¯å‡½æ•°. 5 6// å‡½æ•°æŒ‡é’ˆçš„æ•°ç»„ 7\u0026gt;\u0026gt; int (*(f[10])) (int) fæ˜¯æ•°ç»„,å…ƒç´ ä¸º10ä¸ªå‡½æ•°æŒ‡é’ˆ. å†…å±‚æ‹¬å·è¯´æ˜fæ˜¯æ•°ç»„,å¤–å±‚æ‹¬å·è¯´æ˜å…ƒç´ ç±»å‹æ˜¯å‡½æ•°æŒ‡é’ˆ 8\u0026gt;\u0026gt; int (*f[10]) (int) ä¸ä¸Šé¢ç­‰æ•ˆ. ä½†å¤–å±‚æ‹¬å·ä¸èƒ½çœç•¥ 9\u0026gt;\u0026gt; f[0] = function() èµ‹å€¼ 10\u0026gt;\u0026gt; (*f[0])() æŒ‡å‘å‡½æ•°çš„è°ƒç”¨, å¯ç®€åŒ–ä¸ºf[0]() 11 12// è¿”å›å‡½æ•°æŒ‡é’ˆçš„å‡½æ•° 13\u0026gt;\u0026gt; void (*signal(int sig, ...))(int); signalæ˜¯ä¸€ä¸ªå‡½æ•°, å‚æ•°æœ‰sig.... å®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ, æŒ‡å‘ä»»æ„è¿”å›å€¼ä¸ºvoid, å‚æ•°ä¸ºintçš„å‡½æ•°. typedefå¸®åŠ©ç†è§£å‡½æ•°æŒ‡é’ˆ signal()æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨, ç”¨äºå‘Šè¯‰ç³»ç»Ÿ, å½“æŸç§ç‰¹å®š\u0026quot;è½¯ä»¶ä¸­æ–­\u0026quot;å‘ç”Ÿæ—¶è°ƒç”¨ç‰¹å®šçš„ç¨‹åº. å®ƒçš„çœŸæ­£åç§°åº”å½“æ˜¯: Call that routine when the interrupt comes in.\nçœ‹signal()çš„åŸå‹, éå¸¸å¤æ‚. æ ¹æ®ä¸Šé¢åŸºç¡€æ¶æ„çš„é“ºå«, å¯ä»¥çœ‹å‡ºsignal()çš„è¿”å›å€¼æ˜¯å‡½æ•°æŒ‡é’ˆ, åŒæ—¶å®ƒçš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ. ä¸”è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆæ‰€æŒ‡å‘å‡½æ•°çš„è¿”å›å€¼å’Œå‚æ•°ç›¸åŒ.\n1void (*signal(int sig, void(*func)(int)))(int); å¯ä»¥å€Ÿç”¨typedefè¡¨ç¤ºé€šç”¨éƒ¨åˆ†.\n1typedef void (*sighandler_t)(int); è€Œåsignalçš„å£°æ˜å°±æ˜¯äººèƒ½çœ‹æ‡‚çš„äº†:\n1sighandler_t signal(int signum, sighandler_t handler); Cè¯­è¨€æ ‡å‡† æˆ‘ä»¬åœ¨ä½¿ç”¨Cè¯­è¨€ç¼–ç¨‹æ—¶å¾ˆå°‘æœ‰äººå‘Šè¯‰æˆ‘ä»¬Cè¯­è¨€å„ä¸ªæ ‡å‡†çš„æƒ…å†µï¼Œäºæ˜¯æˆ‘ä»¬åœ¨çœ‹è§ä¸€äº›å‡½æ•°æ ‡å®šæ”¯æŒçš„Cæ ‡å‡†ï¼ˆä¾‹å¦‚ä»…æ”¯æŒC99åŠä»¥åï¼‰ï¼Œå†…å¿ƒä¸ä¼šæœ‰ä»€ä¹ˆæ³¢æ¾œã€‚\næˆ‘ä»¬å¸¸è§è¿™äº›Cæ ‡å‡†ï¼šK\u0026amp;R Cã€ANSI Cã€ISO Cã€C89ã€C99ã€C11ã€C18ã€‚è®©æˆ‘ä»¬è¡¥å……ç‚¹å¯èƒ½å¾ˆå°‘ä½¿ç”¨çš„çŸ¥è¯†å§ã€‚\nä»€ä¹ˆæ˜¯K\u0026amp;R Cï¼Ÿ 1978å¹´ï¼Œä¸¹å°¼æ–¯â€¢é‡Œå¥‡ï¼ˆDennis Ritchieï¼‰å’Œå¸ƒè±æ©â€¢æŸ¯æ—æ±‰ï¼ˆBrian ernighanï¼‰åˆä½œå‡ºç‰ˆäº†ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€ã€‹çš„ç¬¬ä¸€ç‰ˆã€‚ä¹¦ä¸­ä»‹ç»çš„Cè¯­è¨€æ ‡å‡†ä¹Ÿè¢«ç§°ä½œâ€œK\u0026amp;R Câ€ã€‚\næœ€åˆçš„Cæ ‡å‡†ä¸æˆ‘ä»¬ç°åœ¨ç”¨çš„æœ‰è¾ƒå¤§å·®åˆ«ï¼Œä¾‹å¦‚å®ƒç«Ÿç„¶è¿˜ä¸æ”¯æŒvoidç±»å‹ï¼\nä»€ä¹ˆæ˜¯ANSI Cã€ISO Cã€C89ã€C90æ ‡å‡†ï¼Ÿ éšç€Cè¯­è¨€ä½¿ç”¨å¾—è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå‡ºç°äº†è®¸å¤šæ–°é—®é¢˜ï¼Œäººä»¬æ—¥ç›Šå¼ºçƒˆåœ°è¦æ±‚å¯¹Cè¯­è¨€è¿›è¡Œæ ‡å‡†åŒ–ã€‚1983å¹´ï¼Œç¾å›½å›½å®¶æ ‡å‡†åä¼šï¼ˆANSIï¼‰ç»„æˆäº†ä¸€ä¸ªå§”å‘˜ä¼šï¼ŒX3J11ï¼Œä¸ºäº†åˆ›ç«‹ C çš„ä¸€å¥—æ ‡å‡†ã€‚ç»è¿‡æ¼«é•¿è€Œè‰°è‹¦çš„è¿‡ç¨‹ï¼Œè¯¥æ ‡å‡†äº1989å¹´å®Œæˆï¼Œè¿™ä¸ªç‰ˆæœ¬çš„è¯­è¨€ç»å¸¸è¢«ç§°ä½œANSI Cï¼Œæˆ–æœ‰æ—¶ç§°ä¸ºC89ï¼ˆä¸ºäº†åŒºåˆ«C99ï¼‰ã€‚åœ¨1990å¹´ï¼ŒANSI Cæ ‡å‡†ï¼ˆå¸¦æœ‰ä¸€äº›å°æ”¹åŠ¨ï¼‰è¢«ç¾å›½å›½å®¶æ ‡å‡†åä¼šï¼ˆANSIï¼‰é‡‡çº³ä¸ºISO/IEC 9899:1990ã€‚è¿™ä¸ªç‰ˆæœ¬æœ‰æ—¶å€™ç§°ä¸ºC90æˆ–è€…ISO Cã€‚ç»¼ä¸Šï¼ŒANSI Cã€ISO Cã€C89ã€C90å…¶å®æ˜¯åŒä¸€ç§æ ‡å‡†ã€‚\nè¿™ä¸€ç‰ˆæœ¬çš„Cå°±æ›´æ¥è¿‘æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„Cäº†ï¼Œå¤§éƒ¨åˆ†ç‰¹æ€§éƒ½å¼•å…¥äº†ã€‚\nä»€ä¹ˆæ˜¯C99æ ‡å‡†ï¼Ÿ 2000å¹´3æœˆï¼ŒANSI é‡‡çº³äº† ISO/IEC 9899:1999 æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†é€šå¸¸æŒ‡C99ã€‚\nC99æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ–°ç‰¹æ€§æ˜¯ï¼šåœ¨æºä»£ç çš„ä¸­é—´ä½ç½®å£°æ˜å˜é‡ã€‚\nä»€ä¹ˆæ˜¯C11æ ‡å‡†ï¼Ÿ C11æ ‡å‡†æ˜¯Cè¯­è¨€æ ‡å‡†çš„ç¬¬ä¸‰ç‰ˆï¼ˆ2011å¹´ç”±ISO/IECå‘å¸ƒï¼‰ï¼Œå‰ä¸€ä¸ªæ ‡å‡†ç‰ˆæœ¬æ˜¯C99æ ‡å‡†ã€‚ä¸C99ç›¸æ¯”ï¼ŒC11æœ‰å“ªäº›å˜åŒ–å‘¢ï¼Ÿ\n11ã€ å¯¹é½å¤„ç†ï¼šalignof(T)è¿”å›Tçš„å¯¹é½æ–¹å¼ï¼Œaligned_alloc()ä»¥æŒ‡å®šå­—èŠ‚å’Œå¯¹é½æ–¹å¼åˆ†é…å†…å­˜ï¼Œå¤´æ–‡ä»¶\u0026lt;stdalign.h\u0026gt;å®šä¹‰äº†è¿™äº›å†…å®¹ã€‚ 22ã€ _Noreturnï¼š_Noreturn æ˜¯ä¸ªå‡½æ•°ä¿®é¥°ç¬¦ï¼Œä½ç½®åœ¨å‡½æ•°è¿”å›ç±»å‹çš„å‰é¢ï¼Œå£°æ˜å‡½æ•°æ— è¿”å›å€¼ï¼Œæœ‰ç‚¹ç±»ä¼¼äºgccçš„__attribute__((noreturn))ï¼Œåè€…åœ¨å£°æ˜è¯­å¥å°¾éƒ¨ã€‚ 33ã€ _Genericï¼š_Genericæ”¯æŒè½»é‡çº§èŒƒå‹ç¼–ç¨‹ï¼Œå¯ä»¥æŠŠä¸€ç»„å…·æœ‰ä¸åŒç±»å‹è€Œå´æœ‰ç›¸åŒåŠŸèƒ½çš„å‡½æ•°æŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£ã€‚ 44ã€ _Static_assert()ï¼š_Static_assert()ï¼Œé™æ€æ–­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ»è¿›è¡Œï¼Œæ–­è¨€è¡¨è¾¾å¼å¿…é¡»æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå¯ä»¥è®¡ç®—çš„è¡¨è¾¾å¼ï¼Œè€Œæ™®é€šçš„assert()åœ¨è¿è¡Œæ—¶åˆ»æ–­è¨€ã€‚ 55ã€å®‰å…¨ç‰ˆæœ¬çš„å‡ ä¸ªå‡½æ•°ï¼šgets_s()å–ä»£äº†gets()ï¼ŒåŸå› æ˜¯åè€…è¿™ä¸ªI/Oå‡½æ•°çš„å®é™…ç¼“å†²åŒºå¤§å°ä¸ç¡®å®šï¼Œä»¥è‡³äºå‘ç”Ÿå¸¸è§çš„ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Œç±»ä¼¼çš„å‡½æ•°è¿˜æœ‰å…¶å®ƒçš„ã€‚ 66ã€ fopen()æ–°æ¨¡å¼ï¼šfopen()å¢åŠ äº†æ–°çš„åˆ›å»ºã€æ‰“å¼€æ¨¡å¼â€œxâ€ï¼Œåœ¨æ–‡ä»¶é”ä¸­æ¯”è¾ƒå¸¸ç”¨ã€‚ 77ã€ åŒ¿åç»“æ„ä½“ã€è”åˆä½“ã€‚ 88ã€ å¤šçº¿ç¨‹ï¼šå¤´æ–‡ä»¶\u0026lt;threads.h\u0026gt;å®šä¹‰äº†åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹çš„å‡½æ•°ï¼Œæ–°çš„å­˜å‚¨ç±»ä¿®é¥°ç¬¦_Thread_localé™å®šäº†å˜é‡ä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚ 99ã€ _Atomicç±»å‹ä¿®é¥°ç¬¦å’Œå¤´æ–‡ä»¶\u0026lt;stdatomic.h\u0026gt;ã€‚ 1010ã€æ”¹è¿›çš„Unicodeæ”¯æŒå’Œå¤´æ–‡ä»¶\u0026lt;uchar.h\u0026gt;ã€‚ 1111ã€quick_exit()ï¼šåˆä¸€ç§ç»ˆæ­¢ç¨‹åºçš„æ–¹å¼ï¼Œå½“exit()å¤±è´¥æ—¶ç”¨ä»¥ç»ˆæ­¢ç¨‹åºã€‚ 1212ã€å¤æ•°å®ï¼Œæµ®ç‚¹æ•°å®ã€‚ 1313ã€time.hæ–°å¢timespecç»“æ„ä½“ï¼Œæ—¶é—´å•ä½ä¸ºçº³ç§’ï¼ŒåŸæ¥çš„timevalç»“æ„ä½“æ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚ ä»€ä¹ˆæ˜¯C18æ ‡å‡†ï¼Ÿ C18ä¹Ÿç§°C17æ˜¯äº2018å¹´6æœˆå‘å¸ƒçš„ ISO/IEC 9899:2018 çš„éæ­£å¼åç§°ï¼Œä¹Ÿæ˜¯ç›®å‰ï¼ˆæˆªæ­¢åˆ°2020å¹´6æœˆï¼‰ä¸ºæ­¢æœ€æ–°çš„ Cè¯­è¨€ç¼–ç¨‹æ ‡å‡†ï¼Œè¢«ç”¨æ¥æ›¿ä»£ C11 æ ‡å‡†ã€‚\nC17 æ²¡æœ‰å¼•å…¥æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œåªå¯¹ C11 è¿›è¡Œäº†è¡¥å……å’Œä¿®æ­£ã€‚\nâ€‹\nå¦‚ä½•æŸ¥çœ‹è‡ªå·±ç¨‹åºçš„Cæ ‡å‡†ç‰ˆæœ¬ï¼Ÿ ä½¿ç”¨å®__STDC_VERSION__å¯ä»¥è¾“å‡ºå½“å‰ä½¿ç”¨çš„Cæ ‡å‡†ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªé•¿æ•´å‹ï¼š\n1printf(\u0026#34;C std version:%ld\\n\u0026#34;, __STDC_VERSION__); å€¼ä¸æ ‡å‡†çš„å¯¹åº”å…³ç³»ï¼š\n   æ ‡å‡† å®     C94 _STDC_VERSION_= 199409L   C99 _STDC_VERSION_= 199901L   C11 _STDC_VERSION_= 201112L   C18 _STDC_VERSION_= 201710L    â€‹\nå¦‚ä½•æŒ‡å®šæŒ‰ç…§æŸä¸ªæ ‡å‡†æ‰§è¡Œç¼–è¯‘ï¼Ÿ ä»¥ä¸‹çš„ä»‹ç»åªé’ˆå¯¹GCCï¼Œæˆ‘æ²¡æœ‰ç”¨è¿‡åˆ«çš„ç¼–è¯‘å™¨ã€‚\nGCCä¸­å¯ä»¥æ·»åŠ --std=xxxæ¥æŒ‡å®šCæ ‡å‡†ç‰ˆæœ¬ï¼Œå¸¸ç”¨çš„æƒ…å†µå¦‚ä¸‹ï¼š\n1-std=c11 Conform to the ISO 2011 C standard 2-std=c89 Conform to the ISO 1990 C standard 3-std=c90 Conform to the ISO 1990 C standard 4-std=c99 Conform to the ISO 1999 C stand 5 6 7-std=gnu11 Conform to the ISO 2011 C standard with GNU extensions 8-std=gnu89 Conform to the ISO 1990 C standard with GNU extensions 9-std=gnu90 Conform to the ISO 1990 C standard with GNU extensions 10-std=gnu99 Conform to the ISO 1999 C standard with GNU extensions  é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ç”µè„‘ä¸Šçš„gcc 5.4.0ä½¿ç”¨-std-gnu11\n å‚è€ƒç›®å½• https://blog.csdn.net/zhengnianli/article/details/87387268\nC Dialect Options (Using the GNU Compiler Collection (GCC))\nå«ç³Šä¸æ¸…çš„ç¬¦å·æ‰©å±• é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ ä¸‹é¢ä¸€æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿ\n1char c = 0xff; 2 3if (c == 0xff) 4 printf(\u0026#34;successful\\n\u0026#34;); 5else 6 printf(\u0026#34;failed\\n\u0026#34;); ç­”æ¡ˆæ˜¯å–å†³äºä¸åŒçš„ç¼–è¯‘å™¨è®¾å®šï¼š\n å½“ç¼–è¯‘å™¨å°†charè¯†åˆ«ä¸ºsigned charæ—¶ï¼Œè¯¥åˆ¤æ–­ä¼šå¤±è´¥ã€‚å› ä¸ºå¸¸æ•°0xffè¢«è¯†åˆ«ä¸ºintç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨é¦–å…ˆè¦å¯¹cè¿›è¡Œç¬¦å·æ‰©å±•ï¼Œåˆ¤æ–­è¯­å¥c == 0xffæ­¤æ—¶ç­‰ä»·äº(int)c == 0xffã€‚è€Œå¯¹äºsigned charç±»å‹æ˜¯æ‰©å±•å…¶æœ€é«˜ä½ï¼Œå³(int)c=0xffffffffï¼Œifåˆ¤æ–­å¤±è´¥ã€‚ å½“ç¼–è¯‘å™¨å°†charè¯†åˆ«ä¸ºunsigned charæ—¶ï¼Œåˆ¤æ–­æˆåŠŸã€‚å¯¹äºunsigned charç±»å‹æ€»æ˜¯æ‰©å±•0ã€‚   æ³¨ï¼šgccå¯é€šè¿‡æ·»åŠ ç¼–è¯‘å‚æ•° -fsigned-char/ -funsigned-charæ¥æŒ‡å®šç¼–è¯‘å™¨å¦‚ä½•è¯†åˆ«char\n åŒæ ·çš„é—®é¢˜ä¹Ÿå­˜åœ¨ä¸ä½åŸŸ(bitfiled)ä¸­ï¼Œè¯¦è§-fsigned-bitfields/-funsigned-bitfieldså‚æ•°ã€‚\nå¦‚ä½•é¿å…ï¼Ÿ åœ¨ä½¿ç”¨charç±»å‹æ—¶ï¼Œæ ¹æ®æƒ…å†µå†™æ¸…æ¥šunsigned/signed charå°±ok\n1unsigned char c = 0xff 2 3if (c == 0xff) 4 printf(\u0026#34;successful\\n\u0026#34;); 5else 6 printf(\u0026#34;failed\\n\u0026#34;); å³ç§»å’Œé™¤æ³• ä½ æ˜¯å¦æœ‰å¬è¯´è¿‡æœ‰ç¬¦å·æ•°ä¸èƒ½ä½¿ç”¨å³ç§»æ“ä½œ(\u0026gt;\u0026gt;)æ¥ä»£æ›¿é™¤æ³•ï¼Ÿ è¿™ç¯‡çŸ­æ–‡ä¼šå‘ä½ è¯æ˜å®ƒï¼Œå¹¶å°è¯•å‘ä½ è§£é‡Šä¸ºä»€ä¹ˆã€‚\nLogical Shift .vs. Arithmetic Shift è‹¥ä½ ç°åœ¨æœ‰äºŒè¿›åˆ¶æ•°x=1110Bï¼Œå¯¹å…¶æ–½åŠ å³ç§»æ“ä½œï¼Œè¯·é—®é«˜ä½å¡«0è¿˜æ˜¯å¡«1ï¼Ÿ\né€»è¾‘ç§»ä½ä¸ç®¡é€ æˆçš„å½±å“ï¼Œæ€»æ˜¯ç”¨0æ¥å¡«å……ç§»ä½æ“ä½œäº§ç”Ÿçš„ç©ºç¼ºã€‚ä½†æ˜¯è¿™æ ·ç®€å•çš„æƒ³æ³•åœ¨ä¸€äº›æƒ…å†µæ€»ä¼šå‡ºé”™ã€‚ä¾‹å¦‚è‹¥ä¸Šè¿°xæ˜¯æœ‰ç¬¦å·æ•°ï¼Œé‚£ä¹ˆç®€å•çš„å¡«0å°±ä¼šé€ æˆé”™è¯¯ï¼Œèµ·ç æ­£è´Ÿå·å‡ºé”™äº†ã€‚\nç®—æ•°ç§»ä½æ”¯æŒæœ‰ç¬¦å·æ•°çš„ç§»ä½æ“ä½œï¼Œåœ¨ç§»ä½åä½¿ç”¨ç¬¦å·ä½è¿›è¡Œå¡«å……ï¼Œç»“åˆè¡¥ç çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå°±èƒ½å®ç°æ­£ç¡®çš„è´Ÿæ•°ç§»ä½æ“ä½œã€‚\næ€»ç»“æ¥è¯´ï¼šåœ¨æœ‰ç¬¦å·çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ç®—æ•°ä½ç§»ï¼›å¦‚æœä½ èƒ½ä¿è¯ç§»ä½æ“ä½œæ˜¯æ— ç¬¦å·çš„ï¼Œé‚£ä¹ˆç”¨é€»è¾‘ä½ç§»ä¹Ÿæ— å¦¨.\nx86æ±‡ç¼–ä»£ç ä¸­ï¼Œshrä»£è¡¨é€»è¾‘å³ç§»æŒ‡ä»¤ï¼Œsarä»£è¡¨ç®—æ•°å³ç§»æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹Cä»£ç åŠå…¶åæ±‡ç¼–çš„ç»“æœæ¥æ›´å¥½çš„ç†è§£é€»è¾‘ç§»ä½å’Œç®—æ•°ç§»ä½ï¼š\n1#include \u0026lt;stdlib.h\u0026gt;2#include \u0026lt;stdio.h\u0026gt;3 4signed int x = -3; 5unsigned int y = 3; 6 7int main() 8{ 9 x \u0026gt;\u0026gt;= 1; 10 y \u0026gt;\u0026gt;= 1; 11 return 0; 12} 1x: 2 .long -3 3y: 4 .long 3 5main: 6 push rbp 7 mov rbp, rsp 8 mov eax, DWORD PTR x[rip] 9 sar eax 10 mov DWORD PTR x[rip], eax 11 mov eax, DWORD PTR y[rip] 12 shr eax 13 mov DWORD PTR y[rip], eax 14 mov eax, 0 15 pop rbp 16 ret https://godbolt.org/z/K4M4Ko4c7\nå®è·µå‡ºçœŸçŸ¥ åœ¨æˆ‘ä½œä¸ºä¸€ä¸ªåˆçº§ç¨‹åºå‘˜çš„è®¤çŸ¥ä¸­ï¼Œ/2å’Œ\u0026gt;\u0026gt;1æ˜¯ç­‰ä»·çš„ï¼Œç”šè‡³ä¸€èµ·è¿˜å¬è¯´è¿‡åè€…èƒ½å¤Ÿä¼˜åŒ–ä»£ç çš„æ•ˆç‡ã€‚ä½†æ˜¯ä»Šå¤©æˆ‘è¦å‘Šè¯‰ä½ ï¼Œ Definitely wrong!\næˆ–è®¸åœ¨é¥è¿œçš„å¤ä»£ï¼Œæˆ‘ä»¬ä½¿ç”¨ä½ç§»æ“ä½œçœŸçš„èƒ½å¤Ÿå¯¹ä»£ç è¿›è¡ŒåŠ é€Ÿï¼Œä½†æ˜¯å½“ä¸‹ç¼–è¯‘å™¨å·²ç»è¶³å¤Ÿèªæ˜ï¼Œå¦‚æœä½ çœŸçš„åŠ¨æ‰‹åæ±‡ç¼–\u0026rdquo;/2\u0026ldquo;çš„ä»£ç ï¼Œé‚£ä¹ˆä½ å°±ä¼šçŸ¥é“ç¼–è¯‘å™¨å·²ç»æ›¿ä½ ä¼˜åŒ–ä¸ºäº†ä½ç§»æ“ä½œã€‚\næ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬è¦é¿å…ä½¿ç”¨ç§»ä½æ“ä½œæ¥å®ç°é™¤æ³•æˆ–è€…ä¹˜æ³•ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºè¿™ä¸¤è€…ç­‰ä»·ï¼Œå®é™…ä¸Šï¼Œä»–ä»¬å¹¶ä¸æ˜¯ç­‰ä»·çš„ï¼å¹¶ä¸”ä¼šé€ æˆé”™è¯¯ï¼\nè€ƒè™‘å¦‚ä¸‹çš„Cè¯­è¨€ä»£ç ï¼š\n1#include \u0026lt;stdlib.h\u0026gt;2#include \u0026lt;stdio.h\u0026gt;3 4signed int x = -3; 5signed int y = -3; 6 7int main() 8{ 9 x \u0026gt;\u0026gt;= 1; 10 y /= 2; 11 return 0; 12} ä»–ä»¬çš„æ±‡ç¼–ä»£ç æ˜¯ç›¸åŒçš„å—ï¼Ÿè¿™é‡Œè¿˜æ˜¯æ‹¿X86æ±‡ç¼–ä¸¾ä¾‹ï¼š\n1; Following is â€˜x \u0026gt;\u0026gt;= 1â€™ 2mov eax, #-3 ;x 3sar eax 4mov x, eax 5; Following is â€˜y/= 2â€™ 6mov eax, #-3 ;y 7mov edx, eax 8shr edx, 31 9add eax, edx 10sar eax 11mov y, eax æ³¨æ„ï¼šä»¥ä¸Šçš„æ±‡ç¼–ä»£ç çœå»äº†ä¸€äº›æˆ‘è®¤ä¸ºæ— å…³ç´§è¦çš„æ“ä½œï¼Œå¹¶ä¸æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½†æ˜¯è¶³å¤Ÿè¡¨è¾¾ä»–ä»¬çš„å·®åˆ«äº†ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œé™¤æ³•æ¯”ç§»ä½å¤šäº†ä¸€æ­¥shr edx, 31è¿‡ç¨‹ï¼Œä¸‹é¢ä¼šæ¢è®¨è¿™ä¸ªã€‚\nè¿˜æœ‰ä¸€ä»¶ä½¿ä½ éœ‡æƒŠçš„äº‹ä»¶ï¼Œx, yçš„å€¼æœ€ç»ˆæ˜¯ä¸åŒçš„ï¼æ˜¯çš„ï¼Œæ­£æ˜¯å› ä¸ºé‚£æ¡çœ‹ä¼¼â€œå¤šä½™â€çš„shræŒ‡ä»¤ã€‚\nä¸ºä»€ä¹ˆç»“æœä¸åŒ é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šçš„ä¸€ä»¶äº‹æ˜¯ï¼šç¼–è¯‘å™¨çœŸçš„å¸®æˆ‘ä»¬å°†é™¤æ³•æ“ä½œä¼˜åŒ–ä¸ºç§»ä½ã€‚æ‰€ä»¥ï¼Œå†ä¹Ÿä¸è¦è¯´ä½ çš„ä»£ç ä¸­ä½¿ç”¨\u0026gt;\u0026gt;æ¥æ›¿ä»£é™¤æ³•æ˜¯ä¸ºäº†å¢åŠ æ‰§è¡Œæ•ˆç‡äº†ã€‚\nè®©æˆ‘ä»¬æ¥è§£é‡Šä¸‹ä¸ºä»€ä¹ˆä¸¤è€…çš„ç»“æœæ˜¯ä¸åŒçš„ã€‚\né¦–å…ˆï¼ŒsaræŒ‡ä»¤åœ¨x86æŒ‡ä»¤é›†ä¸­è¡¨ç¤ºç®—æ•°å³ç§»ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ï¼Œé‚£ä¹ˆ-3è¿›è¡Œç®—æ•°å³ç§»åçš„ç»“æœå°±æ˜¯-2. æ„å‘³ç€\u0026gt;\u0026gt;æ˜¯å‘è´Ÿæ— ç©·èˆå…¥çš„.\né‚£ä¹ˆé™¤æ³•æ“ä½œåˆæ˜¯åœ¨å¹²ä»€ä¹ˆå‘¢? å®ƒæ˜¯å°†åŸå€¼åŠ ä¸Šå…¶ç¬¦å·ä½.Demoä¸­ä½¿ç”¨çš„æ•°æ®ç±»å‹æ˜¯32ä½int.\n1shr edx, 31 2add eax, edx è¿™æ ·åšå¿…ç„¶æ”¹å˜äº†åŸå€¼å•Šï¼ŒåŠ¨æ‰‹ç®—ä¸€ä¸‹å°±ä¼šçŸ¥é“ï¼Œ-3/2çš„ç»“æœä¸º-1. å¹¶ä¸”åªæœ‰è´Ÿå¥‡æ•°ä¼šå—å½±å“ï¼Œå¯¹äºæ­£æ•°ï¼Œå…¶ç¬¦å·ä¸º0ï¼›å¯¹äºè´Ÿå¶æ•°ï¼Œå…¶è¡¥ç çš„æœ€ä½ä½å¿…ä¸º0ï¼ŒåˆšåŠ ä¸Šçš„1ä¼šè¢«ä¸‹ä¸€æ­¥çš„ç®—æ•°å³ç§»ä¸¢å¼ƒï¼Œä¸å¯¹é«˜ä½äº§ç”Ÿå½±å“ã€‚\nAha, å·®åˆ«å°±æ˜¯å‘è´Ÿæ— ç©·èˆå¼ƒè¿˜æ˜¯å‘0èˆå¼ƒï¼Œä¸€æ—¶é—´ç«Ÿç„¶ä¸çŸ¥é“å“ªä¸ªæ˜¯æ­£ç¡®çš„äº†ã€‚\næˆ‘ä»¬åº”è¯¥å¦‚ä½•åš æ ¹æ®æœ€æ–°çš„[Cè¯­è¨€æ ‡å‡†è‰æ¡ˆ](ISO/IEC 9899:201x (open-std.org)) 6.5.7ç« èŠ‚ï¼Œè´Ÿæ•°çš„å³ç§»æ“ä½œæ˜¯implementation-definedï¼Œå³å–å†³äºå…·ä½“çš„å®ç°ï¼š\n The result of E1 \u0026raquo; E2 is E1 right-shifted E2 bit positions. If E1 has an unsigned type or if E1 has a signed type and a nonnegative value, the value of the result is the integral part of the quotient of E1 / 2E2. If E1 has a signed type and a negative value, the resulting value is implementation-defined.\n å› æ­¤ï¼Œç†è®ºä¸Šå®ƒä¾èµ–äºå®ç°ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ä¸ºäº†ç¨‹åºçš„å¯ç§»æ¤æ€§ï¼Œåº”å½“é¿å…å¯¹æœ‰ç¬¦å·æ•°ä½¿ç”¨ç§»ä½æ“ä½œã€‚é™¤éä½ èƒ½ç¡®å®šå®ƒçš„å€¼ä¸€å®šæ˜¯éè´Ÿæ•°ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œè¯·å°†å®ƒç”¨æ— ç¬¦å·ç±»å‹æ¥å£°æ˜ã€‚\nå¯¹äºé™¤æ³•æ“ä½œï¼Œæ ‡å‡†ä¸­çš„6.5.5ç« èŠ‚è§„å®šäº†ï¼Œé™¤æ³•æ“ä½œæ€»æ˜¯å‘0èˆå…¥. éå¸¸å¥½ï¼\n When integers are divided, the result of the / operator is the algebraic quotient with any fractional part discarded.\n æ£€æŸ¥ä½ çš„ä»£ç ï¼Œæ¢å¤æ‰€æœ‰çš„â€œä¼˜åŒ–â€ä¹˜é™¤æ³•çš„è¡Œä¸ºå§ï¼\n","date":"2023-03-09T17:18:57+08:00","permalink":"https://wangloo.github.io/posts/c/feature/","section":"posts","tags":["c"],"title":"C è¯­è¨€çš„ç‰¹ç‚¹ä¸éš¾ç‚¹"},{"categories":["C Language"],"contents":"å¤´æ–‡ä»¶çš„å¼•ç”¨å½¢å¼ C ä¸­å¼•ç”¨ä¸€ä¸ªå¤´æ–‡ä»¶æœ‰ä¸¤ç§å½¢å¼ #include \u0026lt;\u0026gt;å’Œ#include \u0026quot;\u0026quot;ï¼Œåœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œéœ€è¦å¼•ç”¨ä¸€äº›ç³»ç»Ÿåº“æ–‡ä»¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨\u0026lt;\u0026gt;ï¼Œå¯¹äºè‡ªå·±å®šä¹‰çš„å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨\u0026quot;\u0026quot;ã€‚\nç„¶è€Œå¯¹äºåº•å±‚è½¯ä»¶çš„å¼€å‘ï¼Œæ¯”å¦‚è¯´æ“ä½œç³»ç»Ÿï¼Œç”¨åˆ°çš„åº“éƒ½æ˜¯è‡ªå·±å·¥ç¨‹ä¸­çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”¨\u0026quot;\u0026quot;å’Œ\u0026lt;\u0026gt;æœ‰æ—¶éƒ½èƒ½ workï¼Œé‚£ä¹ˆå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\næœç´¢ç›¸å…³å…³é”®è¯å¾—åˆ°çš„ç»“è®ºæ˜¯: ä¸¤ç§æ–¹å¼çš„åŒºåˆ«æ˜¯æœç´¢æ–‡ä»¶çš„ä¼˜å…ˆçº§ï¼Œ \u0026quot;\u0026quot;ä¼˜å…ˆæœç´¢çš„å½“å‰ç›®å½•ï¼Œè€Œ\u0026lt;\u0026gt;ä¼˜å…ˆæœç´¢ç³»ç»Ÿåº“æ–‡ä»¶ç›®å½•ã€‚å¯¹äºè¿™ä¸ªç³»ç»Ÿåº“ï¼Œå³é‚£äº›ä½¿ç”¨gcc -I\u0026lt;dir\u0026gt;å‚æ•°æŒ‡å®šçš„è·¯å¾„ã€‚ å½“ç„¶ï¼Œå¦‚æœç¬¬ä¸€ä¼˜å…ˆçº§ä½ç½®æ²¡æœ‰è¢«æ‰¾åˆ°ï¼Œä¹Ÿä¼šåˆ°å¦ä¸€ä¸ªç›®å½•ä¸­æœç´¢ã€‚è¿™ä¹ˆä¸¤ç§æ–¹å¼å‡å¯ï¼Œå®é™…å·¥ç¨‹ä¸­ä¹Ÿæœ‰éƒ¨åˆ†äººæ··åˆä½¿ç”¨ï¼Œæ¯«ä¸åœ¨æ„è§„åˆ™ã€‚ä½†æ˜¯æœ‰æ—¶ä¼šå¯¼è‡´ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°-MMDæˆ–è€…ç±»ä¼¼é€‰é¡¹ç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„ä¾èµ–ï¼Œæ–¹ä¾¿å®ç°å¢é‡ç¼–è¯‘ã€‚æ­¤æ—¶å°±å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚\nå‡è®¾ä½ æœ‰ä¸€ä¸ªå¤´æ–‡ä»¶inc/father.h, å®ƒé‡Œé¢ä¼šå¼•ç”¨inc/child.h, å¯¹äºæ ¹ç›®å½•ä¸‹çš„æºæ–‡ä»¶main.cï¼Œå…¶å¼•ç”¨è¯­å¥è¯¥å¦‚ä½•å†™å‘¢ï¼Ÿä»¥ä¸‹åˆ—å‡ºçš„å‡ ç§å½¢å¼éƒ½å¯ä»¥ï¼Œä»»æ„çš„æ’åˆ—ç»„åˆ\n1// ç¼–è¯‘å‚æ•°: -I. -MMD 2// main.c 3#include \u0026#34;inc/father.h\u0026#34;4#include \u0026lt;inc/father.h\u0026gt;5 6// father.h 7#include \u0026#34;inc/child.h\u0026#34;8#include \u0026lt;inc/child.h\u0026gt;9#include \u0026#34;child.h\u0026#34;10#include \u0026lt;child.h\u0026gt; å¦‚æœ main.c æ˜¯ä½¿ç”¨ç³»ç»Ÿåº“è·¯å¾„(-I.)æ¥æ‰¾åˆ°çš„ father.h, å³ä¸Šé¢ main.c çš„ç¬¬ 2 ç§æƒ…å†µï¼Œé‚£ä¹ˆå…¶ç”Ÿæˆä¾èµ–æ–‡ä»¶çš„å½¢å¼å†…å®¹éƒ½æ˜¯ç»å¯¹è·¯å¾„ï¼ŒåŒ…æ‹¬ father.h ä¸­çš„å¼•ç”¨ï¼ˆå› ä¸ºå³ä¾¿ child.h æ˜¯ç›¸å¯¹è·¯å¾„æ‰¾åˆ°çš„ï¼Œç›¸å¯¹çš„ä¹Ÿæ˜¯ father.hï¼Œå…¶åŸºå‡†å°±æ˜¯ç»å¯¹è·¯å¾„ï¼‰ã€‚ä¾‹å¦‚:main.o: main.c /home/xx/father.h /home/xx/child.h å¦åˆ™å³ä»¥ç›¸å¯¹è·¯å¾„æ‰¾åˆ° father.h,å³ä¸Šè¯´ main.c çš„ç¬¬ 1 ç§ï¼Œé‚£ä¹ˆç”Ÿæˆ father.h ä¾èµ–çš„æ–¹å¼ä¸€å®šæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä½† child.h çš„å½¢å¼å´å–å†³äºå…¶æœ¬èº«.  ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ child.h çš„å¯»æ‰¾æ–¹å¼æ˜¯ç»å¯¹çš„ï¼ˆä¸Šé¢çš„ç¬¬ 1,2,4 ç§ï¼‰ï¼Œé‚£ä¹ˆä¾èµ–æ–‡ä»¶çš„å½¢å¼å°±æ˜¯main.o: main.c inc/father.h /home/xx/child.h. å¦‚æœ child.h çš„å¯»æ‰¾æ–¹å¼æ˜¯ç›¸å¯¹çš„(ä¸Šé¢çš„ç¬¬ 3 ç§)ï¼Œé‚£ä¹ˆä¾èµ–æ–‡ä»¶çš„å½¢å¼æ˜¯main.o: main.c inc/father.h inc/child.h    ä¾èµ–æ–‡ä»¶çš„å½¢å¼å¾ˆé‡è¦ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯å‡ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œæ­¤æ—¶ä¸éœ€è¦è€ƒè™‘ä¾èµ–æ–‡ä»¶åœ¨ makefile ä¸­ include çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦è€ƒè™‘ make çš„â€œå½“å‰è·¯å¾„â€ã€‚å¦‚æœéå¾—ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå·²ç»è¦ç¡®å®šèƒ½å¤Ÿ makefile ä¸­ include æ—¶çš„ make å½“å‰è·¯å¾„å°±æ˜¯ç”Ÿæˆä¾èµ–æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦åˆ™ä¸èƒ½å»ºç«‹æ­£ç¡®çš„ä¾èµ–å…³ç³»ã€‚\nå®é™…ä¸Šï¼Œåœ¨â€œåŸºç¡€æ¶æ„â€ä¼˜ç§€çš„é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½å‡ºç°æˆ–è€…å°½é‡é¿å…å‡ºæ¥ä¸¤ç§å½¢å¼éƒ½èƒ½æ‰¾åˆ°å¤´æ–‡ä»¶çš„æƒ…å†µã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¼šå°†æºæ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨å­ç›®å½•src/ä¸‹ä¸å¤´æ–‡ä»¶éš”ç¦»ï¼Œè¿™æ ·å°±ä»æ ¹æœ¬ä¸Šé¿å…äº†ç›¸å¯¹ä¾èµ–çš„ç”Ÿæˆï¼Œåªèƒ½é€šè¿‡ç³»ç»Ÿåº“çš„å½¢å¼æ¥æ‰¾å¤´æ–‡ä»¶ã€‚æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œæ­£ç¡®çš„æ–¹å¼æ˜¯ï¼šmain.c æ”¾å…¥ src/ä¸­ï¼Œç„¶åä¸ç®¡æ˜¯æºæ–‡ä»¶è¿˜æ˜¯å¤´æ–‡ä»¶ï¼Œéƒ½ç»Ÿä¸€ä½¿ç”¨#include \u0026quot;inc/xxx\u0026quot;ã€‚è¿™æ ·åšå³ç»Ÿä¸€ï¼Œä¹Ÿèƒ½ä¿è¯æ‰€æœ‰çš„ä¾èµ–éƒ½æ˜¯ç»å¯¹è·¯å¾„å½¢å¼\n å¦å¤–è¯´ä¸€ç‚¹ï¼Œå…¶å®ä¾èµ–æ–‡ä»¶(.d)ä¸­æºæ–‡ä»¶çš„ä¾èµ–é¡¹å½¢å¼ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ï¼Œè¿™ä¸èƒ½é€šè¿‡ç³»ç»Ÿæ¶æ„æ¥è§£å†³ï¼Œåªèƒ½ç”¨ Makefile çš„æŠ€å·§æ¥å®ç°ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬çš„ make å½“å‰ç›®å½•æ€»æ˜¯æ ¹ç›®å½•ï¼Œè€Œåœ¨å»ºç«‹ OBJS å˜é‡æ—¶ä¸ºå…¶åŠ ä¸Šç»å¯¹è·¯å¾„çš„å‰ç¼€ï¼Œ ä»è€Œ make ä¸éœ€è¦è¿›å…¥å„çº§å­ç›®å½•ï¼Œç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ä¹Ÿéƒ½æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„ï¼Œinclude ä¾èµ–æ–‡ä»¶çš„è¡Œä¸ºä¹Ÿæ˜¯åœ¨æ ¹ç›®å½•è¿›è¡Œçš„ï¼Œä¿è¯ç»Ÿä¸€ã€‚\n å¤–éƒ¨åº“çš„ä½¿ç”¨æ–¹å¼ æœ€è¿‘æˆ‘åœ¨å¼€å‘é¡¹ç›®æ˜¯, éœ€è¦ä½¿ç”¨åˆ° libelf åº“, æˆ‘åœ¨ Github ä¸Šæ‰¾åˆ°äº†å…¶æºä»£ç .\næˆ‘ä¹‹å‰ä½¿ç”¨ä¸€ä¸ª lib éƒ½æ˜¯ä»¥é“¾æ¥çš„å½¢å¼ä½¿ç”¨åŠ¨æ€åº“/é™æ€åº“, ä½†æ˜¯æ—¢ç„¶å®ƒæä¾›äº†æºç , é‚£ä¹ˆæˆ‘å¯ä»¥ç›´æ¥å°†æºç æ‹·è´åˆ°æˆ‘çš„é¡¹ç›®ä¸­å—? ç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥, é‚£ä¹ˆè¿™ä¸¤ç§æ–¹æ¡ˆè¯¥å¦‚ä½•æŠ‰æ‹©å‘¢?\nåœ¨æŸ¥é˜…äº†ä¸€äº›èµ„æ–™å, æˆ‘æ€»ç»“äº†ä»¥ä¸‹å‡ ä¸ªåˆ¤æ–­ä¾æ®:\n åº“çš„å¤§å°/å¯¹ç¼–è¯‘æ—¶é—´çš„æ•æ„Ÿåº¦; å¦‚æœä½¿ç”¨æºä»£ç , æ¯æ¬¡ç¼–è¯‘é¡¹ç›®æ—¶éœ€è¦é¢å¤–å¯¹åº“æ–‡ä»¶è¿›è¡Œç¼–è¯‘(èµ·ç æ˜¯ç¬¬ä¸€æ¬¡), è€Œåº“æ–‡ä»¶çš„å®šä¹‰æ˜¯ä¸å¸¸ä¿®æ”¹çš„, å¦‚æœåº“æ–‡ä»¶æ¯”è¾ƒå¤§, åˆ™ä¼šå»¶é•¿æ•´ä¸ªé¡¹ç›®çš„ç¼–è¯‘æ—¶é—´. æ˜¯å¦éœ€è¦ç‰ˆæœ¬æ§åˆ¶; è¦ä½¿ç”¨çš„åº“å¦‚æœéœ€è¦åŒºåˆ†ç‰ˆæœ¬, æˆ–è€…åˆ†é…ç»™å…¶ä»–çš„å›¢é˜Ÿæˆå‘˜ä½¿ç”¨, é‚£ä¹ˆç”¨åº“çš„å½¢å¼ä¼¼ä¹æ›´ä¸ºæ–¹ä¾¿ å‘æŒ¥ git submodule çš„ä¼˜åŠ¿;   Ref: c++ - Should I add the source of libraries instead of linking to them? - Software Engineering Stack Exchange\n const ä¿®é¥°ç¬¦çš„å¦™ç”¨ æœ‰äº›æ—¶å€™, æˆ‘ä»¬è®¾è®¡çš„ç»“æ„ä½“ä¸­ä¼šæœ‰nameå­—æ®µ, ç±»å‹æ˜¯char *. åœ¨ä½¿ç”¨æ—¶ä¸ºå®ƒåˆ†é…ç©ºé—´, ä¸ä½¿ç”¨æ—¶éœ€è¦å›æ”¶.\nå…¶å®è¿˜æœ‰å¦ä¸€ç§æƒ…å†µ, å°±æ˜¯nameè¦æŒ‡å‘é¢„å…ˆå®šä¹‰å¥½çš„\u0026quot;static name list\u0026quot;, é€‚ç”¨äº name çš„å–å€¼æ˜¯ç¡®å®šçš„èŒƒå›´. ä¾‹å¦‚, libdwarf åº“ä¸­çš„æè¿° section name çš„dss_name æˆå‘˜.\nè¿™æ—¶, ä¸ºäº†é˜²æ­¢ä½¿ç”¨è€…è°ƒç”¨free()æ¥é‡Šæ”¾å®ƒ, æˆ‘ä»¬å¯ä»¥å°†å…¶å£°æ˜ä¸ºconst char *, æ­¤æ—¶å¦‚æœè°ƒç”¨free(.dss_name), ç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Š:\n1const.c:16:10: warning: passing argument 1 of â€˜freeâ€™ discards â€˜constâ€™ qualifier from pointer target type [-Wdiscarded-qualifiers] 2 16 | free(dss_name); 3 | ^~~~~~~~ ","date":"2023-02-27T19:20:20+08:00","permalink":"https://wangloo.github.io/posts/c/experience/","section":"posts","tags":["c"],"title":"C è¯­è¨€ç¨‹åºè®¾è®¡çš„ä¸€äº›ç»éªŒ"},{"categories":["Operating System"],"contents":"ä½¿ç”¨VIM æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶, æœ‰æ—¶ä¼šçœ‹åˆ°ä¾‹å¦‚ ^M è¿™ç±»å­—ç¬¦å‡ºç°. ä¸‹é¢æˆ‘ä¼šæŒ–ä¸€ä¸‹å…¶å‡ºç°çš„åŸå› .\nEOL å­—ç¬¦ EOL æˆ–è€…è¯´ end-of-line è¡¨ç¤ºä¸€ä¸ªæ–°è¡Œçš„å¼€å§‹.\nEOL å­—ç¬¦åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­æ˜¯ä¸åŒçš„. æœ¬æ–‡ä¸­ä»…ä»¥ Linux å’Œ Windows ä¸ºä¾‹è¯´æ˜.\n Windowsä¸­æ˜¯ä»¥è¯»åˆ°å›è½¦\u0026lt;CR\u0026gt;å’Œæ¢è¡Œ\u0026lt;LF\u0026gt; è¡¨ç¤º EOL. Linux ä¸­ä»…ä»¥æ¢è¡Œä½œä¸ºEOL    å›è½¦\u0026lt;CR\u0026gt; : Carriage return. å°†å…‰æ ‡å›åˆ°è¡Œé¦–, å¯¹åº”Cè¯­è¨€ä¸­çš„ \\r æ¢è¡Œ\u0026lt;LF\u0026gt; : Line feed. å°†å…‰æ ‡ä¸‹ç§»ä¸€è¡Œ, å¯¹åº”Cè¯­è¨€ä¸­çš„ \\n   åœ¨ Linux ä¸­æ‰“å¼€ Windows ä¸‹çš„æ–‡ä»¶å°†å¤šä½™çš„å›è½¦é€šå¸¸æ˜¾ç¤ºæˆ ^M æˆ–è€… Control-M\nRef End Of Line Characters\n","date":"2022-12-24T01:35:24+08:00","permalink":"https://wangloo.github.io/posts/os/linux/end-of-line/","section":"posts","tags":["other"],"title":"è¡Œç»“æŸç¬¦åœ¨windowså’Œlinuxçš„åŒºåˆ«"},{"categories":["Operating System"],"contents":"æˆ‘å§‹ç»ˆä»¥ä¸ºï¼ŒCåº“ä¸­å¸¸ç”¨çš„ errno ä»…æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½¿ç”¨äº†å…¨å±€å˜é‡å°±æ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨äº†ï¼Œå› ä¸ºå…¨å±€å˜é‡åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½æ˜¯å…±äº«çš„ã€‚\nè¦å®ç°çº¿ç¨‹å®‰å…¨çš„errno å°±å¿…é¡»å°†å…¶è®¾ç½®ä¸ºçº¿ç¨‹ç§æœ‰çš„å˜é‡ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹GCCæ˜¯å¦‚ä½•å·§å¦™çš„å®ç°çš„ã€‚\næ­£æ–‡ ç°åœ¨çš„errnoå®šä¹‰å¹¶éä¸€ä¸ªå…¨å±€å˜é‡, è€Œæ˜¯ä¸€ä¸ªå®å®šä¹‰, ä»¥ä¸‹æ˜¯åœ¨usr/include/errnoä¸­çš„å£°æ˜:\n1extern int *__errno_location (void); 2# define errno (*__errno_location ()) è¿™ç§æ–¹å¼ä¸‹å…¶å®ç°åŸç†å¤§æ¦‚æ˜¯: __errno_location å‡½æ•°è¿”å›ä¸€ä¸ªintæŒ‡é’ˆ, è€Œè¿™ä¸ªå‡½æ•°çš„å®ç°ä¸­, è¿”å›çš„å°±æ°å¥½æ˜¯å®é™…çš„errno å˜é‡(ä¸å®åŒå)çš„åœ°å€, æ‰€ä»¥å¯¹å…¶è§£å¼•ç”¨å°±ç›¸å½“äºå¯¹å…¶å€¼è¿›è¡Œæ“ä½œ. æ‰€ä»¥, è¿™ç§å®šä¹‰è§„åˆ™ä¸‹, å·¦å€¼å’Œå³å€¼è¡¨è¾¾å¼å‡æˆç«‹.\n1errno = 10; // *__errno_location () = 10 2int x = errno; // x = *__errno_location (); __errno_location çš„å®ç°å°±è‡³å…³é‡è¦, å› ä¸ºå¦‚æœå…¶è¿”å›çš„å˜é‡åœ°å€ä¸åŒ…å«ä»»ä½•æŠ€å·§çš„è¯, å°±å’ŒåŸå…ˆç›´æ¥å®šä¹‰å…¨å±€å˜é‡çš„æ–¹å¼æ²¡å·®äº†, è¯´åˆ°åº•èƒ½å¦å®ç°çº¿ç¨‹å®‰å…¨, è¿˜å¾—çœ‹å®é™…ä¿å­˜errnoçš„å˜é‡æ˜¯å¦ä¸ºçº¿ç¨‹ç‹¬æœ‰çš„. ç›®å‰è¿˜æ²¡æœ‰å‘æ˜åˆ°å…¶ç²¾é«“, åªæ˜¯å¥—å£³è€Œå·².\nä»¥ä¸‹ç»™å‡º/csu/errno-loc.cä¸­__errno_location çš„å®ç°, ä¸æˆ‘ä»¬é¢„æœŸä¸€è‡´, è¿”å›å˜é‡çš„åœ°å€. è€ŒåŒåå˜é‡errnoåˆ™å®šä¹‰åœ¨/csu/errno.cä¸­, å†³å®šäº†èƒ½å¤Ÿå®ç°errnoçš„çº¿ç¨‹å®‰å…¨.\n1int * 2__errno_location (void) 3{ 4 return \u0026amp;errno; 5} 1__thread int errno; \u0026ldquo;__thread\u0026rdquo; æ˜¯GCCæä¾›çš„æ‰©å±•å‰ç¼€, è¡¨ç¤ºè¯¥å˜é‡å°†è¢«åº“å¤„ç†ä¸ºçº¿ç¨‹ç§æœ‰çš„, æ³¨æ„è¿™ä¸€æ­¥æ˜¯Cåº“å®Œæˆçš„, å¯¹ç¨‹åºå‘˜é€æ˜. ç›¸å…³çš„ç†è®ºå« Thread-local Storage, AArch64 æ¶æ„å®ç°çš„åŸç†æ˜¯åˆ©ç”¨TPIDR_EL0 å¯„å­˜å™¨, å…¶ä»–æ¶æ„å¯ä»¥å‚è€ƒæ­¤PDF\n â“ ä»¥ä¸Šæºæ–‡ä»¶ä¸­æœ‰æ³¨é‡Šä¸º non-threadedç‰ˆæœ¬çš„å®ç°, æ˜¯ä»£è¡¨ä»€ä¹ˆå«ä¹‰å‘¢?\n â€‹\nè™½ç„¶æˆ‘æš‚æ—¶æ²¡æœ‰æŸ¥é˜…åˆ°errnoçš„å…¶ä»–çº¿ç¨‹å®‰å…¨çš„å®ç°åŸç†, ä½†èµ·ç GCCä¸‹è¯¥æ–¹å¼è¿™æ˜¯å¯è¡Œçš„. ä¾é çš„æ˜¯\u0026quot;__thread\u0026ldquo;çš„æ”¯æŒ, ä¸æ¢æˆå®å®šä¹‰çš„æ–¹å¼æ— å…³, ä¸æ’é™¤å¯èƒ½ä¸ºäº†è€ƒè™‘å…¼å®¹å…¶ä»–å®ç°æ–¹å¼çš„å¯èƒ½æ€§.\nå‚è€ƒ c - How is thread-safe errno initialized if #define substitutes errno symbol? - Stack Overflow\n","date":"2022-12-21T19:08:22+08:00","permalink":"https://wangloo.github.io/posts/os/errno_thread_safe/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šæµ…è°ˆ errno çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"},{"categories":["Git"],"contents":"åˆå¹¶æ“ä½œ: git merge merge æœ‰ä¸¤ç§æ–¹å¼:\n fast-forward three-way merger  Fast-forward Merge å‡è®¾åˆå¹¶çš„åŒæ–¹ä¸ºmainä¸ºdev, å¦‚æœå…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ç¥–å…ˆ, æ­¤æ—¶ç›´æ¥ç§»åŠ¨ HEAD åˆ°å‰æ–¹å³å¯, ç§°ä¸º fast-forward.\nä¾‹å¦‚, å½“å‰åœ¨ main, æ‰§è¡Œgit merge devçš„è¿‡ç¨‹å¦‚ä¸‹:\n1 main main 2 | | 3M1 --- M2 ===\u0026gt; M1 --- M2 -- F1 4 \\ | 5 \\--- F1 dev 6 | 7 dev three-way Merge åˆå¹¶çš„ä¸¤è€…ä¸æ„æˆç›´æ¥çš„ç¥–å…ˆ-å­©å­å…³ç³», äº§ç”Ÿäº†åˆ†å‰. æ­¤æ—¶è¿›è¡Œåˆå¹¶å°±éœ€è¦æœ‰ä¸ªåŸºå‡†(å‚è€ƒ), å¯¹äºä¸¤è¾¹ç›¸è¾ƒäºåŸºå‡†çš„æ¯ä¸ª diff æ¥è¯´:\n åˆå¹¶çš„ä¸¤è€…éƒ½åœ¨åŸºå‡†ä¸Šè¿›è¡Œäº†æ”¹åŠ¨, ä¸”æ”¹åŠ¨ä¸ä¸€è‡´, æ ‡è®°ä¸ºå†²çª å¦‚æœè¯¥ diffä»…åœ¨å…¶ä¸­ä¸€æ–¹æœ‰æ”¹åŠ¨, é‚£ä¹ˆå°±ä¿ç•™æ­¤æ¬¡æ”¹åŠ¨  åˆå¹¶æ—¶ä½¿ç”¨çš„å‚è€ƒå°±æ˜¯ä¸¤ä¸ªåˆå¹¶ commit çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ, è¿™ç§å€ŸåŠ©ä¸‰ä¸ª commit(main, dev, å…¬å…±ç¥–å…ˆ)æ‰èƒ½å®Œæˆçš„åˆå¹¶æ“ä½œå°±å«åš three-way merge.\nä¾‹å¦‚, å½“å‰åœ¨ main, æ‰§è¡Œgit merge devçš„è¿‡ç¨‹å¦‚ä¸‹:\n1 main main 2 | | 3M1 --- M2 --- M3 ===\u0026gt; M1 --- M2 --- M3 --- M4 4 \\ \\ / 5 \\--- F1 \\--- F1 --- 6 | | 7 dev dev  three-way çš„åˆå¹¶æ–¹å¼å¦‚æœå‘ç”Ÿäº†å†²çª, ä¼šäº§ç”Ÿä¸€æ¬¡é¢å¤–çš„ merge commit, ä¸‹é¢ä»‹ç»å®ƒ\n ä»€ä¹ˆæƒ…å†µä¸‹ merge commit æ²¡æœ‰ä»»ä½• diff? æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­, three-way merge å‘ç”Ÿå†²çªåä¼šäº§ç”Ÿä¸€æ¬¡é¢å¤–çš„ merge commit, å³ M4. å¦‚æœè¿™æ˜¯å»æŸ¥çœ‹ M4 ç›¸è¾ƒå‰ä¸€æ¬¡ commit çš„ diff, æœ‰æ—¶æ˜¯æ²¡æœ‰çš„, æœ‰æ—¶åˆä¼šäº§ç”Ÿ diff.\nå¦‚æœåœ¨è§£å†³å†²çªçš„è¿‡ç¨‹ä¸­, æˆ‘ä»¬ä»…ä»…æ˜¯æ¥æ”¶äº† M2,M3 æˆ–è€… F1 çš„ä¿®æ”¹, é‚£ä¹ˆæ­¤æ—¶ merge commit å°±ä¸ä¼šæœ‰ diff.\nç„¶è€Œ, åœ¨è§£å†³å†²çªæ—¶, æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸é‡‡ç”¨æ¥è‡ªä¸¤æ¡è·¯å¾„çš„ä¿®æ”¹, åšä¸€æ¬¡æ–°çš„ä¿®æ”¹(å¯ä»¥è¯´, åŒæ—¶æ¥æ”¶ä¸¤æ¡ diff å°±æ˜¯è¿™ç§æƒ…å†µ), æ­¤æ—¶æŸ¥çœ‹ merge commit çš„ diff å°±æ˜¯æœ‰å†…å®¹çš„.\nå˜åŸº: rebase rebase å‘½ä»¤éœ€è¦æŒ‡å®šä¸€ä¸ªåŸºå‡†åˆ†æ”¯ï¼Œgit rebase \u0026lt;base-branch\u0026gt;ï¼Œ rebase ä¼šå°†å½“å‰æ‰€å¤„åˆ†æ”¯æ•´ä½“ç§»åŠ¨åˆ°base-branchä¹‹åï¼Œå³æ”¹å˜äº†å½“å‰åˆ†æ”¯çš„å†å²ã€‚\n1// before rebase 2[A]---[B]---[C]---[D]\u0026lt;-dev 3 \\ 4 \\--[E]\u0026lt;-master 5 6// after rebase 7[A]---[E]---[B]---[C]---[D]\u0026lt;-dev 8 | 9 master äº¤äº’å¼ rebase äº¤äº’å¼ rebase æ˜¯ä¸€ç§æ›´é«˜çº§çš„ç”¨æ³•ã€‚åŸºç¡€çš„ rebase ä¸Šé¢è¯´äº†æ˜¯å°†å½“å‰åˆ†æ”¯çš„æ‰€æœ‰æäº¤ç§»åŠ¨åˆ° base-branch ä¹‹åã€‚è€Œäº¤äº’å¼ rebase æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ç§»åŠ¨ä¹‹å‰\u0026quot;æŒ‘é€‰\u0026quot;å½“å‰åˆ†æ”¯çš„ commitã€‚\nå®é™…å·¥ç¨‹ä¸­ï¼Œé€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å°†å¼€å‘åˆ†æ”¯ç§»åŠ¨åˆ° master ä¹‹å‰ï¼Œå¯ä»¥ç»è¿‡äº¤äº’ rebase æ¥æ•´ç†å¼€å‘åˆ†æ”¯ä¸­æ··ä¹±çš„ commit è®°å½•ã€‚\nå…·ä½“çš„ä½¿ç”¨æ–¹æ³•æ˜¯ï¼Œä¸ºgit rebaseæŒ‡ä»¤æä¾›-iå‚æ•°:\n1git checkout dev 2git rebase -i master è¿™ä¸ªå‘½ä»¤ä¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œåˆ—å‡ºå½“å‰ feature åˆ†æ”¯çš„æ‰€æœ‰æäº¤:\n1pick 33d5b7a Message for commit #1 2pick 9480b3d Message for commit #2 3pick 5c67e61 Message for commit #3 åˆ—å‡ºçš„å†…å®¹å°±èƒ½å®Œæ•´çš„è¡¨ç¤º dev åˆ†æ”¯çš„æ‰€æœ‰æäº¤ï¼ŒæŒ‰ç…§é¡ºåºã€‚è€Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä»»æ„çš„é‡æ’è¿™äº› commitï¼Œè€Œä¸”ä¿®æ”¹pickå…³é”®å­—å°±èƒ½å¯¹è¿™äº› commit åšæ”¹åŠ¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯èƒ½å‘ç° commit2 åªæ˜¯å¯¹äº commit1 åšäº†ä¸€ä¸ªå¾ˆå°çš„æ”¹åŠ¨ï¼Œå®ƒä»¬å®Œå…¨å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ª commitï¼Œé‚£ä¹ˆç›´æ¥ commit2 çš„pickä¿®æ”¹ä¸ºfixupï¼Œæ•´ä¸ªå†…å®¹å˜ä¸º:\n1pick 33d5b7a Message for commit #1 2fixup 9480b3d Message for commit #2 3pick 5c67e61 Message for commit #3 å½“ä½ ä¿å­˜å¹¶é€€å‡ºè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œæ”¹åŠ¨å°±ä¼šç”Ÿæ•ˆï¼Œä¸ä»…å°† dev æ•´ä½“ç§»åŠ¨åˆ°äº† master åï¼Œå¹¶ä¸”åˆå¹¶äº†å‰ä¸¤ä¸ª commitã€‚\n1// after rebase interactive 2[A]---[E]---[B]---[D]\u0026lt;-dev 3 | 4 master rebase æ•´ç†å¤šä¸ª commit å¦‚ä¸Šé¢äº¤äº’å¼ rebase æ‰€è¿°ï¼Œå½“ä½ å¼€å‘å®Œ dev åˆ†æ”¯ï¼Œéœ€è¦mergeåˆ° main åˆ†æ”¯æ—¶ï¼Œå¯ä»¥å…ˆåˆ©ç”¨äº¤äº’å¼ rebase\u0026quot;æ•´ç†\u0026quot;ä¸€ä¸‹ dev åˆ†æ”¯çš„ commitã€‚\nè¿™é‡Œå…¶å®è¦ç”¨åˆ°ä¸€ä¸ªå° trickï¼Œä¸Šé¢è¯´è¿‡ rebase å‘½ä»¤éœ€è¦æŒ‡å®šä¸€ä¸ª base-branchï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª base-commitï¼Œè¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬ä¸æ˜¯è¦åˆå¹¶å…¶ä»–åˆ†æ”¯ï¼Œæ‰€ä»¥base-branchå¯ä»¥é€‰æ‹©å½“å‰ dev åˆ†æ”¯çš„å‰é¢æŸä¸€æ¬¡ commitã€‚\n1git checkout dev 2git rebase -i HEAD~3 ä»¥ä¸ŠæŒ‡ä»¤å®ç°çš„åŠŸèƒ½å°±æ˜¯ç»™ä½ æ•´ç†æœ€å 3 æ¬¡æäº¤çš„æœºä¼šï¼Œä½†ä¸ä¼šåˆå¹¶å…¶ä»–åˆ†æ”¯çš„ä¸œè¥¿ã€‚\né‚£å¦‚æœæˆ‘æƒ³æ•´ç†æ•´ä¸ª dev åˆ†æ”¯å‘¢ï¼Ÿæ˜¯å‘ä¸Šæ‰¾åˆ° dev çš„ç¬¬ä¸€æ¬¡ commit å—ï¼Ÿ Git æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿æ‰¾åˆ° dev åˆ†å‰å‡ºæ¥çš„é‚£æ¬¡ commitï¼Œå°†å…¶è¾“å‡ºä¼ é€’ç»™git rebase -iå³å¯å®ç°æ•´ç†æ•´ä¸ª dev çš„æ‰€æœ‰ commitã€‚\n1git merger-base dev main git merege vs git rebase å‡†åˆ™   å¦‚æœåˆ†æ”¯å·²ç»è¢«æäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œå°±ä¸èƒ½å†æ”¹å˜ä»–çš„å†å²äº†ï¼Œå³ä¸èƒ½ä½¿ç”¨ rebaseã€‚ git ä¹Ÿä¼šé˜»æ­¢ä½ è¿™ä¹ˆåšï¼Œå› ä¸ºåˆ†æ”¯çš„å†å²å·²ç»è¢«ä¿®æ”¹ï¼Œé™¤é force-pushã€‚\n  ä½ èƒ½è¿›è¡Œ rebase çš„åˆ†æ”¯æ˜¯æœ¬åœ°çš„â€ç§äººåˆ†æ”¯â€ï¼Œç§äººè¡¨ç¤ºä¸º: åªæœ‰ä½ è‡ªå·±åœ¨ä½¿ç”¨ï¼Œåˆ«äººä¸ä¼šåŸºäºä½ çš„åˆ†æ”¯åšä¸œè¥¿ã€‚\n  dev åŒæ­¥ä¸»åˆ†æ”¯çš„æ”¹åŠ¨: rebase å‡è®¾æˆ‘ä»¬æ­£åœ¨æœ¬åœ°çš„ dev åˆ†æ”¯å¼€å‘ä¸€ä¸ªç‰¹æ€§ï¼Œæ­¤æ—¶ä½ çš„åŒäº‹åœ¨ main(ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„è¿œç¨‹åˆ†æ”¯)ä¸Šæäº¤äº†ä¸€ä¸ªé‡è¦çš„ commitï¼Œä»¥è‡³äºä½ éœ€è¦å®ƒæ¥ç»§ç»­ä½ çš„å¼€å‘ä»»åŠ¡ã€‚\nè¿™ç§æƒ…å†µæˆ‘ä»¬ä½¿ç”¨ rebase å’Œ merge éƒ½èƒ½å®Œæˆç›®æ ‡ï¼Œä½†æ˜¯ rebase æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\n é¦–å…ˆæ»¡è¶³ rebase çš„ä½¿ç”¨æ¡ä»¶ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯ç ´åäº†æœ¬åœ° dev åˆ†æ”¯çš„å†å²ï¼Œå¹¶æ²¡æœ‰åŠ¨åˆ°å…¶ä»–çš„è¿œç¨‹åˆ†æ”¯ï¼Œæ‰€ä»¥å°±ä¸å­˜åœ¨å¹²æ¶‰åˆ«äºº å…¶æ¬¡ï¼Œåœ¨ dev ä¸Š merge å…¶ä»–åˆ†æ”¯ä¼šäº§ç”Ÿä¸€æ¬¡ä¸å¿…è¦çš„merge commitï¼Œå…¶ä¸ä»£è¡¨ä»»ä½•å®é™…æ„ä¹‰ï¼Œæ²¡å¿…è¦å­˜åœ¨çš„  åˆå¹¶ dev åˆ°ä¸»åˆ†æ”¯: merge å¾ˆç®€å•çš„é€»è¾‘ï¼Œä¸»åˆ†æ”¯æˆ–è€…å…¶ä»–åˆä½œå¼€å‘çš„åˆ†æ”¯å¹¶ä¸æ˜¯ä½ ä¸€ä¸ªäººåœ¨ç”¨ï¼Œå¹¶ä¸”éœ€è¦æœ€ååŒæ­¥åˆ°è¿œç¨‹ä»“åº“ï¼Œä¸ç¬¦åˆä½¿ç”¨ rebase çš„å‡†åˆ™\ngit log å‚æ•°:    Parameter Description     non-param åˆ—å‡ºæ‰€æœ‰å†å²æäº¤çš„ SHAã€ä½œè€…ã€æäº¤æ—¥æœŸå’Œ commit   -p æŒ‰è¡¥ä¸æ˜¾ç¤ºæ¯æ¬¡æ›´æ–°ï¼Œæ¯”\u0026ndash;stat æ›´å…¨   \u0026ndash;stat æ˜¾ç¤ºæ¯æ¬¡æ›´æ–°ä¿®æ”¹æ–‡ä»¶çš„åç§°åŠæ·»åŠ ï¼ˆåˆ é™¤ï¼‰çš„è¡Œæ•°ã€‚æ¯”\u0026ndash;name-only æ›´å…¨   \u0026ndash;name-only æ˜¾ç¤ºæ–‡ä»¶æ¸…å•   \u0026ndash;name-status æ˜¾ç¤ºæ–‡ä»¶æ¸…å•åŠæ”¹åŠ¨æ–¹å¼(æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹)   \u0026ndash;oneline åªæ˜¾ç¤ºå‰ 6 ä½ SHA å€¼å’Œ commit   -n æ˜¾ç¤ºå‰ n æ¡ log   \u0026lt;branch\u0026gt; æŸ¥çœ‹æŸä¸ªåˆ†æ”¯çš„å†å²æäº¤ã€‚è¯¥å‚æ•°åªèƒ½ log å‘½ä»¤ä¹‹å   \u0026lt;branch1\u0026gt;..\u0026lt;branch2\u0026gt;             å‚è€ƒç½‘ç«™ï¼šhttps://www.cnblogs.com/bellkosmos/p/5923439.html\nExample 1: å½©è‰²æ˜¾ç¤ºé‡è¦ä¿¡æ¯ 1git log --graph --pretty=format:\u0026#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)\u0026lt;%an\u0026gt;%Creset\u0026#39; --abbrev-commit Example 2: æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯å’Œå¯¹åº”è¿œç¨‹åˆ†æ”¯çš„ commit å·®å¼‚ 1git log --oneline main..origin/main å­æ¨¡å—: submodule æ–°å¢ä¸€ä¸ªå­æ¨¡å— (1) å°†å­æ¨¡å—ä¸Šä¼ åˆ°è¿œç«¯ä»“åº“ä¸Šï¼Œæˆ–è€…ä½¿ç”¨å·²æœ‰çš„ç¬¬ä¸‰æ–¹é¡¹ç›®\n(2) æ‰§è¡Œ\n1git submodule add [url] [path] (3) æ­¤æ—¶çœ‹git status ä¼šæœ‰ä¸¤ä¸ªchangesï¼Œåˆ†åˆ«æ˜¯ï¼š\n .gitmodulesä¸­ä¼šå¢åŠ ä¸€æ¡é¡¹ç›®, è®°å½•å­æ¨¡å—çš„åç§°å’Œåœ°å€ 1[submodule \u0026#34;SubmoduleTestRepo\u0026#34;] 2 path = SubmoduleTestRepo 3 url = https://github.com/jzaccone/SubmoduleTestRepo.git  [å­æ¨¡å—åŒåçš„æ–‡ä»¶]: è®°å½•ä¸»é¡¹ç›®è¿½è¸ªçš„æ˜¯å­æ¨¡å—çš„å“ªä¸ªcommit   .gitmoduleå’Œå­æ¨¡å—åŒåæ–‡ä»¶çš„ä½œç”¨\n  å…ˆè¯´æ¯”è¾ƒç®€å•çš„.gitmoduleï¼Œè®°å½•ä¸»é¡¹ç›®ä¸­ç”¨åˆ°çš„æ‰€æœ‰å­æ¨¡å—ã€‚ ä¸€èˆ¬æ¥è¯´ä»…ä»…è®°å½•å­æ¨¡å—çš„è·¯å¾„å’Œurlï¼Œä½†æœ‰æ—¶è¿˜ä¼šæœ‰æŒ‡å®šçš„åˆ†æ”¯åã€‚ è¿™ä¸ªæˆ‘ä»¬åœ¨ä¸‹é¢ä¼šä»‹ç»ã€‚\n  ç„¶åæ˜¯å’Œå­æ¨¡å—åŒåçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œä¸Šé¢çš„.gitmodulesä»…ä»…å‘Šè¯‰äº†ä»å“ªæ¥ï¼Œ ä½†æ˜¯ä¸€ä¸ªä»“åº“æ˜¯æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå¯¹åº”å¤šä¸ªcommitçš„ï¼Œé‚£ä¹ˆéœ€è¦æœ‰ä¸€ç§æ–¹å¼å»æŒ‡å®šä½¿ç”¨ç»‘å®šå“ªä¸ªcommitï¼Œ è¿™å°±æ˜¯åŒåæ–‡ä»¶çš„ä½œç”¨ã€‚åœ¨åŒåæ–‡ä»¶ä¸­ä¼šè®°å½•ä¸€ä¸‹commitidï¼Œè¡¨æ˜ä¸»é¡¹ç›®ä¾èµ–è¿™ä¸ªcommitidä¸‹çš„å­æ¨¡å—ï¼Œ ä»–ä»¬ä¹‹é—´å…·æœ‰ç»‘å®šå…³ç³»ã€‚\n   (4) git addè¿™ä¸¤å¤„æ”¹åŠ¨ï¼Œgit commit -m \u0026quot;add submodule xxx\u0026quot;\nSubmodule Command Execute git submodule --help to get more info.\ngit submodule init æ­¤å‘½ä»¤cloneæ–°é¡¹ç›®çš„æ—¶å€™ä¼šç”¨åˆ°, å®Œæ•´çš„å‘½ä»¤æ˜¯\n1git submodule init [path]  åœ¨è¯¦ç»†ä»‹ç»å‰éœ€è¦è¯´æ˜ä¸¤ä¸ªæ–‡ä»¶çš„å·®åˆ«: .gitmoduleå’Œ.git/config:\n .gitmoudlesåœ¨ä¸Šé¢å·²ç»ä»‹ç»è¿‡ä¸€äº›ï¼Œè¿™é‡Œä¸»è¦æƒ³è¯´å®ƒæ˜¯è·Ÿéšä¸»é¡¹ç›®ä¸€èµ·æäº¤çš„ï¼Œ è€Œ.git/configæ˜¯åé¢ç”Ÿæˆçš„æœ¬åœ°æ–‡ä»¶ã€‚ .gitmodulesä¼šç»™å‡ºåˆ—å‡ºæ‰€æœ‰å­æ¨¡å—ï¼Œä½†æ˜¯ä¸ä¸€å®šæ¯æ¬¡éƒ½å…¨éƒ¨ä½¿ç”¨ã€‚ **å…·ä½“ä¼šå¯ç”¨å“ªäº›ç”±.git/configæ–‡ä»¶è§„å®šã€‚   git submodule initæŒ‡ä»¤ä¼šæŒ‡å®šç”Ÿæˆ.git/configæ–‡ä»¶çš„å†…å®¹ã€‚ é€‰æ‹©æŸå‡ ä¸ªå­æ¨¡å—å¯ç”¨å³å†™å…¥.git/configã€‚\n åœ¨ç¼ºçœå‚æ•°ä¸‹çš„å«ä¹‰æ˜¯æ·»åŠ æ‰€æœ‰åœ¨.gitmodulesä¸­çš„å­æ¨¡å—ã€‚ æœªæ¥updateæŒ‡ä»¤åªä¼šæ›´æ–°.git/configä¸­çš„é¡¹ç›®ã€‚  git submodule update åˆšæ‰è¯´äº†ï¼Œå› ä¸º.gitmodulesä¸­çš„æ‰€æœ‰å­æ¨¡å—å¹¶ä¸ä¸€å®šéƒ½ä½¿ç”¨ï¼Œ æ‰€ä»¥æ–°cloneä¸‹æ¥çš„é¡¹ç›®å¹¶ä¸ä¼šåŒæ—¶ä¸‹è½½æ‰€æœ‰çš„å­æ¨¡å—ã€‚ åœ¨ä¸Šé¢çš„inité˜¶æ®µç”Ÿæˆäº†.git/configæ¥æŒ‡å®šéœ€è¦å“ªäº›ä¹‹åï¼Œ updateå‘½ä»¤å°±æ˜¯ç”¨äºä¸‹è½½æŒ‡å®šçš„å­æ¨¡å—ã€‚\n\u0026ndash;init ç”±äºæ­¤å‘½ä»¤é…åˆinitå‘½ä»¤ä½¿ç”¨ï¼Œä¸¤è€…é€šå¸¸è¿ç»­æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥åˆå¹¶ä¸º:\n1git submodule update --init \u0026ndash;remote ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸‹è½½å­æ¨¡å—éƒ½æ˜¯checkoutåˆ°.git/configæŒ‡å®šçš„commitã€‚ --remoteåˆ™ä¼šcheckoutåˆ°è¿½è¸ªåˆ†æ”¯çš„æœ€æ–°commitï¼Œä¸‹é¢ä¼šè¯´åˆ°å¦‚ä½•è®¾ç½®è¿½è¸ªåˆ†æ”¯ï¼Œ é»˜è®¤æ˜¯masterã€‚\nå¦‚æœæœ€æ–°çš„commitä¸ç­‰äº.git/configæŒ‡å®šçš„ï¼Œé‚£ä¹ˆæ‰§è¡Œå®Œè¯¥æŒ‡ä»¤åä¼šäº§ç”Ÿä¸€æ¬¡åŒåæ–‡ä»¶çš„æ”¹åŠ¨ã€‚\ngit submoudle set-x ä¿®æ”¹çš„æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Ÿ\n\u0026ldquo;x\u0026quot;å¯ä»¥æ˜¯urlï¼Œä¿®æ”¹å­æ¨¡å—çš„åœ°å€ã€‚\nè¿™é‡Œæˆ‘ä¸»è¦æƒ³ç€é‡ä»‹ç»set-branchå‘½ä»¤ï¼Œå°†åŸæ¥è¿½è¸ªè‡ªæ¨¡å—çš„æ–¹å¼ç”±commitæ›´æ”¹ä¸º(branch+commit)ã€‚ æƒ³è¦ä¿®æ”¹è¿½è¸ªå­æ¨¡å—çš„commitåˆ°æŸä¸ªåˆ†æ”¯çš„æœ€æ–°ï¼Œæœ‰ä¸¤ç§æ–¹æ³•:\n ä¼ ç»Ÿæ–¹æ¡ˆ 1cd lib1/ 2git checkout \u0026lt;branch\u0026gt; 3cd .. 4git add lib1 5git commit -m \u0026#34;change lib1\u0026#39;s tracked commit\u0026#34;  ä½¿ç”¨set-branchå‚æ•° 1git submodule set-branch -b \u0026lt;branch\u0026gt; lib1/ 2# æ”¹å˜è®¾ç½®ä¹‹åï¼Œå­æ¨¡å—ä¸ä¼šç«‹å³å˜åŒ– 3# å¿…é¡»æŒ‡å®šå¸¦remoteå‚æ•°çš„updateå‘½ä»¤ï¼Œæ‰ä¼šç”¨æ›´æ–°åˆ°æ˜¾å¼æŒ‡å®šçš„åˆ†æ”¯æœ€æ–°ï¼Œ 4# è€Œä¸æ˜¯åŒåæ–‡ä»¶ä¸­è§„å®šçš„commitid 5git submodule update --remote 6git add lib1 .gitmodules 7git commit -m \u0026#34;change lib1\u0026#39;s tracked commit\u0026#34;    set-branchä¿®æ”¹äº†.gitmodules, ä¹ŸåŒæ­¥åˆ°äº†.git/configä¸­ã€‚å¦‚æœä½ æƒ³æ‰‹åŠ¨ä¿®æ”¹.gitmodulesæ¥è®¾ç½®åˆ†æ”¯ï¼Œä¸è¦å¿˜äº†submodule initæ¥åŒæ­¥åˆ°.git/config\n ä½¿ç”¨Submoduleæ³¨æ„äº‹é¡¹ 1.Submoduleåˆ°åº•æ˜¯è¿½è¸ªåˆ†æ”¯è¿˜æ˜¯commit äº‹å®è¯æ˜å­æ¨¡å—é»˜è®¤è¿½è¸ªçš„ä¸æ˜¯åˆ†æ”¯ï¼Œå®¹æ˜“éªŒè¯ã€‚ æˆ‘ä»¬å°†å­æ¨¡å—åŸºäºå½“å‰åˆ†æ”¯ï¼ˆå‡è®¾masterï¼‰æ–°å»ºä¸€ä¸ªå­åˆ†æ”¯ï¼Œå¹¶åšä¸€äº›ä¿®æ”¹ï¼Œ å¯ä»¥çœ‹åˆ°ä¸»é¡¹ç›®ä¸­çš„å­æ¨¡å—åŒåæ–‡ä»¶ä¹Ÿå‘ç”Ÿäº†æ”¹åŠ¨ã€‚ æ‰€ä»¥è¯´ï¼Œå®ƒé»˜è®¤å¹¶ä¸æ˜¯è·Ÿè¸ªåˆ†æ”¯ã€‚\næˆ‘æ„Ÿè§‰å¯ä»¥è¯æ˜å®ƒé»˜è®¤è·Ÿè¸ªçš„æ˜¯HEADã€‚è¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œ æ­¤æ—¶ä¸»é¡¹ç›®ä¸­åŒåæ–‡ä»¶å‘ç”Ÿäº†æ”¹åŠ¨ã€‚ä½†æ˜¯å¦‚æœå°†å­æ¨¡å—çš„åˆ†æ”¯åˆ‡æ¢å›åŸæ¥çš„masterï¼Œ å­æ¨¡å—åŒåæ–‡ä»¶çš„æ”¹åŠ¨å°±æ¶ˆå¤±äº†ã€‚ä»¥æˆ‘ç›®å‰çš„è§è§£æˆ‘æš‚ä¸”è¿™ä¹ˆè®¤ä¸ºã€‚\n2. åŒåæ–‡ä»¶å‘ç”Ÿäº†ä¿®æ”¹ï¼Œåº”ä¸åº”è¯¥stageï¼Ÿ åˆ†ä¸¤ç§åœºæ™¯: (1)å¦‚æœå­é¡¹ç›®çš„è¿™äº›æ›´æ–°æœ‰æ„ä¹‰åŒæ­¥åˆ°ä¸»é¡¹ç›®ä¸­ï¼Œé‚£ä¹ˆå°±addå¹¶commitè¿™ä¸ªåŒåæ–‡ä»¶çš„æ”¹åŠ¨ï¼Œ messageä¸º\u0026quot;æ›´æ–°submodule\u0026rdquo;ã€‚ (2)å¦‚è‹¥åªæ˜¯æ›´æ–°å­é¡¹ç›®è€Œå·²ï¼Œæˆ–è®¸æ˜¯ä¸ºäº†å…¶ä»–ä¾èµ–çš„é¡¹ç›®æ‰€æ”¹çš„ï¼Œå¹¶ä¸ æƒ³æ¶‰åŠåˆ°æœ¬ä¸»é¡¹ç›®ï¼Œé‚£ä¹ˆå°±restoreæ­¤æ¬¡æ›´æ–°ï¼Œæˆ–è€…é‡æ–°æ‰§è¡Œsubmodule updateå³å¯(å‰ææ˜¯å¯¹å­æ¨¡å— çš„ä¿®æ”¹å·²ç»push)ã€‚\næ‰€ä»¥è¯´ï¼ŒåŒæ„ä¸»é¡¹ç›®ä¸­çš„è¿™æ¬¡changeçš„äººå¿…é¡»æ˜¯æ›´æ–°è¿™æ¬¡å­æ¨¡å—çš„äººï¼Œç”±ä»–å†³å®šæ˜¯å¦åŒæ­¥åˆ°ä¸»é¡¹ç›®ã€‚ å…¶ä»–äººç”šè‡³åœ¨ä½¿ç”¨æœŸé—´éƒ½ä¸éœ€è¦cdè¿›å…¥å­æ¨¡å—åšgit pullçš„ï¼Œè¿™æ ·ä¹Ÿå°±ä¸ä¼šæœ‰å†³ç­–äº§ç”Ÿï¼Œå³ä¾¿ å­é¡¹ç›®åœ¨è¿œç«¯æ›´æ–°äº†ï¼Œä½ è¦åšçš„å°±æ˜¯å…³æ³¨é‚£ä¸ªåŒåæ–‡ä»¶å°±è¡Œï¼Œå½“åŒåæ–‡ä»¶æ›´æ–°äº†ï¼Œåœ¨ä¸»é¡¹ç›®ä¸­ submodule updateå³å¯ï¼Œ\nå­æ¨¡å—çš„ä¼˜ç¼ºç‚¹ TODO\n","date":"2022-12-13T17:39:42+08:00","permalink":"https://wangloo.github.io/posts/tools/git/git/","section":"posts","tags":["git","tools"],"title":"git å®å…¸"},{"categories":null,"contents":"..\nnm - åˆ—å‡ºç¬¦å· nm (GNU Binary Utilities) (sourceware.org)\n","date":"2022-12-03T19:08:22+08:00","permalink":"https://wangloo.github.io/posts/os/gnu_tools/","section":"posts","tags":["Operating System"],"title":"GNU äºŒè¿›åˆ¶å·¥å…·é›†"},{"categories":["Makefile"],"contents":"ä¼ªç›®æ ‡çš„ä¾èµ–å…³ç³» Makefile ä¸­çš„ä¾èµ–å…³ç³»æŒ‡çš„æ˜¯ç›®æ ‡å’Œä¾èµ–ä¹‹é—´å»ºç«‹çš„å…³ç³»ï¼Œç›®æ ‡å¯¹åº”è§„åˆ™ä¸­çš„è¯­å¥æ˜¯å¦æ‰§è¡Œå–å†³äºä¾èµ–çš„çŠ¶æ€ã€‚\næœ€ç®€å•çš„ä¾èµ–å…³ç³»å¯ä»¥æ‹¿ä¸¤ä¸ªæ–‡ä»¶æ¥ä¸¾ä¾‹:\n1# gccè¯­å¥æ‰§è¡Œå½“å‰ä»…å½“ main.c æ–°äº main.elf 2main.elf: main.c 3 gcc main.c -o main.elf make åœ¨æ‰§è¡Œmain.elfçš„è§„åˆ™æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­ä¾èµ–å…³ç³»ã€‚æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œ gcc è¯­å¥æ˜¯å¦æ‰§è¡Œå–å†³äºmain.c å’Œ main.elfçš„ä¿®æ”¹æ—¶é—´ï¼Œåªæœ‰å½“ ä¾èµ–æ–°ä¸ç›®æ ‡æ—¶ï¼Œè§„åˆ™è¯­å¥æ‰ä¼šæ‰§è¡Œã€‚\nç„¶è€Œè®¸å¤šæƒ…å†µä¸‹ï¼Œç›®æ ‡æˆ–è€…ä¾èµ–å¹¶ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯è™šæ‹Ÿç›®æ ‡ã€‚è™šæ‹Ÿç›®æ ‡ å¹¶ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå³å®ƒæ²¡æœ‰ä¿®æ”¹æ—¶é—´è¿™ä¸ªå±æ€§ï¼Œæ­¤æ—¶ make å°±ä¸èƒ½ä½œæ¯”è¾ƒï¼Œç»“æœå°±æ˜¯ å¦‚æœç›®æ ‡æ˜¯ä¼ªç›®æ ‡ï¼Œé‚£ä¹ˆä¸ç®¡ä¾èµ–å¦‚ä½•éƒ½æ‰§è¡Œè§„åˆ™è¯­å¥ï¼›å¦‚æœä¾èµ–æ˜¯ä¼ªç›®æ ‡ï¼Œ é‚£ä¹ˆç›®æ ‡çš„è§„åˆ™è¯­å¥ä¹Ÿæ°¸è¿œè¢«æ‰§è¡Œã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªä¾‹å­ï¼š\n1# ä¼ªç›®æ ‡ä½œä¸ºç›®æ ‡æ–‡ä»¶å‡ºç° 2# build finishæ€»æ˜¯è¾“å‡ºï¼Œ è€Œgccè¯­å¥ä»…å½“main.cæ¯”main.elfæ–°æ—¶æ‰æ‰§è¡Œ 3.PHONY : all 4all: main.elf 5\t@echo \u0026#39;build finish\u0026#39; 6main.elf: main.c 7\tgcc $\u0026lt; -o $@ 1# ä¼ªç›®æ ‡ä½œä¸ºä¾èµ–æ–‡ä»¶ä¸­å‡ºç° 2# ä¸ç®¡main.cæ˜¯å¦æ¯”main.elfæ›´æ–°ï¼Œå› ä¸ºpre-workæ˜¯ä¼ªç›®æ ‡ 3# æ‰€ä»¥gccè¯­å¥æ€»æ˜¯æ‰§è¡Œ 4.PHONY : pre-work 5main.elf: main.c pre-work 6\tgcc $\u0026lt; -o $@ ä¸Šé¢çš„ä»£ç çš„æ•ˆæœæ˜¯ï¼šä¸¤æ¡è§„åˆ™ä¸­çš„è¯­å¥éƒ½ä¼šæ‰§è¡Œï¼Œå³ä½¿ä½ å¹¶æ²¡æœ‰å¯¹ main.c åšä»»ä½•ä¿®æ”¹ï¼\nææ€–çš„ç©ºæ ¼ Makefile ä¸­çš„å˜é‡ç»“åˆå¾ˆå¸¸è§ï¼Œä¾‹å¦‚$(FIXDEP)=$(FIXDEP_PATH)/build/fixdep.\nç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬è¿™äº›è¯­å¥æ˜¯ä»æŸäº›åœ°æ–¹ç²˜è´´è¿‡æ¥ï¼Œè¦ç‰¹åˆ«æ³¨æ„å˜é‡ä¸­æ˜¯å¦æœ‰ç©ºæ ¼ï¼ŒMakefile éå¸¸é‡è§†è¿™ä¸ªã€‚å‡å¦‚$(FIXDEP_PATH)ä¸­æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œé‚£ä¹ˆ$(FIXDEP)å°±å˜æˆä¸¤ä¸ªå®äº†ï¼ˆä¸çŸ¥é“å«å®åˆä¸åˆé€‚ï¼‰ã€‚è€Œä¸” Make çš„æ‰§è¡Œè¿‡ç¨‹å¾ˆéš¾æ£€æŸ¥å‡ºæ¥ã€‚\nè§„åˆ™çš„æ‰§è¡Œé¡ºåº å¦‚æœä¸ä»å‘½ä»¤è¡Œä¼ å…¥ç›®æ ‡, Makefile ä¸­å®šä¹‰çš„è§„åˆ™å…¶å®æ˜¯ä»¥ä»ä¸Šè€Œä¸‹çš„é¡ºåºæ‰§è¡Œçš„, ä½†æ˜¯æˆ‘ä¹ æƒ¯æŠŠ all è¿™ç§é»˜è®¤è§„åˆ™æ”¾åœ¨æœ€ä¸‹é¢, æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤š Makefile ä¼šåœ¨å¼€å¤´å†™ä¸€å¥è§„åˆ™all:, ä½œç”¨å°±æ˜¯å‘Šè¯‰ make é»˜è®¤(ä¸æ˜¾å¼æŒ‡å®š)çš„ç›®æ ‡æ˜¯all.\n Busybox æ ¹ç›®å½• Makefile ä¸­çš„åšæ³•ç¤ºä¾‹\n1# That\u0026#39;s our default target when \u0026gt;none is given on the command line 2.PHONY: _all 3_all:  å‡½æ•°çš„é­”æ³• patsubst 1$(patsubst \u0026lt;pattern\u0026gt;,\u0026lt;replacement\u0026gt;,\u0026lt;text\u0026gt;) åŠŸèƒ½ï¼šæŸ¥æ‰¾\u0026lt;text\u0026gt;ä¸­çš„å•è¯ï¼ˆä»¥ç©ºæ ¼ï¼Œtabï¼Œå›è½¦ï¼Œæ¢è¡Œåˆ†å‰²ï¼‰ï¼Œçœ‹å…¶æ˜¯å¦ç¬¦åˆ\u0026lt;pattern\u0026gt;, å¦‚æœç¬¦åˆï¼Œå°†å…¶ä½¿ç”¨\u0026lt;replacement\u0026gt;æ›¿æ¢ã€‚å¯ä»¥ä½¿ç”¨é€šé…ç¬¦%ã€‚\nä»¥ä¸‹ä¸¤å¯¹æ˜¯ç­‰æ•ˆçš„, æ˜æ˜¾è¿˜æ˜¯ç›´æ¥ä½¿ç”¨å˜é‡çš„æ›¿æ¢è¯­æ³•æ“ä½œç®€å•:\n1$(patsubst \u0026lt;pattern\u0026gt;,\u0026lt;replacement\u0026gt;,$(var)) 2$(var:\u0026lt;pattern\u0026gt;=\u0026lt;replacement\u0026gt;;) 3 4$(patsubst %\u0026lt;suffix\u0026gt;,%\u0026lt;replacement\u0026gt;,$(var)) 5$(var:\u0026lt;suffix\u0026gt;=\u0026lt;replacement\u0026gt;) ä½¿ç”¨ shell å˜é‡ Make å°† $$var è½¬ä¹‰ä¸º$var, ä¾› shell å¤„ç†.\ndemo(æºè‡ª 6.828 æ ¹ç›®å½•GNUmakefile):\n1handin-check: 2 @if test -n \u0026#34;`git status -s`\u0026#34;; then \\ 3 git status -s; \\ 4 read -p \u0026#34;Untracked files will not be handed in. Continue? [y/N] \u0026#34; r; \\ 5 test \u0026#34;$$r\u0026#34; = y; \\ 6 fi  ä»¥ä¸Š demo è¿˜ä½¿ç”¨äº† test å‘½ä»¤æ¥ç»ˆæ­¢ make çš„æ‰§è¡Œ, å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥y, make å°†ä¼šç»ˆæ­¢æ‰§è¡Œ\n ä½¿ç”¨å¦ä¸€ä¸ª Makefile å¸¸è§çš„æœ‰ä¸‰ç§æ–¹å¼ï¼Œ make -C, make -f å’Œ include\nmake -C \u0026lt;dir\u0026gt; çš„ä½œç”¨ç­‰ä»·ä¸ cd \u0026lt;dir\u0026gt;+make, å¸¸è§äºåœ¨ä¸€ä¸ªå·¥ç¨‹ çš„ä¸»ç›®å½•ä¸‹ï¼Œä¾æ¬¡ç¼–è¯‘ç”Ÿæˆå…¶ä»–å­ç›®å½•çš„ç›®æ ‡æ–‡ä»¶ã€‚æœ‰cdå‘½ä»¤çš„æ•ˆæœï¼Œä¼šåˆ‡æ¢ å½“å‰ç›®å½•ã€‚\nmake -f \u0026lt;file\u0026gt; æ›´åƒä¸´æ—¶ä½¿ç”¨æŸä¸ª Makefile æ¥æ‰§è¡Œä¸€äº›æ“ä½œï¼Œåœ¨æŒ‡å®šçš„ Makefile ä¸­å¦‚æœæƒ³ä½¿ç”¨ä¹‹å‰çš„å˜é‡ï¼Œéœ€è¦export. ç›®å‰è¿˜æ²¡æœ‰å‘ç°æœ‰å¿…è¦çš„ åº”ç”¨åœºæ™¯ï¼Œå¤§éƒ¨åˆ†ç”¨includeæ–¹å¼æ›¿ä»£ã€‚\ninclude \u0026lt;file\u0026gt; ä¸€èˆ¬ç”¨äºå¼•å…¥ä¸€äº›é€šç”¨è§„åˆ™ï¼Œå°±åƒ C è¯­è¨€çš„ include å¤´æ–‡ä»¶ ä¸€æ ·ï¼Œå˜é‡æ— éœ€export.\n","date":"2022-12-03T19:08:22+08:00","permalink":"https://wangloo.github.io/posts/c/make/makefile_tricks/","section":"posts","tags":["makefile"],"title":"Makefile ä¸€äº›æŠ€å·§"},{"categories":null,"contents":" ..\nç¯å¢ƒå˜é‡ç›¸å…³ å†…å­˜æ“ä½œ ç½‘ç»œæ“ä½œ EMMCå’ŒSDå¡ BOOTæ“ä½œæŒ‡ä»¤ bootm go å…¶ä»–å‘½ä»¤ å¯åŠ¨ç›¸å…³\nmd\nmmcinfo\ncp\n","date":"2022-11-27T22:03:48+08:00","permalink":"https://wangloo.github.io/posts/os/uboot/commands/","section":"posts","tags":null,"title":"Uboot: å¸¸ç”¨å‘½ä»¤"},{"categories":["Shell"],"contents":"å¼€å‘ mkfs.ext4 æ ¼å¼åŒ–æ–‡ä»¶ä¸ºext4åˆ†åŒº\n1mkfs.ext4 \u0026lt;file\u0026gt; # å°†fileæ ¼å¼åŒ–ä¸ºext4 dd https://www.runoob.com/linux/linux-comm-dd.html\nmount 1sudo mount [file] [dir] # æŒ‚è½½fileåˆ°dir 2sudo umount [dir] 3sudo mount # è¾“å‡ºå½“å‰å·²ç»æŒ‚è½½çš„åˆ†åŒº é€šç”¨ where and which which æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®\n1$ which python3 2/usr/bin/python3 whereis é™¤äº†å¯æ‰§è¡Œæ–‡ä»¶è¿˜èƒ½æœç´¢å…¶ä»–ç±»å‹çš„æ–‡ä»¶, ä¸å¸¸ç”¨, è¯¦è§ man whereis\n- çš„å¦™ç”¨ ä¸€äº›å‘½ä»¤æ”¯æŒä½¿ç”¨ - ä»£æ›¿æ–‡ä»¶å, è¾“å…¥è¾“å‡ºéƒ½å¯ä»¥:\n ä»£æ›¿æ ‡å‡†è¾“å‡º; ä¸€äº›å‘½ä»¤ä¼šå°†-o/-O åé¢çš„-åˆ¤å®šä¸ºè¾“å‡ºåˆ°STDOUT, è¯¦è§ä¸‹é¢ç¤ºä¾‹. ä»£æ›¿æ ‡å‡†è¾“å…¥;  ä¸‹é¢ç»™å‡ºä¸¤ä¸ªåŒæ—¶ä»£æ›¿è¾“å…¥è¾“å‡ºçš„ä¾‹å­:\n1# å°†æ ‡å‡†è¾“å…¥(STDIN)çš„å†…å®¹ä½œä¸ºgccçš„è¾“å…¥, ç¼–è¯‘åçš„ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º(STDOUT) 2echo \u0026#39;void foo() {}\u0026#39; | gcc -x c -o - - 3# å°†ä¸‹è½½çš„æ–‡ä»¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º, åŒæ—¶ä½œä¸ºtarå‘½ä»¤çš„è¾“å…¥æ–‡ä»¶, è¿›è¡Œè§£å‹ 4wget -O - \u0026#34;https://www.dropbox.com/download?plat=lnx.x86_64\u0026#34; | tar xzf -  - å¦‚ä½•è¢«è§£ææ˜¯å–å†³äºå‘½ä»¤çš„å®ç°, éæ ‡å‡†. æ¯”å¦‚ cd - å°±æœ‰ç‰¹æ®Šçš„å«ä¹‰\n ","date":"2022-11-27T14:45:58+08:00","permalink":"https://wangloo.github.io/posts/shell/shell-commands/","section":"posts","tags":["shell","bash"],"title":"å¸¸ç”¨çš„ shell å‘½ä»¤"},{"categories":["C Language"],"contents":"è®¡ç®—æ•°ç»„å…ƒç´ çš„ä¸ªæ•° 1#define nelem(array) sizeof(array)/sizeof(array[0]) ","date":"2022-11-24T01:35:24+08:00","permalink":"https://wangloo.github.io/posts/c/c-macros/","section":"posts","tags":["c"],"title":"C è¯­è¨€å·¥å…·å®"},{"categories":["C Language"],"contents":"TODO: inline çš„å‘å±•å†ç¨‹: Myth and reality about inline in C99 â€“ Jens Gustedt\u0026rsquo;s Blog (wordpress.com)\nGNU89: å‡½æ•°çš„å®ç°ä¹‹å‰æ·»åŠ ä¸åŒçš„å…³é”®å­—:\n  inline: è¡¨æ˜è¿™ä¸ªå‡½æ•°å¯èƒ½è¢«ä¼˜åŒ–. å¦‚æœæ²¡æœ‰è¢«ä¼˜åŒ–, ç¼–è¯‘å™¨å°±ä¼šè§†ä¸ºä¸€ä¸ªå¸¸è§„å‡½æ•°çš„å®šä¹‰.\n  extern inline: è¡¨æ˜è¿™ä¸ªå‡½æ•°å¯èƒ½è¢«ä¼˜åŒ–. å¦‚æœæ²¡æœ‰è¢«ä¼˜åŒ–, ç¼–è¯‘å™¨å°±å°†è¿™ä¸ªå‡½æ•°çš„å®šä¹‰è½¬æ¢ä¸ºè¯¥å‡½æ•°çš„å£°æ˜, å³ extern inline func(); å› æ­¤å½“æ­¤å‡½æ•°è¢«è°ƒç”¨æ—¶, å¯ä»¥è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨çš„å‡½æ•°æ¥æ›¿ä»£. å¦‚æœæ²¡æœ‰å‡½æ•°è°ƒç”¨å®ƒ, é‚£ä¹ˆä¹Ÿå¯ä»¥æ²¡æœ‰å¤–éƒ¨çš„æ›¿ä»£å‡½æ•°å®ç°.\n  static inline: è¡¨æ˜è¿™ä¸ªå‡½æ•°å¯èƒ½è¢«ä¼˜åŒ–. å¦‚æœæ²¡æœ‰è¢«ä¼˜åŒ–, ç¼–è¯‘å™¨å°±ä¼šè§†ä¸ºä¸€ä¸ªå¸¸è§„é™æ€å‡½æ•°.\n  C99: å‡½æ•°çš„å®ç°ä¹‹å‰æ·»åŠ ä¸åŒçš„å…³é”®å­—:\n inline: ç­‰æ•ˆäºgnu89ä¸­çš„extern inline extern inline: ç­‰æ•ˆäºgnu89ä¸­çš„inline static inline: ä¸gnu89ç›¸åŒå«ä¹‰.  C++: åªæœ‰inlineä¸€ä¸ªå…³é”®å­—, å¦‚æœä¸èƒ½ä¼˜åŒ–å°±å®šä¹‰ä¸ºæ™®é€šå‡½æ•°\n Ref:\nc++ - What does extern inline do? - Stack Overflow\nMyth and reality about inline in C99 â€“ Jens Gustedt\u0026rsquo;s Blog (wordpress.com)\n  C demo å…³äºä»¥ä¸Šçš„å„ç§æƒ…å†µ\n ","date":"2022-11-24T01:35:24+08:00","permalink":"https://wangloo.github.io/posts/c/inline/","section":"posts","tags":["c"],"title":"Cè¯­è¨€ \"inline\" å…³é”®å­—"},{"categories":["Architecture"],"contents":"ç¬¦åˆè°ƒç”¨çº¦å®šä½¿å¾—è°ƒç”¨å‡½æ•°èƒ½å¤Ÿæ­£å¸¸è·å–å‚æ•°, calleeç»“æŸä¹‹åèƒ½å¤Ÿå›åˆ°åŸæ¥ä½ç½®ç»§ç»­æ‰§è¡Œ.\nX86 è°ƒç”¨çº¦å®š å‡½æ•°è°ƒç”¨ x86æ¶æ„ä¸­, å‡½æ•°è°ƒç”¨ä»¥ä¸€æ¡callæŒ‡ä»¤ä¸ºåˆ†ç•Œ.\nåœ¨callæŒ‡ä»¤æ‰§è¡Œä¹‹å‰, æ‰€æœ‰çš„å‚æ•°å¿…é¡»éƒ½èººåœ¨æ ˆä¸­, å‚æ•°å…¥æ ˆçš„è§„åˆ™æ˜¯: ç¬¬ä¸€ä¸ªå‚æ•°æœ€åå…¥æ ˆ.\nå¦å¤–, æ‰§è¡ŒcallæŒ‡ä»¤ä¹‹å‰, å¿…é¡»ç¡®ä¿æ ˆæŒ‡é’ˆespæ˜¯16-byteå¯¹é½. è¿™é¡¹å·¥ä½œæ˜¯ç¼–è¯‘å™¨å®Œæˆçš„, å¦‚æœå®ƒåˆ¤æ–­å‚æ•°å…¥æ ˆä¹‹åçš„esp ä¸æ»¡è¶³å¯¹é½æ¡ä»¶, åˆ™ä¼šæ‰‹åŠ¨è°ƒæ•´espä½¿ä¹‹å¯¹é½. å®ç°æ–¹å¼è§ä¸‹é¢ä¾‹å­.\ncall æŒ‡ä»¤çš„è¯­ä¹‰æ˜¯:\n1push pc+1 ;push next insttuction 2mov pc, func ;set pc = new function call æŒ‡ä»¤ä¹‹åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤å°±æ˜¯calleeçš„å†…å®¹äº†, è‡³æ­¤å°±ç®—æ˜¯è¿›å…¥æ–°å‡½æ•°çš„åœ°ç›˜.\nä½†æ˜¯åœ¨æ‰§è¡Œæ–°çš„ä»»åŠ¡ä¹‹å‰, calleeè¿˜éœ€è¦å®Œæˆæ ˆçš„è½¬æ¢, å› ä¸ºæ­¤æ—¶ä½¿ç”¨çš„æ ˆè¿˜æ˜¯callerçš„.\n1push ebp ;preserve location of caller\u0026#39;s stack 2mov ebp, esp ;new ebp is old esp æ­¤æ—¶espä¹Ÿå°±æ˜¯æ ˆæŒ‡é’ˆç­‰äºebp, è¿™æ˜¯calleeæ ˆçš„åˆå§‹æ¡ä»¶. ä¸‡äº‹ä¿±å¤‡, å¯ä»¥å¼€å§‹æ‰§è¡Œcalleeçš„å®é™…ä»»åŠ¡äº†.\n ebpåœ¨æ•´ä¸ªå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å›ºå®šçš„, å¥½å¤„æ˜¯: èƒ½å¤Ÿå¿«é€Ÿçš„æˆ–è€…å‡½æ•°å‚æ•°, è¿”å›åœ°å€.\n å‡½æ•°è¿”å› calleeæ‰§è¡Œå®Œæ¯•å, éœ€è¦è¿”å›åˆ°callerç»§ç»­æ‰§è¡Œ. åˆšæ‰è¯´è¿‡, calleeçš„è¿”å›åœ°å€åœ¨æ ˆä¸­, æ‰€ä»¥æˆ‘ä»¬è¦åšçš„æ˜¯æ‰¾åˆ°è¿”å›åœ°å€æ‰€åœ¨çš„ä½ç½®, ç„¶åä½¿pc = è¿”å›åœ°å€. å½“ç„¶, è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡å°±æ˜¯æ¢å¤callerçš„æ ˆ.\nä¸Šè¿°ä»»åŠ¡çš„å®ç°ä½¿ç”¨ä¸¤æ¡æ±‡ç¼–è¯­å¥å°±å¯å®Œæˆ: leave å’Œ ret.\nleave è´Ÿè´£æå®šæ ˆ, å…¶è¯­ä¹‰ä¸º:\n1mov esp, ebp ;å›æ»šæ ˆç©ºé—´ 2pop ebp ;æ¢å¤callerçš„ebp ret è´Ÿè´£æå®špc, å…¶è¯­ä¹‰ä¸º:\n1pop ebx ;å–å‡ºè¿”å›åœ°å€ 2mov pc, ebx ;jmp to è¿”å›åœ°å€ ret ä¹‹å, å°±ç®—æ˜¯è¿”å›callerçš„åœ°ç›˜äº†. è¿˜æœ‰ä¸€ä»¶å°äº‹åˆ«å¿˜äº†åš: ç”¨äºä¿å­˜å‚æ•°çš„æ ˆç©ºé—´è¿˜æ²¡æœ‰å›æ”¶, å›åˆ°callerä¹‹åéœ€è¦å…ˆå°†espçš„ä½ç½®è¿›è¡Œè°ƒæ•´.\nExample: å‡½æ•°çš„è°ƒç”¨å’Œè¿”å› ä¸€ä¸ªå…³äºå‡½æ•°è°ƒç”¨å’Œè¿”å›å®ç°çš„å®Œæ•´ä¾‹å­.\n1void caller() 2{ 3 Func(1, 2, 3); 4} 5void Func(int a, int b, int c) 6{ 7 /* Do something */ 8} (ä»¥ä¸‹æ±‡ç¼–æ˜¯AT\u0026amp;Tæ ¼å¼çš„, è¯·è§è°…).\n1; Caller 2sub $0x4,%esp ;make 16-bytes align before call. 0x4 æ˜¯ç”±ç¼–è¯‘å™¨è®¡ç®—çš„ 3push $0x3 ;push å‚æ•°, é¡ºåºæ˜¯ä»å³åˆ°å·¦ 4push $0x2 5push $0x1 6call f01000ad \u0026lt;Func\u0026gt; ;Func()\u0026#39;addr is f01000ad 7;===========\u0026gt;\u0026gt; Turn to callee 8 9 ;Func() 10 push %ebp ;preserve old ebp 11 mov %esp,%ebp ;set new ebp, ebp=esp now 12 /* Do something */ 13 leave ;restore stack 14 ret ;restore instruction point 15 16;\u0026lt;\u0026lt;=========== Back to caller 17add $0x10,%esp ;recycle stack(12 bytes parameters plus 4 bytes alignment) AArch64 è°ƒç”¨çº¦å®š å¤§ä½“çš„æ€æƒ³ä¸x86ç›¸ä¼¼, åªæ˜¯ç»†èŠ‚æœ‰äº›è®¸ä¸åŒ\nCall A Function ARMv8çš„å‡½æ•°è°ƒç”¨ä»¥blæŒ‡ä»¤ä¸ºåˆ†ç•Œï¼Œåœ¨blæ‰§è¡Œä¹‹å‰ï¼Œcalleréœ€è¦å°†å‚æ•°å‡†å¤‡å¥½ã€‚å°‘äº8ä¸ªå‚æ•°çš„å‡½æ•°åœ¨ä¼ å‚æ—¶, å‚æ•°æ˜¯æ”¾åœ¨x0-x7ä¸­, æœ€å·¦è¾¹çš„å‚æ•°å…ˆä½¿ç”¨x0, ä»¥æ­¤ç±»æ¨. å‚æ•°è¶…è¿‡8ä¸ªçš„æƒ…å†µä¸‹æ‰ä½¿ç”¨æ ˆ, è¿™ä¸x86çš„æ–¹å¼ä¸åŒ.\nblæŒ‡ä»¤ä¿å­˜è¿”å›åœ°å€, å¹¶è·³è½¬åˆ°calleeæ‰§è¡Œ, å…¶è¯­ä¹‰æ˜¯:\n1mov lr, pc+1 ;preserve return address 2 ;lr specially used for preservering return addr 3mov pc, new_func ;set pc = new function è‡³æ­¤åˆ°äº†calleeçš„èŒè´£èŒƒå›´ã€‚è¿›å…¥å‡½æ•°æ—¶, éœ€è¦å®Œæˆä¸‰ä¸ªå‰ç½®åŠ¨ä½œ:\n1; ä¸ºcallee()çš„æ‰§è¡Œç•™å‡ºè¶³å¤Ÿçš„æ ˆç©ºé—´ 2; 0x10ä¸æ˜¯å›ºå®šçš„, ç¼–è¯‘å™¨è®¡ç®—å¾—åˆ° 3sub sp, sp, #0x10 4 5; ä¿å­˜lrå’Œfp, å› ä¸ºcalleeå¯èƒ½è°ƒç”¨ 6; å…¶ä»–çš„å‡½æ•°, ä¼šç ´åå½“å‰çš„ 7stp x29, x30, [sp] 8 9; ä¿å­˜spçš„å€¼, æ‰€ä»¥x29ä¹Ÿç§°ä¸ºå¸§æŒ‡é’ˆ 10; åŸå› æ˜¯spåœ¨calleeçš„æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ 11; ä¼šå˜åŒ–. ä¸é€€å‡ºæ—¶é…åˆç†è§£è¾ƒå¥½ 12mov x29, sp ä¸Šè¿°åŠ¨ä½œå®Œæˆå, spæ˜¯è‡ªç”±çš„äº†, callee()çš„å‡½æ•°ä½“å¼€å§‹æ‰§è¡Œ.\nFunction Return callee()æ‰§è¡Œå®Œå, ä¹Ÿéœ€è¦æ‰§è¡Œä¸€äº›åç½®åŠ¨ä½œ, ä»¥ä¾¿æ¢å¤è°ƒç”¨å‰caller()çš„ç¯å¢ƒ.\n1; ç»è¿‡calleeçš„æŒ‡ä»¤æ‰§è¡Œè¿‡å, sp 2; å¯èƒ½æ—©å°±ä¸æ˜¯ä»¥å‰çš„späº†, ä½†æ˜¯å¸§æŒ‡é’ˆ 3; fpæ€»æ˜¯ä¿å­˜ç€calleeåˆå§‹çš„sp 4mov sp, x29 5 6; calleeå¦‚æœè°ƒç”¨äº†å…¶ä»–å‡½æ•°, lrå’Œfp 7; ä¹Ÿä¼šè¢«ç ´å, æ‰€ä»¥ä»æ ˆä¸­æ¢å¤callee 8; æ­£ç¡®çš„lrå’Œfp, æ‰èƒ½æ­£ç¡®å›åˆ°caller 9ldp x29, x30, [sp] 10 11; æ”¶å›ä¸ºcalleeåˆ†é…çš„æ ˆç©ºé—´, æ­¤æ—¶sp 12; æ˜¯è°ƒç”¨calleeä¹‹å‰çš„å€¼. 13add sp, sp, #0x10 åç½®åŠ¨ä½œå®Œæˆå, ç¯å¢ƒå·²ç»å¤§è‡´æ¢å¤åˆ°è°ƒç”¨callee()ä¹‹å‰çš„çŠ¶æ€äº†, é€šç”¨å¯„å­˜å™¨ä¸­çš„å€¼, å…¶å®ä¸å¿…æ‹…å¿ƒ, å› ä¸ºARMv8è§„å®šäº†å“ªäº›å¯„å­˜å™¨æ˜¯caller-savedæˆ–è€…callee-saved, å†è¯´åˆ°lrå’Œsp, callerä¹Ÿä¼šä¿å­˜åˆ°æ ˆä¸­, å°±åƒcalleeè°ƒç”¨å…¶ä»–çš„å‡½æ•°æ—¶çš„æƒ…å†µç›¸åŒ.\næ‰€ä»¥, å®Œæˆåç½®åŠ¨ä½œå, æ‰§è¡Œretæ¥è¿”å›åˆ°lrçš„ä½ç½®å³å¯.\nä¸ºä»€ä¹ˆç¼–è¯‘å‡ºçš„æ±‡ç¼–æ–‡ä»¶æ²¡æœ‰mov sp, x29? å¦‚æœæŸ¥çœ‹å®é™…Cå‡½æ•°ç¼–è¯‘åçš„æ±‡ç¼–ç»“æœ, å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šå‘ç°å‰ç½®å’Œåç½®è¡Œä¸ºä¸æ˜¯ä¸¥æ ¼çš„æŒ‰ç…§A64PCSä¸­è§„å®šçš„æ ·å­, å¸¸è§çš„æ˜¯åç½®åŠ¨ä½œç¼ºå°‘æ¢å¤spçš„æ‰§è¡Œ, å³mov sp, x29.\nåŸå› å…¶å®ä¸éš¾å‘ç°, calleeä¸­ä½¿ç”¨çš„å¯»å€æ–¹å¼éƒ½æ˜¯ç›¸å¯¹äºspå¯»å€, å³ä¸ä¿®æ”¹sp. æ—¢ç„¶spä»å§‹è‡³ç»ˆéƒ½æ²¡è¢«æ”¹è¿‡, è‡ªç„¶ä¹Ÿä¸éœ€è¦æ¢å¤äº†. è¿™æ ·ä¸éœ€è¦æ¯æ¬¡éƒ½éœ€è¦sp, æ›´åŠ é«˜æ•ˆ.\nä½†æ˜¯, å‰ç½®åŠ¨ä½œä¸­çš„ä¿å­˜spåˆ°fpçš„è¡Œä¸ºé€šå¸¸æ˜¯ä¸ä¼šè¢«çœç•¥çš„, æˆ‘çŒœæ˜¯å› ä¸ºè°ƒè¯•è¡Œä¸º(ä¾‹å¦‚backtrace)çš„å®ç°éœ€è¦ç”¨åˆ°fp.\nä¸æ˜¯æ¯æ¬¡éƒ½è¿™æ ·, ä¹Ÿæœ‰æ—¶ä¼šä¿®æ”¹sp, æ­¤æ—¶å°±å¿…é¡»æ¢å¤.\nå¸§æŒ‡é’ˆ(fp)å­˜åœ¨çš„æ„ä¹‰ ä¸Šé¢è¯´äº†, å¦‚æœä¸€ç›´ä½¿ç”¨spç›¸å¯¹å¯»å€æ¥æ“ä½œæ ˆ, é‚£ä¹ˆfpçš„å­˜åœ¨ä¼¼ä¹æ˜¯éå¿…è¦çš„.\næˆ‘äº†è§£åˆ°çš„äº‹å®ä¹Ÿæ˜¯å¦‚æ­¤, fpå­˜åœ¨çš„å¿…è¦æ€§ä¼¼ä¹å°±æ˜¯ä½¿å¾—ä¸€äº›è°ƒè¯•åŠŸèƒ½æ›´åŠ æ–¹ä¾¿. å †æ ˆå›æº¯æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ©ç”¨fpçš„åœºæ™¯, ä»calleeçš„fpå¯ä»¥æ‰¾åˆ°å…¶callerçš„fp, ä¹Ÿå°±æ˜¯callerçš„å †æ ˆç©ºé—´, ä»¥æ­¤ç±»æ¨å¯ä»¥æ‰¾åˆ°caller-callerçš„fp\u0026hellip;\nå¦‚ä½•å…³é—­å¸§æŒ‡é’ˆ ä»…é’ˆå¯¹AArch64æ¥è¯´, GCCæä¾›äº†ä¸€äº›ç›¸å…³çš„ç¼–è¯‘é€‰é¡¹æ¥ç»™ç¨‹åºå‘˜é€‰æ‹©æ˜¯å¦å¯ç”¨fpçš„æƒåˆ©.\n -fomit-frame-pointer å¼ºåˆ¶çœç•¥fp -fno-omit-frame-pointer å¼ºåˆ¶ä¸çœç•¥fp  å‚è€ƒ  x86 call æŒ‡ä»¤æ‰§è¡Œå‰éœ€è¦espå¯¹é½åˆ° 16-byte: x86 - What are the following instructions after this call (assembly) - Stack Overflow x86æ ˆå¸§åŸç† - çŸ¥ä¹ (zhihu.com) ç ´è·ARM64ä½CPUä¸‹linux crashè¦æ¡ˆä¹‹ç¥æŠ€èƒ½ï¼šæ‰‹åŠ¨æ¢å¤å‡½æ•°è°ƒç”¨æ ˆ  ç»“è¯­ èƒ½å¤Ÿæ­£ç¡®è¾¾åˆ°å‡½æ•°è°ƒç”¨å’Œè¿”å›çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤š, ä¸æ˜¯ä»…æœ‰è¿™ä¸€ç§æ–¹å¼, çº¦å®šä»…ä»…æ˜¯ä¸€ä¸ªçº¦å®š, å¤§å®¶éƒ½è¿™æ ·å»åšé™ä½äº†å¼€å‘çš„éš¾åº¦.\n","date":"2022-11-21T10:30:35+08:00","permalink":"https://wangloo.github.io/posts/armv8/function-call-conventions/","section":"posts","tags":["armv8","x86","Operating System"],"title":"AArch64/X86 å‡½æ•°è°ƒç”¨çº¦å®š"},{"categories":["C Language"],"contents":"é—®é¢˜æºäºæˆ‘åœ¨çŸ¥ä¹åˆ·åˆ°çš„ä¸€ä¸ªå›ç­”: èƒ½åˆ†äº«ä½ CæŒ‡é’ˆç”¨å¾—æœ€çµæ´»ï¼ˆé£˜ï¼‰çš„ä¸€æ¬¡å—?\næ–‡ä¸­æåˆ°äº†Linuså…³äºæ— å¤´èŠ‚ç‚¹å•é¡¹é“¾è¡¨çš„åˆ é™¤æ“ä½œç»™å‡ºçš„ä¸€ç§æ–°çš„æ€è·¯, æˆ‘è§‰å¾—å¯¹ç†è§£æŒ‡é’ˆéå¸¸æœ‰å¸®åŠ©, æ‰€ä»¥åœ¨è¿™é‡Œè¯¦ç»†æè¿°ä¸€ä¸‹è¿™ä»¶äº‹.\nä»æˆ‘å­¦ä¹ æ•°æ®ç»“æ„èµ·, å¯¹ä¸å«å¤´èŠ‚ç‚¹çš„å•å‘é“¾è¡¨çš„åˆ é™¤æ“ä½œ, åšæ³•å¸¸æ˜¯: å€Ÿç”¨preæŒ‡é’ˆæœç´¢. è¿™ç§æƒ…å†µä¸‹é¿å…ä¸äº†å¯¹äºé“¾è¡¨ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ç‰¹åˆ¤(ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰pre).\nLinusæåˆ°äº†ä¸€ç§å€ŸåŠ©äºŒçº§æŒ‡é’ˆé¿å…è¯¥åˆ†æ”¯çš„æ–¹æ³•.\n1void remove_if(node ** head, remove_fn rm) 2{ 3 for (node** curr = head; *curr; ) 4 { 5 node * entry = *curr; 6 if (rm(entry)) 7 { 8 *curr = entry-\u0026gt;next; 9 free(entry); 10 } 11 else 12 curr = \u0026amp;entry-\u0026gt;next; 13 } 14} æŒ‡é’ˆçš„å†…å®¹å°±æ˜¯åœ°å€, int *p = a ä¹Ÿå°±æ„å‘³ç€å˜é‡p ä¸­ä¿å­˜ç€å˜é‡açš„åœ°å€. æ‰€ä»¥å‚æ•°headåœ¨å†…å­˜ä¸­çš„å«ä¹‰ä¸º:\nå‡å¦‚è¦åˆ é™¤node2, é‚£ä¹ˆæ”¹å˜*currå®é™…ä¸Šå°±æ˜¯æ”¹äº†node1çš„nextæˆå‘˜.\n","date":"2022-11-20T23:40:30+08:00","permalink":"https://wangloo.github.io/posts/c/pointers-pointers-list/","section":"posts","tags":["c"],"title":"äºŒçº§æŒ‡é’ˆæ“ä½œé“¾è¡¨æŠ€å·§"},{"categories":["Operating System"],"contents":"å¤§å°ç«¯é—®é¢˜çš„ç”±æ¥ ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸–ç•Œéœ€è¦åŒºåˆ†å¤§å°ç«¯? å†…å­˜é‡Œå­˜å–çš„å•ä½æ˜¯å­—èŠ‚, å¦‚æœæ‰€æœ‰çš„æ•°æ®ç±»å‹é•¿åº¦éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚, é‚£å°±å®Œå…¨ä¸éœ€è¦å¤§å°ç«¯äº†, æ¯ä¸ªå˜é‡éƒ½ä»…å æ®å•ç‹¬ä¸€ä¸ªå­—èŠ‚.\nä¾‹å¦‚, ä¸‰ä¸ªå˜é‡ a=10, b=20, c=30, åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯èƒ½å°±æ˜¯:\n1 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 2 â”‚ â”‚ 3 â”‚ 10 â”‚ a 4 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 5 â”‚ â”‚ 6 â”‚ 20 â”‚ b 7 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 8 â”‚ â”‚ 9 â”‚ 30 â”‚ c 10 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 11 â”‚ â”‚ 12 â”‚ â”‚ 13 â”‚ â”‚ 14 â”‚ â”‚ 15 â”‚ â”‚ 16 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ä½†æ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ•°æ®ç±»å‹è‚¯å®šæœ‰è¶…è¿‡ä¸€ä¸ªå­—èŠ‚çš„, intç±»å‹åœ¨64ä½çš„ç³»ç»Ÿä¸­å°±å 4ä¸ªå­—èŠ‚. ä¾‹å¦‚å˜é‡a=0xaabbccdd\nä¸€ä¸ªå˜é‡çš„å¤§å°ä¸€æ—¦è¶…è¿‡4ä¸ªå­—èŠ‚, å†…å­˜çš„å­˜å–åˆæ˜¯ä»¥å­—èŠ‚ä½å•ä½çš„, é‚£ä¹ˆè¦æŠŠå®ƒå¡åˆ°å†…å­˜é‡Œå°±å¿…ç„¶ä¼šäº§ç”Ÿä¸¤ç§ä¸åŒå­˜æ”¾æ–¹å¼: å…ˆæ”¾0xaaè¿˜æ˜¯å…ˆæ”¾0xdd\né¦–å…ˆ, 0xddæ˜¯å˜é‡açš„ä½8ä½, 0xaaæ˜¯æœ€é«˜8ä½, è¿™æ˜¯ç¡®å®šçš„.\n  å¦‚æœå…ˆæ”¾0xaa, å³ä½åœ°å€æ”¾é«˜ä½, å°±å«åšå¤§ç«¯, å¦‚å·¦å›¾;\n  å¦‚æœå…ˆæ”¾0xdd, å³ä½åœ°å€æ”¾ä½ä½, å°±å«å°ç«¯, å¦‚å³å›¾.\n  1 2 start addr of `a` start addr of `a` 3 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 4 â”‚ â”‚ â”‚ â”‚ 5 â”‚ aa â”‚ â”‚ dd â”‚ 6 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 7 â”‚ â”‚ â”‚ â”‚ 8 â”‚ bb â”‚ â”‚ cc â”‚ 9 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 10 â”‚ â”‚ â”‚ â”‚ 11 â”‚ cc â”‚ â”‚ bb â”‚ 12 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 13 â”‚ â”‚ â”‚ â”‚ 14 â”‚ dd â”‚ â”‚ aa â”‚ 15 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 16 â”‚ â”‚ â”‚ â”‚ 17 â”‚ â”‚ â”‚ â”‚ 18 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ä»€ä¹ˆæƒ…å†µ? çœ‹ä¸‹é¢çš„ä»£ç , çŒœæµ‹è¾“å‡ºçš„ç»“æœ\n1unsigned int i = 0x00646c72; 2printf(\u0026#34;Hello Wo%s\u0026#34;, \u0026amp;i); %s ä¼šæŒ‰å­—èŠ‚ä¸€ç›´æ‰“å°å†…å­˜ä¸­çš„å­—ç¬¦, ç›´åˆ°é‡åˆ°\\0. é¦–å…ˆæ‰“å°çš„å­—ç¬¦ä¾¿æ˜¯å˜é‡içš„åœ°å€å¤„çš„å†…å®¹.\nå¦‚æœæ˜¯å°ç«¯å­˜å‚¨æ–¹å¼, å˜é‡içš„åœ°å€å¤„çš„ä¸€ä¸ªå­—èŠ‚å€¼æ˜¯0x72, å³å­—ç¬¦r. ä»¥æ­¤ç±»æ¨, æ‰€ä»¥å¦‚æœCPUçš„å­—èŠ‚åºæ˜¯å°ç«¯å½¢å¼, é‚£ä¹ˆprintfçš„ç»“æœæ˜¯: Hello world\nå¤§å°ç«¯å½¢å¼çš„ä¼˜ç¼ºç‚¹ å°ç«¯çš„ä¼˜åŠ¿:\n  ä»¥ä¸åŒçš„é•¿åº¦è¯»å–å˜é‡éå¸¸æ–¹ä¾¿, ä¸ç”¨è®¡ç®—åœ°å€. ä¾‹å¦‚u64 a=0x1234, å½“(u16)aæ—¶, CPUä¸éœ€è¦é‡æ–°è®¡ç®—è¯»å–çš„èµ·å§‹ä½ç½®, æ°¸è¿œéƒ½æ˜¯å˜é‡açš„èµ·å§‹åœ°å€.\n  Easily to do mathematical computations â€œbecause of the 1:1 relationship between address offset and byte number (offset 0 is byte 0), multiple precision math routines are correspondingly easy to write.â€\n  ","date":"2022-11-17T10:30:35+08:00","permalink":"https://wangloo.github.io/posts/os/big-little-endian/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šå¤§å°ç«¯é—®é¢˜"},{"categories":["Operating System"],"contents":"æœ¬æ–‡åŸºäºAArch64æ‰§è¡Œç¯å¢ƒ, ä»‹ç»ç°ä»£æ“ä½œç³»ç»Ÿä¸­ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç›¸å…³å†…å®¹.\nä½•ä¸ºä¸Šä¸‹æ–‡ æˆ‘ä»¬æ­£åœ¨çœ‹ä¸€æœ¬ä¹¦çš„æ—¶å€™å¦‚æœè¢«å…¶ä»–çš„äº‹æƒ…æ‰“æ–­, è¿”å›æ—¶ä¸ºäº†èƒ½å¤Ÿä»ä¸Šæ¬¡è¢«æ‰“æ–­çš„ä½ç½®ç»§ç»­è¯», å°±è¦åœ¨è¢«æ‰“æ–­çš„æ—¶å€™è®°ä¸‹æ¥å½“å‰æ˜¯è¯»åˆ°äº†å“ªä¸ªç¬¬å‡ é¡µçš„ç¬¬å‡ è¡Œ.\næ“ä½œç³»ç»Ÿå¯¹å¾…çº¿ç¨‹ä¹Ÿæ˜¯å¦‚æ­¤, éœ€è¦ä¿å­˜çš„ç”¨äºæ¢å¤çº¿ç¨‹æ‰§è¡Œçš„ä¿¡æ¯å°±ç§°ä¸ºçº¿ç¨‹çš„ä¸Šä¸‹æ–‡.\né‚£ä¹ˆå¯¹äºçº¿ç¨‹æ¥è¯´éœ€è¦è®°ä¸‹çš„å†…å®¹æœ‰ä»€ä¹ˆå‘¢? å¯„å­˜å™¨å’Œæ ˆå³å¯. æ‹¿ AArch64 æ¶æ„æ¥è·ç¦», çº¿ç¨‹çš„ä¸Šä¸‹æ–‡å°±æ˜¯:\n é€šç”¨å¯„å­˜å™¨x0-x29: å‡½æ•°è°ƒç”¨çš„å‚æ•°, æŸäº›è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´å€¼, éƒ½è¦ç”¨åˆ°è¿™äº›å¯„å­˜å™¨. çº¿ç¨‹çš„æ‰§è¡Œæµå¯èƒ½åœ¨ä»»ä½•æ—¶å€™è¢«æ‰“æ–­, å½“ç„¶è¿™äº›å†…å®¹ä¹Ÿä¸èƒ½ä¸¢. é€šç”¨å¯„å­˜å™¨lr(x30): lr ä¿å­˜ç€è¿”å›åœ°å€, å³å½“å‰å‡½æ•°ç»“æŸä¹‹åè¯¥è¿”å›åˆ°å“ªæ‰§è¡Œ. æ ˆé¡¶æŒ‡é’ˆ sp: æ ˆçš„é‡è¦æ€§æ— éœ€å¤šè¨€. ç¨‹åºè®¡æ•°å™¨ pc: è¢«æ‰“æ–­çš„çº¿ç¨‹å¦‚æœå†æ¬¡æ‰§è¡Œ, ä»å“ªé‡Œæ‰§è¡Œå‘¢? æ˜¾ç„¶æ˜¯è¢«æ‰“æ–­æŒ‡ä»¤çš„ä¸‹ä¸€æ¡(æˆ–è€…é‡æ–°æ‰§è¡Œå½“å‰). è¿™ä¸ªæŒ‡ä»¤çš„åœ°å€å½“ç„¶ä¹Ÿéœ€è¦è¢«ä¿å­˜å¥½. PSTATE: æƒ³ä¸€ä¸‹, æœ‰äº†ä»¥ä¸Šçš„å†…å®¹å°±èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®Œæ•´çš„æ¢å¤ä¹‹å‰çš„ç¯å¢ƒå—? å…¶ä»–çš„ä¾‹å¦‚ä¸­æ–­æ˜¯å¼€è¿˜æ˜¯å…³, æœ‰å“ªäº›æ ‡å¿—ä½(NZCV)è¢«è®¾ç½®äº†. è¿™äº›ä¿¡æ¯åœ¨ AArch64 ä¸­æ˜¯ä¿å­˜åœ¨ PSTATE çš„å„ä¸ªå­—æ®µä¸­. ttbr0ï¼šä¿å­˜ç€è¿›ç¨‹çš„é¡µè¡¨  ä¸Šä¸‹æ–‡ä¿å­˜å’Œæ¢å¤ TODO\nåç¨‹çš„ä¸Šä¸‹æ–‡ åç¨‹æ˜¯ç”¨æˆ·çº§åˆ«çš„çº¿ç¨‹,\n åç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¸è¿›å…¥å†…æ ¸ åˆ‡æ¢åç¨‹åªèƒ½æ˜¯æŸä¸ªåç¨‹ä¸»åŠ¨æ”¾å¼ƒæ§åˆ¶æƒ  æˆ‘ä»¬åœ¨è¿™é‡Œè®¨è®ºä¸€ä¸‹åç¨‹åˆ‡æ¢æ—¶éœ€è¦ä¿å­˜çš„ä¸Šä¸‹æ–‡æ˜¯å¦ä¸çº¿ç¨‹æœ‰æ‰€ä¸åŒ.\né¦–å…ˆ, PC ä¸€å®šå±äº, è¿™ä¸ªæ¯‹åº¸ç½®ç–‘. å…¶æ¬¡æ˜¯æ ˆé¡¶æŒ‡é’ˆ sp, æ¯ä¸ªåç¨‹éƒ½æœ‰å•ç‹¬çš„æ ˆ, å¦‚æœä¸ä¿å­˜æ ˆçš„ä½ç½®, é‚£ä¹ˆåç¨‹å†…éƒ¨å®šä¹‰å±€éƒ¨å˜é‡å°±æ²¡æ³•è®¿é—®äº†(å±€éƒ¨å˜é‡çš„è®¿é—®æŒ‡ä»¤éƒ½æ˜¯ä»¥ sp ä¸º base çš„åç§»æ¥åšçš„).\nå¦å¤–, å…³äºé€šç”¨å¯„å­˜å™¨, ç”±äºåç¨‹çš„åˆ‡æ¢éœ€è¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå‡½æ•°(é€šå¸¸å«åšyield()), åœ¨å‡½æ•°çš„æœ€åå°† PC è®¾ç½®ä¸ºæ–°åç¨‹çš„ä¸Šä¸‹æ–‡ PC. ä¿å­˜å½“å‰åç¨‹ä¸Šä¸‹æ–‡çš„æ“ä½œä¹Ÿåœ¨è¿™ä¸ªå‡½æ•°ä¸­, è€Œå…¶å‚æ•°æˆ‘ä»¬å¹¶ä¸å…³å¿ƒ, å³x0-x7æ²¡å¿…è¦ä¿å­˜. åŒæ ·çš„, caller-saved å¯„å­˜å™¨ä¹Ÿæ˜¯æ²¡å¿…è¦ä¿å­˜çš„, å› ä¸ºè¿™äº›å¯„å­˜å™¨ä½œä¸ºå‡½æ•°è°ƒç”¨ä½¿ç”¨çš„ä¸´æ—¶å˜é‡, å½“å†æ¬¡è¿”å›è¯¥åç¨‹æ—¶, PC=yield()è¿”å›åœ°å€, caller å¦‚æœå…³å¿ƒè¿™äº›å¯„å­˜å™¨åº”å½“è‡ªå·±æ‰§è¡Œä¿å­˜å’Œæ¢å¤. ä½†æ˜¯callee-saved å¯„å­˜å™¨å¿…é¡»è¦ä¿å­˜åˆ°ä¸Šä¸‹æ–‡ä¸­, å› ä¸ºåœ¨ yield()ä¸­, æˆ‘ä»¬å¦‚æœä¿®æ”¹äº† callee-saved å¯„å­˜å™¨, å°±éœ€è¦åœ¨è¿”å›æ—¶(ä¹Ÿå°±æ˜¯å†æ¬¡è°ƒåº¦åˆ°è¯¥åç¨‹æ—¶) æ¢å¤, è¿™æ˜¯ callee è¯¥åšçš„, ä¹Ÿå°±æ˜¯ä¸Šä¸‹æ–‡ä¸­åº”è¯¥æœ‰çš„å”¯ä¸€é€šç”¨å¯„å­˜å™¨ç»„.\n","date":"2022-11-14T22:13:06+08:00","permalink":"https://wangloo.github.io/posts/os/context/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šä¸Šä¸‹æ–‡åˆ‡æ¢"},{"categories":["C Language"],"contents":"ä»‹ç» setjmp() and longjmp() æ˜¯ä¸€å¯¹ç»„åˆä½¿ç”¨çš„å‡½æ•°, å¯ä»¥å®ç°å…¨å±€çš„goto.\nsetjmp() æ„é€ ä¸€ä¸ªè¿è¡Œç¯å¢ƒ, è°ƒç”¨longjmp() åˆ™å°†æ‰§è¡Œæµåˆ‡æ¢åˆ°è¯¥ç¯å¢ƒ.\n1/* setjmp() ä¿å­˜å½“å‰çš„è¿è¡Œç¯å¢ƒ(ä¸Šä¸‹æ–‡)åˆ° env å‚æ•°ä¸­ */ 2int setjmp(jmp_buf env); 3 4/* longjmp() å°†æ§åˆ¶æµåˆ‡æ¢åˆ° env æŒ‡å®šçš„è¿è¡Œç¯å¢ƒ */ 5void longjmp(jmp_buf env, int val); ä½¿ç”¨æ–¹æ³• 1#include \u0026lt;setjmp.h\u0026gt;2#include \u0026lt;stdio.h\u0026gt;3 4jmp_buf e; 5 6void foo() { 7 longjmp(e, 1); 8} 9 10int main(void) { 11 int ret; 12 13 /* After calling longjmp(), the execution flow back to setjmp(), 14and setjmp() will return not 0. */ 15 ret = setjmp(e); 16 if (ret == 0) { 17 printf(\u0026#34;Return from setjmp\\n\u0026#34;); 18 foo(); 19 } else { 20 printf(\u0026#34;Return from longjmp\\n\u0026#34;); 21 } 22 23 return 0; 24} åŸºäº AArch64 çš„å®ç° 1.macro func _name 2.global \\_name 3.type \\_name, %function 4\\_name: 5.endm 6 7.macro endfunc _name 8.size \\_name, .-\\_name 9.endm 10 11 12/** 13 * setjmp (jmp_buf env) 14 * 15 * See also: 16 * longjmp 17 * 18 * @return 0 - if returns from direct call, 19 * nonzero - if returns after longjmp. 20 */ 21 22func setjmp 23 stp x19, x20, [x0], #16 24 stp x21, x22, [x0], #16 25 stp x23, x24, [x0], #16 26 stp x25, x26, [x0], #16 27 stp x27, x28, [x0], #16 28 stp x29, x18, [x0], #16 29 mov x9, sp 30 stp lr, x9, [x0], #16 31 mov x0, #0 32 33 ret 34endfunc setjmp 35 36/** 37 * longjmp (jmp_buf env, int val) 38 * 39 * Note: 40 * if val is not 0, then it would be returned from setjmp, 41 * otherwise - 1 would be returned. 42 * 43 * See also: 44 * setjmp 45 */ 46 47func longjmp 48 ldp x19, x20, [x0], #16 49 ldp x21, x22, [x0], #16 50 ldp x23, x24, [x0], #16 51 ldp x25, x26, [x0], #16 52 ldp x27, x28, [x0], #16 53 ldp x29, x18, [x0], #16 54 ldp lr, x9, [x0], #16 55 mov sp, x9 56 57 mov x0, x1 58 cbnz x0, 1f 59 add x0, x0, #1 601: 61 62 ret 63endfunc longjmp éœ€è¦ä¿å­˜çš„ä¸Šä¸‹æ–‡åŒ…æ‹¬\n callee-saved é€šç”¨å¯„å­˜å™¨, å› ä¸ºå¯èƒ½ç¬¬ä¸€æ¬¡è°ƒç”¨ setjmp() ä¹‹åçš„æ‰§è¡Œæµä¿®æ”¹äº†è¿™äº›å¯„å­˜å™¨, ä»ç¬¬äºŒæ¬¡å›åˆ° setjmp() çš„è§’åº¦æ¥çœ‹, å°±æ˜¯æ‰§è¡Œsetjmp() ä¸­ç ´åçš„. caller-saved å¯„å­˜å™¨åˆ™ä¸å¿…, å› ä¸ºæœ¬æ¥å³ä¾¿çœ‹ä½œæ˜¯ setjmp() ç ´åçš„, ä¹Ÿæ˜¯æ­£å¸¸çš„.  è§£é‡Šä¸€ä¸‹ï¼šåœ¨å¦‚ä¸‹çš„è°ƒç”¨åœºæ™¯ä¸­, å¯ä»¥çœ‹åˆ°åœ¨setjmp()ä¹‹å‰åˆ†åˆ«èµ‹å€¼äº†x2å’Œx19ï¼Œ è¿™å…¶ä¸­x2æ˜¯caller-savedï¼Œx19å±äºcallee-savedã€‚ callee-savedå¯„å­˜å™¨åœ¨å­å‡½æ•°è°ƒç”¨ä¹‹å‰å’Œä¹‹ååº”è¯¥æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥è¯´å¦‚æœå­å‡½æ•°éœ€è¦ä¿®æ”¹ä»–ä»¬åº”è¯¥åœ¨å‡½æ•°è¿›å…¥å‰è¿›è¡Œå¤‡ä»½ã€‚ æ‰€ä»¥è¯´æ˜¾ç„¶åœ¨(1)çš„æ­¥éª¤ä¸­åº”è¯¥æœ‰x19çš„å¤‡ä»½è¿‡ç¨‹ï¼Œ(6)ä¸­ä¹Ÿåº”è¯¥æœ‰å¯¹åº”çš„æ¢å¤ã€‚\né‚£ä¹ˆå¯¹äºsetjmp()å‘¢ï¼Ÿå®ƒè‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿéœ€è¦æ»¡è¶³è§„å®šã€‚æ‰€ä»¥å¿…é¡»ä¿è¯(5)è®¿é—®åˆ°æ•°æ®ä¸€å®šæ˜¯(3)ä¸­ä¿å­˜çš„ã€‚ é—®é¢˜æ˜¯å¯¹äºsetjmp()çš„ä½¿ç”¨æ–¹æ³•æ¥è¯´ï¼Œä¸æ˜¯éƒ½éµå¾ª(1)(2)(3)(4)(5)çš„è°ƒç”¨ï¼Œä¸‹æ¬¡ä¼šä»åˆ«çš„ä½ç½®ç›´æ¥è·³åˆ°(4)ã€‚ æ­¤æ—¶ä»ç„¶éœ€è¦ç¡®ä¿x19å¯„å­˜å™¨çš„æ­£ç¡®æ€§ï¼Œåªèƒ½åœ¨é¦–æ¬¡è°ƒç”¨setjmp()æ—¶å°†x19ä¿å­˜ä¸‹æ¥ï¼Œä»¥åæ¯æ¬¡ä¸ç®¡ä»å“ªé‡Œè°ƒè¿‡æ¥å…ˆå»æ¢å¤ä¿å­˜çš„x19ã€‚è¿™æ ·å°±èƒ½å¤Ÿå®ç°callee-savedå¯„å­˜å™¨çš„æ­£ç¡®æ€§ã€‚\nå†è¯´è¯´caller-savedå¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯demoä¸­çš„x2ä¸ºä¾‹ï¼Œåœ¨ä¸­é—´è·¨è¶Šä¸€ä¸ªsetjmp()çš„æ¡ä»¶ä¸‹ï¼Œ archä¸èƒ½ä¿è¯(4)ä¸­å¾—åˆ°çš„å€¼ä¸€å®šæ˜¯(2)ä¿å­˜çš„ï¼Œå› ä¸ºsetjmp()å¯ä»¥éšæ„çš„ä¿®æ”¹caller-savedå¯„å­˜å™¨ã€‚æ‰€ä»¥è¯´ï¼Œå¦‚æœfunc()ä¸å¾—ä¸è¦æ±‚(4)è®¿é—®å€¼çš„æ­£ç¡®æ€§ï¼Œ ä¸€ä¸ªè§£å†³æ–¹æ³•å°±æ˜¯åœ¨è°ƒç”¨setjmp()ä¹‹å‰ä¿å­˜x2åˆ°æ ˆä¸­ï¼Œåœ¨setjmp()ä¹‹åç«‹é©¬æ¢å¤ã€‚ è¿™æ˜¯callerçš„è´£ä»»ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨func()å®Œæˆï¼Œè€Œä¸æ˜¯setjmp()å†…éƒ¨ã€‚\nä»¥ä¸Šå°±æ˜¯ä¸ºä»€ä¹ˆsetjmp()åªéœ€è¦ä¿å­˜callee-savedå¯„å­˜å™¨çš„è§£é‡Šã€‚\n1func() 2{ 3 // (1) 4 Set x2 // (2) 5 Set x19 // (3) 6 setjmp() 7 Access x2 // (4) 8 Access x19 // (5) 9 // (6) 10} setjmp() å®ç° try-catch ","date":"2022-11-01T23:38:54+08:00","permalink":"https://wangloo.github.io/posts/c/setjmp_and_longjmp/","section":"posts","tags":["armv8","c"],"title":"ARM64 ä¸Šå®ç° setjmp/longjmp"},{"categories":null,"contents":"Â Kernel Monitor æ˜¯ä»€ä¹ˆ Kernel Monitor æ˜¯ä¸€ä¸ªé€‚é…æˆ‘ä»¬å¾®å†…æ ¸æ“ä½œç³»ç»Ÿçš„ Kernel è°ƒè¯•å’Œç›‘æ§ç³»ç»Ÿ. å®ƒèƒ½å®ç°å†…æ ¸çš„åŠ¨æ€è°ƒè¯•å’Œç›‘æ§. åŒæ—¶, å®ƒè¿˜æ¥ç®¡å†…æ ¸çš„åŒæ­¥å¼‚å¸¸å’Œç³»ç»Ÿé”™è¯¯, ä½¿å¼€å‘è€…èƒ½å¤Ÿäº†è§£å‘ç”Ÿå¼‚å¸¸æ—¶ç³»ç»Ÿçš„çŠ¶æ€.\nKernel Monitor å…·æœ‰ä¸€å®šçš„å¯æ‰©å±•æ€§, ä¾‹å¦‚é€šè¿‡ç»Ÿè®¡å†…æ ¸ä¸­å­˜å‚¨çš„ TCB æ¥å®æ—¶ç›‘æ§ç³»ç»Ÿä¸­æ‰€æœ‰çº¿ç¨‹çš„çŠ¶æ€. å¯æ ¹æ®å¼€å‘è€…çš„éœ€æ±‚æ·»åŠ ç»Ÿè®¡çš„å¯¹è±¡, å¦‚ Endpoint, Capabilityç­‰.\nÂ Kernel Monitor æ€»ä½“è®¾è®¡ Kernel Monitor ç³»ç»ŸåŒ…å« Clinet å’Œ Server ä¸¤ä¸ªéƒ¨åˆ†. ç®€å•æ¥è¯´, Client è´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥, å¹¶å°†è¾“å…¥è¿›è¡Œè§£æ, å°è£…ä¸º ä¸€ç³»åˆ—åŸºç¡€å‘½ä»¤. å‘é€ç»™ Server. Server è´Ÿè´£æ‰§è¡Œè¿™äº› åŸºç¡€çš„å‘½ä»¤, å¦‚è®¾ç½®æ–­ç‚¹, æŸ¥çœ‹æŸä¸ªåœ°å€çš„å€¼ç­‰.\næ•´ä¸ªç³»ç»Ÿæœ‰ä¸¤ç§æ¶æ„: æœ¬åœ° Monitor å’Œè¿œç¨‹ Monitor.\næœ¬åœ°monitor å’Œè¿œç¨‹ monitor çš„åŒºåˆ«æ˜¯: Monitor Client çš„ä½ç½®åœ¨å“ª, æ˜¯å¦ä¸ Server åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Š.\n å…ˆè¯´ Monitor Server, å®ƒå¿…é¡»åµŒå…¥è¦è°ƒè¯•çš„ Kernel ä¸­, ä½äºä¸€ä¸ªåœ°å€ç©ºé—´, æ–¹ä¾¿æ“ä½œ Kernel çš„å†…å­˜.\n æœ¬åœ° Monitor åœ¨æœ¬åœ° Monitor ä¸­, client å’Œ sever éƒ½ä½äºç›®æ ‡æœº(Target)ä¸Š, ç›®æ ‡æœºé€šå¸¸æ˜¯å¼€å‘æ¿.\nå¯¹äº AArch64 ä½“ç³»ç»“æ„æ¥è¯´, æœ€å¤šæœ‰å››ä¸ªå¼‚å¸¸ç­‰çº§(EL0-EL3). Client å¯ä»¥è¿è¡Œåœ¨EL2.\nè¿œç¨‹ Monitor è¿œç¨‹ Monitor æ¶æ„åˆ™ä¸åŒ, Clinet è¿è¡Œåœ¨å®¿ä¸»æœº(Host)ä¸Š, é€šå¸¸æ˜¯Linux. å®ƒä¸ Server çš„é€šä¿¡æ˜¯é€šè¿‡ç½‘ç»œ/UARTå®ç°çš„.\n Monitor Client è¿è¡Œåœ¨æœ¬åœ°å’Œè¿œç¨‹å¯¹äºå®ç°çš„éš¾åº¦å’Œç”¨æˆ·ä½“éªŒæœ‰å½±å“.\n  å¦‚æœ Client å®ç°åœ¨æœ¬åœ°, åˆ™ Client æ— éœ€å®ç°ç½‘å£å’Œä¸²å£çš„é©±åŠ¨, ä½†Monitor è¾“å…¥è¾“å‡ºçš„ä¸²å£ä¸æ“ä½œç³»ç»Ÿæœ¬èº«çš„ä¸²å£ç›¸åŒ, ä¿¡æ¯å†—æ‚åœ¨ä¸€èµ·ä¸æ˜“æŸ¥çœ‹; åŒæ—¶, å¦‚æœ Client å®ç°åœ¨æœ¬åœ°, é‚£ä¹ˆå¯¹äºELFçš„è§£æéœ€è¦åœ¨æ— æ“ä½œç³»ç»Ÿæä¾›çš„åº“æ”¯æŒä¸‹å®Œæˆ, å¯èƒ½æ¯”è¾ƒå¤æ‚.\n  å¦‚æœ Client å®ç°åœ¨è¿œç¨‹, å³ä¸º Linux ä¸Šçš„ä¸€ä¸ªAPP. é‚£ä¹ˆå®ƒå’Œ Server çš„é€šä¿¡å°±éœ€è¦é€šè¿‡å¤–éƒ¨çš„ç½‘å£æˆ–è€…ä¸²å£(å¯¹äºæˆ‘ä»¬ä½¿ç”¨çš„64ä½å¼€å‘æ¿åªå¼•å‡ºäº†ä¸€ä¸ªä¸²å£, æ‰€ä»¥åªèƒ½ä½¿ç”¨ç½‘å£). éœ€è¦åœ¨ Server ä¸Šå®ç°ç½‘å£çš„é©±åŠ¨, è¿™éƒ¨åˆ†æ¯”è¾ƒå¤æ‚. ä½†æ˜¯å¥½å¤„æ˜¯ Client çš„å®ç°ç®€å•å¾ˆå¤š, å› ä¸ºæœ‰ Linux APP è¿è¡Œç¯å¢ƒçš„æ”¯æŒ. åŒæ—¶, è¿œç¨‹ Monitor æ¶æ„ä¸‹, Monitor å’Œ æ“ä½œç³»ç»Ÿè‡ªèº«çš„è¾“å…¥è¾“å‡ºåˆ†å¼€, ç”¨æˆ·å¯è¯»æ€§æ›´å¥½.\n   Server æ˜¯åµŒå…¥åˆ°Kernelçš„ä»£ç ä¸­, ä¸Clientè¿›è¡Œäº¤äº’. å®ƒæ˜¯æ•´ä¸ª Monitor ç³»ç»Ÿçš„åç«¯, è´Ÿè´£å®ç°åŸºç¡€çš„è°ƒè¯•æ“ä½œ. ä¾‹å¦‚, è®¾ç½®æ–­ç‚¹, å†…å­˜çš„è¯»å†™, å¯„å­˜å™¨çš„è¯»å†™ç­‰.\n ç”±äºServerä¸ Kernel ä½äºåŒä¸€ä¸ªåœ°å€ç©ºé—´, æ‰€ä»¥æŸ¥çœ‹/ä¿®æ”¹å†…å­˜çš„å€¼æ˜¯éå¸¸æ–¹ä¾¿çš„. å¯¹äºå¯„å­˜å™¨ä¹Ÿæ˜¯åŒç†. æ–­ç‚¹(Breakpoint), ç›‘è§†ç‚¹(Watchpoint), å•æ­¥æ‰§è¡Œ(Soft step)çš„å®ç°ä¾èµ–ä¸ ARMv8 æä¾›çš„çš„ self-hosted debug æ”¯æŒ.  åŒæ—¶, Server è¿˜è´Ÿè´£ç›‘è§†ç³»ç»Ÿä¸­æ‰€æœ‰çš„ åŒæ­¥å¼‚å¸¸å’Œç³»ç»Ÿé”™è¯¯. ä¸€æ—¦å‘ç”Ÿ, å¯åœ¨ Monitor ä¸­æŸ¥çœ‹æŸäº›å†…å­˜, å¯„å­˜å™¨çš„å€¼å®šä½é—®é¢˜å‘ç”Ÿçš„åŸå› .\nMonitor Client è®¾è®¡ Client çš„æ„æˆå¯åˆ†ä¸ºä¸‰ä¸ªæ¨¡å— :\n ç”¨æˆ·äº¤äº’æ¨¡å— ç¬¦å·å¤„ç†æ¨¡å— æ¶ˆæ¯æ”¶å‘æ¨¡å—  ç”¨æˆ·äº¤äº’æ¨¡å—è´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¾“å…¥è¾“å‡º, è°ƒç”¨å…¶ä»–ä¸¤ä¸ªæ¨¡å—å®Œæˆè°ƒè¯•å‘½ä»¤.\nç¬¦å·å¤„ç†æ¨¡å—è´Ÿè´£è§£æå¯æ‰§è¡Œæ–‡ä»¶(ELF), å¹¶å»ºç«‹é™æ€ç¬¦å·è¡¨, å­˜å‚¨ç¬¦å·å’Œåœ°å€çš„å¯¹åº”å…³ç³». å°†ç”¨æˆ·è¾“å…¥çš„ç¬¦å·è§£æä¸ºè™šæ‹Ÿåœ°å€, æˆ–è€…åå‘è§£æ.\næ¶ˆæ¯æ”¶å‘æ¨¡å—è´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¾“å…¥, å°†å…¶è½¬åŒ–ä¸ºåŸºç¡€, æ ‡å‡†çš„å‘½ä»¤, å‘é€ç»™Serveræ‰§è¡Œ. Client å’Œ Serverä¹‹é—´é€šä¿¡çš„æ•°æ®åŒ…åè®®å¯ä»¥ä½¿ç”¨ GDB Remote Serial Protocol (ä»¥ä¸‹ç®€ç§°RSPåè®®), æˆ–è€…è‡ªå·±è§„å®šä¸€ä¸ªåè®®ä¹Ÿæ˜¯å¯è¡Œçš„.\n RSPåè®®æ”¯æŒä¸‰ç§åŸºç¡€å‘½ä»¤:\n å¯„å­˜å™¨ç›¸å…³ å†…å­˜ç›¸å…³ ç¨‹åºæ§åˆ¶å‘½ä»¤   å¯ç”¨ Monitor æ—¶ Kernel å¯åŠ¨æµç¨‹  Kernel é¦–å…ˆåšå¿…è¦çš„åˆå§‹åŒ–, GIC, å¼‚å¸¸å‘é‡è¡¨, MMUç­‰. å°†æ§åˆ¶æƒäº¤ç»™ Monitor, ç­‰å¾…ç”¨æˆ·è¾“å…¥.  Â Kernel debug è¿‡ç¨‹ç¤ºä¾‹ ç¤ºä¾‹ä¸€: æŸ¥çœ‹å˜é‡ var çš„å€¼  ç”¨æˆ·è¾“å…¥ print var æŒ‡ä»¤. ç”±ç¬¦å·å¤„ç†æ¨¡å—, å°†varç¬¦å·è½¬ä¸ºvar è™šæ‹Ÿåœ°å€. ç”±æ¶ˆæ¯æ”¶å‘æŒ‡ä»¤å°†è¯·æ±‚å°è£…ä¸ºRSPåè®®åŒ…æ ¼å¼, å¹¶å‘é€åˆ° Monitor Server. æ‰§è¡Œæµç¨‹äº¤ç»™ Monitor Server, å®ƒè®¿é—®è¯¥åœ°å€, å°†å†…å®¹å°è£…å‘å› Monitor Client. Client è¾“å‡ºvarçš„å€¼, ç»§ç»­ç­‰å¾…ç”¨æˆ·è¾“å…¥  ç¤ºä¾‹äºŒ: æ·»åŠ æ–­ç‚¹åˆ° main å‡½æ•°  ç”¨æˆ·è¾“å…¥ break main æŒ‡ä»¤ ç”±ç¬¦å·å¤„ç†æ¨¡å—, è§£æå¾—åˆ° main å‡½æ•°çš„åœ°å€. æ¶ˆæ¯æ”¶å‘æ¨¡å—å°†è¯·æ±‚å°è£…ä¸ºRSPåŒ…æ ¼å¼, å‘é€åˆ°Monitor Server. æ‰§è¡Œæµç¨‹äº¤ç»™ Server. å®ƒæ‰§è¡Œ breakpoint exception æŒ‡ä»¤, å¹¶è®¾ç½®ç›¸å…³è½¯ä»¶æ–­ç‚¹ç›¸å…³å¯„å­˜å™¨ æ‰§è¡Œæµäº¤ç»™ Kernel, ç›´åˆ°è¾¾åˆ°æ–­ç‚¹å¤„(å¯ä½¿ç”¨åœ°å€+ContextIDåŒé‡éªŒè¯), è§¦å‘Debugå¼‚å¸¸ Debugå¼‚å¸¸å±äºåŒæ­¥å¼‚å¸¸, ç”± Monitor ç³»ç»Ÿæ¥ç®¡, å›åˆ° Client ç»§ç»­ç­‰å¾…ç”¨æˆ·è¾“å…¥  ç¤ºä¾‹ä¸‰: å•æ­¥æ‰§è¡Œ  ç”¨æˆ·è¾“å…¥ step æŒ‡ä»¤ æ¶ˆæ¯æ”¶å‘æ¨¡å—å°†è¯·æ±‚å°è£…ä¸ºRSPåŒ…æ ¼å¼, å‘é€åˆ° Monitor Server. æ‰§è¡Œæµç¨‹äº¤ç»™ Server, å¯ç”¨ software step. ç„¶æ‰§è¡Œä¸€æ¬¡å¼‚å¸¸è¿”å›, å›åˆ°Kernel ç»§ç»­æ‰§è¡Œ. å› ä¸ºå¯ç”¨äº† Software step, å›åˆ° Kernel æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤å, å°±ä¼šè§¦å‘ Debugå¼‚å¸¸ Debug å¼‚å¸¸å±äºåŒæ­¥å¼‚å¸¸, ç”± Monitor ç³»ç»Ÿæ¥ç®¡, å›åˆ° Client ç»§ç»­ç­‰å¾…ç”¨æˆ·è¾“å…¥  Â å…¶ä»–æ‹“å±•åŠŸèƒ½ back trace\næ€§èƒ½åˆ†æ\n","date":"2022-10-28T22:56:19+08:00","permalink":"https://wangloo.github.io/posts/os/monitor/","section":"posts","tags":null,"title":"Armv8 Kernel Monitor"},{"categories":["Architecture"],"contents":"Introduction MMU: ä¸“ç”¨äºå°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€. é€šå¸¸é…åˆåˆ†é¡µæœºåˆ¶æ¥å·¥ä½œ.\né¡µè¡¨: é¡µè¡¨ä¸­çš„è¡¨é¡¹åŒ…å«æä¾›è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ä¹‹é—´çš„æ˜ å°„.\nMMUå°±æ˜¯ç›´æ¥è®¿é—®é¡µè¡¨, å¹¶ä¸”é€šè¿‡å°†é¢‘ç¹ä½¿ç”¨çš„æ˜ å°„ç¼“å­˜åˆ°TLBä¸­.\nMMU çš„ç»“æ„ MMUæ˜¯ä¸€ç§ç¡¬ä»¶, å¯ä»¥é€šè¿‡åœ¨é€‚å½“çš„å®‰å…¨çŠ¶æ€ä¸‹å¯¹å…¶è¿›è¡Œé…ç½®. æ¯ä¸ªCoreéƒ½æœ‰è‡ªå·±çš„MMU, æ¯ä¸ªMMUåŒ…æ‹¬:\n ä¸€ä¸ªTLB, ç¼“å­˜æœ€è¿‘è®¿é—®çš„æ˜ å°„. ä¸€ä¸ªTable Walk Unit, ä»å†…å­˜ä¸­æŸ¥è¯¢é¡µè¡¨, å¾—åˆ°æœ€ç»ˆçš„è™šæ‹Ÿåœ°å€-ç‰©ç†åœ°å€çš„æ˜ å°„.  MMU æ§åˆ¶ç€æ•´ä¸ªç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥, å†…å­˜å±æ€§å’Œè®¿é—®æƒé™. MMUå¼€å¯å, è½¯ä»¶å‘å‡ºçš„æ‰€æœ‰å†…å­˜è®¿é—®éƒ½ä½¿ç”¨è™šæ‹Ÿåœ°å€, è¦æ±‚MMUä¸ºæ¯æ¬¡è®¿é—®è¿›è¡Œåœ°å€è½¬æ¢.\nMMU çš„é…ç½® åœ¨å¯ç”¨MMUå‰, å¿…é¡»å‘ŠçŸ¥å…¶é¡µè¡¨å­˜æ”¾çš„ä½ç½®.\nMMU åœ°å€è½¬æ¢çš„è¿‡ç¨‹ å¯¹äºæ¯ä¸ªè½¬æ¢è¯·æ±‚, MMUé¦–å…ˆæ£€æŸ¥TLBæ˜¯å¦å·²ç»å¯¹è¯¥åœ°å€ç¼“å­˜, å¦‚æœè¯¥åœ°å€æœªç¼“å­˜, åˆ™éœ€è¦éå†é¡µè¡¨.\né¡µè¡¨éå†å•å…ƒåœ¨é¡µè¡¨ä¸­æœç´¢ç›¸å…³çš„æ˜ å°„è¡¨é¡¹.\n ä¸€æ—¦æ‰¾åˆ°æ˜ å°„, MMUå°±ä¼šæ£€æŸ¥æƒé™å’Œå±æ€§. å†³å®šå…è®¸æœ¬æ¬¡è®¿é—®, æˆ–è€…å‘å‡ºæ•…éšœä¿¡å·. è‹¥æœªæ‰¾åˆ°æ˜ å°„, åˆ™è§¦å‘ç¼ºé¡µå¼‚å¸¸.  é¡µè¡¨çš„å·¥ä½œåŸç† é¡µè¡¨çš„å·¥ä½œæ–¹å¼æ˜¯å°†è™šæ‹Ÿåœ°å€ç©ºé—´å’Œç‰©ç†åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„å—, ç§°ä¸ºé¡µé¢.\né¡µè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹å¯¹åº”ç€ä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å—, è¡¨é¡¹çš„å€¼å°±æ˜¯è¿™å—è™šæ‹Ÿåœ°å€ç©ºé—´å¯¹åº”çš„ç‰©ç†åœ°å€å—, ä»¥åŠè®¿é—®ç‰©ç†åœ°å€æ—¶è¦ä½¿ç”¨çš„å±æ€§.\nåœ¨æŸ¥è¡¨è¿‡ç¨‹ä¸­, å°†è™šæ‹Ÿåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†:\n é«˜é˜¶ä½ç”¨ä½œé¡µè¡¨çš„ç´¢å¼•. ç”¨æ¥æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†å— ä½åœ°å€æ˜¯å—å†…çš„åç§»é‡, ä¸ä¼šå› ä¸ºæ˜ å°„è€Œæ”¹å˜. é¡µè¡¨é¡¹ä¸­çš„ç‰©ç†åœ°å€ä¸è¯¥åç§»ç»„åˆå½¢æˆç”¨äºè®¿é—®å†…å­˜çš„ç‰©ç†åœ°å€.  å¤šçº§é¡µè¡¨ å®é™…å®ç°ä¸­, å¤šé‡‡ç”¨å¤šçº§é¡µè¡¨çš„æ–¹æ¡ˆ, å„çº§é¡µè¡¨è‡ªå®šå‘ä¸‹ç»„æˆæ ‘çš„å½¢å¼, åä½œå®ç°è™šæ‹Ÿåˆ°ç‰©ç†åœ°å€çš„è½¬æ¢.\næ ‘ä¸­çš„åˆ†æ”¯æˆä¸ºé¡µç›®å½•, é¡µç›®å½•ä¸­çš„è¡¨é¡¹ä¸æ˜¯ç›´æ¥å­˜å‚¨ç›®æ ‡ç‰©ç†åœ°å€, è€Œæ˜¯ä¸‹ä¸€çº§é¡µè¡¨çš„åœ°å€; æœ€åä¸€çº§é¡µè¡¨çš„è¡¨é¡¹ä¸­ä¿å­˜ç€ç›®æ ‡ç‰©ç†åœ°å€.\n å¤šçº§é¡µè¡¨æ˜¯å‡å°é¡µè¡¨å ç”¨å­˜å‚¨ç©ºé—´è¿‡å¤§çš„æœ‰æ•ˆæ–¹æ¡ˆ.\n é¡¶çº§é¡µè¡¨å°†åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºå¤§å—, æ¯ä¸ªè¡¨é¡¹å¯ä»¥æŒ‡å‘å¤§å°ç›¸ç­‰çš„å†…å­˜å—. ä¹Ÿå¯ä»¥æŒ‡å‘å°†å—è¿›è¡Œå†æ¬¡ç»†åˆ†çš„ä¸‹ä¸€çº§é¡µè¡¨. æ”¯æŒå¤§å—çš„ä¼˜ç‚¹:\n å¤§çš„å†…å­˜å—éœ€è¦æŸ¥è¡¨çš„æ¬¡æ•°æ›´å°‘ æå‡TLBçš„æ•ˆç‡, å› ä¸ºä¸€ä¸ªTLBè¡¨é¡¹è¦†ç›–æ›´å¤§çš„å†…å­˜åŒºåŸŸ.  å‡¡äº‹éƒ½æ˜¯æœ‰åˆ©æœ‰å¼Š, ä½¿ç”¨å¤§å—ä¹Ÿå¢åŠ äº†å†…å­˜æµªè´¹, å®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®éœ€è¦æ¥æƒè¡¡.\nå†…å­˜ç±»å‹ æ™®é€šç±»å‹å†…å­˜ æ™®é€šç±»å‹çš„å†…å­˜æ˜¯å¼±ä¸€è‡´æ€§çš„(weakly ordered)å†…å­˜æ¨¡å‹, æ²¡æœ‰é¢å¤–çš„çº¦æŸ, å¯ä»¥æä¾›æœ€é«˜çš„å†…å­˜è®¿é—®æ€§èƒ½.\né€šå¸¸ä»£ç æ®µ, æ•°æ®æ®µä»¥åŠå…¶ä»–æ•°æ®éƒ½æ”¾åœ¨æ™®é€šå†…å­˜ä¸­.\næ™®é€šå†…å­˜å…è®¸å¤„ç†å™¨åšå¾ˆå¤šä¼˜åŒ–, å¦‚åˆ†æ”¯é¢„æµ‹, æ•°æ®é¢„å–, Cache lineé¢„å–, ä¹±åºæ‰§è¡Œç­‰.\nè®¾å¤‡ç±»å‹å†…å­˜ CPUè®¿é—®è®¾å¤‡å†…å­˜ä¼šæœ‰å¾ˆå¤šé™åˆ¶, å¦‚ä¸èƒ½è¿›è¡Œæ•°æ®é¢„å–ç­‰. è®¾å¤‡ç±»å‹çš„å†…å­˜ä¸¥æ ¼æŒ‰ç…§æŒ‡ä»¤çš„é¡ºåºæ¥æ‰§è¡Œçš„.\nè®¾å¤‡ç±»å‹å†…å®¹é€šå¸¸ç•™ç»™è®¾å¤‡æ¥è®¿é—®, ä¾‹å¦‚ä¸­æ–­æ§åˆ¶å™¨(GIC), ä¸²å£, å®šæ—¶å™¨ç­‰.\nä¸¤å¥—é¡µè¡¨  å½“CPUè®¿é—®çš„åœ°å€å±äºç”¨æˆ·ç©ºé—´æ—¶, MMUä¼šè‡ªåŠ¨é€‰æ‹©TTBR0æŒ‡å‘çš„é¡µè¡¨. å½“CPUè®¿é—®çš„åœ°å€å±äºå†…æ ¸ç©ºé—´æ—¶. MMUä¼šè‡ªåŠ¨é€‰æ‹©TTBR1æŒ‡å‘çš„é¡µè¡¨  EL2å’ŒEL3æ²¡æœ‰TTBR1, åªæœ‰TTBR0. ä¹Ÿå°±æ„å‘³ç€:\nâ€¢ If EL2 is using AArch64, it can only use Virtual Addresses in the range 0x0 to 0x0000FFFF_FFFFFFFF. â€¢ If EL3 is using AArch64, it can only use Virtual Addresses in the range 0x0 to 0x0000FFFF_FFFFFFFF.\nè¶Šæƒ, è¶Šç•Œ åœ¨æœªä½¿ç”¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¹‹å‰, æ‰€æœ‰çš„ç”¨æˆ·ç¨‹åºéƒ½å¯ä»¥è®¿é—®å…¨éƒ¨çš„ç‰©ç†å†…å­˜, æ‰€ä»¥æ¶æ„ç¨‹åºå¯ä»¥ä¿®æ”¹å…¶ä»–ç¨‹åºçš„å†…å­˜æ•°æ®, è¿™ä½¿å¾—æ•´ä¸ªç³»ç»Ÿå¤„äºå±é™©çš„çŠ¶æ€. æ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´éƒ½è¦å—åˆ°ä¿æŠ¤, ä»¥å…è¢«å…¶ä»–è¿›ç¨‹æœ‰æ„/æ— æ„çš„ç ´å.\nç°ä»£æ“ä½œç³»ç»Ÿä¸­, æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´. åœ¨è¿›ç¨‹çš„è§’åº¦ä¸Š, å®ƒæ‹¥æœ‰æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´. ä¸åŒçš„è¿›ç¨‹å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿåœ°å€, MMUé€šè¿‡é¡µè¡¨å°†å…¶æ˜ å°„åˆ°åˆé€‚çš„ç‰©ç†åœ°å€.\nä¸¤ä¸ªç‰©ç†åœ°å€ç©ºé—´ ARMv8 ä½“ç³»ç»“æ„å®šä¹‰ä¸¤ä¸ªç‰©ç†åœ°å€ç©ºé—´: secure address space å’Œ non-secure address space.\nç†è®ºä¸Š, å®‰å…¨å’Œéå®‰å…¨çš„åœ°å€ç©ºé—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„, ç„¶è€Œç°å®ä¸­å¤§å¤šæ•°ç³»ç»Ÿéƒ½å°†å®‰å…¨å’Œéå®‰å…¨è§†ä¸ºè®¿é—®æ§åˆ¶çš„å±æ€§. æ­£å¸¸(éå®‰å…¨)ä¸–ç•Œåªèƒ½è®¿é—®éå®‰å…¨çš„ç‰©ç†å†…å­˜; è€Œå®‰å…¨ä¸–ç•Œå¯ä»¥è®¿é—®è¿™ä¸¤ä¸ªåœ°å€ç©ºé—´.\nARMv8 MMUæƒé™æ§åˆ¶ ç¨‹åºè¯·æ±‚æŸä¸ªåœ°å€æ—¶, MMUéœ€è¦è¿›è¡Œæƒé™æ£€æŸ¥. å¦‚æœè¯·æ±‚çš„åœ°å€æ˜¯æ•°æ®, åˆ™æ£€æŸ¥è¯»å†™æƒé™; å¦‚æœè¯·æ±‚çš„æ˜¯åœ°å€, åˆ™æ£€æŸ¥å…¶å¯æ‰§è¡Œæƒé™.\nARMv8 é¡µè¡¨é¡¹çš„APå­—æ®µæ§åˆ¶è¯¥ä¸åŒå¼‚å¸¸ç­‰çº§ä¸‹, é¡µé¢çš„è¯»å†™æƒé™.\n[è¡¨æ ¼]\nARMv8 é¡µè¡¨é¡¹çš„PNXå­—æ®µå’ŒXN/UXNå­—æ®µæ¥è®¾ç½®CPUæ˜¯å¦å¯¹è¿™ä¸ªé¡µé¢æœ‰æ‰§è¡Œæƒé™.\n  å½“ç³»ç»Ÿæœ‰ä¸¤å¥—é¡µè¡¨æ—¶, UXNæ˜¯ç”¨æ¥è®¾ç½®ç”¨æˆ·ç©ºé—´é¡µé¢æ˜¯å¦æœ‰å¯æ‰§è¡Œæƒé™; PXN ç”¨æ¥è®¾ç½®ç‰¹æƒç©ºé—´çš„é¡µé¢æ˜¯å¦æœ‰å¯æ‰§è¡Œæƒé™.\n  è‹¥ç³»ç»Ÿåªæœ‰ä¸€å¥—é¡µè¡¨, åˆ™é€šè¿‡XNå­—æ®µæ§åˆ¶\n  é¡µè¡¨çš„ç»“æ„ åœ°å€å®½åº¦ 48bit\né¡µé¢ç²’åº¦ é¡µé¢ç²’åº¦è¡¨ç¤ºä¸€æ¬¡æœ€å°åˆ†é…å†…å­˜å—çš„å¤§å°. AArch64æ”¯æŒä¸‰ç§é¡µçš„å¤§å°, 4KB, 16KB, 64KB. æ”¯æŒå“ªä¸€ç§æ˜¯ç”±å®ç°å®šä¹‰çš„ã€‚åˆ›å»ºé¡µè¡¨çš„ä»£ç èƒ½å¤Ÿè¯»å–ç³»ç»Ÿå¯„å­˜å™¨ID_AA64MMFR0_EL1ï¼Œä»¥æ‰¾å‡ºå“ªäº›æ˜¯å—æ”¯æŒçš„å¤§å°ã€‚Cortex-A53å¤„ç†å™¨æ”¯æŒæ‰€æœ‰ä¸‰ç§å°ºå¯¸ï¼Œä½†æœ‰äº›å¤„ç†å™¨çš„æ—©æœŸç‰ˆæœ¬å¹¶éå¦‚æ­¤ï¼Œä¾‹å¦‚Cortex-A57ï¼Œå®ƒä¸æ”¯æŒ16Kç²’åº¦ã€‚\nAArch64 é¡µè¡¨é¡¹ç»“æ„ æ— æ•ˆé¡µè¡¨é¡¹ table block é¡µè¡¨ç»“æ„(4KBé¡µé¢ä¸ºä¾‹) ä»¥4KBé¡µé¢ç²’åº¦, è™šæ‹Ÿåœ°å€å®½åº¦ä¸º 48ä½. ä½¿ç”¨4çº§é¡µè¡¨.\n48ä½åœ°å€æ¯å±‚è½¬æ¢æœ‰9ä¸ªåœ°å€ä½ï¼Œå³æ¯å±‚512ä¸ªæ¡ç›®ï¼Œæœ€å12ä½é€‰æ‹©4kBå†…çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç›´æ¥æ¥è‡ªåŸå§‹åœ°å€\nè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¿‡ç¨‹ å½“å¤„ç†å™¨ä¸ºè·å–æŒ‡ä»¤æˆ–æ•°æ®è®¿é—®å‘å‡ºä¸€ä¸ª64ä½çš„è™šæ‹Ÿåœ°å€æ—¶ï¼ŒMMUç¡¬ä»¶å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç›¸åº”çš„ç‰©ç†åœ°å€ã€‚å¯¹äºè™šæ‹Ÿåœ°å€ï¼Œå‰16ä½[63:47]å¿…é¡»å…¨éƒ¨ä¸º0æˆ–1ï¼Œå¦åˆ™åœ°å€å°†è§¦å‘æ•…éšœã€‚\nNon-secure and secure access ARMv8-Aæ¶æ„å®šä¹‰äº†ä¸¤ç§å®‰å…¨çŠ¶æ€:å®‰å…¨çš„å’Œéå®‰å…¨çš„ã€‚å®ƒè¿˜å®šä¹‰äº†ä¸¤ä¸ªç‰©ç†åœ°å€ç©ºé—´:å®‰å…¨çš„å’Œéå®‰å…¨çš„. æ­£å¸¸(éå®‰å…¨)ä¸–ç•Œåªèƒ½è®¿é—®éå®‰å…¨ç‰©ç†åœ°å€ç©ºé—´ã€‚å®‰å…¨ä¸–ç•Œå¯ä»¥è®¿é—®ä¸¤ä¸ªç‰©ç†åœ°å€ç©ºé—´ã€‚è¿™ä¹Ÿæ˜¯é€šè¿‡è½¬æ¢è¡¨æ¥æ§åˆ¶çš„ã€‚\nåœ¨éå®‰å…¨çŠ¶æ€ä¸‹ï¼Œè½¬æ¢è¡¨ä¸­çš„NSä½å’ŒNSTableä½å°†è¢«å¿½ç•¥ã€‚åªèƒ½è®¿é—®éå®‰å…¨å†…å­˜ã€‚åœ¨å®‰å…¨çŠ¶æ€ä¸‹ï¼ŒNSä½å’ŒNSTableä½æ§åˆ¶è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºå®‰å…¨ç‰©ç†åœ°å€è¿˜æ˜¯éå®‰å…¨ç‰©ç†åœ°å€ã€‚\nYou can use SCR_EL3.SIF æ¥ç¦ç”¨å®‰å…¨ä¸–ç•Œè®¿é—®éå®‰å…¨åœ°å€.\nç›¸å…³çš„å¯„å­˜å™¨ ä¸åœ°å€è½¬æ¢ç›¸å…³çš„å¯„å­˜å™¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ª:\n è½¬æ¢æ§åˆ¶å¯„å­˜å™¨(TCR) ç³»ç»Ÿæ§åˆ¶å¯„å­˜å™¨(SCTLR) é¡µè¡¨åŸºåœ°å€å¯„å­˜å™¨(TTBR)  TCR IPS: é…ç½®åœ°å€è½¬æ¢åè¾“å‡ºç‰©ç†åœ°å€çš„æœ€å¤§å€¼\nTxSz: é…ç½®è¾“å…¥åœ°å€çš„æœ€å¤§å€¼, å³è™šæ‹Ÿåœ°å€çš„å®½åº¦\nTG1: é…ç½®TTBR1é¡µè¡¨çš„é¡µé¢ç²’åº¦å¤§å°\nSHx: é…ç½®TTBRxç›¸å…³å†…å­˜çš„Cacheå…±äº«å±æ€§\nORGNx:\nIRGNx:\nSCTLR M: Disable/Enable MMUåœ°å€è½¬æ¢\nC: Disable/Enable Data Cache\nI: Disable/Enable Instruction Cache\nTTBR å­˜å‚¨é¡µè¡¨çš„åŸºåœ°å€\nAArch32 è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ ARMv8 AArch32 çš„è™šæ‹Ÿå†…å­˜ç³»ç»Ÿå‘åå…¼å®¹ARMv7, ä¸ARMv7çš„åŸºæœ¬ä¸€è‡´.\n","date":"2022-09-29T08:01:33+08:00","permalink":"https://wangloo.github.io/posts/armv8/mmu/","section":"posts","tags":["armv8"],"title":"AArch64 MMUä»‹ç»"},{"categories":["Architecture"],"contents":"ARMv8 å¼‚å¸¸è¿”å›æŒ‡ä»¤ å½“å¼‚å¸¸å¤„ç†ç¨‹åºç»“æŸåï¼Œéœ€è¦æ‰§è¡Œå¼‚å¸¸è¿”å›æŒ‡ä»¤æ¢å¤è¿›å…¥å¼‚å¸¸ä¹‹å‰çš„çŠ¶æ€.\nå…·ä½“è¦åšçš„äº‹æƒ…åŒ…æ‹¬:\n  æ¢å¤å‘ç”Ÿå¼‚å¸¸å‰çš„PC\n  ä»SPSRä¸­æ¢å¤PSTATEå¯„å­˜å™¨(ç°åœº)\n  å¼‚å¸¸è¿”å›çš„æŒ‡ä»¤æ ¹æ®å½“å‰æ‰§è¡ŒçŠ¶æ€ä¸ºAArch32è¿˜æ˜¯AArch64æœ‰æ‰€ä¸åŒ.\nAArch32 AArch32çš„å¼‚å¸¸è¿”å›æŒ‡ä»¤åœ¨ä¸åŒçš„æ¨¡å¼ä¸‹ä¹Ÿæœ‰æ‰€ä¸åŒ:\nè‹¥å¼‚å¸¸æ˜¯åœ¨Hypæ¨¡å¼ä¸‹å¤„ç†: ä»…å¯æ‰§è¡ŒERETæŒ‡ä»¤ä»å¼‚å¸¸è¿”å›.\nè‹¥å¼‚å¸¸æ˜¯åœ¨å…¶ä»–æ¨¡å¼ä¸‹å¤„ç†, AArch32æä¾›äº†ä»¥ä¸‹çš„å¼‚å¸¸è¿”å›æŒ‡ä»¤:\n  ERET æŒ‡ä»¤\n  ä½¿ç”¨å¸¦Såç¼€çš„æ•°æ®å¤„ç†æŒ‡ä»¤ç›´æ¥æ“ä½œPC(ä¾‹å¦‚, MOVS, PC, LR), æ¢å¤PSTATE\n  RFE æŒ‡ä»¤: RFE \u0026lt;Rn\u0026gt;. ä»åŸºå€å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€ä¾æ¬¡åŠ è½½PCå’ŒPSTATE\n  LDM æŒ‡ä»¤: LDM \u0026lt;Rn\u0026gt; {pc..}. è‹¥ç›®æ ‡å¯„å­˜å™¨ä¸­åŒ…å«PC, åˆ™ä¼šåŒæ—¶æ¢å¤PSTATE\n  AArch64 AArch64ä¸‹ç»Ÿä¸€ä½¿ç”¨ ERET æŒ‡ä»¤è¿›è¡Œå¼‚å¸¸è¿”å›.\næŒ‡ä»¤æ ¼å¼åŠç”¨æ³•å‚è€ƒ ERET ERETæŒ‡ä»¤å®Œæˆäº†:\n  ä»ELR_ELxä¸­æ¢å¤PCæŒ‡é’ˆ\n  ä»SPSR_ELxä¸­æ¢å¤PSTATEå¯„å­˜å™¨çš„çŠ¶æ€.\n  LDM(Load Multiple) æ ¼å¼: LDM \u0026lt;Rn\u0026gt; {registers}\nå«ä¹‰: ä»åŸºå€å¯„å­˜å™¨\u0026lt;Rn\u0026gt;æŒ‡å‘çš„åœ°å€å¼€å§‹ä¾æ¬¡åŠ è½½å¤šä¸ªå¯„å­˜å™¨å€¼. è‹¥ç›®æ ‡å¯„å­˜å™¨ä¸­åŒ…å«PC, åˆ™åŒæ—¶æ¢å¤PSTATE.\nä¾‹å¦‚: LDM \u0026lt;r0\u0026gt; {pc, r1} ç­‰ä»·äº:\n1pc = [r0] 2r1 = [r0+4] 3PSTATE = SPSR ;ä»…å½“ç›®æ ‡å¯„å­˜å™¨åŒ…å«PCæ—¶è‡ªåŠ¨å®Œæˆ RFE(Return From Exception) æ ¼å¼: LDM \u0026lt;Rn\u0026gt; \nå«ä¹‰: ä»åŸºå€å¯„å­˜å™¨\u0026lt;Rn\u0026gt;æŒ‡å‘çš„åœ°å€ä¾æ¬¡åŠ è½½PCå’ŒPSTATE.\nä¾‹å¦‚: RFE \u0026lt;r0\u0026gt; ç­‰ä»·äº:\n1pc = [r0] 2PSTATE = [r0+4] ","date":"2022-09-24T21:19:01+08:00","permalink":"https://wangloo.github.io/posts/armv8/exception_return/","section":"posts","tags":["armv8"],"title":"AArch64 å¼‚å¸¸ç­‰çº§åˆ‡æ¢"},{"categories":["C Language"],"contents":"è¯­å¥ç»“æ„ 1asm asm-qualifiers ( AssemblerTemplate 2 : OutputOperands 3 : InputOperands 4 : Clobbers 5 : GotoLabels) The asm keyword is a GNU extension. å½“ä½¿ç”¨ç¼–è¯‘é€‰é¡¹ -ansi æˆ– -std æ—¶, ä½¿ç”¨ __asm__ä»£æ›¿ asm.\nQualifiers  volatile: å‘ç¼–è¯‘å™¨è¯´æ˜ç¦æ­¢å†…æ•›çš„è¯­å¥ä¸å…¶ä»–è¯­å¥ reorderã€‚ä½†ä¸èƒ½ä¿è¯å†…éƒ¨ reorderï¼Œé‚£æ˜¯å†…å­˜å±éšœçš„ä»»åŠ¡ goto inline  Parameters AssemblerTemplate: å­—ç¬¦ä¸², æ±‡ç¼–ä»£ç çš„æ¨¡æ¿\nOutputOperands: è¾“å‡ºæ“ä½œæ•°; æŒ‡ä»¤å°†ä¼šä¿®æ”¹çš„å˜é‡é›†åˆ\nInputOperands: è¾“å…¥æ“ä½œæ•°; æŒ‡ä»¤å°†è¯»å–çš„å˜é‡é›†åˆ\nClobbers: ???TODO\nGotoLabels: ä»…å½“ qualifiers ä½¿ç”¨gotoæ—¶, å£°æ˜labelé›†åˆ.\n The total number of input + output + goto operands is limited to 30.\n Â Param #1: AssemblerTemplate å¤šæ¡è¯­å¥å¯ä»¥æ”¾åœ¨ä¸€ä¸ªasmå­—ç¬¦ä¸²ä¸­, ä½†æ˜¯æ›´å¸¸è§çš„æ˜¯æ¯æ¡æ±‡ç¼–è¯­å¥ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸², å¹¶åœ¨ç»“æŸæ—¶ä½¿ç”¨æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦(\\n, \\t)æ¥è¡¨ç¤ºæ¢è¡Œ.\n è²Œä¼¼å¯¹äº arm æ±‡ç¼–, åªç”¨ \\n ä¹ŸOK?\n Â Param #2: OutputOperands å¤šä¸ª OutputOperands ä¹‹é—´ä½¿ç”¨,éš”å¼€, æ¯ä¸ª OutputOperands çš„æ ¼å¼å¦‚ä¸‹:\n1[ [asmSymbolicName] ] constraint (cvariablename) asmSymbolicName: æŒ‡å®šè¯¥æ“ä½œæ•°çš„åç§°\nconstraint: å¯¹è¯¥æ“ä½œæ•°çš„ä¸€äº›é™åˆ¶\n1// æè¿°æ“ä½œæ•°çš„æƒé™, è¾“å‡ºæ“ä½œæ•°çš„çº¦æŸå¿…é¡»ä»¥æ­¤å¼€å¤´ 2= å¿½ç•¥ç°æœ‰å€¼ 3+ è¯»å†™, å½“åŸå…ˆå€¼æœ‰æ„ä¹‰æ—¶ç”¨å®ƒ 4\u0026amp; ç¦æ­¢ç¼–è¯‘å™¨å°†è¯¥æ“ä½œæ•°ä¸ä¸ç›¸å…³çš„è¾“å…¥æ“ä½œæ•°åˆ†é…åŒä¸€ä¸ªå¯„å­˜å™¨ 5 6// æè¿°è¾“å‡ºæ“ä½œæ•°æ‰€åœ¨ä½ç½®, å¦‚æœä½ ä¸çŸ¥é“, å¯ä»¥åŒæ—¶è®¾ç½®, ç¼–è¯‘å™¨ä¼šå¸®ä½ å†³å®š 7r å¯„å­˜å™¨ 8m å†…å­˜ 9 10// æ¶æ„ç›¸å…³çš„ 11z AArch64ä¸­å­˜åœ¨. è¡¨è¾¾å¯ä»¥ä½¿ç”¨é›¶å¯„å­˜å™¨(XZR or WZR). Useful when combined 12 with `r` to represent an operand that can be either a general-purpose register 13 or the zero register. cvariablename: è¾“å‡ºåˆ°çš„ C è¯­è¨€å˜é‡å\nÂ Param #3: Input Operands è¾“å…¥æ“ä½œæ•°çš„æ ¼å¼ä¸è¾“å‡ºæ“ä½œæ•°åŸºæœ¬ä¸€è‡´:\n1[ [asmSymbolicName] ] constraint (cexpression)  å¯¹äºè¾“å…¥æ“ä½œæ•°, ä¸€èˆ¬æ²¡æœ‰åˆ«çš„é™åˆ¶, ä»…ä½¿ç”¨\u0026quot;r\u0026quot;(val)\n Â Param #4: Clobbers æ¯ä¸ª clobber éƒ½æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥, å¹¶ç”¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²å¸¸é‡.\nå¸¸ç”¨çš„ clobber å‚æ•°:\n  \u0026ldquo;memory\u0026rdquo;\nå‘ç¼–è¯‘å™¨è¯´æ˜å¯¹äºæ‰€æœ‰å†…å­˜è®¿é—®æ“ä½œï¼Œä¸èƒ½ä½¿ç”¨ asm ä¹‹å‰é¢„åŠ è½½åˆ°å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œ è€Œå¿…é¡»åœ¨ asm å†…éƒ¨é‡æ–°åŠ è½½ã€‚ä¿è¯å…¶å†…éƒ¨è®¿é—®å†…å­˜å€¼å…·æœ‰å¯è§æ€§å’Œæ­£ç¡®æ€§ã€‚\n  \u0026ldquo;cc\u0026rdquo;\nThis stands for \u0026ldquo;condition codes\u0026rdquo;. Since the add instruction will affect the carry flag amongst other things, we need to tell gcc about it. Otherwise it might want to split a test-and-branch around our code. If it did so, the branch might go the wrong way due to the condition codes being corrupted. Basically, any inline asm that does arithmetic should explicitly clobber the flags like this.\n  Â Param #5: GotoLabels å°½é‡ä¸ä½¿ç”¨, å¯ä»¥åœ¨ASMçš„å†…éƒ¨ç›´æ¥å®šä¹‰ label\nTODO\nÂ æ ·ä¾‹ æœ€ç®€å•çš„æ¨¡æ¿ 1int src = 1; 2int dst; 3 4asm (\u0026#34;mov %1, %0\\n\\t\u0026#34; 5 \u0026#34;add $1, %0\u0026#34; 6 : \u0026#34;=r\u0026#34; (dst) 7 : \u0026#34;r\u0026#34; (src)); 8 9printf(\u0026#34;%d\\n\u0026#34;, dst); æ“ä½œæ•°ä½¿ç”¨ asmSymbolicName 1uint32_t c = 1; 2uint32_t d; 3uint32_t *e = \u0026amp;c; 4 5asm (\u0026#34;mov %[e], %[d]\u0026#34; 6 : [d] \u0026#34;=rm\u0026#34; (d) 7 : [e] \u0026#34;rm\u0026#34; (*e)); å†…éƒ¨å®šä¹‰ label 1 long temp; 2 long ret; 3\tasm volatile( 4 \u0026#34;1: \\n\u0026#34; 5 \u0026#34;ldxr %0, [%2]\\n\u0026#34; 6 \u0026#34;sub %0, %0, %3\\n\u0026#34; 7 \u0026#34;stxr %w1, %0, [%2]\\n\u0026#34; 8 \u0026#34;cbnz %w1, 1b\\n\\t\u0026#34; 9 : \u0026#34;=\u0026amp;r\u0026#34;(ret), \u0026#34;=\u0026amp;r\u0026#34;(temp) 10 : \u0026#34;r\u0026#34;(p), \u0026#34;r\u0026#34;(val) 11 : \u0026#34;memory\u0026#34; 12 ); Reference Extended Asm (Using the GNU Compiler Collection (GCC))\nAArch64 Constraint codes\n","date":"2022-09-24T16:48:58+08:00","permalink":"https://wangloo.github.io/posts/c/inline-asm/","section":"posts","tags":["c"],"title":"GNU C å†…è”æ±‡ç¼–å­¦ä¹ "},{"categories":["Shell"],"contents":"â„¹ï¸ ä»¥ä¸‹å‘½ä»¤/è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒå‡ä¸º bash.\nç»Ÿè®¡ä»£ç é‡  ä½¿ç”¨åˆ°çš„å‘½ä»¤åŒ…å«: find, wc, xargs, sort ç­‰\n åˆ—å‡ºæ‰€æœ‰çš„æ–‡ä»¶åŠå…¶ä»£ç è¡Œæ•°, åªç»Ÿè®¡.c å’Œ.h, è¿‡æ»¤./scriptsç›®å½•.\n1find -name \u0026#39;*.[c|h]\u0026#39; ! -path \u0026#39;./scripts/*\u0026#39; | xargs wc -l +å°†å†…å®¹æŒ‰ç…§ä»£ç è¡Œæ•°é™åºæ’åˆ—\n1find -name \u0026#39;*.[c|h]\u0026#39; ! -path \u0026#39;./scripts/*\u0026#39; | xargs wc -l | sort -rn è‹¥ä»…åˆ—å‡ºæ€»çš„ä»£ç è¡Œæ•°, å»é™¤ç©ºè¡Œ\n1(find ./ -name \u0026#39;*.[c|h]\u0026#39; -print0 | xargs -0 cat) | sed \u0026#39;/^\\s*$/d\u0026#39; | wc -l åˆ é™¤ç›®å½•ä¸‹æ‰€æœ‰çš„å¯æ‰§è¡Œæ–‡ä»¶ 1find . -maxdepth 1 -executable -type f | xargs rm åˆ¤æ–­æ‰§è¡Œè„šæœ¬æ—¶å¸¦çš„å‚æ•° 1if [ $# -ne 1 ]; then 2 echo \u0026#34;ONE parameter is needed\u0026#34; 3 exit -1 4fi 5 6if [ $1 == \u0026#39;build\u0026#39; ]; then 7 # do something 8elif [ $1 == \u0026#39;run\u0026#39; ]; then 9 # do something 10elif [ $1 == \u0026#39;gdb\u0026#39; ]; then 11 # do something 12else 13 echo \u0026#34;Not supported command\u0026#34; 14fi è‡ªåŠ¨æ‹·è´æ–‡ä»¶åˆ° SD Card  TODO\n æ·»åŠ è¿›åº¦æ¡   1#!/bin/bash 2sd_path=$(find /media/$USER -maxdepth 1 -type d -name \u0026#34;*-*\u0026#34;) 3 4while [ ! -d \u0026#34;${sd_path}\u0026#34; ] 5do 6 sleep 1 7 echo \u0026#34;waiting for inserting SD-Card\u0026#34; 8done 9 10echo \u0026#34;SD-Card is inserted\u0026#34; 11cp ./output/kernel/kernel.bin ${sd_path} 12echo \u0026#34;Copy completely\u0026#34; è·å–æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯(å¯é€’å½’è¿›å…¥å­ç›®å½•) è·å–dirè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯, è¿™é‡Œè·å–çš„æ˜¯æ–‡ä»¶çš„å®Œæ•´è·¯å¾„.\n TODO\n æ“ä½œæ•°ç»„ä¸‹æ ‡çš„æ–¹å¼å¯èƒ½æœ‰å¾…æ”¹è¿›? filenumæ„Ÿè§‰æ²¡å¿…è¦, æš‚æ—¶è¿˜ä¸ä¼šæ”¹ é€šè¿‡æ‹¼æ¥è·å¾—æ–‡ä»¶ä¿¡æ¯(è·¯å¾„)çš„æ–¹å¼ä¹Ÿæœ‰ç‚¹æ€ªå¼‚   1dir=./ 2files=() 3filenum=0 4function getfiles() 5{ 6 for file in `ls $dir`; 7 do 8 if [ -d $file ]; then 9 cd $file 10 getfiles 11 cd .. 12 else 13 files[$filenum]=$(pwd $file)/$(basename $file) 14 # echo file=$(pwd $file)/$(basename $file) 15 let filenum++ 16 fi 17 done 18} å¸¦é¢œè‰²çš„è¾“å‡º ä½¿ç”¨ANSI escape code\n1Black 0;30 Dark Gray 1;30 2Red 0;31 Light Red 1;31 3Green 0;32 Light Green 1;32 4Brown/Orange 0;33 Yellow 1;33 5Blue 0;34 Light Blue 1;34 6Purple 0;35 Light Purple 1;35 7Cyan 0;36 Light Cyan 1;36 8Light Gray 0;37 White 1;37 Code example:\n1#!/bin/bash 2 3RED=\u0026#39;\\033[0;31m\u0026#39; 4GREEN=\u0026#39;\\033[0;32m\u0026#39; 5YELLOW=\u0026#39;\\033[1;33m\u0026#39; 6BLUE=\u0026#39;\\033[0;34m\u0026#39; 7CYAN=\u0026#39;\\033[0;36m\u0026#39; 8NC=\u0026#39;\\033[0m\u0026#39; # No Color 9 10echo -e \u0026#34;${YELLOW}HELLO, YELLOW${NC}\u0026#34; 11echo -e \u0026#34;${GREEN}HELLO, GREEN${NC}\u0026#34; 12echo -e \u0026#34;${RED}HELLO, RED${NC}\u0026#34; 13echo -e \u0026#34;${BLUE}HELLO, BLUE${NC}\u0026#34; 14echo -e \u0026#34;${CYAN}HELLO, CYAN${NC}\u0026#34; 15 16######################################################### 17# generic functions ##################################### 18 19function ERROR(){ 20 echo -e \u0026#34;${RED}[error] $*${NC}\u0026#34;; 21 exit 1 22} 23 24function INFO { 25 echo -e \u0026#34;${BLUE}[info] $*${NC}\u0026#34;; 26} 27 28function WARN { 29 echo -e \u0026#34;${YELLOW}[warn] $*${NC}\u0026#34;; 30} 31 32function LOG { 33 echo -e \u0026#34;${GREEN}[log] $*${NC}\u0026#34; \u0026gt;\u0026gt; $LOG 34} 35 36INFO \u0026#34;This is an infomation\u0026#34; 37WARN \u0026#34;This is a log\u0026#34; ","date":"2022-07-20T11:54:13+08:00","permalink":"https://wangloo.github.io/posts/shell/shell-script/","section":"posts","tags":["shell","bash"],"title":"æ­¦å™¨åº“: Shell Scripts"},{"categories":["C Language"],"contents":"è¿ç»­å†…å­˜å–n bit 1#include \u0026lt;stdio.h\u0026gt;2#include \u0026lt;stdint.h\u0026gt;3#include \u0026lt;assert.h\u0026gt;4 5#define bitmask(n) ((1ul \u0026lt;\u0026lt; (n)) - 1) 6 7/* 8* ä»ptræŒ‡å‘çš„å†…å­˜å¼€å§‹ï¼ŒæŠ½å–ç¬¬startä¸ªbitå¼€å§‹çš„è¿ç»­nä¸ªbit 9* é™åˆ¶: n \u0026lt; 32 10*/ 11uint32_t extract_bits(uint8_t *ptr, uint32_t start, uint32_t n) 12{ 13 uint32_t start_byte = start / 8; 14 uint32_t start_offset = start % 8; 15 uint32_t *pstart = (uint32_t *)(ptr + start_byte); 16 17 uint32_t end = start + n - 1; 18 uint32_t end_byte = end / 8; 19 uint32_t end_offset = end % 8; 20 uint32_t *pend = (uint32_t *)(ptr + end_byte); 21 22 uint32_t data = *pstart \u0026gt;\u0026gt; start_offset; 23 24 if (n \u0026gt; 32 - start_offset) { 25 /* ç”±äºn \u0026lt; 32, æ‰€ä»¥è¡¥é½*pendä¸€å®šå°±å¤Ÿäº†ï¼Œ 26* end_offsetå¯¹é½åˆ°æœ€åä¸€ä½(n-1). 27* 28* ä¸¥è°¨æ€§è¯æ˜: n ä¸€å®š\u0026gt; end_offset + 1 29* å› ä¸ºn \u0026gt; 32-start_offset ==\u0026gt; n \u0026gt; 25, 30* ä¸”end_offset + 1 \u0026lt; 9, æ•…å¾—è¯ 31*/ 32 data |= *pend \u0026lt;\u0026lt; (n - end_offset - 1); 33 } 34 35 return data \u0026amp; bitmask(n); 36} 37 38void test_val(uint32_t val, uint32_t expect) 39{ 40 if (val != expect) { 41 printf(\u0026#34;error: val: 0x%x, expect: 0x%x\\n\u0026#34;, val, expect); 42 } 43 assert(val == expect); 44} 45 46 47int main(void) 48{ 49 uint32_t vals[] = {0x11223344, 0x11223344}; 50 uint32_t ret; 51 52 ret = extract_bits((uint8_t *)vals, 31, 30); 53 test_val(ret, 0x22446688); 54 55 56 printf(\u0026#34;Test Passed!\\n\u0026#34;); 57 return 0; 58} ä¸€ä¸ªæ•°å–è¿ç»­n bit 1/* 2* ä»ä¸€ä¸ªæ•°ä¸­å–ç¬¬startä¸ªbitå¼€å§‹çš„è¿ç»­nä¸ªbit 3*/ 4uint32_t extract_bits (uint32_t val, uint32_t start, uint32_t n) 5{ 6 return (val \u0026gt;\u0026gt; start) \u0026amp; bitmask(n); 7} åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸º2çš„å¹‚ 1unsigned int v; 2 3if ((v \u0026amp; (v - 1)) == 0) 4 printf(\u0026#34;v is a power of 2\\n\u0026#34;); 5else 6 printf(\u0026#34;v is not a power of 2\\n\u0026#34;); Â ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„æ•°é‡ ä¾ç„¶æ˜¯åˆ©ç”¨v \u0026amp; (v -1)çš„è¿ç®—ç»“æœä¼šå°†vçš„æœ€ä½ä½çš„1(å¦‚æœæœ‰çš„è¯)ç½®0.\nå¾ªç¯æ‰§è¡Œæ­¤æ“ä½œå°±å¯ç»Ÿè®¡vä¸­1çš„æ•°é‡.\n1int numberof1(int v) { 2 int count = 0; 3 4 while(v) { 5 count++; 6 v = v \u0026amp; (v -1); 7 } 8 return count; 9} Â å°†ä¸€ä¸ªæ•°å‘ä¸Šå–æ•´ä¸º2çš„å¹‚ ç”¨ä¸€ä¸ª1ä¸€ç›´å·¦ç§», ç›´åˆ°æ¯”è¿™ä¸ªæ•°å¤§ä¸ºæ­¢.\n1uint32_t roundup_pow_of_two(const uint32_t x) { 2 uint32_t ret = 1; 3 4 while (ret \u0026lt; x) { 5 ret = ret \u0026lt;\u0026lt; 1; 6 } 7 return ret; 8} Linuxå†…æ ¸ä¸­ä½¿ç”¨äº†ä¸€ç§æ›´å¿«çš„æ–¹æ¡ˆ, amazing!!!\n1static __inline__ int generic_fls(int x) 2{ 3\tint r = 32; 4 5\tif (!x) 6\treturn 0; 7\tif (!(x \u0026amp; 0xffff0000u)) { 8\tx \u0026lt;\u0026lt;= 16; 9\tr -= 16; 10\t} 11\tif (!(x \u0026amp; 0xff000000u)) { 12\tx \u0026lt;\u0026lt;= 8; 13\tr -= 8; 14\t} 15\tif (!(x \u0026amp; 0xf0000000u)) { 16\tx \u0026lt;\u0026lt;= 4; 17\tr -= 4; 18\t} 19\tif (!(x \u0026amp; 0xc0000000u)) { 20\tx \u0026lt;\u0026lt;= 2; 21\tr -= 2; 22\t} 23\tif (!(x \u0026amp; 0x80000000u)) { 24\tx \u0026lt;\u0026lt;= 1; 25\tr -= 1;1 26\t} 27\treturn r; 28} 29 30static inline unsigned long __attribute_const__ roundup_pow_of_two(unsigned long x) 31{ 32\treturn (1UL \u0026lt;\u0026lt; generic_fls(x - 1)); 33} Â å‘ä¸Š/å‘ä¸‹å¯¹é½, æ£€æŸ¥æ˜¯å¦å¯¹é½ 1/* uintptr_t ä»£è¡¨æŒ‡é’ˆçš„ä½æ•° 2* åŠ uintptr_tè½¬æ¢çš„åŸå› æ˜¯: (void *)ä¸èƒ½è¿›è¡Œè¿ç®— 3*/ 4#define IS_ALIGNED(X, align) (((uintptr_t)(const void *)(X)) % (align) == 0) 5#define ALIGN_UP(X, align) (((X) + ((align) - 1)) \u0026amp; ~((align) - 1)) 6#define ALIGN_DOWN(x, align) ((X) \u0026amp; ~((align) - 1)) 7 8#define X (0x12345675) 9#define align (1 \u0026lt;\u0026lt; 2) 10 11int main() 12{ 13 int v = IS_ALIGNED(X, align); 14 15 if (0 == v) { 16 printf(\u0026#34;Given X(0x%x) is not align to 0x%08x\\n\u0026#34;, X, align); 17 printf(\u0026#34;After align up, new X = 0x%x\\n\u0026#34;, ALIGN_UP(X, align)); 18 printf(\u0026#34;After align down, new X = 0x%x\\n\u0026#34;, ALIGN_DOWN(X, align)); 19 } else { 20 printf(\u0026#34;Give X(0x%x) is aligned to 0x%08x\\n\u0026#34;, X, align); 21 printf(\u0026#34;After align up, new X = 0x%x\\n\u0026#34;, ALIGN_UP(X, align)); 22 printf(\u0026#34;After align down, new X = 0x%x\\n\u0026#34;, ALIGN_DOWN(X, align)); 23 } 24 25 return 0; 26} Â æ£€æŸ¥ä¸¤ä¸ªæœ‰ç¬¦å·æ•°æ˜¯å¦å¼‚å· 1int x,y; 2 3if ((x ^ y) \u0026lt; 0) 4 printf(\u0026#34;They have opposite signs\\n\u0026#34;); 5else 6 printf(\u0026#34;They have same signs\\n\u0026#34;); Â å¤§å°ç«¯è½¬æ¢ Â å¯¹æŸä¸ªä½çš„get/set/clearæ“ä½œ 1#define GET_BIT(x, bit) ( ((x) \u0026amp; (1ULL \u0026lt;\u0026lt; (bit))) \u0026gt;\u0026gt; (bit) ) 2#define SET_BIT(x, bit) ( (x) |= (1ULL \u0026lt;\u0026lt; (bit)) ) 3#define CLEAR_BIT(x, bit) ( (x) \u0026amp;= ~(1ULL \u0026lt;\u0026lt; (bit)) )  Release note:\n æ·»åŠ å¯¹unsigned long longé•¿åº¦çš„æ”¯æŒ   Â Sign extending from a varaiable bit-width 1 int bits = 2 * 8; // number of bits representing the number in x 2 int x = 0xFFC1; // ready to get sign-extended 3 int rst; // resulting sign-extended number 4 int const mask = 1U \u0026lt;\u0026lt; (bits - 1); // mask can be pre-computed if bits if fixed. 5 6 x = x \u0026amp; ((1U \u0026lt;\u0026lt; bits) - 1); // cut x if it holds more bits 7 rst = (x ^ mask) - mask; // excellent trick! 8 9 printf(\u0026#34;INPUT: 0x%x, RESULT: 0x%x\\n\u0026#34;, x, rst); Â å­—ç¬¦/å­—ç¬¦æ•°ç»„çš„å¤§å°å†™è½¬æ¢ 1#define TO_LOWER(c) (unsigned char)((c \u0026gt;= \u0026#39;A\u0026#39; \u0026amp;\u0026amp; c \u0026lt;= \u0026#39;Z\u0026#39;) ? (c | 0x20) : c) 2#define TO_UPPER(c) (unsigned char)((c \u0026gt;= \u0026#39;a\u0026#39; \u0026amp;\u0026amp; c \u0026lt;= \u0026#39;z\u0026#39;) ? (c \u0026amp; ~0x20) : c) 3 4#define TO_LOWER_STR(s, len) { \\ 5for (int i = 0; i \u0026lt; len \u0026amp;\u0026amp; s[i] != \u0026#39;\\0\u0026#39;; i++) { \\ 6s[i] = TO_LOWER(s[i]); \\ 7} \\ 8} 9 10#define TO_UPPER_STR(s, len) {\\ 11for (int i = 0; i \u0026lt; len \u0026amp;\u0026amp; s[i] != \u0026#39;\\0\u0026#39;; i++) { \\ 12s[i] = TO_UPPER(s[i]); \\ 13} \\ 14} ","date":"2022-07-03T09:44:13+08:00","permalink":"https://wangloo.github.io/posts/c/bitops/","section":"posts","tags":["c"],"title":"C è¯­è¨€ä½æ“ä½œæŠ€å·§"},{"categories":null,"contents":"Â å †çš„å«ä¹‰ æˆ‘ä»¬éƒ½çŸ¥é“mallocåŠ¨æ€ç”³è¯·çš„å˜é‡æ˜¯å­˜æ”¾åœ¨å †ä¸­. æ‰€ä»¥ç›¸æ¯”æ ˆæ¥è¯´, å †æ˜¯åŠ¨æ€çš„.\nå †å æ®è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„å¤§éƒ¨åˆ†, æˆ‘ä»¬å¯èƒ½é€šè¿‡å †æ¥ç”³è¯·1GBçš„æ•°ç»„, ä½†æ˜¯æ ˆé€šå¸¸ä¸è¡Œ , å¤§å¤šä¹Ÿå°±å‡ å…†çš„ç©ºé—´.\nÂ å †ç©ºé—´çš„ç®¡ç† è¿›ç¨‹ä¸­å †ç©ºé—´çš„ç®¡ç†æ˜¯è¿è¡Œåº“è´Ÿè´£çš„, åœ¨Linuxä¸­æ˜¯GLIBC.\nè¿è¡Œåº“åœ¨åˆå§‹åŒ–æ—¶ä¼šåƒæ“ä½œç³»ç»Ÿç”³è¯·ä¸€å¤§å—çš„å †ç©ºé—´, å†ä¸ºæ¯ä¸ªè¿›è¡Œåˆ†åˆ«åˆ†é…éœ€æ±‚. å½“ç„¶, å¦‚æœæŸäº›ç¨‹åºçš„éœ€æ±‚è¿‡å¤§, è¿è¡Œåº“ä¹Ÿå¯ä»¥ä½¿ç”¨mmapç³»ç»Ÿè°ƒç”¨ç›´æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·, ç„¶å è¿”å›ç»™ç”¨æˆ·è¿›ç¨‹.\n GLIBCçš„mallocå‡½æ•°çš„å¤„ç†æ–¹å¼æ˜¯: å¯¹äºå°äº128KBçš„ç”³è¯·, ä¼šä»è¿è¡Œåº“\u0026quot;æ‰¹å‘çš„\u0026quot;å †ç©ºé—´ é‡Œåˆ†å‡ºä¸€å—æ¥; ä½†è‹¥ç”³è¯·çš„ç©ºé—´è¿‡å¤§, åˆ™ä½¿ç”¨mmapç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºåŒ¿åç©ºé—´åˆ†é…ç»™ç”¨æˆ·.\n  Linuxä¸­è™šæ‹Ÿåœ°å€å—(VMA)çš„ç®¡ç†ä½¿ç”¨äº†çº¢é»‘æ ‘, å¯ä»¥ç”¨äºè¿è¡Œåº“ç®¡ç†è‡ªå·±å‘æ“ä½œç³»ç»Ÿ \u0026ldquo;æ‰¹å‘\u0026quot;çš„å †ç©ºé—´. ä½¿å¾—ç”¨æˆ·ç¨‹åºåŠ¨æ€ç”³è¯·å’Œé‡Šæ”¾å†…å­˜æ€§èƒ½æé«˜.\n ","date":"2022-06-28T16:41:54+08:00","permalink":"https://wangloo.github.io/posts/os/stack-and-heap/","section":"posts","tags":["Operating system","Virtual memory"],"title":"Stack and Heap"},{"categories":["Operating System"],"contents":"é™æ€é“¾æ¥å¸¦æ¥çš„é—®é¢˜   åƒæ˜¯libcè¿™ç§å‡ ä¹æ¯ä¸ªç¨‹åºéƒ½è¦ç”¨åˆ°çš„åº“, å¦‚æœæ˜¯é™æ€çš„, é‚£ä¹ˆä¸ä»…æ„å¤–ç€æ¯ä¸ªç¨‹åºçš„ å¯æ‰§è¡Œæ–‡ä»¶å¾ˆå¤§, æµªè´¹ç£ç›˜ç©ºé—´. å¹¶ä¸”å½“ç¨‹åºåŠ è½½åˆ°å†…å­˜æ—¶, å¯èƒ½è®¸å¤šç¨‹åºéƒ½ä¼šç”¨åˆ°printf , ä½¿å¾—å†…å­˜ä¸­ä¼šå­˜åœ¨å¥½å¤šä»½çš„printfæºç .\n  ç»´æŠ¤å’Œæ›´æ–°éš¾. ä¸€æ—¦é™æ€é“¾æ¥çš„å…¶ä¸­ä¸€ä¸ªç›®æ ‡æ–‡ä»¶æ›´æ–°, æ‰€æœ‰çš„å¯æ‰§è¡Œç¨‹åºéƒ½è¦é‡æ–°é“¾æ¥.\n  ä¸æ»¡è¶³å±€éƒ¨æ€§åŸç†. ä¸Šé¢æåˆ°, å†…å­˜ä¸­åŒæ—¶å­˜åœ¨å¤šä»½çš„printfæºç ä¼šç ´åå±€éƒ¨æ€§åŸç†çš„. æ˜¾ç„¶å¦‚æœæ‰€æœ‰çš„ç¨‹åºå…±äº«ä¸€ä»½printfæºç çš„æƒ³æ³•æ›´å¥½. å³åŠ¨æ€åŠ è½½.\n  å¯ç§»æ¤æ€§å·®. é™æ€é“¾æ¥, åªè¦æœ‰ä¸€ä¸ªä¾èµ–ç›®æ ‡æ–‡ä»¶çš„å®ç°ä¸åŒ, è½¯ä»¶å‚å•†å°±å¾—ä¸“é—¨å‘å¸ƒä¸€ä¸ª ç‰ˆæœ¬. è€ŒåŠ¨æ€é“¾æ¥åˆ™ä¿¡èµ–å®¢æˆ·ç”µè„‘ä¸Šçš„åŠ¨æ€åº“, ç›¸å½“äºä¸€ä¸ªä¸­é—´å±‚.\n  åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹ å¯¹æ¯”é™æ€é“¾æ¥ä½¿ç”¨ldé“¾æ¥å™¨åœ¨ç¼–è¯‘åå³æ‰§è¡Œé“¾æ¥, åŠ¨æ€é“¾æ¥åˆ™æ˜¯å°†é“¾æ¥è¿‡ç¨‹æ¨è¿Ÿåˆ°è¿è¡Œæ—¶, å³è£…è½½åˆ°å†…å­˜æ—¶.\nè¿™æ ·, é“¾æ¥å™¨åœ¨é“¾æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æ—¶å°±æœ‰ä¸¤ç§åšæ³•:\n å¯¹äºé™æ€ç¬¦å·, æŒ‰ç…§é™æ€é“¾æ¥çš„è§„åˆ™è¿›è¡Œåœ°å€å¼•ç”¨é‡å®šä½ å¯¹äºåŠ¨æ€ç¬¦å·, é“¾æ¥å™¨åˆ™ä»…æ ‡è®°å…¶ä¸ºåŠ¨æ€é“¾æ¥ä¸­çš„ç¬¦å·, ä¸è¿›è¡Œå¤„ç†. è€Œæ˜¯ç­‰åˆ°è£…è½½æ—¶ç”± ä¸“é—¨çš„åŠ¨æ€é“¾æ¥å™¨æ¥å®ŒæˆåŠ¨æ€ç¬¦å·çš„é“¾æ¥å·¥ä½œ.  â‰ï¸ é“¾æ¥å™¨å¦‚ä½•ç¡®å®šä¸€ä¸ªç¬¦å·æ˜¯é™æ€çš„ or åŠ¨æ€çš„?\nåœ¨åŠ¨æ€å…±äº«å¯¹è±¡(.so)ä¸­ä¿å­˜äº†å®Œæ•´çš„åŠ¨æ€ç¬¦å·è¡¨*, è¡¨ä¸­å­˜åœ¨çš„ç¬¦å·å³ä¸ºåŠ¨æ€çš„, å¦åˆ™ä¸ºé™æ€.\n Linux çš„ C è¯­è¨€è¿è¡Œåº“glibçš„åŠ¨æ€é“¾æ¥ç‰ˆæœ¬å«libc.so. å®ƒåœ¨å¤–å­˜ä¸Šåªä¿å­˜ä¸€ä»½, æ‰€æœ‰çš„ç¨‹åº éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒ. æ‰€ä»¥åƒä¸‡ä¸è¦åˆ æ‰å®ƒ.\n  åŠ¨æ€é“¾æ¥æœ‰ä¸€å®šçš„æ€§èƒ½æŸå¤±, å› ä¸ºæ¯æ¬¡è¿è¡Œç¨‹åºæ—¶éƒ½è¦é‡æ–°é“¾æ¥, å¹¶ä¸åƒé™æ€é“¾æ¥æ˜¯ä¸€åŠ³æ°¸é€¸çš„. ä¹Ÿæœ‰ä¾‹å¦‚å»¶è¿Ÿç»‘å®šå¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–çš„æ–¹æ³•, å¤§æ¦‚ä»…æœ‰ 5%çš„æŸè€—, ä¸å¸¦æ¥çš„ä¾¿åˆ©ç›¸æ¯”å¯ä»¥å¿½ç•¥ä¸è®¡.\n åœ°å€æ— å…³ä»£ç  PIC GCC ç”ŸæˆåŠ¨æ€åº“æ—¶éœ€è¦æ·»åŠ å‚æ•°-fPIC, å«ä¹‰å°±æ˜¯ç”Ÿæˆåœ°å€æ— å…³ç \nåœ°å€æ— å…³ç çš„å«ä¹‰æ˜¯ä»£ç ä¸­ä¸åŒ…å«ä»»ä½•çš„ç»å¯¹åœ°å€å¼•ç”¨, å…¨éƒ½æ˜¯ç›¸å¯¹åœ°å€.\n å¯¹äºæ¨¡å—å†…çš„è·³è½¬/æ•°æ®å¼•ç”¨, ä½¿ç”¨ç›¸å¯¹çš„è·³è½¬/åŠ è½½æŒ‡ä»¤. ä¾‹å¦‚ ARM æŒ‡ä»¤é›†ä¸­çš„B, ADR, ç»è¿‡æ±‡ç¼–å™¨ä¹‹å, ç›®æ ‡çš„åœ°å€éƒ½ä¼šè½¬ä¸ºç›¸å¯¹äºè¯¥æŒ‡ä»¤(PC)çš„åç§». å¯¹äºæ¨¡å—é—´çš„è·³è½¬/æ•°æ®å¼•ç”¨, å€Ÿç”¨GOT è¡¨æ¥é—´æ¥å®ç°åœ°å€æ— å…³.  è€Œå¦‚æœè¯¥åŠ¨æ€åº“ä¸­å…¨éƒ¨ä½¿ç”¨ç›¸å¯¹åœ°å€, é‚£ä¹ˆåŠ è½½æ—¶ä¹Ÿå°±ä¸éœ€è¦è¿›è¡Œé‡å®šä½, å³æ‰€æœ‰çš„ç¨‹åºéƒ½å¯ä»¥ å…±äº«è¿™äº›åœ°å€æ— å…³ä»£ç .\n ä¸Šé¢è¯´ PIC çš„åŠ¨æ€åº“ä¸éœ€è¦é‡å®šä½å…¶å®æ˜¯é”™è¯¯çš„, åªä¸è¿‡å®ƒçš„é‡å®šä½è¿‡ç¨‹ä¸éœ€è¦ä¿®æ”¹ä»£ç æ®µ, è€Œæ˜¯è®¾ç½®äº†ä¸€ä¸ªæ”¾ç½®åœ¨æ•°æ®æ®µçš„GOTè¡¨æ¥å®ç°ä»£ç æ®µéƒ¨åˆ†çš„åœ°å€æ— å…³ç‰¹æ€§.\n  ç°åœ¨è²Œä¼¼ GCC ARM ç‰ˆæœ¬åœ¨ç¼–è¯‘åŠ¨æ€åº“æ—¶å¼ºåˆ¶ä½¿ç”¨-fPIC é€‰é¡¹, å¦åˆ™ä¼šæŠ¥é”™. å¯¹æ­¤æˆ‘ä¸æ˜¯ éå¸¸ç¡®å®š!\n  ä¸€èˆ¬æ¥è¯´, ä¸å°†ä¸»ç¨‹åºç¼–è¯‘ä¸ºåœ°å€æ— å…³ç . å› ä¸ºä¸»ç¨‹åºä¸éœ€è¦å…±äº«, è€Œä¸”åœ°å€æ— å…³ç çš„è°ƒç”¨ éœ€è¦ä¸¤ä¸ªæŒ‡ä»¤: è®¡ç®—åœ°å€ + è·³è½¬. å¤šäº†ä¸€æ­¥æ ¹æ®åç§»å¾—åˆ°ç»å¯¹åœ°å€.\n åŠ¨æ€åŠ è½½ ä¸Šé¢è¯´çš„ï¼Œæœ‰äº†åŠ¨æ€é“¾æ¥ä¹‹åï¼Œåº“æ–‡ä»¶çš„é‡å®šä½åˆ°è¿è¡Œæ—¶ã€‚è¿è¡Œæ—¶ä¸€å®šæ˜¯åº“åŠ è½½åˆ°å†…å­˜æ—¶å€™å—ï¼Ÿ çœ‹ä½ æ€ä¹ˆç†è§£â€œè¿è¡Œæ—¶â€ï¼Œæ˜¯ä¸»ç¨‹åºè¿è¡Œçš„æ—¶åˆ»ï¼Œè¿˜æ˜¯åº“ä¸­çš„ä»£ç è¿è¡Œçš„æ—¶åˆ»ã€‚æ‰€ä»¥æˆ‘å¯ä»¥å›ç­”çš„æ˜¯ï¼š ä¸»ç¨‹åºè¿è¡Œæ—¶ï¼ŒåŠ¨æ€åº“ä¸ä¸€å®šç«‹é©¬åŠ è½½åˆ°å†…å­˜ï¼Œä¹Ÿå°±ä¸ä¸€å®šå‘ç”ŸåŠ¨æ€é“¾æ¥ã€‚\nåŠ¨æ€åŠ è½½è¿™ç§æ€æƒ³ç±»ä¼¼äº COWï¼Œå¯ä»¥æå‡ä¸»ç¨‹åºå¯åŠ¨çš„é€Ÿåº¦ï¼Œå¯åŠ¨æ¶ˆè€—çš„å†…å­˜æ›´å°ã€‚ ç¼ºç‚¹å°±æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨åº“çš„é€Ÿåº¦å˜æ…¢ï¼Œå› ä¸ºåŠ è½½ã€é‡å®šä½éƒ½éœ€è¦å‘ç”Ÿã€‚\næœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œä¸€èˆ¬çš„åŠ¨æ€é“¾æ¥è¿‡ç¨‹ï¼ˆä¸è€ƒè™‘åŠ¨æ€åŠ è½½ï¼‰å°±æ˜¯æ‰€æœ‰çš„åº“ä¸€è‚¡è„‘åŠ è½½åˆ°å†…å­˜ï¼Œ ç„¶åè¿›è¡Œé‡å®šä½å·¥ä½œã€‚é‡å®šä½å®Œæ‰€æœ‰ç¬¦å·åï¼Œä¼šå°†ä¸»ç¨‹åºçš„ GOT è¡¨è®¾ç½®ä¸ºåªè¯»ï¼Œé¿å… got è¡¨è¢«æ¶æ„ä¿®æ”¹ï¼Œ è¿™ä¸ªè¿‡ç¨‹æ˜¯åŠ¨æ€é“¾æ¥å™¨ld.soåšçš„ã€‚\n è¿™ä¸ªè¯´æ³•å¯ä»¥é€šè¿‡çœ‹ elf çš„ section å¸ƒå±€ç¡®å®šï¼Œgot è¡¨éƒ½ä¼šå’Œä¸€äº›å…¶ä»–çš„åªè¯» section æ”¾åœ¨ä¸€èµ·ï¼Œ è€Œä¸æ€»æ˜¯ RW çš„ section åˆ†å¼€ï¼Œè¿™æ ·å¸ƒå±€ä»¥åè®¾ç½® got åªè¯»çš„æ—¶å€™æ›´åŠ æ–¹ä¾¿ã€‚    è¿™é‡Œå›¾ä¸­çš„ got è™½ç„¶æ˜¯å¯å†™å…¥çš„ï¼Œåªæ˜¯ä¸ºäº†å¯ä»¥è¢«é‡å®šä½ä¿®æ”¹ï¼Œæ”¹å®Œä¹‹åç”± ld.so é‡æ˜ å°„ä¸ºåªè¯»ã€‚\n åŠ å…¥åŠ¨æ€åŠ è½½ä¹‹åï¼Œå…¶å® got è¡¨ä¸èƒ½åœ¨ä¸»ç¨‹åºåŠ è½½å®Œåå°±è®¾ä¸ºåªè¯»ï¼Œå› ä¸ºé“¾æ¥å»¶ååˆ°äº†åŠ¨æ€åº“åŠ è½½åˆ°å†…å­˜æ—¶ï¼Œ ç°åœ¨çš„åšæ³•æ—¶ï¼Œå°† got è¡¨è¿›è¡Œæ‹†åˆ†==\u0026gt; .got å’Œ.got.plt, .got.plt ä¿å­˜çš„æ˜¯ä»¥åè¿è¡Œä¸­éšæ—¶éœ€è¦é‡å®šä½çš„ç¬¦å·ï¼Œ å°±ä¸èƒ½è¢«è®¾ä¸ºåªè¯»ï¼Œè€Œä¸ºäº†å…¼å®¹ï¼Œ.got å°±ä¼šåœ¨ä¸»ç¨‹åºåŠ è½½åè¢«è®¾ä¸ºåªè¯»ï¼Œå› ä¸ºé‡Œé¢æ²¡æœ‰éœ€è¦æ‰§è¡Œæ—¶é‡å®šä½çš„ç¬¦å·äº†ã€‚\n ä¸»ç¨‹åºç¼–è¯‘æ—¶æ·»åŠ é€‰é¡¹ -Wl,-z,lazy å¯ç”¨åŠ¨æ€åŠ è½½\n      åŠ¨æ€é“¾æ¥å’ŒåŠ¨æ€åŠ è½½å…³ç³» åŠ¨æ€åŠ è½½å’ŒåŠ¨æ€é“¾æ¥å¹¶ä¸è¿›è¡Œç»‘å®š\n é™æ€é“¾æ¥-åŠ¨æ€åŠ è½½ï¼šå› ä¸ºæ˜¯é™æ€é“¾æ¥ï¼Œæ‰€ä»¥åº“çš„åœ°å€å·²ç»ç¡®å®šï¼Œä½†åŠ è½½æ—¶åªåˆ†é…è™šæ‹Ÿåœ°å€ç©ºé—´ åŠ¨æ€é“¾æ¥-åŠ¨æ€åŠ è½½ï¼šç”¨åˆ°åº“æ—¶æ‰åŠ è½½åˆ°å†…å­˜ï¼Œæ­¤æ—¶æ‰è¿›è¡ŒåŠ¨æ€é‡å®šä½ åŠ¨æ€é“¾æ¥-é™æ€åŠ è½½ï¼šè¿è¡Œä¸»ç¨‹åºæ—¶åº“åŒæ—¶è¢«åŠ è½½åˆ°å†…å­˜ï¼Œç„¶åç«‹é©¬æ‰§è¡ŒåŠ¨æ€é‡å®šä½  ","date":"2022-06-26T19:50:45+08:00","permalink":"https://wangloo.github.io/posts/os/dynamic-link/","section":"posts","tags":["Operating System"],"title":"æ“ä½œç³»ç»Ÿï¼šåŠ¨æ€é“¾æ¥/åŠ¨æ€åŠ è½½"},{"categories":["Operating System"],"contents":"ELFæ˜¯ä»€ä¹ˆ ELFï¼ˆExecutable Linkable Formatï¼‰å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸æ­¢æ˜¯å•æŒ‡â€œå¯ä»¥è¢«æ‰§è¡Œçš„æ–‡ä»¶â€ï¼Œ åŠ¨æ€é“¾æ¥åº“ã€é™æ€é“¾æ¥åº“éƒ½æŒ‰ç…§å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼æ¥å­˜å‚¨ã€‚\nELFæ ‡å‡†é‡ŒæŠŠé‡‡ç”¨ELFæ ¼å¼çš„æ–‡ä»¶åˆ†ä¸ºå››ç±»ï¼š\n   Type description å®ä¾‹     Relocatable File è¿™äº›æ–‡ä»¶åŒ…å«äº†ä»£ç å’Œdata, å¯ä»¥è¢«ç”¨æ¥é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«ç›®æ ‡æ–‡ä»¶. .o, .a   Executable File ç›´æ¥å¯æ‰§è¡Œçš„æ–‡ä»¶ /bin/ls   Shared Object File Including code and data. é“¾æ¥å™¨å¯å°†å…¶ä¸å…¶ä»–Relocatable Fileæˆ–Shared Object Fileç»“åˆ, ç”Ÿæˆæ–°çš„ç›®æ ‡æ–‡ä»¶. åŠ¨æ€é“¾æ¥å™¨å¯å°†å…¶ä¸Executable Fileç»“åˆ, ä½œä¸ºè¿›ç¨‹æ˜ åƒçš„ä¸€éƒ¨åˆ†æ¥è¿è¡Œ. .so   Core Dump File Restore critical infomation when process is terminated unexpectedly core dump     ğŸ“Œ file command in Linux can output the format of a file.\n å…³äºé™æ€åº“ ä¸€ä¸ªé™æ€åº“å¯ä»¥ç®€å•çš„çœ‹ä½œæ˜¯ a set of object file.\nè¿™äº› object file å¯èƒ½åŒ…æ‹¬: è¾“å…¥è¾“å‡ºç›¸å…³çš„printf.o, scanf.o, æ—¥æœŸæ—¶é—´ç›¸å…³çš„time.o, date.oç­‰.\nâ“ ä¸ºä»€ä¹ˆä¸ç›´æ¥æä¾›è¿™äº›ç›®æ ‡æ–‡ä»¶å‘¢?\nè¿™äº›é›¶æ•£çš„æ–‡ä»¶è‹¥ç›´æ¥æä¾›ç»™ä½¿ç”¨è€…, å¾ˆå¤§ç¨‹åº¦ä¸Šé€ æˆæ–‡ä»¶ä¼ è¾“, ç®¡ç†ç­‰æ–¹é¢çš„ä¸ä¾¿.\näºæ˜¯äººä»¬é€šå¸¸ä½¿ç”¨arå‹ç¼©ç¨‹åºå°†è¿™äº›ç›®æ ‡æ–‡ä»¶å‹ç¼©åˆ°ä¸€èµ·.\nâ“ å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªé™æ€åº“æ˜¯ç”±å“ªäº›object fileå‹ç¼©åˆ°ä¸€èµ·çš„?\nShell commandar -t libc.a å¯ä»¥æŸ¥çœ‹libc.aä¸­åŒ…å«çš„æ‰€æœ‰object files.\nELF æ–‡ä»¶ç»„æˆçš„ç»“æ„ çŸ¥é“äº†ELFæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œæ¥ä¸‹æ¥å°±çœ‹çœ‹å…¶å†…éƒ¨çš„ç»“æ„ã€‚\n1+---------------------------------+ 2| ELF Header | åŒ…å«æè¿°æ•´ä¸ªELFçš„åŸºæœ¬ä¿¡æ¯, å¦‚ç‰ˆæœ¬, å…¥å£åœ°å€... 3+---------------------------------+ 4| .text | 5+---------------------------------+ 6| .data | 7+---------------------------------+ ç´§æ¥ç€æ˜¯å„ä¸ªæ®µ 8| .bss | 9+---------------------------------+ 10| ... | 11| other sections | 12+---------------------------------+ 13| | ä¸sectionç›¸å…³æœ€é‡è¦çš„ç»“æ„ 14| Section Header table | æè¿°äº†æ¯ä¸ªsectionçš„åç§°,é•¿åº¦,æƒé™... 15| | 16+---------------------------------+ 17| | ä¸segmentç›¸å…³æœ€é‡è¦çš„ç»“æ„ 18| Program Header table | æè¿°äº†æ¯ä¸ªsegmentçš„ä½ç½®ã€å±æ€§(RWX)ã€size... 19| | 20+---------------------------------+ 21| String tables | 22| Symbol tables | 23+---------------------------------+ ELF Header    å­—æ®µ å«ä¹‰     e_machine ç›®æ ‡æ¶æ„   e_entry å…¥å£åœ°å€   e_machine ç›®æ ‡æ¶æ„   e_phnum number of entries in the program header table   e_shnum number of entries in the section header table   e_shoff offset, in bytes, of the section header table   e_phoff offset, in bytes, of the program header table   e_machine ç›®æ ‡æ¶æ„   e_machine ç›®æ ‡æ¶æ„    Program Header Table æ¯ä¸ªè¡¨é¡¹å¯¹åº”ä¸€ä¸ªsegmentï¼Œè¡¨æ˜å…¶ä½ç½®ã€å±æ€§(LOAD?åŠ¨æ€é“¾æ¥ç”¨?)ã€memory sizeå’Œfile sizeï¼Œæƒé™(RWX)ç­‰ã€‚\n Memory Size \u0026gt;= Segment Size, å› ä¸ºæœ‰BSSæ®µå­˜åœ¨ã€‚\n Section Header Table ç›¸åº”åœ°ï¼Œæ¯ä¸ªè¡¨é¡¹æŒ‡å®šä¸€ä¸ªsectionçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå­—ã€å¤§å°ã€åœ°å€ç­‰ã€‚\nåˆ†æELFæ–‡ä»¶çš„å‘½ä»¤ 1# è¾“å‡º section header table 2readelf -S xxx.elf 3# è¾“å‡º program header table 4readelf -l xxx.elf 5# è¾“å‡º ELF header 6readelf -h xxx.elf 7# è¾“å‡º elf headerï¼Œsection header tableï¼Œprogram header table(å¸¸ç”¨ï¼‰ 8readelf -e xxx.elf å¦‚ä½•ç”Ÿæˆä¸€ä¸ªELFå¯æ‰§è¡Œæ–‡ä»¶ ä»ä¸€ä¸ªCæ–‡ä»¶åˆ°ä¸€ä¸ªELFå¯æ‰§è¡Œæ–‡ä»¶åŒ…æ‹¬ç¼–è¯‘ã€é“¾æ¥ä¸¤ä¸ªæ­¥éª¤ï¼Œå…·ä½“æ¥è¯´ï¼Œå…±åŒ…å«4ä¸ªæ­¥éª¤ï¼š\n   é¢„ç¼–è¯‘ 1gcc â€“E hello.c â€“o hello.i é¢„ç¼–è¯‘è¿‡ç¨‹ä¸»è¦å¤„ç†é‚£äº›æºä»£ç æ–‡ä»¶ä¸­çš„ä»¥â€œ#â€å¼€å§‹çš„é¢„ç¼–è¯‘æŒ‡ä»¤ã€‚æ¯”å¦‚ â€œ#includeâ€ã€â€œ#define â€ç­‰\n å°†æ‰€æœ‰çš„ â€œ#define â€åˆ é™¤ï¼Œå¹¶ä¸”å±•å¼€æ‰€æœ‰çš„å®å®šä¹‰ã€‚ å¤„ ç† æ‰€ æœ‰ æ¡ ä»¶ é¢„ ç¼– è¯‘ æŒ‡ ä»¤ï¼Œ æ¯” å¦‚ â€œ#ifâ€ã€â€œ#ifdefâ€ã€â€œ#elifâ€ã€â€œ#elseâ€ã€â€œ#endif â€ã€‚ å¤„ç† â€œ#include â€é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ ç½®ã€‚æ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€’å½’è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«åŒ…å«çš„æ–‡ä»¶å¯èƒ½è¿˜åŒ…å«å…¶ ä»–æ–‡ä»¶ã€‚ åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Šâ€œ//â€å’Œâ€œ/* */â€ã€‚ æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†ï¼Œæ¯”å¦‚#2â€œhello.câ€2ï¼Œä»¥ä¾¿äºç¼–è¯‘æ—¶ç¼–è¯‘å™¨äº§ç”Ÿè°ƒ è¯•ç”¨çš„è¡Œå·ä¿¡æ¯åŠç”¨äºç¼–è¯‘æ—¶äº§ç”Ÿç¼–è¯‘é”™è¯¯æˆ–è­¦å‘Šæ—¶èƒ½å¤Ÿæ˜¾ç¤ºè¡Œå·ã€‚ ä¿ç•™æ‰€æœ‰çš„ #pragma ç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œå› ä¸ºç¼–è¯‘å™¨é¡»è¦ä½¿ç”¨å®ƒä»¬ã€‚  ç¼–è¯‘ 1gcc â€“S hello.i â€“o hello.s # or 2gcc â€“S hello.c â€“o hello.s ç¼–è¯‘è¿‡ç¨‹å°±æ˜¯æŠŠé¢„å¤„ç†å®Œçš„æ–‡ä»¶è¿›è¡Œä¸€ç³»åˆ—è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æåŠä¼˜åŒ–åç”Ÿäº§ç›¸åº”çš„æ±‡ç¼–ä»£ç æ–‡ä»¶\næ±‡ç¼– 1as hello.s â€“o hello.o # or 2gcc â€“c hello.c â€“o hello.o æ±‡ç¼–å™¨æ˜¯å°†æ±‡ç¼–ä»£ç è½¬å˜æˆæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ¯ä¸€ä¸ªæ±‡ç¼–è¯­å¥å‡ ä¹éƒ½ å¯¹åº”ä¸€æ¡æœºå™¨æŒ‡ä»¤ã€‚æ‰€ä»¥æ±‡ç¼–å™¨çš„æ±‡ç¼–è¿‡ç¨‹ç›¸å¯¹äºç¼–è¯‘å™¨æ¥è®²æ¯”è¾ƒç®€å•ï¼Œ å®ƒæ²¡æœ‰å¤æ‚çš„è¯­æ³•ï¼Œä¹Ÿæ²¡æœ‰è¯­ä¹‰ï¼Œä¹Ÿä¸éœ€è¦åšæŒ‡ä»¤ä¼˜åŒ–ï¼Œåªæ˜¯æ ¹æ®æ±‡ç¼–æŒ‡ ä»¤å’Œæœºå™¨æŒ‡ä»¤çš„å¯¹ç…§è¡¨ä¸€ä¸€ç¿»è¯‘å°±å¯ä»¥äº†\né“¾æ¥ ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½éœ€è¦ç”¨åˆ°è®¸å¤šä¸ªç›®æ ‡æ–‡ä»¶ï¼Œä¾‹å¦‚Cåº“ã€pthreadåº“ã€è‡ªå·±å†™çš„åº“ç­‰ã€‚ é“¾æ¥çš„è¿‡ç¨‹å°±æ˜¯æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nä»…ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¯¹äºå¤–éƒ¨çš„å‡½æ•°ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®å®šå®é™…è·³è½¬çš„åœ°å€ï¼Œ åªèƒ½å…ˆå†™0ï¼Œé“¾æ¥è¿‡ç¨‹ä¼šå¯¹è¿™ä¸ªå€¼è¿›è¡Œä¿®æ”¹ã€‚\nä¸»è¦åŒ…å«ä¸¤ä¸ªè¿‡ç¨‹ï¼šï¼ˆ1ï¼‰åœ°å€ç©ºé—´åˆ†é…ï¼ˆ2ï¼‰é‡å®šä½\n åœ°å€ç©ºé—´åˆ†é…ï¼šè¿™ä¹ˆå¤š.oï¼Œè¿™ä¹ˆå¤šsectionï¼Œä»–ä»¬ç»“åˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶ååœ°å€æ€ä¹ˆè§„åˆ’å‘¢ï¼Ÿæ˜¯ä¸æ˜¯æœ‰çš„ section å¯ä»¥åˆå¹¶ï¼Œæ¯”å¦‚å¤šä¸ªä»£ç æ®µã€‚ é‡å®šä½ï¼šå¯¹äºå¤–éƒ¨è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™äº›å®é™…çš„å€¼ä¹Ÿéœ€è¦æ›´æ­£ï¼Œæˆ–è€…é‡‡ç”¨åˆ«çš„æ–¹æ³•æ¥é—´æ¥å¯»å€ï¼ˆåŠ¨æ€é“¾æ¥ï¼‰  é™æ€é“¾æ¥ é‡å®šä½\nåˆå¹¶åçš„æ¯ä¸ªsectionéƒ½æœ‰ä¸€ä¸ªé‡å®šä½è¡¨.rel.xxï¼Œ é‡Œé¢çš„å†…å®¹å¤§æ¦‚æ˜¯:\n1RELOCATION RECORDS FOR [.text]: 2OFFSET TYPE VALUE 30000001c R_386_32 shared 400000027 R_386_PC32 swap å¯¹äºæ¯ä¸ªéœ€è¦é‡å®šä½çš„æŒ‡ä»¤ï¼Œéƒ½ä¼šåœ¨è¿™é‡Œè¡¨é‡Œå¯¹åº”åˆ°ï¼Œæ‰€ä»¥é“¾æ¥æ—¶éœ€è¦éå†å®ƒï¼Œå¡«å……ä¸ŠçœŸæ­£çš„åœ°å€ã€‚\nåŠ¨æ€é“¾æ¥ é™æ€é“¾æ¥çš„åšæ³•å°±å†³å®šäº†ï¼Œç¨‹åºAå’ŒBä¸èƒ½å…±äº«åŒä¸€ä»½åº“ï¼Œæµªè´¹å†…å­˜ã€‚åº“ç¼–è¿›äº†å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å°±å¾ˆå¤§ï¼Œ å¦å¤–è¿™æ ·å¦‚æœè¦ä¿®æ”¹åº“çš„è¯å°±éœ€è¦å¯¹æ‰€æœ‰ä¾èµ–çš„Aå’ŒBéƒ½é‡æ–°ç¼–è¯‘ã€‚\nåŠ¨æ€é“¾æ¥æ˜¯ç›®çš„æ˜¯è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåº“ä¸ç¼–åˆ°ELFé‡Œï¼ŒELFåœ¨è¿è¡Œçš„æ—¶å€™èƒ½æ‰¾åˆ°å®ƒå°±è¡Œã€‚ è¿™æ ·ä¸€ä¸ªç¨‹åºç¼–è¯‘é“¾æ¥åå…¶å®ä¸èƒ½ç¡®å®šåº“çš„åœ°å€, è€Œæ˜¯å°†è¿™ä¸ªè¿‡ç¨‹æ¨è¿Ÿåˆ°è¿è¡Œæ—¶çš„æŸä¸ªæ—¶é—´ã€‚\n è¯¦ç»†å¯è§åŠ¨æ€é“¾æ¥\n ELF åŠ è½½  åºŸäº†åŠå¤©åŠ²ç¼–è¯‘ç”Ÿæˆçš„ELFæ–‡ä»¶, æƒ³è¦æœ€ç»ˆè·‘èµ·æ¥åˆ™åŒ…å«çš„instruction and dataå¿…é¡»è¦åœ¨å†…å­˜ä¸­.\n æˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„åŠæ³•æ˜¯: æŠŠæ•´ä¸ªELFçš„æ‰€æœ‰æŒ‡ä»¤å’Œæ•°æ®åœ¨è¿è¡Œä¹‹å‰å°±å…¨éƒ¨loadåˆ°å†…å­˜ä¸­. è¿™å°±æ˜¯é™æ€åŠ è½½.\næ›´åŠ é«˜æ•ˆçš„åšæ³•æ˜¯: å……åˆ†åˆ©ç”¨å±€éƒ¨æ€§åŸç†, å°†æŒ‡ä»¤å’Œæ•°æ®åˆ’åˆ†ä¸ºæ¨¡å—, åªæœ‰å½“è¯¥æ¨¡å—è¢«ä½¿ç”¨æ—¶, æ‰loadè¿›å†…å­˜, å¦åˆ™å°±åœ¨å¤–å­˜ä¸­è€è€å®å®å‘†ç€. è¿™å°±æ˜¯åŠ¨æ€åŠ è½½.\né™æ€åŠ è½½  è¯»å–ELF header, æ ¡éªŒmagic numberå’Œæ¶æ„æ˜¯å¦æ­£ç¡® æ ¹æ®ELF headerä¸­æŒ‡å®šçš„ program header tableåœ°å€å»è¯» segments åŠ è½½segments ä¸­å±æ€§ä¸ºLOADçš„segment, å…ˆè¦åˆ†é…å¯¹åº”çš„è™šæ‹Ÿç©ºé—´, æ ¹æ®ELFçš„LMA åŠ è½½ç¨‹åºä¸ºELFåˆ†é…æ ˆç©ºé—´ï¼Œå¹¶å¡«å……argc, argvï¼Œenvç­‰ã€‚  å‚æ•°ã€ç¯å¢ƒå˜é‡æ€ä¹ˆå¡«å……éœ€è¦å‚è€ƒä½“ç³»ç»“æ„çš„ABIæ‰‹å†Œ\n  å°†PCè®¾ç½®ä¸ºELF headerä¸­entry point, è¿”å›åˆ°ç”¨æˆ·æ€å¼€å§‹æ‰§è¡Œ  åŠ¨æ€åŠ è½½  è¯¦ç»†å¯è§åŠ¨æ€åŠ è½½\n å…¶ä»–é—®é¢˜æ±‡æ€» ä¸ºä»€ä¹ˆè¦åŒºåˆ†sectionå’Œsegment segmentæ˜¯åŠ è½½å…³å¿ƒçš„, sectionæ˜¯é“¾æ¥è¿‡ç¨‹å…³å¿ƒçš„ã€‚\n segmentä¸­åŒ…å«äº†å¤šä¸ªsection, è¿™äº›sectionåœ°å€ç›¸è¿ã€å±æ€§ç±»ä¼¼, åŠ è½½å™¨åªæŒ‰ç…§segmentå»åŠ è½½ã€‚ è€Œé“¾æ¥æ—¶, é“¾æ¥å™¨ä¼šå¯¹æ¯ä¸ªsectionè¿›è¡Œé‡å®šä½, åŒæ—¶ä¹Ÿéœ€è¦ .rel* sectionæ¥å®Œæˆé‡å®šä½ã€‚ è°ƒè¯•ä¿¡æ¯ä¹Ÿæ˜¯æŒ‰ç…§sectionè¿›è¡Œå­˜å‚¨çš„ï¼Œè°ƒè¯•å™¨ä¾èµ–ä»–ä»¬å¾—åˆ°ç¬¦å·ä¿¡æ¯ã€‚  ä¸ºä»€ä¹ˆç›®æ ‡æ–‡ä»¶ä¸­ä»£ç å’Œæ•°æ®è¦åˆ†å¼€æ”¾? ä¸€æ–¹é¢, ç¨‹åºè¢«åŠ è½½è¿›å†…å­˜å, ä»£ç æ®µå’Œæ•°æ®æ®µåˆ†åˆ«è¢«æ˜ å°„åˆ°ä¸¤ä¸ªvirtual memory region. é€šè¿‡MMUçš„æ”¯æŒ, å¯ä»¥å°†ä»£ç æ®µçš„åŒºåŸŸè®¾ç½®ä¸ºåªè¯», é˜²æ­¢æ¶æ„ç¯¡æ”¹.\nå¦ä¸€æ–¹é¢, å½“ä¸‹CPU Cacheå¤šåˆ’åˆ†ä¸ºInstruction Cacheå’ŒData Cache, å†é…åˆäº’ç›¸ç‹¬ç«‹çš„ åœ°å€åŒºåŸŸèƒ½å¤Ÿæé«˜å±€éƒ¨æ€§åŸç†çš„æ•ˆæœ.\næœ€å, ä»£ç æ®µå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«(ä¾‹å¦‚éƒ½è°ƒç”¨åŒä¸€å¤–éƒ¨å‡½æ•°), èŠ‚çœå†…å­˜ç©ºé—´.\n é’ˆå¯¹åµŒå…¥å¼è®¾å¤‡, å¦‚æœå†…å­˜ç©ºé—´ä¸å¤Ÿå¤§, åªè¯»çš„ä»£ç æ®µå¯å­˜æ”¾åœ¨ROMä¸­\n æ®µåœ°å€å¯¹é½æŠ€æœ¯  ç”±å‰é¢åŠ¨æ€åŠ è½½çš„æ­¥éª¤å¯çŸ¥, ELFæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®è¢«æŒ‰pageåˆ’åˆ†. å¹¶åªæœ‰åœ¨ç”¨åˆ°æ—¶æ‰è¢«åŠ è½½åˆ°å†…å­˜, å¹¶å»ºç«‹è™šæ‹Ÿå†…å­˜-ç‰©ç†å†…å­˜çš„æ˜ å°„.\n å‡è®¾ä¸€ä¸ªELFæœ‰ä¸‰ä¸ªæ®µéœ€è¦è¢«LOAD, ELFæ®µè¡¨å¦‚ä¸‹:\n   Segment Length offset     SEG 0 127 B 34 B   SEG 1 9899 B 164 B   SEG 2 1988 B 0 B    â“ è¿™ä¸‰ä¸ªæ®µåœ¨ELFæ–‡ä»¶ä¸­çš„å¸ƒå±€å¦‚ä½•? æ ¹æ®å‰é¢ELFæ–‡ä»¶æ ¼å¼çš„ä»‹ç», è¿™ä¸‰ä¸ªæ®µå¿…ç„¶æ˜¯æŒ¨ç€çš„(ç®€å•è€ƒè™‘, ELFä¸­ä»…æœ‰è¿™ä¸‰ä¸ªæ®µ).\nâ“ è¿™ä¸‰ä¸ªæ®µåœ¨ç‰©ç†å†…å­˜ä¸­çš„å¸ƒå±€? å‘ç”Ÿpage faultä¹‹å, OSä¼šä¸ºé¡µé¢åˆ†é…åˆé€‚çš„ç‰©ç†é¡µé¢, å¦‚åˆ©ç”¨buddy systemç­‰.\nå¯ä»¥ä¿è¯æ®µå†…çš„è¿ç»­, ä¸èƒ½ä¿è¯æ®µä¸æ®µæ˜¯è¿ç»­çš„.\n æœªä½¿ç”¨æ®µå¯¹é½æŠ€æœ¯ä¹‹å‰, SEG0çš„é•¿åº¦ä¸è¶³ä¸€é¡µ, ä½†æ˜¯ä¹Ÿç»™å®ƒåˆ†é…ä¸€é¡µçš„ç©ºé—´. åŒç†ä¸ºSEG1åˆ†é…ä¸¤é¡µ, SEG2åˆ†é…ä¸€é¡µ. æ€»å…±å ç”¨ 1+2+1=5ä¸ªç‰©ç†é¡µ.\n â“ è¿™ä¸‰ä¸ªæ®µåœ¨ç”¨æˆ·virtual addrspaceä¸‹çš„å¸ƒå±€å¦‚ä½•? todo\nâ“ ä½•ä¸ºæ®µåœ°å€å¯¹é½æŠ€æœ¯? ä¸Šé¢è¯´äº†, åœ¨ä¸ºè¿™ä¸‰ä¸ªæ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶, è™½ç„¶ä»–ä»¬çš„çœŸå®å¤§å°è¿œå°äº5ä¸ªé¡µé¢, ä½†ç”±äºç®€å•é‡‡ç”¨: æ¯ä¸ªæ®µçš„å¼€å¤´å¿…é¡»æ˜¯page align, å¯¼è‡´å®é™…ä¸Šäº§ç”Ÿäº†å·¨å¤§çš„å†…éƒ¨ç¢ç‰‡.\næ®µåœ°å€å¯¹é½å®é™…ä¸Šå°±æ˜¯åœ¨ä¸ºELFæ–‡ä»¶ä¸­çš„æ®µåˆ†é…ç‰©ç†å†…å­˜æ—¶, ä¸è€ƒè™‘å…¶æ®µçš„ç‹¬ç«‹æ€§, å¼ºåˆ¶æŒ‰ç…§pageæ¥åˆ’åˆ†. åˆ’åˆ†çš„è¡Œä¸ºå¦‚ä¸‹å›¾æ‰€ç¤º. ç»“æœå°±æ˜¯ä»…éœ€å ç”¨3ä¸ªç‰©ç†é¡µé¢.\n1+---+---------------+ 2| P | SEG0 | 3| A +---------------+ 4| G | | 5| E | | 6+---+ | 7| P | SEG1 | 8| A | | 9| G | | 10| E | | 11+---+ | 12| P +---------------+ 13| A | | 14| G | SEG2 | 15| E | | 16+---+---------------+  ç›®å‰, gcc(æ›´å‡†ç¡®æ˜¯è¯´æ˜¯GUN ld)é»˜è®¤å¯ç”¨æ®µå¯¹é½æŠ€æœ¯. å„ä¸ªæ®µçš„è™šæ‹Ÿåœ°å€å¹¶ä¸æ˜¯page align.\n  ğŸ€ ç‰©ç†é¡µé¢åˆ°è™šæ‹Ÿé¡µé¢çš„æ˜ å°„é˜¶æ®µ, é‚£äº›åŒæ—¶åŒ…å«ä¸¤ä¸ªæ®µçš„é¡µé¢ä¼šè¢«æ˜ å°„ä¸¤æ¬¡, å³ä¸€ä¸ªç‰©ç†é¡µé¢å¯¹åº”ä¸¤ä¸ª è™šæ‹Ÿé¡µ.\nåŸå› æ˜¯: åœ¨ä¸€ä¸ªé¡µé¢çš„ä¸åŒæ®µå¯èƒ½æƒé™ä¸åŒ, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨åŒä¸€æ˜ å°„.\n ","date":"2022-06-20T16:21:27+08:00","permalink":"https://wangloo.github.io/posts/binary/elf-format/","section":"posts","tags":["Operating System"],"title":"ELF æ–‡ä»¶çš„é“¾æ¥ä¸åŠ è½½"},{"categories":["C Language"],"contents":"æ·»åŠ æ›´å¤šçš„ç¼–è¯‘é€‰é¡¹(comiler options)æ¥é˜²æ­¢bug å¯¹äºæˆ‘å¸¸ç”¨çš„GCC, æ¨èå¼€å¯ä¸€ä¸‹çš„compiler options:\n  -Wall: enable a lot of common warnings\n  -Wno-format-truncation: warns about the snprintf output buffer not being large enough for a corresponding â€œ%sâ€ in the format string.\n  -Werror: turn warnings into errors.\n  Â åŠ¨æ€ç”³è¯·çš„ç©ºé—´åˆ°åº•è¦ä¸è¦é‡Šæ”¾ When using a barebones embedded OS, you absolutely need to tightly manage your memory.\nä½†æ˜¯, å¦‚æœä½ æ˜¯å†™åº”ç”¨ä¸šåŠ¡çš„ä»£ç , ç‰¹åˆ«æ˜¯åœ¨å†…å­˜è¶³å¤Ÿçš„åœºæ™¯ä¸‹. æœ€å¥½ä¸è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜, å› ä¸ºå½“çº¿ç¨‹/è¿›ç¨‹é€€å‡ºæ—¶, æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡Šæ”¾. æŸäº›æƒ…å†µä¸‹, é‡Šæ”¾å†…å­˜çš„æ“ä½œä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå¢åŠ é€»è¾‘çš„å¤æ‚åº¦.\n å¦‚æœä½ æ˜¯ä¸€ä¸ªå†…æ ¸ç¨‹åºå‘˜, åˆ™å¿…é¡»æ‰‹åŠ¨çš„é‡Šæ”¾. ä¸ç”¨æ€€ç–‘.\n Â å°½å¯èƒ½åœ¨åˆ›å»ºå˜é‡æ—¶èµ‹åˆå€¼ æ”¾ç½®æŸäº›å˜é‡åˆ›å»ºåæ˜¯ magic value. è€Œä½¿ç”¨è¿™äº›å˜é‡å¯èƒ½ä¸ä¼šç«‹é©¬å¯¼è‡´é”™è¯¯, ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªéšæ‚£.\nä½†è¿™ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜, æœ‰æ—¶æˆ‘ä»¬å®šä¹‰å˜é‡ä¹‹åçš„ä¸ä¹…ä¹‹åå°±ä¼šå¯¹å…¶èµ‹äºˆæ­£ç¡®çš„å€¼, è¿™æ—¶å€™åˆå€¼å°±æ˜¯ å¤šä½™çš„. è€Œä¸”ç»´æŠ¤è€…å¯èƒ½è®¤ä¸ºè¿™ä¸ªå€¼æ˜¯meaningful, è¿™å°±è¦æ±‚æˆ‘ä»¬å¦‚æœè¦èµ‹åˆå€¼, å°±è¦è¯´æ˜è¿™ä¸ªå€¼ ä»…ä»…æ˜¯æ— æ„ä¹‰çš„åˆå€¼.\nÂ ä½¿ç”¨#define, enum å¯¹äºä»£ç åœ¨ä¸åŒåœ°æ–¹ä½¿ç”¨çš„åŒä¸€ä¸ªå€¼, åº”ä½¿ç”¨#defineæ¥å£°æ˜ä½¿å¾—ä»£ç maintainable.\nå¦‚æœè¿™äº›å€¼æœ‰å¤šä¸ªä¸”èƒ½è§„åˆ’ä¸ºåŒä¸€ç±»åˆ«, åˆ™è¿˜å¯å°†#defineçš„æ–¹å¼æ¢ä¸ºenum. è¿™ä¼šä½¿ä»£ç æ›´åŠ meaningful\n ä½¿ç”¨enumä½¿è¿˜è¦æ³¨æ„å…¶æ‰€å å†…å­˜ç©ºé—´åœ¨ä¸åŒæ¶æ„ä¸­å¯èƒ½ä¸åŒçš„é—®é¢˜, see enumçš„ä¼˜åŠ¿å’Œæ¼æ´\n Â ä½¿ç”¨typedefä¼˜åŒ–function pointer Â é‡å®šä¹‰ä¸€å¥—è‡ªå·±çš„ç±»å‹ åœ¨å¼€å‘å¤§é¡¹ç›®æ—¶, éœ€è¦è€ƒè™‘å¯ç§»æ¤æ€§çš„æƒ…å†µä¸‹, æœ€å¥½åˆ©ç”¨typedefå¯¹ç±»å‹è¿›è¡Œé‡å®šä¹‰.\n1#if SYSTEM1 2 typedef int INT32; 3 ... 4#else 5 typedef long INT32; 6 ... 7#endif å¦‚ä¸Š, å¯¹äºæŸäº›æ¶æ„intç±»å‹å¯èƒ½ä¸æ˜¯32bit, æ­¤æ—¶å°±è¦ä½¿ç”¨long. è¿™ç§å®šä¹‰çš„æ–¹å¼ä¼šä¿è¯æˆ‘ä»¬çš„ç³»ç»Ÿ åœ¨ä»»ä½•æ¶æ„ä¸­éƒ½ä¸ä¼šå‡ºç°ç±»å‹çš„bug. è€Œä¸”ä¹Ÿå¢åŠ äº†ä»£ç çš„readability.\nÂ å–„ç”¨~0 åœ¨åšåµŒå…¥å¼ç¼–ç¨‹æ—¶, æœ‰æ—¶åœ¨è®¾ç½®æ©ç (mask)æˆ–è€…å…¶ä»–æƒ…å†µä¼šè¦ç”¨åˆ°å…¨1çš„å˜é‡å€¼, ä½ æ˜¯å¦ç»å¸¸è¿™æ ·å£°æ˜?\n1int mask = 0xffff; æš‚ä¸”ä¸è°ˆintç±»å‹åˆ°åº•å å¤šå°‘å­—èŠ‚çš„é—®é¢˜. å°±åƒä¸Šé¢ä¸€æ ·, æˆ‘ä»¬ç¨‹åºå‘˜ç»å¸¸å¿˜è®°æŸä¸ªç±»å‹çš„å¤§å°, è€Œå°‘æ·»åŠ äº†f. ä¼šå¯¼è‡´å˜é‡maskçš„å€¼ä¸æ˜¯å…¨1(32ä½æƒ…å†µä¸‹).\nè¿™æ˜¯è¦å˜æ¢ä¸€ä¸‹æ€ç»´, ä½¿ç”¨~0çš„å®šä¹‰æ–¹æ³•å°±å¯è½»æ¾åŒ–è§£, æ— éœ€ç®¡å˜é‡çš„ç±»å‹æ˜¯ä»€ä¹ˆ.\n1int mask = ~0; Â åˆç†çš„ä½¿ç”¨gotoè¯­å¥ åœ¨å¤§å­¦è¯¾å ‚ä¸­, æˆ‘ä»¬è€å¸ˆè¯´è¿‡ç¦æ­¢ä½¿ç”¨gotoè¯­å¥, ä½†å´æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„åŸå› .\nå®é™…ä¸Š, åˆç†çš„ä½¿ç”¨gotoèƒ½å¤Ÿæå¤§çš„å‡å°‘ç¨‹åºçš„å†—ä½™åº¦.\ngotoè¯­å¥å¸¸ç”¨äºç¨‹åºå‡ºç°é”™è¯¯è¦é€€å‡ºæ—¶, å¯èƒ½æœ‰å¤šä¸ªæƒ…å†µä¼šä½¿ç”¨é‡å¤çš„ä»£ç å¤„ç†, ä¾‹å¦‚é‡Šæ”¾ä¸€äº›allocated memory. ç›¸è¾ƒäºä½¿ç”¨flag, ä½¿ç”¨gotoæ˜¾ç„¶æ›´åŠ clearly and readability.\næ‰€ä»¥, åœ¨é¢å¯¹é‡å¤çš„é”™è¯¯å¤„ç†ä»£ç æ—¶, æƒ³æƒ³èƒ½ä¸èƒ½ç”¨gotoè¿›è¡Œä¼˜åŒ–. å½“ç„¶, é¿å…è¿‡æ—©ä¼˜åŒ–.\n æ³¨æ„, gotoå‡ºç°çš„åœºæ™¯å…¶å®å¾ˆå—é™. Never use a backward goto or jump into control statements.\n Â å®šä¹‰åˆç†, æ­£ç¡®çš„ç»“æ„ä½“ ç»“æ„ä½“æ˜¯Cè¯­è¨€ç¼–ç¨‹åº”ç”¨ä¸­å¸¸ç”¨çš„æ•°æ®ç»“æ„, å…³äºç»“æ„ä½“ä¹Ÿæœ‰è®¸å¤šè¦æ³¨æ„çš„ç‚¹.\n#1 Flexible Array Member C99å¼€å§‹æ”¯æŒFlexible Array Member. ä¸”çœ‹æˆ‘lstringåº“çš„ç»“æ„ä½“å®šä¹‰:\n1struct str { 2 int length; 3 int size; 4 char data[]; // Flexible array member - C99 only 5}; å¯¹äºè¿™ç§ä¸å®šé•¿çš„æ•°ç»„å…ƒç´ , æˆ‘ä¹‹å‰éƒ½æ˜¯å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ, å ç”¨ä¸€ä¸ªsizeof(char *)çš„ç©ºé—´. è€ŒFlexible Array Memberæœ¬èº«ä¸å ç”¨ç©ºé—´. éœ€è¦åœ¨mallocæ—¶ä¸ºä»–å•ç‹¬å£°æ˜ç©ºé—´.\n1int n = 100 2struct str *s = malloc(sizeof(struct str) + sizeof(char[n]));  è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå°trick, ä½¿ç”¨sizeof(char[n]) æ¯” sizeof(char) * n æ›´ç®€æ´!\n # 2 Padding and Packed æœ‰å…³ç»“æ„ä½“çš„å¤§å°, å’Œåœ°å€å¯¹é½çš„é—®é¢˜. å‡è®¾æˆ‘æœ‰ä¸€ä¸ªç»“æ„ä½“å¦‚ä¸‹:\n1struct mystruct_A 2{ 3 char a; int b; char c; 4} x; Paddingæ˜¯ç¼–è¯‘å™¨å¯¹ç»“æ„ä½“é»˜è®¤åšçš„äº‹æƒ…. å®ƒä¼šåœ¨æˆå‘˜ä¹‹é—´æ’å…¥ä¸€äº› gap æ¥ä¿è¯åœ°å€å¯¹é½:\n1struct mystruct_A { 2 char a; 3 char gap_0[3]; /* inserted by compiler: for alignment of b */ 4 int b; /* int åœ¨32ä½ä¸Šå…¶åœ°å€æ˜¯4å­—èŠ‚å¯¹é½çš„ */ 5 char c; 6 char gap_1[3]; /* -\u0026#34;-: for alignment of the whole struct in an array */ 7} x;  é™¤äº†ä¿è¯æ¯ä¸ªæˆå‘˜çš„åœ°å€æ˜¯å¯¹é½çš„, æ•´ä¸ªç»“æ„ä½“çš„åœ°å€ä¹Ÿæ˜¯æŒ‰ç…§å…¶æœ€å¤§çš„æˆå‘˜ç±»å‹æ¥å¯¹é½, å³å¯¹é½åˆ°int(4å­—èŠ‚).\n å¦‚æœä½ ä¸æƒ³è¦è¿™äº› gap, é‚£ä¹ˆå¯ä»¥å¯¹ç»“æ„ä½“å£°æ˜ä½¿ç”¨ __attribute__((__packed__))å…³é”®å­—. æ•´ä¸ªç»“æ„ä½“å¤§å°ä»…ä¸º6ä¸ªå­—èŠ‚.\n1struct __attribute__((__packed__)) mystruct_A { 2 char a; 3 int b; 4 char c; 5}; Â æ°¸è¿œä¸ºä½ çš„å‡½æ•°è®¾ç½®error return value ä¸€æ—¦ä½ çš„å‡½æ•°å¯èƒ½è¢«å…¶ä»–äººè°ƒç”¨, é‚£ä¹ˆå…»æˆè®¾ç½®return valueçš„ä¹ æƒ¯. å³ä¾¿ä½ ç°åœ¨çš„å®ç° å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•é”™è¯¯, ä¹Ÿè¯·è¿”å›success.\nè¿™æ ·åšçš„åŸå› æ˜¯, callerå¯ä»¥æ ¹æ®ä½ çš„å®šä¹‰åšé”™è¯¯åˆ¤æ–­, å³ä¾¿ä»¥åä½ çš„å®ç°åŠ ä¸Šäº†å‡ºé”™æƒ…å†µ, ä¸Šå±‚çš„ä»£ç ä¹Ÿä¸éœ€è¦ä¿®æ”¹.\nÂ å˜é‡ç±»å‹çš„é€‰æ‹©  åå­—, ç‰¹å®šä¸å˜çš„å­—ç¬¦ä¸²ä½¿ç”¨const char *, ç”šè‡³const char const* é•¿åº¦ä½¿ç”¨size_t è¡¨ç¤ºç±»å‹çš„å‚æ•°å°½å¯èƒ½ä½¿ç”¨enum å¾ªç¯å˜é‡iä½¿ç”¨signed, é¿å…æº¢å‡ºåå‡ºé”™  Â Reference How I Improve My (C) Code Quality\nTen Fallacies of Good C Code\n","date":"2022-06-14T17:59:22+08:00","permalink":"https://wangloo.github.io/posts/c/improve_quality/","section":"posts","tags":["c"],"title":"å†™é«˜è´¨é‡çš„Cè¯­è¨€å·¥ç¨‹çš„è§„èŒƒ"},{"categories":["Operating System"],"contents":"seL4 Capabilities In seL4, capabilities are stored in C-space. C-space is a hierarchical data structure very similar to page table.\n page table is a mapping from virtual address to physical address. C-space is a mapping from object ID to capability. Kernel object is made up of several C-nodes, just like a page table made up of individual page tables. Each C-nodes is an array of cap slots, which contain capability.  Inaccessible to userland, you can never hold an actual capability\n You can only hold a reference to capability, which pointers into C-space(slot addresses) These C-space addresses are called CPTRs   You don\u0026rsquo;t need to do the transform, because this is typically extracted in some libs.\n Capabilities convey specific privilege (acces rights)\n Read, Write, Execute, GrantReply(call), Grant(cap transfer)  Main operations on capabilities:\n Invokeperform operation on object referred to by cap.  For example, map some frame into memory. You need to have capabilities to both the frame and address space.   Copy|Mint|Grant: create copy of cap with same/lesser privilege. Move|Mutate: transfer to different address with same/lesser privilege.  Between C-space or within C-space.   Delete: invalidate slot(cleans up object if this is the only cap to it) Revoke: delete any derived(eg. copied or minted) caps  Capability Derivation MINT OPERATION The Mint operation creates a new, less powerful cap\n Can add badge Can strip access rights, eg RW-\u0026gt;RO  1mint(dest, src, rights, badge)  The first two arguement are capability pointers(CPTR) to a C-space(represented by C-node), which are references inside C-node. The destination C-node cap must allow modification Then you have the rights and the batch of the new cap.  ğŸ“Œ This is an alternative of sending addressed capabilities by IPC operation. That is what operating system do to set up protection domains for user level process.\nCOPY OPERATION  Copy as a version of Mint.\n Â seL4 Kernel Objects In file libsel4\\include\\sel4\\objecttype.h\n1typedef enum api_object { 2 seL4_UntypedObject, 3 seL4_TCBObject, 4 seL4_EndpointObject, 5 seL4_NotificationObject, 6 seL4_CapTableObject, 7#ifdef CONFIG_KERNEL_MCS 8 seL4_SchedContextObject, 9 seL4_ReplyObject, 10#endif 11 seL4_NonArchObjectTypeCount, 12} seL4_ObjectType; Â seL4 System Calls seL4 has 11 syscalls:\nYield(): invokes scheduler\n does NOT require a capability!  Send(),Recv() and variants/combinations thereof: IPC operations\n Call(),ReplyRecv(): usually invokes by client/server Send(), NBSend(): send-only and non-blocking version of it. Recv(), NBRecv(), NBSendRecv() Wait(), NBWait(), NBSendWait()   We just use Call() normally, the others are only for bootstrapping protocols and exception handling.\n Call() is atomic Send() + reply-object setup + Wait()\n cannot be simulated with one-way operations!  ReplyRecv() is NBSend() + Recv()\nDifferent object support different operations ENDPOINTS Endpoints support all 10 IPC variants.\nNOTIFICATIONS Notifications support:\n NBSend() - aliased as Signal() Wait() NBWait() - aliased as Poll()  OTHER OBJECTS Other objects only supports Call() operation.\n Appear as (kernel-implemented) servers. If you invoking a method on an object, this is done by treating the object as a kernel-implemented server. And you invoke it with a call() operation just as you do a normal server invocation. Each of these kernel objects has a different kernel-defined protocol  operations encoded in message tag parameters passed in message words   Mostly hidden behind syscall wrappers, user do not need to know this details.  Â seL4 IPC  IPC in seL4 is a way to realize cross-domain invocation.\n seL4 IPC is not a mechanism for shipping data. Transfering data is axillary but not the primary purpose.\nseL4 IPC is a protected procedure call, a user-controlled context switch(from clients context into server context).\nÂ seL4 Threads Creating a thread  Obtain a TCB object Set attributes: V-space, C-space, fault endpoint, IPC buffer Set Scheduling parameters:  priority, scheduling context, timeout endpoint(maybe MCP)   Set architecture-related registers  Threads and Stacks Stacks are completely user-managed, kernel doesn\u0026rsquo;t care!\n Kernel only preserves SP.. on context switch\n Stack location, allocation, size must be managed by userland.\nKernel beware of stack overflow\n","date":"2022-06-04T11:52:51+08:00","permalink":"https://wangloo.github.io/posts/os/sel4/","section":"posts","tags":null,"title":"æ“ä½œç³»ç»Ÿï¼šSeL4 åŸºç¡€æ¦‚å¿µ"},{"categories":["Hugo"],"contents":"æœ¬ç« å°†è§£ç­”Hugoæ˜¯ä»€ä¹ˆ, ä»¥åŠHugoæ˜¯å¦‚ä½•å·¥ä½œçš„. åªæœ‰äº†è§£Hugoçš„å·¥ä½œæœºåˆ¶ä¹‹å, æ‰èƒ½å‘æŒ¥æƒ³è±¡åŠ›è¿›è¡ŒDIY.\næœ¬ç« å†…å®¹å¤§å¤šæ¥è‡ªå®˜æ–¹æ‰‹å†Œæˆ–è€…æœç´¢å¼•æ“æä¾›çš„ç»“æœ.\nHugo é¡¹ç›®ç»“æ„ ä¸€ä¸ªhugo é¡¹ç›®é€šå¸¸åŒ…å«ä»¥ä¸‹å†…å®¹:\n1. 2â”œâ”€â”€ archetypes 3â”œâ”€â”€ config.toml 4â”œâ”€â”€ content 5â”œâ”€â”€ data 6â”œâ”€â”€ layouts 7â”œâ”€â”€ public 8â”œâ”€â”€ static 9â””â”€â”€ themes è¿™é‡Œé¢æœ‰äº›æ˜¯å¿…é¡»çš„, æœ‰äº›æ˜¯å¯é€‰çš„.\narchetypes\nå®šä¹‰æ–°åˆ›å»ºpostæ—¶, headerçš„æ ¼å¼.\nasserts\n Note: assets directory is not created by default.\n config\nHugo uses the config.toml, config.yaml, or config.json (if found in the site root) as the default site config file.\nThe user can choose to override that default with one or more site config files using the command-line --config switch.\n1hugo --config debugconfig.toml 2hugo --config a.toml,b.toml,c.toml  Note: config directory is not created by default.\n content\næ˜¾ç„¶, å­˜å‚¨æ‰€æœ‰çš„post.\ndata\nThis directory is used to store configuration files that can be used by Hugo when generating your website.\nåƒæ˜¯ä½  website çš„ä¸€ä¸ªmini æ•°æ®åº“, ä½ å¯ä»¥æ”¾ç½® toml, yaml, jsonæ ¼å¼çš„æ–‡ä»¶.\nlayouts\nStores templates in the form of .html files that specify how views of your content will be rendered into a static website. Templates include list pages, your homepage, taxonomy templates, partials, single page templates, and more.\npublic\nä¿å­˜buildç”Ÿæˆçš„ç«™ç‚¹. å½“è¿è¡Œhugo [flag]æ—¶ç”Ÿæˆ.\næ‹·è´è¯¥ç›®å½•ä¸‹çš„å†…å®¹, å¯ä»¥éƒ¨ç½²åˆ°web æœåŠ¡å™¨ä¸Šäº†.\nstatic\nStores all the static content: images, CSS, JavaScript, etc. å½“Hugoæ„å»ºæ‚¨çš„ç«™ç‚¹æ—¶ï¼Œé™æ€ç›®å½•ä¸­çš„æ‰€æœ‰èµ„æºéƒ½ä¼šæŒ‰åŸæ ·å¤åˆ¶ã€‚\nå³å½“æ„å»ºwebsiteæ—¶, static/ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå¤åˆ¶åˆ° public/ä¸‹.\nThe static files are served on the site root path (eg. if you have the file static/image.png you can access it using http://{server-url}/image.png, to include it in a document you can use ![Example image](/image.png) ).\nresources\nä¸€äº›ç¼“å­˜æ–‡ä»¶\n Note: resources directory is not created by default.\n Hugo CLI å‘½ä»¤ hugo æ”¯æŒçš„æ‰€æœ‰å‘½ä»¤å¯ä»¥é€šè¿‡ hugo help å‘½ä»¤æ¥æŸ¥çœ‹. æ¯ä¸€æ¡å‘½ä»¤çš„å…·ä½“ç”¨æ³•, å¯ä»¥æ‰§è¡Œ hugo [command] help æ¥æŸ¥çœ‹\n1Usage: 2 hugo [flags] 3 hugo [command] hugo completion ç”¨æ¥é…ç½®è¡¥å…¨ hugo command å’Œ flag çš„. è¯¥å‘½ä»¤ä¼šè¾“å‡ºä¸€æ®µè„šæœ¬, å°†è¯¥è„šæœ¬å¤åˆ¶åˆ°ä½ çš„ shell çš„é…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨ hugo tab è¡¥å…¨äº†.\nhugo config æ‰“å°hugoçš„é…ç½®æ–‡ä»¶, å³æ ¹ç›®å½•ä¸‹çš„ config.toml.\nhugo env æ‰“å° hugo çš„ç‰ˆæœ¬å’Œç¯å¢ƒä¿¡æ¯\nhugo list æ‰“å°æ‰€æœ‰postçš„info, åŒ…å«æ ‡é¢˜, å‘å¸ƒæ—¥å¿—, é“¾æ¥ç­‰.\nhugo new éå¸¸é‡è¦çš„å‘½ä»¤, å¯ä»¥ç”¨æ¥æ–°å»ºä¸€ä¸ª website, ä¸»é¢˜, æˆ–è€…ä¸€ç¯‡post(å¸¸ç”¨). å¸¦æœ‰è®¸å¤š flagå¯ä»¥ä½¿ç”¨.\nhugo server æ‰§è¡Œhugo serverä¹‹å, é¦–å…ˆæ„å»ºäº†ä½ çš„ç½‘ç«™(ä½†æ˜¯é»˜è®¤å¹¶ä¸åœ¨æœ¬åœ°åˆ›å»ºæ–‡ä»¶, è€Œæ˜¯æ”¾åœ¨å†…å­˜), ç„¶åå¯åŠ¨hugo è‡ªå¸¦çš„ webæœåŠ¡å™¨è®©æˆ‘ä»¬èƒ½çœ‹è§ç½‘ç«™çš„æ•ˆæœ.\nåŒæ—¶, é»˜è®¤æƒ…å†µä¸‹, server ä¼šåŒæ­¥ä½ çš„æœ¬åœ°æ›´æ”¹, ç„¶åå®æ—¶çš„reloadä½ çš„é¡µé¢. è¿™æ ·ä½ å°±èƒ½åŒæ—¶çœ‹åˆ°ä¿®æ”¹çš„æ•ˆæœ.\nhugo server çš„å¸¸ç”¨flag:\n1-D åŒ…å«æ ‡è®°ä¸ºè‰ç¨¿çš„post. é»˜è®¤ä¸æ„å»ºè‰ç¨¿. 2--theme strings ä½¿ç”¨[strings]ä¸»é¢˜è¿›è¡Œæ„å»º hugo [flags] hugo è‡ªèº«å°±æ˜¯ä¸€ä¸ªå‘½ä»¤, ç”¨äºbuild website, æ”¾åˆ° public/ç›®å½•ä¸‹.\nå¸¸ç”¨ Flag(All supported flags):\n1--gc åœ¨buildåä¼šæ¸…é™¤ä¸€äº›cacheæ–‡ä»¶. ä¸ resource/æœ‰å…³ 2--minify minify any supported output format (HTML, XML etc.)  hugo å‘½ä»¤ä¸ä¼šåˆ é™¤ä¹‹å‰çš„æ–‡ä»¶. è€Œæ˜¯ä»…æ–°å¢æ”¹åŠ¨. æ‰€ä»¥æ¯æ¬¡buildæ—¶éœ€è¦ä½ æ‰‹åŠ¨åˆ é™¤ public/ ç›®å½•.\n Hugo å†…å®¹ç®¡ç† hugo build åçš„websiteé¡µé¢çš„å¸ƒå±€å’Œä½ æºæ–‡ä»¶çš„å¸ƒå±€ç›¸åŒ, æ‰€æœ‰æºæ–‡ä»¶éƒ½æ”¾ç½®åœ¨ content/ ç›®å½•ä¸‹.\n1â””â”€â”€ content 2 â”œâ”€â”€ _index.md // \u0026lt;- https://example.com 3 | 4 â”œâ”€â”€ about 5 | â””â”€â”€ index.md // \u0026lt;- https://example.com/about/ 6 â”œâ”€â”€ posts 7 | â”œâ”€â”€ _index.md // https://example.com/posts/ 8 | â”œâ”€â”€ firstpost.md // \u0026lt;- https://example.com/posts/firstpost/ 9 | â”œâ”€â”€ happy 10 | | â””â”€â”€ ness.md // \u0026lt;- https://example.com/posts/happy/ness/ 11 | â””â”€â”€ secondpost.md // \u0026lt;- https://example.com/posts/secondpost/ 12 â””â”€â”€ quote 13 â”œâ”€â”€ first.md // \u0026lt;- https://example.com/quote/first/ 14 â””â”€â”€ second.md // \u0026lt;- https://example.com/quote/second/  hugo å°†content/ ä¸‹çš„é‚£çº§ç›®å½•(ä¾‹å¦‚ content/posts)ç‰¹æ®Šçœ‹å¾…, ç§°ä¸º section.\n é¡µé¢èµ„æº(Page Resources) é¡µé¢èµ„æºæŒ‡æ¯ä¸ªé¡µé¢ç§æœ‰çš„å›¾ç‰‡, æ–‡æ¡£ç­‰é™æ€èµ„æº. ä¸static/ ä¸­å…¨å±€çš„èµ„æºä¸åŒ.\né¡µé¢èµ„æºæ”¾åœ¨content/ä¸‹çš„ä»»æ„ä½ç½®, ä½†ä¸æ˜¯æ‰€æœ‰é¡µé¢éƒ½èƒ½è®¿é—®. page bundles ä¸­çš„index.md or _index.md èƒ½å¤Ÿè®¿é—®è¯¥ bundles ä¸‹çš„èµ„æº.\n1content 2â””â”€â”€ post 3 â”œâ”€â”€ first-post 4 â”‚ â”œâ”€â”€ images 5 â”‚ â”‚ â”œâ”€â”€ a.jpg 6 â”‚ â”‚ â”œâ”€â”€ b.jpg 7 â”‚ â”‚ â””â”€â”€ c.jpg 8 â”‚ â”œâ”€â”€ index.md (root of page bundle, èƒ½å¤Ÿè®¿é—®first-post/ä¸‹çš„æ‰€æœ‰èµ„æº) 9 â”‚ â”œâ”€â”€ notice.md ä¸èƒ½è®¿é—®ä»»ä½•èµ„æº, ä½†å…¶è‡ªèº«ä½œä¸ºä¸€ä¸ªèµ„æºå¯è¢«index.mdè®¿é—® 10 â”‚ â”œâ”€â”€ office.mp3 11 â”‚ â”œâ”€â”€ pocket.mp4 12 â”‚ â”œâ”€â”€ rating.pdf 13 â”‚ â””â”€â”€ safety.txt 14 â””â”€â”€ second-post 15 â””â”€â”€ index.md (root of page bundle, ä½†ä¸èƒ½è®¿é—®first-post/ä¸‹çš„èµ„æº) å†…å®¹åˆ†ç±»(Taxonomy) Taxonomy: How to group the content together. Two default taxonomies are tags and categories.\nä»£ç é«˜äº®(Syntax Highlighter) ä»£ç é«˜äº®çš„é…ç½®(in config.toml):\né¡µé¢åˆ†ç±» ä»å¸ƒå±€ä¸Šæ¥çœ‹, é¡µé¢å¯ä»¥åˆ†ä¸ºä¸¤ç±»: List page å’Œ single page.\næ˜¾è€Œæ˜“è§, list pageæ¯”è¾ƒç‰¹æ®Š, å®ƒè´Ÿè´£åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰post. æ‰€ä»¥ä¸€ä¸ªç›®å½•åœ°å€å¿…ç„¶æ˜¯ä¸€ä¸ªlist page.\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, https://example.com , https://example.com/posts/happy/ éƒ½å¯ä»¥å«åš list page.\n  https://example.com/posts/happy/ æ˜¯list page, ç›®å½•ä¸‹çš„_index.md ä¸æ˜¯å¿…é¡»çš„, hugo ä¼šé»˜è®¤ä»…æ˜¾ç¤ºæ‰€æœ‰postçš„title. è¯¦è§\n  https://example.com/about/ ä¸æ˜¯list page, å› ä¸ºå…¶ç›®å½•ä¸‹æœ‰index.md, å¼ºåˆ¶è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª single page. è¯¦è§\n  1â””â”€â”€ content 2 â”œâ”€â”€ _index.md // \u0026lt;- https://example.com 3 | 4 â”œâ”€â”€ about 5 | â””â”€â”€ index.md // \u0026lt;- https://example.com/about/ 6 â””â”€â”€ posts 7 â”œâ”€â”€ _index.md // https://example.com/posts/ 8 â”œâ”€â”€ firstpost.md // \u0026lt;- https://example.com/posts/firstpost/ 9 â”œâ”€â”€ happy 10 | â””â”€â”€ ness.md // \u0026lt;- https://example.com/posts/happy/ness/ 11 â””â”€â”€ secondpost.md // \u0026lt;- https://example.com/posts/secondpost/  Homepage å’Œ section page éƒ½å±äºç‰¹æ®Šçš„ list page.\n homepage ç‰¹æŒ‡ content/_index.md section page ç‰¹æŒ‡ content/[section]/_index.md   shortcodes shortcode å¯ä»¥ç†è§£ä¸º hugo ä¸ºäº†å°è£…äº†ä¸€äº›ä»£ç å—, é€šè¿‡ shortcode æ¥è°ƒç”¨.\næ¨¡æ¿(Template) æ¨¡æ¿æ˜¯hugoçš„ä¸€ä¸ªé«˜çº§ç”¨æ³•, ç”¨æ¥å®šä¹‰ä½ ç½‘ç«™çš„style. æ¨¡æ¿ä¸ç­‰åŒä¸ä¸»é¢˜(themes), å¯ä»¥ç†è§£ä¸ºä¸»é¢˜æ˜¯ä¸€å¥—æ¨¡æ¿çš„é›†åˆ. æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ¨¡æ¿çš„åŒæ—¶æ·»åŠ DIYçš„ style. ğŸ˜ Hugo ä¼šæœ‰ä¼˜å…ˆçº§çš„åˆ¤æ–­.\nä¸åŒçš„é¡µé¢ç±»å‹éœ€è¦å®šä¹‰ä¸åŒçš„æ¨¡æ¿. List page çš„æ¨¡æ¿ç§°ä¸º List template, single page çš„æ¨¡æ¿ç§°ä¸º single template. åŒç†è¿˜æœ‰ homepage template, section template.\nå­˜å‚¨æ¨¡æ¿çš„ç›®å½•ä¸ºlayout/, ä¸Šé¢ä»‹ç»hugoçš„ç›®å½•ç»“æ„æ—¶å·²ç»è¯´è¿‡. å¦‚æœä½ ä½¿ç”¨äº†ä¸€ä¸ª theme, é‚£ä¹ˆthemes/[your-theme]/layout/å°±æ˜¯è¯¥themeçš„æ¨¡æ¿.\nhomepage æ¨¡æ¿ Base æ¨¡æ¿ å¯¹åº”layouts/_default/baseof.html\nbase æ¨¡æ¿æ˜¯æ•´ä¸ªwebsiteçš„æ ¸å¿ƒ. æ‰€æœ‰çš„æ¨¡æ¿åŒ…æ‹¬ list template, single template, homepage template\u0026hellip; éƒ½æ˜¯ç‹¬ç«‹çš„, base template å°†å…¶ä»–çš„æ¨¡æ¿è”ç³»åˆ°ä¸€èµ·.\nåˆ†é¡µæ¨¡æ¿ å¯¹äºæ¡æ•°è¿‡å¤šçš„åœºæ™¯ï¼ˆæ¯”å¦‚æ‰€æœ‰çš„post listï¼ŒæŸä¸ªtagçš„post listï¼‰ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªåˆ†é¡µå™¨ï¼Œç”¨ã€ä¸Šä¸€é¡µã€‘ã€ä¸‹ä¸€é¡µã€‘æ¥ä½¿å•ä¸ªé¡µé¢ç®€æ´ä¸€ç‚¹ï¼Œé¿å…æ»‘ä¸åˆ°å¤´çš„æƒ…å†µ :X\nä¸è¿‡å¯¹äºç›®å‰ï¼Œæˆ‘è¿˜æ²¡æœ‰é‚£ä¹ˆå¤šæ¡ç›®çœ‹ä¸è¿‡æ¥ï¼Œæ‰€ä»¥æš‚ä¸”æ²¡ç»†çœ‹ã€‚\nPaginationæ¨¡æ¿ å®˜æ–¹è¯´æ˜\npartial æ¨¡æ¿ åŒ…å«ç½‘ç«™çš„è®¸å¤šå…ƒç´ , å¢åŠ æ¨¡å—åŒ–. æˆ‘å¯ä»¥ä¸ºç½‘ç«™çš„ header æˆ–è€… footer å†™ä¸€ä¸ªæ¨¡æ¿(html), è¿™äº›HTMLå¯ä»¥åµŒå…¥å…¶ä»–çš„æ¨¡æ¿.\næ¨¡æ¿ä¼˜å…ˆçº§ æ—¢ç„¶åŒä¸€ç§é¡µé¢çš„æ¨¡æ¿å¯ä»¥å®šä¹‰åœ¨å¤šä¸ªä½ç½®, å¦‚æœä»–ä»¬åŒæ—¶å­˜åœ¨æ—¶, ä¼˜å…ˆçº§è§„åˆ™å¿…ç„¶å­˜åœ¨. å¸¸è§çš„æƒ…å†µæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨äº†æŸä¸ªæ¨¡æ¿, ç„¶è€Œ, æˆ‘ä»¬å¯¹æ¨¡æ¿ä¸­çš„ä¸€äº›å¸ƒå±€ä¸æ»¡æ„, ç›´æ¥ä¿®æ”¹æ¨¡æ¿ä¸­çš„æ–‡ä»¶æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•, é‚£ä¹ˆè¯¥æ€ä¹ˆåšå‘¢?\nä¸€èˆ¬æ¥è¯´, å¦‚æœä½ åªæƒ³é‡å†™themeä¸­çš„æŸä¸ªæ¨¡æ¿, ä¾‹å¦‚section template. é‚£ä¹ˆä½ åªéœ€è¦æ–°å»º layout/_default/section.html å³å¯, hugo æ„å»ºä½ çš„ç½‘ç«™æ—¶, å¦‚æœæ£€æµ‹åˆ°æœ¬åœ°å’Œthemeçš„layout/_defaultä¸‹éƒ½æœ‰ section.html, å®ƒä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„é‚£ä¸ª.\n å®Œæ•´çš„, å¤šçº§çš„ä¼˜å…ˆçº§è§„åˆ™: Hugo\u0026rsquo;s Lookup Order | Hugo (gohugo.io)\n å˜é‡(Variables) â— Hugo å˜é‡ä»…è®¾è®¡ç»™æ¨¡æ¿ä½¿ç”¨, å³åœ¨layouts/ä¸‹çš„htmlæ–‡ä»¶.\nPage Variables ä¸postç›¸å…³çš„å˜é‡, å®šä¹‰åœ¨post çš„ front matterä¸­.\n1// Define Page variables in front matter of post 2---------------- 3title: \u0026#34;ä½¿ç”¨ HuGo æ­å»ºä¸ªäººç½‘ç«™\u0026#34; 4description: å­¦ä¹ æ­£ç¡®çš„ Hugo é£Ÿç”¨æ–¹å¼, DIY å±äºè‡ªå·±çš„ website~ 5Myvar: \u0026#34;my value\u0026#34; 6---------------- 7 8// Use Page Variables 9{{.Description}} // Get the description of the post 10{{.Params.Myvar}} // Get the value of Myvar, that is, \u0026#34;my value\u0026#34; Site Variables ç«™ç‚¹å±‚é¢çš„å˜é‡å¤§éƒ¨åˆ†æ˜¯ç½‘ç«™é…ç½®ç›¸å…³.\nå‡½æ•°(Functions) å‡½æ•°æ˜¯hugoä¸ºä½ å°è£…çš„ä¸€äº›æ–¹æ³•ä½ å¯ä»¥ç›´æ¥è°ƒç”¨.\nâ— Hugo å‡½æ•°ä»…è®¾è®¡ç»™æ¨¡æ¿ä½¿ç”¨, å³åœ¨layouts/ä¸‹çš„htmlæ–‡ä»¶. Same as variables.\nHugo pipes DIY My Own Website æ”¯æŒ Emoji Adding emoji tutorial\nEmoji chart\n","date":"2022-05-21T17:39:42+08:00","permalink":"https://wangloo.github.io/posts/hugo/basic/","section":"posts","tags":["hugo"],"title":"Hugo å®˜æ–¹æ–‡æ¡£å­¦ä¹ "},{"categories":null,"contents":"Content Fourteen years ago, Steve stood on this stage and told your predecessors \u0026ldquo;Your time is limited. So don\u0026rsquo;t waste is living someone else\u0026rsquo;s life.\u0026rdquo;\nSo what is true then is true now. Don\u0026rsquo;t waste your time living someone else\u0026rsquo;s life. Don\u0026rsquo;t try to emulate the people who came before you to the exclusion of everything else, contorting into a shape that doesn\u0026rsquo;t fit.\nGraduates, the fact is, when your time comes, and it will, you will never be ready. But you\u0026rsquo;re not suppposed to be. Find the hope in the unexpected. Find the hope int the challenge. Find your vision on the solitary road. Don\u0026rsquo;t get distracted. There are too many people who want credit without responsibility. Too many who show up for the ribbon cutting without building anything worth a damn.\nBe different. Leave something worthy. And always remember that you can\u0026rsquo;t take it with you. You\u0026rsquo;re going to have to pass it on.\nThank you very much. And Congratulations to the Class of 2019!\nYouTube vidio\n","date":"2022-05-18T19:32:38+08:00","permalink":"https://wangloo.github.io/posts/motivation/2019-stanford-commencement-timcook/","section":"posts","tags":["tim cook","address"],"title":"2019 Stanford Commencement Timcook"},{"categories":["HTML/CSS"],"contents":"Get start What is HTML\u0026amp;CSS?   HTML is resonsible for the content of the page. That\u0026rsquo;s the text, images, buttons, etc.\n  CSS is resonsible for the presentation of the content. That\u0026rsquo;s the color, layout, etc.\n  Web designers create the overall look and fell of a website.\n  Web developers implement the design using HTML, CSS and JavaScript code.\n  Configure VIM as HTML code-editor  Finally in the arms of vscode ğŸ™‰\n Add vim plugin:\n emmet: Coding HTML faster.  CSS autocomplete key: \u0026lt;C-x\u0026gt; \u0026lt;C-o\u0026gt;\nHTML and CSS live previes plugin: bracey\n urlopen error solution  Â HTML Fundamentals Anatomy of an HTML element 1\u0026lt;p\u0026gt; THML is a markup language\u0026lt;/p\u0026gt; The HTML element is composed of opening tag, content, closing tag.\nHTML good styles  \u0026lt;img/\u0026gt; element should add alt attritube at all time, for the convenience of the blind. An important principle in web design is making the HTML elements meaningful. That is semantic HTML.  Â CSS Fundamentals CSS describes the visual style and presentation of the contend in HTML.\nAnatomy of an HTML element 1h1 { 2 color: blue; 3 text-align: center; 4 font-size: 20px; 5} h1 is Seletor, every style has proporty and value.\nCSS good styles  Class selector is more commonly used than ID selector, as ID is unique in HTML. For scalability, remember always using class selector. We should always specify all the four state of \u0026lt;a\u0026gt; element in order, which including link, visited, hover and active.  Priority conflicts between selectors CSS style priority from high to low:\n Inline style(style attribute in HTML) ID selector class or pseudo-class selector element selector universal element selector  Â The CSS box model The box model defines how elements are displayed on a webpage and how they are sized.\nIn the box model, every element on a webpage can be seen as a rectangular box.\nÂ Universal element \u0026amp; \u0026lt;body\u0026gt; element Styles in \u0026lt;body\u0026gt; selector take effect because of inheritance. But the text-independent elements do not support inheritance.\nThat is where universal element selector is needed. It\u0026rsquo;s styles take effect on all element.\nWhen we want to set padding and margin of all elements to 0. Must put the code in universal element selector.\nÂ Inline elements \u0026amp; Block elements Inline elements:\n Occupies only the space necessary for its content. Box model applies in different way: heights and widths do no apply. Paddings and margins are applied only horizontally(left and right).  Block elements:\n 100% of parent\u0026rsquo;s width vertivally, one after another  Inline-Block elements:\n Good example is \u0026lt;img\u0026gt;.  Â The 3 ways of building layouts with CSS Float Layouts: The old way of building layouts, using the float CSS property. Still used, but getting outdated fase.\n Element is removed from the normal flow: out of flow. Like absolutely positioning. Text and inline elements will wrap around the floated elements. Different from absolutely elements. The container will NOT adjust its height to the elements.  FlexBox: Modern way of laying out elements in a 1-dimensional row without using floats. Prefect for component layouts.\n One of its most useful applications is vertical centering. Flex container property:  gap: To create space between items. justify-content: To align items along main axis(horizontally, by default) align-items: To align items along cross axis(vertically, by dedauly) flex-wrap: To allow items to wrap into a new line if they are too large align-content: Only applies when there are multiple lines(flex-wrap: wrap)   Flex Items property:  align-self: To overwrite align-items for individual flex items. flex-grow: To allow an element to grow. flex-shrink: To allow an element to shrink. flex-basis: To define an item\u0026rsquo;s width, instead of the width property. flex: Recommended shorthand for flex-grow, -shrink, -basis.    CSS Grid: For laying out elements in a fully-fledged 2-dimensional grid. Perfect for page layouts and complex components.\n  CSS grid is a set of CSS properties for building 2-dimensional layouts\n  The main idea behind CSS Grid is that we divide a container element into rows and columns that can be filled with its child elements\n  CSS grid is not meant to replace flexbox!. Instead, they work perfectly together. Need a 1D layouts? Use flexbox. Need a 2D layout? Use CSS grid\n  Grid container\n grid-template-rows/grid-template-columns: To establish the grid row and column tracks. One length uniit for each track. Any unit can be used, new fr fills unused space row-gap/colum-gap: To create empty space between tracks justify-items/align-items: To align items inside rows/columns(horizontally/vertically)    Grid items\n grid-column/grid-row: To place a grid item into a specific cell, based on line numbers. span keyword can be used to span an item across more cells justify-self/align-self: To overwrite justify-items/align-items for single items    ","date":"2022-05-17T11:02:04+08:00","permalink":"https://wangloo.github.io/posts/html-css/0/","section":"posts","tags":["html","css"],"title":"Html Css Learning note (0)"},{"categories":["Vim"],"contents":"Search a word quickly: put cursor on the word, press / and press \u0026lt;C-R\u0026gt; \u0026lt;C-W\u0026gt;.\nÂ ç¼©å†™çš„å«ä¹‰(Meaning of abbreviations) Operation\n d - delete y - yank(copy, å› ä¸ºcè¢«å äº†) c - change r - replace v - visual select  Scope or location\n i - inside a - around f - forward t - to  Object\n w - word s - sentence p - paragraph  Â ä¹¦ç­¾: Bookmark ma: create bookmark a inside file.\nmA: create global bookmark A.\n`a: jump to bookmark a.\n:marks: display all bookmarks\ntag ç›®å‰ç”¨çš„ç”Ÿæˆtagsæ–‡ä»¶å·¥å…·æ˜¯ ctag, æ„Ÿè§‰è¿˜å¯ä»¥ã€‚\n1ta \u0026lt;tag\u0026gt; \u0026#34; è·³è½¬åˆ°ä¸€ä¸ªtagï¼Œå¦‚æœæœ‰å¤šä¸ªåº”è¯¥æ˜¯éšæœºä¸€ä¸ª 2CTRL-] \u0026#34; å¿«æ·é”®è·³è½¬åˆ°å½“å‰å…‰æ ‡ä¸‹çš„tag 3ts \u0026lt;tag\u0026gt; \u0026#34; å¤šä¸ªtagæ—¶ï¼Œå¯ä»¥é€‰æ‹©è·³è½¬åˆ°å“ªä¸€ä¸ª 45help tag \u0026#34; æŸ¥çœ‹æ›´å¤šå¸®åŠ© ç¼©è¿›: indent   \u0026gt;: increase indent , \u0026lt;: decrease indent ,=: auto indent\n  \u0026gt;\u0026gt;: å¢åŠ å½“å‰è¡Œçš„ç¼©è¿›\n  gg=G: ç¼©è¿›å…¨æ–‡, æ— è®ºå½“å‰å…‰æ ‡åœ¨å“ª\n   ä»¥ä¸Šå‘½ä»¤éƒ½å¯ä»¥é…åˆvisual modeä½¿ç”¨\n è‡ªåŠ¨ç¼©è¿›çš„è§„åˆ™ ä¸»è¦æœ‰å››ç§å¯ç”¨ç¼©è¿›çš„æ–¹å¼, åˆ†åˆ«æ˜¯:\n1\u0026#39;autoindent\u0026#39; æ²¿ç”¨ä¸Šä¸€è¡Œçš„ç¼©è¿›ã€‚ 2\u0026#39;smartindent\u0026#39; ç±»ä¼¼ \u0026#39;autoindent\u0026#39;ï¼Œä½†æ˜¯å¯ä»¥è¯†åˆ«ä¸€äº› C è¯­æ³•ä»¥èƒ½åœ¨åˆé€‚çš„åœ°æ–¹ 3 å¢åŠ  / å‡å°‘ç¼©è¿›ã€‚ 4\u0026#39;cindent\u0026#39; æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´èªæ˜ï¼›å¯ä»¥è®¾ç½®ä¸åŒçš„ç¼©è¿›é£æ ¼ã€‚ 5\u0026#39;indentexpr\u0026#39; æœ€çµæ´»çš„ä¸€ä¸ª: æ ¹æ®è¡¨è¾¾å¼æ¥è®¡ç®—ç¼©è¿›ã€‚è‹¥æ­¤é€‰é¡¹éç©ºï¼Œåˆ™ä¼˜å…ˆäºå…¶å®ƒ 6 é€‰é¡¹è¦†ç›–ã€‚å‚è§ indent-expression ã€‚ è‡ªå®šä¹‰çš„å¿«é€Ÿå‘½ä»¤:\n1command IndentOff setl noai nocin nosi indentexpr=\u0026#34;\u0026#34;2command IndentOn setl ai cin si \u0026#34;indentexpr can\u0026#39;t be re-enabled.3command IndentStatus set ai? si? cin? indentexpr? cindent ä¸ä¸€å®šå¯¹æ‰€æœ‰çš„è¯­è¨€éƒ½æœ‰æ•ˆæœ. åªæ˜¯ C-like é£æ ¼, å…¶ä¸­ä¸€ä¸ªè¦æ±‚æ˜¯é¡¶å±‚å‡½æ•°å¿…é¡»åœ¨ç¬¬ä¸€åˆ—ä¸­å«æœ‰ {.\n  åªæœ‰å½“indentexprè®¡ç®—ä¸å‡ºå½“å‰éœ€è¦ç¼©è¿›å‡ æ ¼æ—¶(return -1), æ‰ä½¿ç”¨ä¸Šé¢çš„ä¸‰ä¸ªè§„åˆ™. å®ƒæ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„.\n Find and Tail f(: ä»å½“å‰cursorå¤„å‘å³æŸ¥æ‰¾ä¸‹ä¸€ä¸ª(, å¹¶å°†å…‰æ ‡ç§»åŠ¨åˆ°(å¤„.\nF(: Like f(, but å‘å·¦æŸ¥æ‰¾.\nt(: Like f(, but å°†cursorç§»åŠ¨åˆ°(çš„å‰ä¸€ä¸ª.\nT(: You can guess.\nTrick vt(c: With visual, åˆ é™¤å½“å‰å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ª(å‰çš„æ‰€æœ‰å†…å®¹.\n;/,: æŸ¥æ‰¾ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ª f/F/t/T çš„å†…å®¹.\nÂ Substitute and Global  See: :help :s and :help :g\n è¿™ä¸¤ä¸ªéƒ½å±äºvimçš„å‘½ä»¤. vim çš„æ›¿æ¢å’Œsed çš„så‘½ä»¤ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸€è‡´. å°±ä¸å¤šä»‹ç»äº†.\nè€Œ vim çš„ global å‘½ä»¤å’Œsedæœ‰äº›è®¸å·®åˆ«. ä½¿ç”¨Sedåˆ é™¤åŒ…å«ä¸ªå­—ç¬¦ä¸²çš„è¡Œçš„æŒ‡ä»¤ä¸º: sed '/STRING/d' input_file, è€Œåœ¨vimä¸­åˆ™å¤šäº†ä¸€ä¸ªgå‰ç¼€, :g/STRING/d.\nglobal å¯ä»¥å’Œ substitute ç»“åˆä½¿ç”¨, ä¾‹å¦‚æƒ³è¦åœ¨åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„è¡Œä¸­æ›¿æ¢goodä¸ºexcellent\n1:g/STRING/s/good/excellent/  TODO:\n More [cmd] in global. Power of g | Vim Tips Wiki | Fandom vim subtituteä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼é›†åŒ…å« \\zså’Œ\\ze, ç„¶è€Œ sed æ²¡æœ‰(Sed ä¸º POSIX Basic Regular Expression).   Â å¤§å°å†™è½¬æ¢    cmd description     g~ ç¿»è½¬å¤§å°å†™   gu è½¬æ¢ä¸ºå°å†™   gU è½¬æ¢ä¸ºå¤§å†™    ä»¥ä¸Šå‘½ä»¤(ä¸¥æ ¼æ¥è¯´å«æ“ä½œç¬¦)éœ€è¦é…åˆåŠ¨ä½œå‘½ä»¤æ¥ä½¿ç”¨.\n gUaw: å°†å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å•è¯è½¬ä¸ºå¤§å†™ gUap: å°†å…‰æ ‡æ‰€åœ¨ä½ç½®çš„æ®µè½è½¬ä¸ºå¤§å†™  Â Search and replace case 1: search and convert to uppercase/lowercase æˆ‘ç›´è§‰æƒ³åˆ°çš„æ–¹å¼æ˜¯%s/html/HTML/gc\nè¿™ç§æ–¹å¼åœ¨ç®€å•æƒ…å†µä¸‹ä¹Ÿè¡Œ, æ¯”è¾ƒçµæ´»ä¸”ç›´è§‚, ä½†æ˜¯å¯¹äºå¤æ‚æ–‡ä»¶ä¸å¤Ÿé€šç”¨ä¸”å®¹æ˜“å‡ºé”™\nè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å…ˆæœç´¢, ç„¶åä¸€æ­¥æ­¥æ›¿æ¢\n æœç´¢: /\\vhtml\\C æ›¿æ¢: æ‰§è¡Œå‘½ä»¤gUgn, ç„¶åä½¿ç”¨nå’Œ.æ¥é‡å¤æ“ä½œä¸‹ä¸€ä¸ªé€‰ä¸­é¡¹.   gnå‘½ä»¤è¿›å¯¹äºsreachçš„åŒ¹é…é¡¹ä½¿ç”¨, ç±»ä¼¼äºn, ä½†ä¼šå°†ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹(è‹¥å…‰æ ‡åœåœ¨matchä¸Š, é‚£åˆ™é€‰ä¸­å½“å‰åŒ¹é…é¡¹) è½¬ä¸ºvisualæ¨¡å¼é€‰ä¸­çš„çŠ¶æ€.\n  å…¶å®å¯¹äºç®€å•çš„æ–‡æœ¬, nå’Œ.ä¹Ÿå¯ä»¥ç®€åŒ–ä¸º.. å”¯ä¸€çš„åå¤„å°±æ˜¯å¦‚æœä¸¤ä¸ªåŒ¹é…çš„è·ç¦»å¤ªå¤§, ä½ ä¸èƒ½ç¡®è®¤æ˜¯å¦searchäº†ä½ æƒ³è¦çš„å†…å®¹.\n case 2: search the text seleted in visual mode  vim æœ¬èº«å¹¶æœªæä¾›è¿™ä¸ªåŠŸèƒ½, éœ€è¦å€ŸåŠ©ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆ\n search the text selected in visual mode\nÂ Visual Block æ¨¡å¼   é€‰ä¸­å, ç¼–è¾‘æ‰€æœ‰è¡Œ: I(captial i), ç¼–è¾‘å®ŒæˆåæŒ‰ä¸¤æ¬¡ESC\n  é‡å¤visual é€‰ä¸­ä¸Šæ¬¡çš„ block: Normalæ¨¡å¼ä¸‹gvå³å¯.\n  Â å•è¯é—´è·³è½¬ w: Move cursor to begin of next word.\nb: Move cursor to begin of last word.\ne: Move cursor to end of next word.\nTrick w/bé…åˆceä½¿ç”¨å¯è¾¾åˆ°åœ¨æŸä¸€è¡Œä¸­å¿«é€Ÿç§»åŠ¨åˆ°æŸä¸ªå•è¯, ç„¶ååˆ é™¤è¯¥å•è¯å¼€å§‹edit.\ndaw: å³ Delete A Word, å¯ä»¥åˆ é™¤ä¸€ä¸ªå®Œæ•´çš„å•è¯, æ— è®ºå½“å‰å…‰æ ‡çš„ä½ç½®åœ¨å“ª.\nÂ ç¼–è¾‘äºŒè¿›åˆ¶/åå…­è¿›åˆ¶æ–‡ä»¶ å¯ä»¥ä½¿ç”¨xxdå‘½ä»¤å°†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ–‡æœ¬è½¬æ¢ä¸ºhexæ ¼å¼æ˜¾ç¤º. åœ¨vimä¸­é”®å…¥:%!xxd å³å¯. å¾—åˆ°çš„æ•ˆæœå¦‚ä¸‹:\n10000000: 5468 6973 2069 7320 6120 7465 7374 0a41 This is a test.A 20000010: 6e6f 7468 6572 206c 696e 650a 416e 6420 nother line.And 30000020: 7965 7420 616e 6f74 6865 720a yet another. åé¢çš„å¯¹åº”æ–‡æœ¬æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„, ä»…éœ€è¦ä¿®æ”¹åå…­è¿›åˆ¶çš„éƒ¨åˆ†å³å¯. ä¿®æ”¹å®Œæˆå, è¦è¿”å›åŸæœ¬çš„æ¨¡å¼, é”®å…¥:%!xxd -r.\n å¯é€šè¿‡è®¾ç½®æ–‡æœ¬æ ¼å¼å¯¹åå…­è¿›åˆ¶å†…å­˜é«˜äº®æ˜¾ç¤º set ft=xxd.\n Â åˆ é™¤å…‰æ ‡å‰/åçš„æ‰€æœ‰å­—ç¬¦  d^ \u0026ndash; delete to first non-whitespace character in the line d0 \u0026ndash; delete to beginning of the line c-u in insert mode. Same as bash command shortkeys, see here  Â æ–‡ä»¶æ¢å¤/swpæ–‡ä»¶ æ­£ç¡®å¯¹å¾…swpæ–‡ä»¶çš„å§¿åŠ¿:\n vim æ‰“å¼€åŸæ–‡ä»¶, æ­¤æ—¶ä¼šæç¤ºFound a swap file the name .xxx.swp, æ˜¾ç„¶é€‰æ‹©(R)ecover æ¥æ¢å¤æœªä¿å­˜çš„å†…å®¹. ä½¿ç”¨:wå°†æ¢å¤çš„å†…å®¹ä¿å­˜ä¸‹æ¥ ä½†æ˜¯æ­¤æ—¶åŸæœ¬çš„swpæ–‡ä»¶è¿˜æ˜¯å­˜åœ¨, æ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œ:eåˆ·æ–°ä¸€ä¸‹å½“å‰bufffer, ä»ç„¶ä¼šæç¤ºæ¢å¤çš„é€‰é¡¹, ä½†æ­¤æ—¶æ–‡ä»¶å†…å®¹å·²ç»æ¢å¤, é€‰æ‹©(D)elete å°±å¯å°†å¯¹åº”çš„swpæ–‡ä»¶åˆ é™¤äº†   åˆ é™¤å½“å‰ç›®å½•ä¸­æ‰€æœ‰swp fileçš„è„šæœ¬?\néœ€è¦ç¡®ä¿:\n æ‰€æœ‰æ–‡ä»¶å†…å®¹å·²æ¢å¤ å½“å‰çª—å£æˆ–è€…å…¶ä»–çª—å£æ²¡æœ‰vimæ­£åœ¨æ‰“å¼€æ–‡ä»¶(ä¼šç”Ÿæˆswp file)  1find . -type f -name \u0026#34;.*.sw[klmnop]\u0026#34; -delete  How to handle swapfiles in Vim (longwood.edu)\nÂ Debug VIM key mapping https://vi.stackexchange.com/a/7723/43494\nÂ å¦‚ä½•åŒæ­¥ VIM Dotfiles vim çš„ dotfiles ä¸»è¦åŒ…å«.vimrcå’Œ.vim/ä¸­çš„æ’ä»¶.\n  å¯¹äº.vimrc, æˆ‘é€‰æ‹©ä½¿ç”¨mackup è½¯ä»¶å’Œå…¶ä»–system dotfiles ä¸€èµ·å¤‡ä»½. Git repo\n  å¯¹äº plugins, ä¼ ç»Ÿçš„ç®¡ç†æ’ä»¶çš„æ–¹å¼(ä½¿ç”¨vim-plug), ä¹Ÿå°±æ˜¯æ”¾åœ¨~/.vim/plugged/ç›®å½•ä¸­çš„, å¯ä»¥é€šè¿‡:PlugInstallå‘½ä»¤åœ¨æ–°æœºå™¨ä¸Šé‡æ–°ä»ç½‘ä¸Šå…‹éš†. èƒ½å¤Ÿä¿è¯ä½¿ç”¨çš„æ˜¯æ–°ç‰ˆæœ¬.\n  VIM 8.0 ä¹‹å, å¼•å…¥ pack system æ–°çš„æ’ä»¶ç®¡ç†æ–¹å¼. å¯¹äºè¿™ç±»çš„æ’ä»¶, æˆ‘ä»¬ç›´æ¥åˆ©ç”¨submoduleåŠ å…¥å¦ä¸€ä¸ªå¤‡ä»½çš„ Git repo. ä½¿ç”¨æ–¹æ³•è§README.\n  Â Good plugins  Reference: The Ultimate vimrc\n TODO Installed NERD Commneter - å¿«é€Ÿæ³¨é‡Š\nNERD Tree - ç›®å½•æ ‘\nOpen File Under Cursor - æ‰“å¼€å…‰æ ‡å¤„çš„æ–‡ä»¶ç›®å½•\n ä¸æ”¯æŒvim-plugå®‰è£…. ç›´æ¥cloneæºç åˆ°pluggedç›®å½•å³å¯. Usage: gf: åœ¨å½“å‰windowæ‰“å¼€æ–‡ä»¶. \u0026lt;C-w\u0026gt;\u0026lt;C-f\u0026gt;: new vertical windowsä¸­æ‰“å¼€æ–‡ä»¶.  Ack.vim - å¿«é€Ÿå®šä½å†…å®¹\nLeaderF - Like Ctrlp but better?\nbarbaric - normalæ¨¡å¼åˆ‡æ¢è‹±æ–‡è¾“å…¥æ³•\nÂ Helpful script search text selected in visual mode 1xnoremap * :\u0026lt;C-u\u0026gt;call \u0026lt;SID\u0026gt;VSetSearch(\u0026#39;/\u0026#39;)\u0026lt;CR\u0026gt;/\u0026lt;C-R\u0026gt;=@/\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt;2xnoremap # :\u0026lt;C-u\u0026gt;call \u0026lt;SID\u0026gt;VSetSearch(\u0026#39;?\u0026#39;)\u0026lt;CR\u0026gt;?\u0026lt;C-R\u0026gt;=@/\u0026lt;CR\u0026gt;\u0026lt;CR\u0026gt;3function! s:VSetSearch(cmdtype)4let temp = @s5norm! gv\u0026#34;sy6let @/ = \u0026#39;\\V\u0026#39; . substitute(escape(@s, a:cmdtype.\u0026#39;\\\u0026#39;), \u0026#39;\\n\u0026#39;, \u0026#39;\\\\n\u0026#39;, \u0026#39;g\u0026#39;)7let @s = temp8endfunction","date":"2022-05-09T19:28:12+08:00","permalink":"https://wangloo.github.io/posts/tools/vim/basic/","section":"posts","tags":["Vim"],"title":"æˆ‘çš„ vim è°ƒæ•™éšç¬”"},{"categories":null,"contents":"Change code theme Default use monokai.css. see å®˜æ–¹æ–‡æ¡£\nä¿®æ”¹éœ€è¦ä¸‹è½½æ–°çš„cssæ”¾åˆ°plugin/highlight/ç›®å½•ä¸‹.\nå…¶ä»–å¯ç”¨çš„cssåœ¨highlight.jsä»“åº“ä¸­ä¸‹è½½.\nAlign Slide Align å–æ¶ˆcenterå¯¹é½æ–¹å¼:\n1Reveal.initialize({ 2 ... 3 center: false, 4 ... }) æ‰€æœ‰slideå·¦å¯¹é½: https://github.com/hakimel/reveal.js/issues/1897\nç”¨markdownå†™çš„æ–¹å¼ä¸‹ä½¿æŸä¸€å¹»ç¯ç‰‡å·¦å¯¹é½: https://github.com/hakimel/reveal.js/issues/890#issuecomment-129735291\n","date":"2022-05-08T19:34:44+08:00","permalink":"https://wangloo.github.io/posts/revealjs/","section":"posts","tags":null,"title":"reveal.js Tutorial"},{"categories":["Architecture"],"contents":"Load/Store æŒ‡ä»¤ å¯»å€æ¨¡å¼ Base register - w0=[x1]\n1ldr w0, [x1] Offset addressing mode - w0=[x1+12]\n1ldr w0, [x1, 12] Pre-index addressing mode - x1+=12; w0=[x1]\n1ldr w0, [x1, 12]! Post-index addressing mode - w0=[x1]; x1+=12\n1ldr w0, [x1], 12 æ›´å¤šç¤ºä¾‹ 1// load a byte from x1 2ldrb w0, [x1] 3 4// load a signed byte from x1 5ldrsb w0, [x1] 6 7// store a 32-bit word to address in x1 8str w0, [x1] 9 10// load two 32-bit words from stack, then add 8-byte to sp 11ldp w0, w1, [sp], 8 12 13// store two 64-bit words at [sp-96] and subtract 96-byte from sp. 14stp x1, x2, [sp, -96]! 15 16// LDRä¼ªæŒ‡ä»¤. load 32-bit immediate from literal pool(addr: 0x12345678) 17ldr w0, =0x12345678 æ•°æ®å¤„ç†æŒ‡ä»¤ Bitfield æ“ä½œæŒ‡ä»¤ Bitfield æŒ‡ä»¤å¸¸ç”¨äºè®¾ç½®/æå–å¯„å­˜å™¨çš„æŸä¸ªå­—æ®µ.\n1;BFI(Bit Field Insert) 2BFI w0, w0, #9, #6 ;w0[0, 5] = w0[9, 14] 3 4;BFC(Bit Field Clear) 5BFC w0, #4, #2 ;w0[4, 5] = 0 6 7;UBFX(Unsigned Bit Field Extract) 8UBFX w1, w0, #18, #7 ;w1=w0[18, 24]  ä¸ UBFX ç›¸å¯¹çš„æ˜¯ SBFX, è‹¥æå–åçš„å­—æ®µé«˜ä½ä¸º 1, ä¼šè¿›è¡Œç¬¦å·æ‰©å±•\n åˆ†æ”¯/æ§åˆ¶æŒ‡ä»¤ è·å¾—åœ°å€çš„ç›¸å…³æŒ‡ä»¤ å†™æ±‡ç¼–ä¸­ï¼Œå¸¸å¸¸ä¼šè·å–ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°(label)çš„åœ°å€ï¼ŒA64 ä¸­ä¸€å…±æœ‰å‡ ç§è·å–åœ°å€çš„æŒ‡ä»¤ï¼Œ åŒ…æ‹¬adr, adrp, adrl, ldrç­‰ï¼Œä¸‹é¢æˆ‘å°±å¯¹è¿™äº›æŒ‡ä»¤è¿›è¡Œä»‹ç»ã€‚\nADR é¦–å…ˆæ˜¯ adrï¼Œå®ƒçš„ä½œç”¨æ˜¯åŠ è½½ PC ç›¸å¯¹åœ°å€ã€‚PCç›¸å¯¹çš„å¦ä¸€å±‚å«ä¹‰å°±æ˜¯ç‰©ç†åœ°å€ï¼Œ è€Œä¸ä¸€å®šæ˜¯ç¼–è¯‘åæŒ‡ä»¤çš„VMAï¼Œä»…ä»…å–å†³äºå½“å‰çš„PCåœ¨å“ªï¼Œè¿”å›çš„å°±æ˜¯åç§»åçš„ç»“æœã€‚\n æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒæŒ‡ä»¤æ­£å¸¸è¿è¡Œä¸ä¸€å®šPCå¯¹åº”çš„æŒ‡ä»¤ä¸€ç­‰ç­‰äºå…¶åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„VMAï¼Œ å°±æ‹¿bring-upä»£ç åšå‚è€ƒå³å¯ã€‚è¿™æ—¶å€™æŒ‡ä»¤èƒ½æ­£å¸¸æ‰§è¡Œçš„åŸå› æ˜¯ï¼šå–æŒ‡åŠ¨ä½œæ°¸è¿œéƒ½æ˜¯ç®€å•çš„PC+1ï¼Œ ä»…ä»…ä¸PCæœ‰å…³è€Œå·²ã€‚\n adr æŒ‡ä»¤çš„æ ¼å¼æ˜¯:\n1adr reg, offset è¾“å…¥ä¸€ä¸ª offsetï¼Œè¾“å‡º PC+offset çš„å€¼ï¼Œä½†æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ offset å¡«æŸä¸€ä¸ª labelï¼Œä¾‹å¦‚å‡½æ•° æˆ–è€…å˜é‡ï¼Œæ­¤æ—¶ reg ä¸­å­˜çš„å°±æ˜¯æ­¤å‡½æ•°çš„åœ°å€äº†ã€‚ä¾‹å¦‚ï¼Œ\n1adr x0, a_func # x0 = addr(a_func) adr æŒ‡ä»¤ä¸­ç•™ç»™ offset çš„ä½æ•°æ˜¯ 21ï¼Œæ‰€ä»¥æœ€å¤§çš„å¯»å€èŒƒå›´ä¸º+-1MBã€‚\nADRP adrp çš„æŒ‡ä»¤æ ¼å¼ä¸ adr ç›¸åŒï¼Œä¸åŒç‚¹æ˜¯ä¼šå°†è®¡ç®—çš„ç»“æœå‘ä¸‹å¯¹é½åˆ° 4kï¼Œä½†è¿™æ ·ç›´æ¥è®¡ç®—çš„ åœ°å€ç»“æœå¾€å¾€æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºå°‘äº†é¡µå†…çš„åç§»ã€‚éœ€è¦ä¸€ä¸ªé¢å¤–çš„ add æŒ‡ä»¤è¿›è¡Œçº æ­£ï¼Œä¸€èˆ¬æ¥è¯´ æ˜¯ç»„åˆèµ·æ¥ç”¨çš„ï¼š\n1adrp x0, a_func 2add x0, x0, :lo12:a_func æ˜¾ç„¶ adrp è¿™æ ·åšæ˜¯ä¸ºäº†æ›´å¤§çš„å¯»å€ç©ºé—´ï¼Œèƒ½åˆ°+-4GBã€‚\nLDR ä¼ªæŒ‡ä»¤ ä¸€èˆ¬é€šç”¨çš„ldræŒ‡ä»¤éƒ½æ˜¯ç”¨æ¥åŠ è½½å†…å­˜ä¸­çš„å€¼ï¼Œæ¯”å¦‚å¸¸è§çš„ ldr x0, [x1]ã€‚ æˆ–è€…è¯´å®¹æ˜“æ··æ·†çš„åŠ è½½labelå¤„å†…å­˜çš„å€¼: ldr x0, labelã€‚\nå¦‚æœ ldr æŒ‡ä»¤çš„å‚æ•°æ˜¯=\u0026lt;label\u0026gt;ï¼Œé‚£å°±ä»£è¡¨ä¼ªæŒ‡ä»¤ï¼Œä½œç”¨æ˜¯åŠ è½½ label çš„ç»å¯¹åœ°å€ï¼Œ æ³¨æ„ä¸æ˜¯å†…å­˜çš„å€¼ï¼Œè€Œæ˜¯åœ°å€, æ‹¿åˆ°çš„åœ°å€æ˜¯ç»å¯¹åœ°å€ï¼Œå³VMAã€‚ å¥½å¤„æ˜¯å¯ä»¥è·å–åˆ°ä¸€ä¸ªä½äºä»»æ„ label çš„åœ°å€ï¼Œä¸å—å¯»å€ç©ºé—´çš„çº¦æŸã€‚\n ç®€å•è¯´ä¸‹ldrå’Œldrä¼ªæŒ‡ä»¤çš„åŒºåˆ«\n1label_1: // assmue VMA of label_1 = 0x12345678 2 .word 0xabcdabcd 3 4ldr x0, addr // x0 = 0xabcdabcd 5ldr x0, =addr // x0 = 0x12345678   å½“ç›®å‰æŒ‡ä»¤æ‰§è¡Œåœ°å€ä¸ç­‰äºå®ƒä»¬çš„è™šæ‹Ÿåœ°å€æ—¶ï¼Œæ¯”å¦‚å½“ MMU æœªå¼€å§‹æ—¶é€šè¿‡ uboot åŠ è½½åˆ°å†…å­˜ ä¸­ç›´æ¥è¿è¡Œçš„é‚£æ®µç¨‹åºï¼Œæ­¤æ—¶ç”¨adr/adrpè¿™äº›åŠ è½½ pc ç›¸å¯¹åœ°å€çš„æŒ‡ä»¤å°±ä¼šæ­£ç¡®çš„è¿”å› label çš„å®é™…è¿è¡Œåœ°å€ï¼›è€Œldråˆ™æ˜¯æ°¸è¿œè¿”å›å…¶ç¼–è¯‘é“¾æ¥åç»‘å®šçš„è™šæ‹Ÿåœ°å€ã€‚è¿™ç§æƒ…å†µä¸‹ å¦‚æœå¯»å€èŒƒå›´å…è®¸ï¼Œç”¨adr*æŒ‡ä»¤æ›´æ–¹ä¾¿ã€‚\n æœ‰è¶£ç‰¹æ€§/å¸¸è§è¯¯åŒº \u0026lsquo;#\u0026rsquo; before the immediate value  A64 assembly language does not require the # to introduce constant immediate value. But the assembler can also indentify the #. In armv7, there must be a # or $ before other than using .syntax unified. About syntax unified.   Agreed Recommendation\nUse .syntax unified in v7 code, and never use # on any literal on either v7 or v8. Unified syntax is newer and better, and those # and $ signs are just more code noise.\n ","date":"2022-05-07T21:19:01+08:00","permalink":"https://wangloo.github.io/posts/armv8/a64/","section":"posts","tags":["arm64"],"title":"AArch64 A64 æŒ‡ä»¤é›†"},{"categories":["Architecture"],"contents":"å¯„å­˜å™¨åˆ†ç±» é€šç”¨å¯„å­˜å™¨  x0-x7 å‚æ•°å¯„å­˜å™¨: Restore function parameters and return vaule. x9-x15 caller-saved ä¸´æ—¶å¯„å­˜å™¨: callee é»˜è®¤å¯ä»¥ç›´æ¥ä½¿ç”¨æ¥ä¿å­˜ä¸´æ—¶å˜é‡, ä¸éœ€è¦ä¿å­˜å’Œæ¢å¤. å¦‚æœ caller åœ¨é‡Œé¢å­˜å‚¨äº†éä¸´æ—¶ä¿¡æ¯, é‚£ä¹ˆåœ¨å‡½æ•°è°ƒç”¨ä¹‹å‰åº”å½“ç”± caller è´Ÿè´£ä¿å­˜. x19-x28 callee-saved å¯„å­˜å™¨: callee åº”è¯¥é¿å…ä½¿ç”¨. å¦‚æœå¿…é¡»è¦ä½¿ç”¨ï¼Œé‚£ä¹ˆåœ¨è¿”å›å‰å¿…é¡»æ¢å¤. special registers:  x8 restore indirect result. Commonly used when returning a struct. x18 platform reserved register. x29 frame pointer register(FP). x30 link register(LR).     All general-purpose register xN is 64-bit width. They all have corresponding wN register using the lower 32-bit of xN. And write to wN will clear the upper 32bit of xN.\n  ğŸ’« The different between Caller-saved and callee-saved registers\n Caller-saved å¯„å­˜å™¨åˆç§°ä¸ºä¸´æ—¶å¯„å­˜å™¨, å¸¸ç”¨æ¥å­˜æ”¾ä¸´æ—¶å˜é‡. ä¾‹å¦‚A() è°ƒç”¨ B(), é‚£ä¹ˆ B() å¯ä»¥ç›´æ¥ä½¿ç”¨ caller-saved å¯„å­˜å™¨, ä¹Ÿå°±æ˜¯è¯´ A() åœ¨è°ƒç”¨ B() ä¹‹å‰ä¸ä¼šåœ¨è¿™äº›å¯„å­˜å™¨é‡Œä¿å­˜é‡è¦ä¿¡æ¯(ç¼–è¯‘å™¨å®ç°), ä¸èƒ½ä¿è¯è°ƒç”¨ B() å‰åå…¶å€¼ä¸å˜. å¦‚æœå¿…é¡»è¦ä¿è¯, é‚£ä¹ˆä¿å­˜å’Œæ¢å¤(åˆ©ç”¨æ ˆ)è¿™ä»¶äº‹æ˜¯ A() æ¥åš. Callee-saved å¯„å­˜å™¨åˆ™ç›¸å, é€šå¸¸æŒç»­ä½¿ç”¨çš„å€¼ä¼šä¿å­˜åˆ°è¿™äº›å¯„å­˜å™¨ä¸­. è¿˜æ˜¯æ‹¿ A() call B() æ¥ä¸¾ä¾‹. å¦‚æœ A() ä¸­çš„ä¸€ä¸ªå˜é‡éœ€è¦åœ¨è°ƒç”¨ B() å‰åæŒç»­æœ‰æ•ˆ, é‚£ä¹ˆå®ƒåº”å½“ä¿å­˜åˆ° callee-saved å¯„å­˜å™¨ä¸­. è€Œä¸” B() æ­£å¸¸æ¥è¯´ä¸åº”è¯¥åŠ¨è¿™äº›å¯„å­˜å™¨, å¦‚æœéå¾—åŠ¨(ä¾‹å¦‚å¯„å­˜å™¨ä¸å¤Ÿç”¨), é‚£ä¹ˆ B() éœ€è¦åœ¨ä½¿ç”¨ä»–ä»¬çš„å‰åè¿›è¡Œä¿å­˜å’Œæ¢å¤(åˆ©ç”¨æ ˆ).   æ¯ä¸ªELçš„ç‰¹æ®Šå¯„å­˜å™¨  sp_el0/1/2/3 stack pointer register of each EL. elr_el1/2/3 exception link register of each EL except EL0. spsr_el1/2/3 save program status register of each EL except EL0.   sp is an alias of sp_el0. Do NOT treat sp as general-purpose register.\n ","date":"2022-05-07T20:19:44+08:00","permalink":"https://wangloo.github.io/posts/armv8/register/","section":"posts","tags":["armv8"],"title":"AArch64 å¯„å­˜å™¨"},{"categories":["Math"],"contents":"è€ƒè¯•å¤§çº² ğŸ¯ To Reader:\nThis blog is JUST FOR EXAMINATION! If you are interested in numberical analysis, please quit this web. I try to sort out the knowledge points of the course, just to pass the exam.\nBased on the course of Professor Zhong Erjie of UESTC.\nğŸ’¢ I hate mathematics!\nÂ ç¬¬äºŒç«  éçº¿æ€§æ–¹ç¨‹/æ–¹ç¨‹ç»„çš„æ±‚è§£ 1. äºŒåˆ†æ³•åŠè¿­ä»£  äºŒåˆ†æ³•è¯¯å·®ä¼°è®¡å®šç†  2. ä¸åŠ¨ç‚¹è¿­ä»£  ä¸åŠ¨ç‚¹åŠä¸åŠ¨ç‚¹è¿­ä»£çš„æ¦‚å¿µ è¿­ä»£æ ¼å¼çš„é€‰æ‹©? æ˜¯å¦æ”¶æ•›? è¿­ä»£çš„åˆå€¼æ˜¯å¦åˆé€‚?  3. ç‰›é¡¿æ³•è§£éçº¿æ€§æ–¹ç¨‹  èƒŒæ™¯: å¦‚æœå‡½æ•°f(x)æ˜¯çº¿æ€§çš„, é‚£ä¹ˆå®ƒçš„æ±‚æ ¹é—®é¢˜å°±ä¼šç®€åŒ–. ç‰›é¡¿æ³•å®è´¨ä¸Šæ˜¯ä¸€ç§çº¿æ€§åŒ–æ–¹æ³•, å°†éçº¿æ€§æ–¹ç¨‹é€æ­¥å½’ç»“ä¸ºæŸç§çº¿æ€§æ–¹ç¨‹æ¥æ±‚è§£.\n ç‰›é¡¿æ³•çš„è¿­ä»£æ ¼å¼: $$ x^{k+1} = x^k - \\frac{f(x^k)}{f^\u0026rsquo;(x^k)} $$\n4. å¼¦æˆªæ³•  èƒŒæ™¯: å¼¦æˆªæ³•æ˜¯ç‰›é¡¿æ³•çš„ä¸€ä¸ªæ”¹è¿›. ç‰›é¡¿æ³•æ±‚æ ¹æ—¶éœ€è¦è®¡ç®—f'(x), è€Œå¯¼æ•°çš„è®¡ç®—å¾€å¾€å›°éš¾. å¼¦æˆªæ³•ä½¿ç”¨å·®å•†æ¥å›é¿å¯¼æ•°çš„è®¡ç®—.\n 5. æ”¶æ•›é˜¶ 6. éçº¿æ€§æ–¹ç¨‹ç»„çš„ç‰›é¡¿è¿­ä»£æ ¼å¼  é›…å¯æ¯”çŸ©é˜µæ˜¯ä»€ä¹ˆ?  Â ç¬¬ä¸‰ç«  ç›´æ¥æ³•è§£çº¿æ€§æ–¹ç¨‹ç»„ 1. Gaussæ¶ˆå…ƒæ³• æ±‚è§£è¿‡ç¨‹çš„ç®—æ³•å¤æ‚åº¦ä¸ºO(n^2), æ¶ˆå…ƒè¿‡ç¨‹çš„ç®—æ³•å¤æ‚åº¦ä¸ºO(n^3).\n2. ç›´æ¥ä¸‰è§’åˆ†è§£æ³•(Doolittleåˆ†è§£æ³•)  èƒŒæ™¯: ç›´æ¥æ„å‘³ç€å¯ä»¥ç”±Açš„å…ƒç´ ç›´æ¥è®¡ç®—Lå’ŒU, ä¸éœ€è¦ä»»ä½•çš„ä¸­é—´æ­¥éª¤.\n ä¸€æ—¦Lå’ŒUå¾—åˆ°, æ±‚è§£Ax=bå°±å¯ä»¥ç­‰ä»·è¡¨ç¤ºä¸ºæ±‚è§£ä¸¤ä¸ªä¸‰è§’å½¢æ–¹ç¨‹ç»„:\n Ly=b, æ±‚y Ux=y. æ±‚x  Â ç¬¬å››ç«  è¿­ä»£æ³•è§£çº¿æ€§æ–¹ç¨‹ç»„  èƒŒæ™¯: å¯¹äºçº¿æ€§æ–¹ç¨‹ç»„Ax=b, å½“Aä¸ºä½é˜¶ç¨ å¯†çŸ©é˜µæ—¶, [é€‰ä¸»å…ƒæ¶ˆå»æ³•]æ˜¯æ±‚è§£çš„æœ‰æ•ˆæ–¹æ³•.\nä½†æ˜¯å®é™…æƒ…å†µä¸­Aå¤§éƒ½æ˜¯å·¨å‹çš„ç¨€ç–çŸ©é˜µ, è¿™æ˜¯é‡‡ç”¨è¿­ä»£æ³•æ¥æ±‚è§£æ˜¯åˆé€‚çš„. è¿­ä»£æ³•å¯ä»¥åˆ©ç”¨Aä¸­æœ‰å¤§é‡é›¶å…ƒç´ çš„ç‰¹ç‚¹.\n  è¿­ä»£æ³•ä¸ä¸€å®šæœ€ç»ˆèƒ½å¤Ÿé€¼è¿‘æ–¹ç¨‹ç»„çš„è§£, è®¤è¯†è¯¯å·®å‘é‡çš„æ¦‚å¿µ.  1. Jacobiè¿­ä»£ é›…å¯æ¯”è¿­ä»£æ ¼å¼å’Œæ”¶æ•›æ€§çš„åˆ¤åˆ«\nå¿«é€Ÿè®¡ç®—Bjçš„ç‰¹å¾å€¼\nJacobiè¿­ä»£ç”±Aç›´æ¥çœ‹å‡ºBj\n2. Seidelè¿­ä»£ Seidelè¿­ä»£æ”¶æ•›æ ¼å¼å’Œæ”¶æ•›æ€§çš„åˆ¤åˆ«\nSeidelè¿­ä»£ç‹¬æœ‰çš„åˆ¤æ–­æ”¶æ•›æ€§çš„æ–¹å¼: è‹¥Aä¸ºå¯¹ç§°é˜µ, ä¸”Aæ­£å®š, é‚£ä¹ˆè¿­ä»£æ”¶æ•›.\nÂ ç¬¬äº”ç«  æ’å€¼æ³• 1. æ’å€¼æ–¹æ³•ä¸æ’å€¼é—®é¢˜  èƒŒæ™¯: ä»…å·²çŸ¥æŸäº›ç‚¹å’Œè¯¥ç‚¹çš„å‡½æ•°å€¼çš„æƒ…å†µä¸‹, å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ªæ’å€¼å‡½æ•°P(x), ä½¿å¾—è¯¯å·®æœ€å°.\n  ä»€ä¹ˆæ˜¯æ’å€¼å‡½æ•°P(x)? è¢«æ’å‡½æ•°? æ’å€¼èŠ‚ç‚¹? æ’å€¼ä½™é¡¹?  2. å¤šé¡¹å¼æ’å€¼  å¯è¯æ˜å¤šé¡¹å¼P(x)å­˜åœ¨å”¯ä¸€. å¤šé¡¹å¼æ’å€¼é€šè¿‡è§£æ–¹ç¨‹ç»„å°±èƒ½å¾—åˆ°è§£(a0, a1,..., an).  3. æ‹‰æ ¼æœ—æ—¥æ’å€¼å…¬å¼  èƒŒæ™¯: è™½ç„¶ä¸Šé¢çš„å¤šé¡¹å¼æ’å€¼èƒ½å¦è§£å†³n+1ä¸ªç‚¹çš„å…‰æ»‘å‡½æ•°, ä¸”è§£æ˜¯å”¯ä¸€çš„. ä½†æ˜¯è§£æ–¹ç¨‹ç»„æ˜¯å¾ˆéº»çƒ¦çš„.\n æ‹‰æ ¼æœ—æ—¥æ’å€¼å…¬å¼: $$ L_n(x) = l_0(x)y_0 + l_1(x)y_1 + \\dots + l_n(x)y_n $$ æ’å€¼åŸºå‡½æ•°:\næ’å€¼æ¡ä»¶(æ’å€¼ç³»æ•°): $$ y_0 = f(x_0), y_1 = f(x_1), \\dots,y_n = f(x_n) $$\nè¯¯å·®ä½™é¡¹Rn(x)\n4. ç‰›é¡¿æ’å€¼å…¬å¼  èƒŒæ™¯: ç»™å®š5ä¸ªæ’å€¼èŠ‚ç‚¹åŠå…¶å‡½æ•°å€¼, å¯ä»¥å¾—åˆ°L4(x); ç”±äºæŸç§åŸå› , éœ€è¦åŠ å…¥ä¸€ä¸ªæ–°çš„æ’å€¼èŠ‚ç‚¹. Lagrangeæ’å€¼æ³•ä¹‹å‰çš„è®¡ç®—ç»“æœ(l)å‡å¤±æ•ˆ, éœ€è¦é‡æ–°è®¡ç®—. éå¸¸çš„ä¸æ–¹ä¾¿.\n  ç‰›é¡¿æ³•æ˜¯åŸºäºå·®å•†çš„æ¦‚å¿µ. å¯¼æ•°æ˜¯å·®å•†çš„æé™. å·®å•†çš„å·®å•†æ˜¯é«˜é˜¶å·®å•†.  ç‰›é¡¿æ’å€¼æ³•çš„æ’å€¼å‡½æ•°(ä»¥äºŒæ¬¡æ’å€¼ä¸¾ä¾‹): $$ P(x) = a_0 + a_1(x-x_0) + a_2(x-x_0)(x-x_1) $$ éœ€è¦åšçš„å°±æ˜¯è§£å‡ºç³»æ•°a0,a1,....\næ‰€ä»¥å¼•å…¥å·®å•†çš„ç¬¦å·: $$ a_1=f[x_0,x_1]=\\frac{f(x_1)-f(x_0)}{x_1-x_0} $$ $$ a_2=f[x_0,x_1,x_2]=\\frac{f[x_1,x_2]-f[x_0,x_1]}{x_2-x_0} $$\n5. Hermiteæ’å€¼  èƒŒæ™¯: æœ‰æ—¶æˆ‘ä»¬å·²çŸ¥çš„æ¡ä»¶ä¸éƒ½æ˜¯å‡½æ•°å€¼, ä¹Ÿæœ‰å¯¼æ•°å€¼. ä¾‹å¦‚å·²çŸ¥ä¸¤ä¸ªç‚¹çš„å‡½æ•°å€¼å’Œä¸¤ä¸ªç‚¹çš„å¯¼æ•°å€¼, å¯ä»¥åº”ç”¨Heimiteæ’å€¼æ³•å¾—åˆ°ä¸‰æ¬¡å¤šé¡¹å¼.\n æ±‚Hermiteæ’å€¼å‡½æ•°çš„æ–¹æ³•: æ„é€ å·®å•†è¡¨, é‡å¤èŠ‚ç‚¹ç‰¹æ®Šå¤„ç†.\nHermiteæ’å€¼æ–¹æ³•çš„ä½™é¡¹è¯æ˜ä¸Langrangeæ’å€¼æ³•ç›¸åŒ.\n6. åˆ†æ®µä½æ¬¡æ’å€¼  èƒŒæ™¯: æ¬¡æ•°å¤ªé«˜çš„å¤šé¡¹å¼æ’å€¼çš„æ•ˆæœä¸å¥½. æ¯”å¦‚é¾™æ ¼ç°è±¡.\n  åˆ†æ®µ: æŠŠè¢«æ’å€¼å‡½æ•°æ‰€åœ¨çš„å¤§åŒºé—´åˆ†æˆä¸€ä¸ªä¸ªçš„å°åŒºé—´. ä½æ¬¡: æ¯ä¸ªå°åŒºé—´ä¸Šç”¨æ¬¡æ•°ä¸è¶…è¿‡3çš„å‡½æ•°æ¥é€¼è¿‘  6.1 åˆ†æ®µçº¿æ€§æ’å€¼ å°±æ˜¯åˆ†æ®µæŠ˜çº¿\nåˆ†æ®µçº¿æ€§æ’å€¼çš„ä¼˜ç‚¹:\n ç®€å• å½“äºŒé˜¶å¯¼æ•°è¶‹è¿‘0æ—¶, ä¸€å®šæ”¶æ•›  åˆ†æ®µçº¿æ€§æ’å€¼çš„ç¼ºç‚¹:\n åˆ†æ®µæŠ˜çº¿ä¸å…‰æ»‘, åˆ†æ®µç‚¹å¤„ä¸èƒ½æ±‚å¯¼.  6.2 åˆ†æ®µHermiteæ’å€¼  èƒŒæ™¯: ä¸ºäº†è§£å†³åˆ†æ®µçº¿æ€§æ’å€¼çš„ç¼ºç‚¹(å­˜åœ¨å°–ç‚¹).\n å·²çŸ¥å‡½æ•°åœ¨(n+1)ä¸ªç‚¹çš„å‡½æ•°å€¼å€¼ä»¥åŠå…¶å¯¼æ•°å€¼, å»æ„é€ ä¸€é˜¶è¿ç»­å¯å¯¼å‡½æ•°.\nåˆ†æ®µHermiteæ’å€¼æ ¹æ®(n+1)ä¸ªå·²çŸ¥ç‚¹åˆ’åˆ†ä¸º(n+1)ä¸ªåŒºé—´. è¿™æ ·åœ¨æ¯ä¸ªå°åŒºé—´ä¸Šéƒ½å·²çŸ¥4ä¸ªæ¡ä»¶, å¯ä»¥ä½¿ç”¨3æ¬¡Hermiteæ’å€¼.\nç»“è®º: å·²çŸ¥(2n+2)ä¸ªæ¡ä»¶çš„æƒ…å†µä¸‹, å±…ç„¶åªå¾—åˆ°ä¸€é˜¶è¿ç»­å¯å¾®å‡½æ•°. ç»“è®ºå¤ªå·®!\nÂ ç¬¬å…­ç«  æ‹Ÿåˆ ğŸ” æ’å€¼, æ‹Ÿåˆ, é€¼è¿‘çš„åŒºåˆ«\n1. æœ€ä½³å¹³æ–¹é€¼è¿‘ 2. æœ€å°äºŒä¹˜æ³•  èƒŒæ™¯: å·²çŸ¥ä¸å…±çº¿çš„ä¸‰ç‚¹, å¦‚ä½•ç¡®å®šä¸€æ¡å¯ä¿¡çš„ç›´çº¿.\n ä¸‰ä¸ªç‚¹å¯ä»¥ç”¨æ’å€¼æ¥æ¨¡æ‹ŸäºŒæ¬¡å¤šé¡¹å¼, ä½†é¢˜ç›®è¦æ±‚äº†ç”¨ä¸€æ¬¡å¤šé¡¹å¼, è¿™æ˜¯æ’å€¼æ— æ³•åšåˆ°çš„.\nä¸å…±çº¿çš„ä¸‰ç‚¹ä¸å¯èƒ½åŒæ—¶ç»è¿‡ä¸€æ¡ç›´çº¿, æ‰€ä»¥è¦ç”¨é€¼è¿‘çš„æ€æƒ³. æ‰¾ä¸€æ¡è¿‘ä¼¼çš„ç›´çº¿, ä½¿å¾—è¯¯å·®æœ€å°.\n ä¸æ’å€¼çš„åŒºåˆ«: æ’å€¼æ˜¯æ˜ç¡®ç»™å‡ºn+1ä¸ªæ’å€¼æ¡ä»¶, å¾—åˆ°næ¬¡å¤šé¡¹å¼. å¦‚ä½•å®šä¹‰è¯¯å·®æœ€å°?: å‡½æ•°é—´çš„è·ç¦».  1. çº¿æ€§æ‹Ÿåˆ æ‹Ÿåˆçš„å‡½æ•°æ˜¯næ¬¡å¤šé¡¹å¼, å¯è½¬åŒ–ä¸ºè¶…å®šæ–¹ç¨‹GX.\n å…¶ä¸­è§„å®šGä¸ºç³»æ•°çŸ©é˜µ, Xä¸ºå˜é‡çš„åˆ—å‘é‡. åŒæ—¶å®šä¹‰åˆ—å‘é‡Fä¸ºç»™å‡ºçš„å‡½æ•°å€¼. GX=Fæ˜¯è¶…å®šæ–¹ç¨‹ç»„, æ²¡æœ‰å‡†ç¡®è§£. å¾—åˆ°æ®‹å·®æœ€å°çš„è§£çš„æ–¹æ³•å³æœ€å°äºŒä¹˜æ³•.  æ‰€ä»¥çº¿æ€§æ‹Ÿåˆçš„æ®‹å·®r = |GX - F|, è€Œæ‰¾åˆ°ç›®æ ‡å‡½æ•°çš„å®—æ—¨å°±æ˜¯ä½¿ræœ€å°. ä½¿ç”¨åˆç­‰å˜åˆ†åŸç†å°†è¿™ä¸ªé—®é¢˜è½¬åŒ–ä¸ºæ­£è§„æ–¹ç¨‹ç»„æ±‚è§£çš„é—®é¢˜.\nÂ ç¬¬ä¸ƒç«  æ•°å€¼ç§¯åˆ†  èƒŒæ™¯: å®šç§¯åˆ†çš„è®¡ç®—ä¸­å¯èƒ½æ— æ³•æ‰¾åˆ°åŸå‡½æ•°çš„æƒ…å†µ. è€ƒè™‘å®šç§¯åˆ†çš„æœ¬è´¨æ˜¯ä¸€å¥å…·ä½“çš„æ•°, æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªæ•°çš„è¿‘ä¼¼å€¼, è¶Šæ¥è¿‘è¶Šå¥½.\n è§£å†³çš„ä¸¤ç§æ€è·¯: ç§¯åˆ†ä¸­å€¼å®šç† å’Œ æ’å€¼å‹æ±‚ç§¯å…¬å¼(è¿‘ä¼¼è¢«ç§¯å‡½æ•°).\n1. ç§¯åˆ†ä¸­å€¼å®šç† åŸºæœ¬çš„ç§¯åˆ†ä¸­å€¼å®šç†: $$ \\int_{a}^{b}f(x)dx = f(\\xi)(b-a) $$\nå°†ä¸€ä¸ªåŒºåŸŸçš„é¢ç§¯è½¬åŒ–ä¸ºçŸ©å½¢çš„é¢ç§¯. å¦‚ä½•ç¡®å®šçŸ©å½¢çš„é«˜å‘¢? å·¦çŸ©é˜µ, å³çŸ©é˜µ, ä¸­é—´çŸ©é˜µ, æ¢¯å½¢å…¬å¼.\næ›´å¸¸ç”¨çš„ç§¯åˆ†å…¬å¼æ˜¯ åœ¨ä¹˜ç§¯å‡½æ•°ç§¯åˆ†ä¸­, å¦‚æœg(x)ä¸å˜å·, åˆ™æœ‰: $$ \\int_{a}^{b}g(x)f(x)dx =f(\\xi)\\int_{a}^{b}g(x)dx $$\n2. æ’å€¼å‹æ±‚ç§¯å…¬å¼ åœ¨è¢«ç§¯å‡½æ•°å¾ˆå¤æ‚çš„æƒ…å†µä¸‹, å¯ä»¥å¯¹å…¶è¿›è¡Œè¿‘ä¼¼å¤„ç†, ä¾‹å¦‚ä½¿ç”¨Lagrangeæ’å€¼æ³•.\näºŒæ¬¡æ’å€¼: Simpsonå…¬å¼ å–äºŒæ¬¡æ’å€¼çš„æ­¥é•¿h=(b-a)/2, å³å¢åŠ ä¸€ä¸ªæ’å€¼èŠ‚ç‚¹(b-a)/2, Simpsonå…¬å¼åŒ–ç®€çš„ç»“æœä¸º: $$ \\int_{a}^{b}f(x)dx = \\frac{b-a}{6}[f(a)+4f(\\frac{a+b}{2})+f(b)]+R[f] $$\nğŸ“Œ Simpsonå…¬å¼æ»¡è¶³3é˜¶ä»£æ•°ç²¾åº¦. è™½ç„¶å®ƒåªæ˜¯äºŒæ¬¡æ’å€¼å¾—åˆ°çš„.\n3. ä½™é¡¹  æ’å€¼å‹æ±‚ç§¯å…¬å¼çš„ä½™é¡¹, å³å¯¹åº”çš„æ’å€¼æ–¹æ³•(å¦‚Lagrange, Newton)çš„ä½™é¡¹åœ¨åŒºé—´ä¸Šçš„ç§¯åˆ†. æ¢¯å½¢å…¬å¼æ–¹æ³•çš„ä½™é¡¹å¯ä»¥ç”¨ç§¯åˆ†ä¸­å€¼å®šç†æ¥ä¼˜åŒ–. Simpsonå…¬å¼çš„ä½™é¡¹ä¸èƒ½ä½¿ç”¨ç§¯åˆ†ä¸­å€¼å®šç†æ¥ä¼˜åŒ–, å› ä¸ºä¸æ»¡è¶³ä¿å·çš„æ¡ä»¶.  4. è¡¡é‡æ±‚ç§¯å…¬å¼çš„å¥½å ä»£æ•°ç²¾åº¦: ä¸æ˜¯ä¸€ç§è¯¯å·®, è€Œæ˜¯å¯¹è¯¯å·®çš„æè¿°.\nå¦‚ä½•å¾—çŸ¥æŸä¸ªå…¬å¼çš„ä»£æ•°ç²¾åº¦: åªè¦å¸¦å…¥ä¸€ä¸ªmæ¬¡å¤šé¡¹å¼éªŒè¯ä½™é¡¹æ˜¯å¦ä¸º0å³å¯.\n5.å¤åˆæ±‚ç§¯å…¬å¼ ä¸ºäº†æé«˜ç²¾åº¦é€šå¸¸æŠŠç§¯åˆ†åŒºé—´åˆ†ä¸ºè‹¥å¹²ä¸ªå­åŒºé—´, å†åœ¨æ¯ä¸ªå­åŒºé—´ä¸Šåº”ç”¨ä½é˜¶æ±‚ç§¯å…¬å¼.\n å¤åˆæ¢¯å½¢å…¬å¼: å°†åŒºé—´ç­‰åˆ†. å¤åˆsimpsonå…¬å¼: å°†åŒºé—´å¶æ•°ç­‰åˆ†.  Â ç¬¬å…«ç«  å¸¸å¾®åˆ†æ–¹ç¨‹åˆå€¼é—®é¢˜æ•°å€¼è§£æ³• å°†ç ”ç©¶çš„å†…å®¹è¿›ä¸€æ­¥é™å®šä¸º: ä¸€é˜¶åˆå€¼é—®é¢˜, å•æ­¥æ³•.\n èƒŒæ™¯: åœ¨æ— æ³•ç»™å‡ºè§£æè¡¨è¾¾å¼æ—¶å¦‚æœåˆ©ç”¨æ•°å€¼æ–¹æ³•æ±‚å‡ºyçš„è¿‘ä¼¼è§£?\n 1. ç®€å•çš„æ•°å€¼æ–¹æ³• 1.1 Eulerå…¬å¼ ä½¿ç”¨ä¸€é˜¶å‘å‰å·®å•†è¿‘ä¼¼æ›¿ä»£y'. å¾—åˆ°é€’æ¨çš„æ•°åˆ—è¡¨è¾¾å¼: $$ y_{n+1} = y_{n} + hf(x_n,y_n), n=0,1,2,\u0026hellip; $$\nè¯¯å·®: Euleræ³•ä½¿ç”¨çš„è¿‘ä¼¼ä»£æ›¿åªæœ‰ä¸€é˜¶ç²¾åº¦, æ‰€ä»¥è¯¯å·®å¾ˆå¤§. æ­¤æ—¶æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ:\n åŠ ç»†æ­¥é•¿h, è‹¥ä¸è¡Œå†åŠ ç»†. æ€»æ˜¯èƒ½å¾—åˆ°æ­£ç¡®çš„, å¦‚æœä½ ä¸å«Œå¼ƒå¸¦æ¥çš„è®¡ç®—å˜å¾—ç¼“æ…¢çš„é—®é¢˜. æ¢æ–¹æ³•.  1.2 æ¢¯å½¢å…¬å¼  èƒŒæ™¯:ä¸ºå¾—åˆ°æ¯”Euleræ³•ç²¾åº¦æ›´é«˜çš„è®¡ç®—å…¬å¼. æ¢¯å½¢å…¬å¼å…·æœ‰äºŒé˜¶ç²¾åº¦.\n å¯¹y' = f(x,y)çš„ä¸¤ç«¯è¿›è¡Œå±€éƒ¨çš„ç§¯åˆ†, ç„¶åç”¨æ¢¯å½¢å…¬å¼è¿‘ä¼¼è®¡ç®—å³è¾¹.\n1.3 æ”¹è¿›Eulerå…¬å¼ å…ˆç”¨æ¬§æ‹‰å…¬å¼æ±‚å¾—ä¸€ä¸ªè¿‘ä¼¼çš„yn+1, å¸¦å…¥æ¢¯å½¢å…¬å¼, å¾—åˆ°çŸ«æ­£çš„yn+1.\n","date":"2022-05-07T18:04:58+08:00","permalink":"https://wangloo.github.io/posts/numberical-analysis/","section":"posts","tags":["Math","Examination"],"title":"Numberical Analysis Exam"},{"categories":["Vim"],"contents":"Use plugin vimtex Vim build-in support of LaTeX files is just OK. When we need more excellent exprience, good plugins is very recommended.\nvimtex is a nice and modern vim plugin for LaTeX files.\nUseful Futures of vimtex IMO\n \u0026lt;leader\u0026gt;ll Complier. By default, it will auto-complier when you type :w. \u0026lt;leader\u0026gt;lt Open content tree as a sidebar. \u0026lt;leader\u0026gt;lv View PDF with configured PDF viewer. \u0026lt;leader\u0026gt;li File information. cse Change surrounding \\begin \\end environment. tse Exchange between \\begin{env} and \\begin{env*}. tsc Exchange between \\command{} and \\command*{}.  Â Add Support of Simplified Chinese Install xetex I use xetex to add supports for Chinese fonts in LaTex files. Actually the magician is amacro package of xetex named xeCJK.\nAnd xetex is included intexlive. so we install it from source:\n1sudo apt install texlive-xetex Install Chinese Font If there is no Chinese font in your system, you must install one. I choose WinQingYuan microhei as a instance.\n1sudo apt install ttf-wqy Excute fc-list to check if install successfully, here is excepted output:\n1fc-list | grep wqy 1/usr/share/fonts/truetype/wqy/wqy-microhei.ttc: WenQuanYi Micro Hei,æ–‡æ³‰é©›å¾®ç±³é»‘,æ–‡æ³‰é©¿å¾®ç±³é»‘:style=Regular 2/usr/share/fonts/truetype/wqy/wqy-microhei.ttc: WenQuanYi Micro Hei Mono,æ–‡æ³‰é©›ç­‰å¯¬å¾®ç±³é»‘,æ–‡æ³‰é©¿ç­‰å®½å¾®ç±³é»‘:style=Regular Configure your tex file 1\\documentclass {article} 2\\usepackage{xeCJK} 3\\setCJKmainfont{WenQuanYi Micro Hei} 4 5\\begin{document} 6Hello, LaTeX! 7 8ä½ å¥½, LaTex! 9 10\\end{document} Complier it and see, the Chinese font is displayed!\nÂ Confusing Tools Difference between {pdf,lua,xe}Tex and {pdf,lua,xe}LaTeX If a .texfile starts with \\documentclass, it\u0026rsquo;s a LaTex format file rather than the Plain Tex format file.\nThe LaTeX format file has some specific macro like \\documentclass that cannot be compliered by [pdf]Tex, so that\u0026rsquo;s the job of [pdf]LaTeX. Same goes for other engines.\nWhat is xetex/xelatex? xetex/xelatex is one of the TeX/LaTeX engines. Others are pdfTex, LuaTex, etc. Wiki\nxetex/xelatex add fonts and character sets support for TeX/LaTeX file.\n Treat input as Unicode Allow us to use many system fonts in LaTeX file easily  What is latexmk? LaTeXmk æ˜¯ä¸€ä¸ªé›†æˆåŒ–çš„å‘½ä»¤è¡Œå·¥å…·, it must work with one LaTeX engine.\nThe fundamental issue that latexmk solves is that the number of runs of [pdf]latex is highly dynamically dependent on the document and the class file used. latex just need to be run once a time.\nDifferent between CTeX/MiKTeX/TeXlive ? They are all åŒ…å«ä¸.texæ–‡ä»¶å…³è”çš„å„ç§ç¼–è¾‘ã€æŸ¥çœ‹å·¥å…·ã€å¸¸ç”¨å®åŒ…åŠæ–‡æ¡£.\nCTex packages add complete Chinese support based on MiKTeX.\n CTex is only avilable in windows.  ","date":"2022-05-04T17:07:51+08:00","permalink":"https://wangloo.github.io/posts/tools/vim/latex_vim/","section":"posts","tags":["Vim"],"title":"LaTeX Vim Tutorial"},{"categories":null,"contents":"When reading C standard documents, we usually see phrases like \u0026ldquo;Implementation-defined\u0026rdquo;, \u0026ldquo;Unspecified\u0026rdquo;,.etc.\nSo, what do they really mean?\næœ¯è¯­ æˆ‘ä»¬å°†è¿™äº›éš¾ä»¥ç›´æ¥ç†è§£çš„è¯æ±‡ç§°ä¸ºæœ¯è¯­ï¼Œåœ¨ANSI Cä¸­ï¼Œæœ¯è¯­å¯ä»¥åˆ†ä¸ºæè¿°ä¸å¯ç§»æ¤ä»£ç (unportable), åä»£ç (bad), å¯ç§»æ¤çš„ä»£ç (portable)ä¸‰ç±».\nunportable code Implementation-defined\néœ€è¦ç”±ç¼–è¯‘å™¨è®¾è®¡è€…å†³å®šé‡‡å–ä½•ç§è¡Œä¸ºï¼Œä»–ä»¬å¯èƒ½ä¸åŒï¼Œä½†éƒ½ä¸èƒ½è¯´æ˜¯é”™è¯¯çš„.\nä¾‹å¦‚ï¼šå½“æ•´å‹æ•°å³ç§»æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰©å±•ç¬¦å·ä½. å³ç§»ä»£æ›¿é™¤æ³•å¯èƒ½å¯¼è‡´çš„ç¾éš¾.\nunspecified\nåœ¨æŸäº›æ­£ç¡®æƒ…å†µä¸‹çš„åšæ³•ï¼Œæ ‡å‡†å¹¶æœªæ˜ç¡®è§„å®šåº”è¯¥æ€æ ·åš.\nä¾‹å¦‚ï¼šå‚æ•°æ±‚å€¼çš„é¡ºåº.\nbad code undefined\nåœ¨æŸäº›ä¸æ­£ç¡®æƒ…å†µä¸‹çš„åšæ³•ï¼Œä½†æ ‡å‡†å¹¶æœªè§„å®šåº”è¯¥æ€æ ·åšã€‚æ„å‘³ç€ä½ å¯ä»¥é‡‡å–ä»»ä½•è¡ŒåŠ¨ï¼Œå¯ä»¥ä»€ä¹ˆéƒ½ä¸åšï¼Œä¹Ÿå¯ä»¥å‘å‡ºä¸€æ¡è­¦å‘Šä¿¡æ¯, æˆ–è€…ç»ˆæ­¢CPUé‡å¯ç­‰ç­‰. ä½ ç”šè‡³å¯ä»¥å‘å°„æ ¸å¯¼å¼¹(åªè¦ä½ å®‰è£…äº†èƒ½å‘å°„æ ¸å¯¼å¼¹çš„ç¡¬ä»¶ç³»ç»Ÿ).\nä¾‹å¦‚ï¼šå½“ä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°æº¢å‡ºæ—¶è¯¥é‡‡å–ä»€ä¹ˆè¡ŒåŠ¨.\nconstraint\nè¿™æ˜¯ä¸€ä¸ªå¿…é¡»éµå®ˆçš„é™åˆ¶æˆ–è¦æ±‚. å¦‚æœä½ ä¸éµå®ˆ, é‚£ä¹ˆä½ çš„ç¨‹åºçš„è¡Œä¸ºå°±ä¼šå˜æˆå¦‚ä¸Šæ‰€è¯´çš„undefined. è¿™å‡ºç°äº†ä¸€ç§å¾ˆæœ‰æ„æ€çš„æƒ…å†µ: åˆ†è¾¨æŸç§ä¸œè¥¿æ˜¯å¦æ˜¯ä¸€ä¸ªconstaintæ˜¯å¾ˆå®¹æ˜“çš„, å› ä¸ºæ¯ä¸ªæ ‡å‡†çš„ä¸»é¢˜éƒ½é™„æœ‰ä¸€ä¸ªconstraintå°èŠ‚, åˆ—å‡ºäº†æ‰€æœ‰çš„çº¦æŸæ¡ä»¶ã€‚\nä¾‹å¦‚: %æ“ä½œç¬¦çš„æ“ä½œæ•°å¿…é¡»ä¸ºæ•´å‹. æ‰€ä»¥,åœ¨éæ•´å‹æ•°æ®ä¸Šä½¿ç”¨%æ“ä½œç¬¦è‚¯å®šä¼šå¯¼è‡´undefined.\nportable code strictly conforming\nä¸¥æ ¼éµå®ˆæ ‡å‡†çš„. ç¬¦åˆè¯¥æ¡ä»¶çš„ç¨‹åºåº”å½“æ˜¯:\n åªä½¿ç”¨å·²ç¡®å®šçš„ç‰¹æ€§ ä¸çªç ´ä»»ä½•ç”±ç¼–è¯‘å™¨å®ç°(Implementation-defined)çš„é™åˆ¶. ä¸ä½¿ç”¨unspecifiedå’Œundefinedç‰¹æ€§  è¿™æ ·è§„å®šçš„ç›®çš„æ˜¯æœ€å¤§ç¨‹åºä¿è¯ä»£ç çš„å¯ç§»æ¤æ€§. ä½†ç¬¦åˆè¯¥æœ¯è¯­çš„ä»£ç å¹¶ä¸å¸¸è§, ä¾‹å¦‚INT_MAXçš„å€¼åœ¨ä¸åŒæ¶æ„çš„æœºå™¨ä¸Šç»“æœå¯èƒ½ä¸åŒ.\ncomforming\néµå¾ªæ ‡å‡†çš„; ä¸€ä¸ªéµå¾ªæ ‡å‡†çš„ç¨‹åºå¯ä»¥ä¾èµ–ä¸€äº›å¯¹äºæŸç§ç¼–è¯‘å™¨ç‰¹æœ‰çš„ä¸å¯ç§»æ¤çš„ç‰¹æ€§. è¿™æ ·ä¸€ä¸ªç¨‹åºå¯¹äºæŸä¸ªç¼–è¯‘å™¨å¯èƒ½æ˜¯éµå¾ªæ ‡å‡†çš„, ä½†å¯¹äºå¦å¤–ä¸€ä¸ªç¼–è¯‘å™¨åˆæ˜¯ä¸éµå¾ªæ ‡å‡†çš„.\n","date":"2022-05-01T16:41:35+08:00","permalink":"https://wangloo.github.io/posts/reading-notes/expert_c_programming/portability_issues/","section":"posts","tags":null,"title":"Portability Issues"},{"categories":null,"contents":"","date":"2022-05-01T16:41:35+08:00","permalink":"https://wangloo.github.io/posts/third-blog/","section":"posts","tags":null,"title":"Third Blog"},{"categories":["Makefile"],"contents":"As we all know, there are huge number of parameters for GCC. With them, we can make many things possible. Now we talk about -M and related ones. After reading this article, you will know the meaning of there magic parameters. And I will put some little demos follows. Finally, we will see what can they do in really project. Let\u0026rsquo;s go ahead.\nå®ä¾‹è§„åˆ™ ä»¥ä¸‹çš„åˆ†æéƒ½æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„è§„åˆ™, åº”è¯¥æ¥è¯´å…·æœ‰ä¸€å®šçš„é€šç”¨æ€§ã€‚\n1build/obj/main.o: src/main.c 2 $(CC) $(CFLAGS) $(INCLUDES) -c $\u0026lt; -o $@ main.cä¸­çš„å†…å®¹ï¼š\n1/* File: main.c */ 2#include \u0026lt;stdio.h\u0026gt; // system header file3#include \u0026#34;header.h\u0026#34; // user defined header file4int main() { 5 return 0; 6} -M Output the dependencies of the input source file. Incluing the names of itself and all included files.\n-M(and ä¸‹é¢çš„-MM)å’Œ-o ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œå› ä¸ºéƒ½éšå«-Eã€‚ å‡è®¾æˆ‘ä»¬åªæƒ³è¾“å‡ºä¾èµ–æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¤ºä¾‹ä¸­çš„è§„åˆ™å¦‚æ­¤æ”¹é€ ï¼š\n1build/obj/main.o: src/main.c 2 $(CC) $(CFLAGS) $(INCLUDES) -c $\u0026lt; -M We will get messy output like following. Notice that the first two words is object filename and a colon.\n1main.o: src/main.c /usr/include/stdc-predef.h /usr/include/stdio.h \\ 2 /usr/include/x86_64-linux-gnu/bits/libc-header-start.h \\ 3 /usr/include/features.h /usr/include/x86_64-linux-gnu/sys/cdefs.h \\ 4 /usr/include/x86_64-linux-gnu/bits/wordsize.h \\ 5 /usr/include/x86_64-linux-gnu/bits/long-double.h \\ 6 /usr/include/x86_64-linux-gnu/gnu/stubs.h \\ 7 /usr/include/x86_64-linux-gnu/gnu/stubs-64.h \\ 8 /usr/lib/gcc/x86_64-linux-gnu/9/include/stddef.h \\ 9 /usr/lib/gcc/x86_64-linux-gnu/9/include/stdarg.h \\ 10 /usr/include/x86_64-linux-gnu/bits/types.h \\ 11 /usr/include/x86_64-linux-gnu/bits/timesize.h \\ 12 /usr/include/x86_64-linux-gnu/bits/typesizes.h \\ 13 /usr/include/x86_64-linux-gnu/bits/time64.h \\ 14 /usr/include/x86_64-linux-gnu/bits/types/__fpos_t.h \\ 15 /usr/include/x86_64-linux-gnu/bits/types/__mbstate_t.h \\ 16 /usr/include/x86_64-linux-gnu/bits/types/__fpos64_t.h \\ 17 /usr/include/x86_64-linux-gnu/bits/types/__FILE.h \\ 18 /usr/include/x86_64-linux-gnu/bits/types/FILE.h \\ 19 /usr/include/x86_64-linux-gnu/bits/types/struct_FILE.h \\ 20 /usr/include/x86_64-linux-gnu/bits/stdio_lim.h \\ 21 /usr/include/x86_64-linux-gnu/bits/sys_errlist.h 22 src/header.h -MM Like -M but do NOT output system header files.\n1main.o: src/main.c src/header.h -MF \u0026lt;file\u0026gt; Use with -M or -MM. Specify output dependencies to file instead of STDOUT.\næ³¨æ„ï¼Œåªè¦ä½¿ç”¨è¿½åŠ ä¸Š-MFï¼Œå°±å¯ä»¥å’Œ-oé€‰é¡¹å¹¶å­˜äº†ï¼Œå¯ä»¥å†™åœ¨ä¸€æ¡è¯­å¥ä¸­\n-MD -MD is same as -M -MF \u0026lt;file\u0026gt;. But the filename is basd on the object file but replacing .o with .d.\nå¦‚æœå°†ç¤ºä¾‹ä¸­çš„ä»£ç æ¢æˆï¼š\n1build/obj/main.o: src/main.c FORCE 2 $(CC) $(CFLAGS) $(INCLUDES) -c $\u0026lt; -o $@ -MD 1$ ll build/obj/ 2 3total 16 4drwxrwxr-x 2 soben soben 4096 3æœˆ 23 20:45 ./ 5drwxrwxr-x 3 soben soben 4096 3æœˆ 23 20:35 ../ 6-rw-rw-r-- 1 soben soben 1144 3æœˆ 23 20:45 main.d 7-rw-rw-r-- 1 soben soben 1368 3æœˆ 23 20:45 main.o  Note: -MD and -MMD å› ä¸ºæœ‰-MTï¼Œä¹Ÿä¸éšå« -E.\n -MMD -MMD is same as -MM -MF \u0026lt;file\u0026gt;. Also named on object file but replacing .o with .d.\n-MT \u0026lt;target\u0026gt; MT æ˜¯ä¸€ä¸ªå•ç‹¬çš„é€‰é¡¹ï¼Œä¸ä¸ä¸Šé¢çš„å†²çªã€‚ä½œç”¨æ˜¯æ”¹å˜ç”Ÿæˆä¾èµ–è§„åˆ™çš„ç›®æ ‡æ ¼å¼ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œé»˜è®¤çš„æ ¼å¼æ˜¯æ–‡ä»¶å.oï¼Œå»é™¤ä»»ä½•å‰ç¼€ç›®å½•ã€‚\nè€Œä½¿ç”¨-MTä¹‹åå¯ä»¥è‡ªå®šä¹‰è§„åˆ™ä¸­ç›®æ ‡çš„æ ¼å¼ï¼Œ ç”±\u0026lt;target\u0026gt;æŒ‡å®šã€‚\nä¾‹å¦‚ï¼Œå¯¹äºå‰é¢çš„é€‰é¡¹ï¼Œä¾èµ–è§„åˆ™ç›®å‰æ€»æ˜¯main.oï¼Œå¾ˆå¤šä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å…¶ç¼–è¯‘è§„åˆ™ä¸­ç›®æ ‡çš„å½¢å¼ï¼ŒåŒ…å«è·¯å¾„ï¼Œå¹¶ä¸ä»…ä»…æ˜¯æ–‡ä»¶åæœ¬èº«ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨-MTï¼Œå¯ä»¥å°†ç¤ºä¾‹ä¸­çš„è§„åˆ™åšå¦‚ä¸‹ä¿®æ”¹:\n1build/obj/main.o: src/main.c FORCE 2 $(CC) $(CFLAGS) $(INCLUDES) -c $\u0026lt; -o $@ -MMD -MT $@ ä¾èµ–æ–‡ä»¶çš„å†…å®¹å°±å˜ä¸º:\n1build/obj/main.o: src/main.c src/header.h  å®é™…ä¸Šï¼Œä»æˆ‘çš„å¼€å‘ç»éªŒæ¥çœ‹ï¼Œå¤§é¡¹ç›®ä¸­ç¼–è¯‘è§„åˆ™çš„ç›®æ ‡å¹¶ä¸ç›´æ¥æ˜¯ç›®æ ‡æ–‡ä»¶ï¼Œæ€»æœ‰ä¸€ä¸ªè·¯å¾„å‰ç¼€ï¼Œä¾‹å¦‚ï¼š$(objdir)/%.o: $(srcdir)/%c, è¿™æ—¶å¦‚æœ include çš„ä¾èµ–æ–‡ä»¶çš„ç›®æ ‡åªæ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œå…¶å®æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚ æ‰€ä»¥ -MT åº”è¯¥æ˜¯åœ¨å¼€å‘å¤§å‹é¡¹ç›®ä¸­å¾ˆå¸¸è§çš„ã€‚\n -MQ \u0026lt;target\u0026gt; ä¸MTç±»ä¼¼ï¼Œè€Œä¸”æˆ‘æ²¡æœ‰éªŒè¯æˆåŠŸå®˜ç½‘è¯´å‡ºçš„å’Œ MT çš„åŒºåˆ«. æ‰€ä»¥ï¼Œè¿™æ˜¯ä¸€ä¸ª TODOã€‚\nApplication Here is an important question you may ask me: Why do we struggle to get the dependencies formats? What can they do?\nIf you are familiar with make and Makefile, aha, that\u0026rsquo;s it! With the help of M-related parameters, you can easily handle the problem of tracing header files.\nGive you a little demo about my point.\n1-include *.d 2%.o:%.c 3 $(CC) $(CFLAGS) $(INCLUDES) $\u0026lt; -c -MMD -o $@ Actually, we do two things in order:\n When complieing source files, we generate dependency files xxx.d at the same time. After geting xxx.d, we include them in makefile. As its format is exactly the dependency format required by makefile.  Summary Hope this article can give you a clear understanding of M-related parameters in GCC. We can sometimes find them in large projects\u0026rsquo; makefile. It\u0026rsquo;s very useful to automatic build dependency for header files. So try to use them in your current or next project.\nReference  GNU GCC options GCC -M, -MM, -MMD, -MF, -MT  ","date":"2022-04-26T19:08:22+08:00","permalink":"https://wangloo.github.io/posts/c/make/gcc_-m_related/","section":"posts","tags":["c","makefile"],"title":"\"GCC -M\" é€‰é¡¹åœ¨Makefileä¸­çš„ä½¿ç”¨"},{"categories":null,"contents":"This is my second blog.\n Wish you have a good life.\n  happy smile   sunset   ","date":"2022-04-26T15:32:11+08:00","permalink":"https://wangloo.github.io/posts/second-blog/second-blog/","section":"posts","tags":null,"title":"Second Blog"},{"categories":null,"contents":"This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog. This is my first blog.\n1#include \u0026lt;stdio.h\u0026gt;2 3int main(void) { 4 printf(\u0026#34;hello, hugo\\n\u0026#34;); 5 return 0; 6} ","date":"2022-04-26T15:13:07+08:00","permalink":"https://wangloo.github.io/posts/first-blog/first-blog/","section":"posts","tags":null,"title":"First Blog"},{"categories":null,"contents":"ç¼–è¯‘Linux æºç  ä¸Šæµ·äº¤é€šå¤§å­¦é•œåƒç«™\n1# get linux source code 2wget http://ftp.sjtu.edu.cn/sites/ftp.kernel.org/pub/linux/kernel/ 3# extract 4tar xvf linux-4.12.1.tar.gz 5# enter dir 6cd linux-4.12.1/ 7 8# generate .config 9make ARCH=arm64 CROSS_COMPILE=aarch64-none-linux-gnu- defconfig 10make ARCH=arm64 CROSS_COMPILE=aarch64-none-linux-gnu- menuconfig 11# compile  12make ARCH=arm64 CROSS_COMPILE=aarch64-none-linux-gnu- Image -j16 æ„å»ºæ ¹æ–‡ä»¶ç³»ç»Ÿ ä½¿ç”¨ Busybox æ„å»º, ä¸‹è½½æºç æ—¶å¯èƒ½æ¯”è¾ƒæ…¢, æš‚æ—¶æ²¡æœ‰å‘ç°å›½å†…é•œåƒç«™\n1# Download busybox source code 2wget https://busybox.net/downloads/busybox-1.35.0.tar.bz2 3 4# menuconfig - generate .config 5make ARCH=arm64 CROSS_COMPILE=aarch64-none-linux-gnu- menuconfig 6# compile 7make ARCH=arm64 CROSS_COMPILE=aarch64-none-linux-gnu- -j16 8 9make ARCH=arm64 CROSS_COMPILE=aarch64-none-linux-gnu- install 10 11# create rootfs 12cd ../ 13qemu-img create -f raw qemu_rootfs.img 128M 14# set ext4 filesystem 15mkfs.ext4 qemu_rootfs.img 16# mount on host 17mkdir mnt-tmp 18sudo mount -o loop qemu_rootfs.img ./mnt-tmp 19# copy file 20sudo cp busybox-1.35.0/_install/* mnt-tmp/ -r 21cd mnt-tmp 22# create other path 23sudo mkdir proc sys dev etc etc/init.d åœ¨etc/init.d/rcSä¸­å†™å…¥å¯åŠ¨è„šæœ¬\n1#!/bin/sh 2mount -t proc none /proc 3mount -t sysfs none /sys 4/sbin/mdev -s èµ‹äºˆrcSå¯æ‰§è¡Œæƒé™\n1sudo chmod +x rcS æ”¹ä¸ºmount -a ä¹‹åå¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨æŒ‚åœ¨/etc/fstabæ–‡ä»¶ä¸­å£°æ˜çš„æ‰€æœ‰åˆ†åŒº\nfstab åœ¨ Linux å¼€æœºä»¥åè‡ªåŠ¨é…ç½®å“ªäº›éœ€è¦è‡ªåŠ¨æŒ‚è½½çš„åˆ†åŒº\n1#device mount-point type options dump fsck order 2proc /proc proc defaults 0 0 3tmpfs /tmp tmpfs defaults 0 0 4sysfs /sys sysfs defaults 0 0 5tmpfs /dev tmpfs defaults 0 0 6debugfs /sys/kernel/debug debugfs defaults 0 0 7tracefs /sys/kernel/tracing tracefs defaults 0 0 æ·»åŠ è½¯ä»¶ perf perfå·²ç»é›†æˆåˆ°äº†Linux ä¸»åˆ†æ”¯ä¸­ï¼Œæºç çš„ä½ç½®åœ¨tools/perf\nç¼–è¯‘å‘½ä»¤:\nstrace ä¸‹è½½æºç ï¼šReleases Â· strace/strace (github.com)\nç¼–è¯‘\u0026amp;\u0026amp;å®‰è£…:\n1# ç¡®å®šç¼–è¯‘çš„å‚æ•° 2./configure \\ 3--host=aarch64-linux \\ 4--prefix=/home/soben/linux-qemu/strace-6.0/_install \\ 5--enable-mpers=no \\ 6CC=aarch64-none-linux-gnu-gcc \\ 7LD=aarch64-none-linux-gnu-ld \\ 8RANLIB=aarch64-none-linux-gnu-ranlib 9 10# ç¼–è¯‘ä¸ºé™æ€é“¾æ¥æ–¹å¼ 11make LDFLAGS+=\u0026#39;-static -pthread\u0026#39; -j16 12 13# æ‹·è´åˆ° _install ç›®å½• 14make install å¯åŠ¨ QEMU è¿è¡Œ Linux ","date":"0001-01-01T00:00:00Z","permalink":"https://wangloo.github.io/posts/os/arm64-linux-qemu/","section":"posts","tags":null,"title":""},{"categories":null,"contents":"åè¯è§£é‡Š probe ä¸€ä¸ªprobeæ˜¯ä¸€ä¸ªä½ç½®æˆ–è€…æ´»åŠ¨, åŠ¨æ€è¿½è¸ªå·¥å…·å¯ä»¥åœ¨probeä¸Šç»‘å®šä¸€äº›action. ä¾‹å¦‚è®°å½•æ ˆå¸§ä½ç½®, æŸ¥çœ‹å‚æ•°ç­‰.\nprobeå°±åƒæ˜¯ä¸€ä¸ªå¯ç¼–ç¨‹çš„ä¼ æ„Ÿå™¨, ä½ å¯ä»¥ä¸ºä»–è®¾å®šè§¦å‘çš„äº‹ä»¶æˆ–è€…æŒ‡ä»¤. å½“probe è§¦å‘æ—¶, å¯ä»¥æ‰§è¡Œä½ æå‰ç»‘å®šçš„å‡½æ•°, äº†è§£æ­¤æ—¶ç³»ç»Ÿçš„çŠ¶æ€\n","date":"0001-01-01T00:00:00Z","permalink":"https://wangloo.github.io/posts/os/trace/","section":"posts","tags":null,"title":""},{"categories":null,"contents":"Clangæ˜¯ä¸ªå•¥ Clangä¸llvm\nllvmæœ‰ä¸¤ç§å«ä¹‰ï¼šllvmæ¡†æ¶å’Œllvm Core\n llvmæ¡†æ¶å®šä¹‰äº†ä¸€ä¸ªç¼–è¯‘å™¨çš„ç»„æˆæ¶æ„ï¼Œæ­¤æ—¶Clangå¯ä»¥ä½œä¸ºæ¡†æ¶ä¸­é’ˆå¯¹C/C++è¯­è¨€çš„å‰ç«¯ã€‚ å½“ç„¶llvmæ¡†æ¶ä¹Ÿå¹¶ä¸åªæ˜¯åŒ…å«è¿™ä¸€ä¸ªå‰ç«¯ï¼Œä¹Ÿå¯ä»¥æœ‰å…¶ä»–çš„å‰ç«¯ã€‚ llvm Coreæ˜¯é™¤äº†å‰ç«¯ä¹‹å¤–çš„å…¶ä»–æ„æˆç¼–è¯‘å™¨çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ä¸­ç«¯ä¼˜åŒ–å’Œåç«¯ã€‚  Clangä¸Gcc\n Clangæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨å‰ç«¯ï¼ŒClang+llvm Core=ç¼–è¯‘å™¨ï¼ŒGccä¹Ÿæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ Clangçš„ä»£ç ç»“æ„æ›´å¥½ï¼Œæ‰©å±•æ€§å¼º  Clangd VSCodeé…ç½®Clangdè¡¥å…¨ ä¸€èˆ¬å†™Cä»£ç ï¼Œç”¨C/C++è¿™ä¸ªæ’ä»¶æ¥è¿›è¡Œè‡ªåŠ¨è¡¥å…¨ï¼Œ æ•ˆæœä¸å¤ªå¥½å› ä¸ºå®ƒæ˜¯åŸºäºä»£ç è¿›è¡Œåˆ†æï¼Œ ç†è®ºä¸Šä¸èƒ½å‡†ç¡®çš„åŒºåˆ«åŒåå‡½æ•°åˆ°åº•æ˜¯è°ƒç”¨è°çš„æƒ…å†µã€‚ è€Œä¸”åœ¨å®è·µä¸­ä¹Ÿç»å¸¸äº§ç”Ÿè«åå…¶å¦™æ‰¾ä¸åˆ°å®šä¹‰çš„æƒ…å†µã€‚\nâ€œå¬è¯´â€Clangdå¯ä»¥æ”¯æŒåŸºäºç¼–è¯‘çš„åˆ†æåšä»£ç è¡¥å…¨ï¼Œ åŸç†ä¸Šå®ƒè§£æä¸€ä¸ªè°ƒç”¨æ•°æ®åº“æ–‡ä»¶compile_commands.json æ¥åšè§£æè¡¥å…¨ã€‚\nVimé…ç½®Clangdè¡¥å…¨ æˆ‘ç›®å‰ä½¿ç”¨coc-nvimæ’ä»¶æ¥è°ƒç”¨Clangdè¿›è¡Œè¡¥å…¨ã€‚\nClangdé…ç½®æ–‡ä»¶ Clangdæ”¯æŒçš„æ‰€æœ‰é…ç½®é¡¹ï¼šhttps://clangd.llvm.org/config.html\næœ‰ä¸¤ç§æ–¹å¼å¯¹Clangdçš„é…ç½®è¿›è¡Œè®¾å®šï¼š\n å…¨å±€é…ç½® ~/.config/clangd/config.yaml å·¥ç¨‹å†…éƒ¨ .clangd ä»…åœ¨å·¥ç¨‹ç›®å½•å†…ç”Ÿæ•ˆ  ä»¥ä¸Šä¸¤ä¸ªéƒ½æ˜¯YAMLç±»å‹çš„æ–‡ä»¶ï¼Œæˆ‘ç›®å‰ä½¿ç”¨åˆ°äº†å¿½ç•¥ä¸€äº›ç¼–è¯‘å‚æ•°:\n1CompileFlags: 2 Remove: [-march=armv8-a] # invalid target CPU values in clangd-15 Clang-format ä»£ç æ ¼å¼åŒ–å·¥å…·\nReference  Clangd config   ","date":"0001-01-01T00:00:00Z","permalink":"https://wangloo.github.io/posts/tools/clang/","section":"posts","tags":null,"title":""}]